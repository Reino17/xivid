--------------------------------
Xivid notities
--------------------------------

[Reeksen en positionering]

$ xidel -se 'join(1 to 10)'
$ xidel -se 'join(for $x in 1 to 10 return $x)'
1 2 3 4 5 6 7 8 9 10

$ xidel -se 'join((1 to 10) ! .[. mod 2 eq 1])'
$ xidel -s --xquery 'join(for $x in 1 to 10 where $x mod 2 eq 1 return $x)
1 3 5 7 9

$ xidel -se 'join((1 to 10) ! .[. mod 2 eq 0])'
$ xidel -s --xquery 'join(for $x in 1 to 10 where $x mod 2 eq 0 return $x)'
2 4 6 8 10

$ xidel -se 'join((65 to 74) ! codepoints-to-string(.))'
$ xidel -se 'join((65 to 74) ! x:cps(.))'
$ xidel -se 'join(for $x in 65 to 74 return x:cps($x))'
A B C D E F G H I J

------------------------------------------------------------------------------------------------

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a)'
A B C D E F G H I J

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return $a[1]'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return head($a)'
A

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return $a[10]'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return $a[last()]'
J

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join(tail($a))'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() gt 1])'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join(subsequence($a,2))'
B C D E F G H I J

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() lt last()])'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() lt 10])'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join(subsequence($a,1,count($a) - 1))'
A B C D E F G H I

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() ne 5])'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join(remove($a,5))'
A B C D F G H I J

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() gt 3][position() lt 5])'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() = 4 to 7])'
$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join(subsequence($a,4,4))'
D E F G

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() mod 2 eq 1])'
A C E G I

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join($a[position() mod 2 eq 0])'
B D F H J

$ xidel -se 'let $a:=(65 to 74) ! x:cps(.) return join(reverse($a))'
J I H G F E D C B A

$ xidel -se 'let $a:=1 to 10 return (join($a),join($a ! x:cps(. + 64)),join(reverse($a)),join(reverse($a) ! x:cps(. + 64)))'
1 2 3 4 5 6 7 8 9 10
A B C D E F G H I J
10 9 8 7 6 5 4 3 2 1
J I H G F E D C B A

================================================================================================

[JSON filtering and selection]

$ xidel -se '
  let $a:={"a":1,"b":2} return (
    {"foo":{"bar":$a/c}},
    {"foo":{"bar":$a/c}[bar]},
    {"foo":{"bar1"?:$a/a,"bar2"?:$a/b,"bar3"?:$a/c}},
    {"foo":{"bar1"?:$a/a,"bar2"?:$a/c}},
    {"foo":{"bar"?:$a/c}},
    {"foo":[{"bar":$a/a},{"bar":$a/b},{"bar":$a/c}[bar]]},
    {"foo":[{"bar":$a/a},{"bar":$a/c}[bar]]},
    {"foo":[{"bar":$a/c}[bar]]},
    {"foo":({"bar":$a/a},{"bar":$a/b},{"bar":$a/c}[bar])},
    {"foo":({"bar":$a/a},{"bar":$a/c}[bar])},
    {"foo":({"bar":$a/c}[bar])},
    {"foo":({"bar":$a/a},{"bar":$a/b},{"bar":$a/c}[bar]) ! [.]},
    {"foo":({"bar":$a/a},{"bar":$a/c}[bar]) ! [.]},
    {"foo":({"bar":$a/c}[bar]) ! [.]},
    {"foo":let $b:=({"bar":$a/a},{"bar":$a/b},{"bar":$a/c}[bar]) return [$b]},
    {"foo":let $b:=({"bar":$a/a},{"bar":$a/c}[bar]) return [$b]},
    {"foo":let $b:=({"bar":$a/c}[bar]) return [$b]},
    {"foo":let $b:=({"bar":$a/a},{"bar":$a/b},{"bar":$a/c}[bar]) return [$b][exists($b)]},
    {"foo":let $b:=({"bar":$a/a},{"bar":$a/c}[bar]) return [$b][exists($b)]},
    {"foo":let $b:=({"bar":$a/c}[bar]) return [$b][exists($b)]}
  )
' --printed-json-format=compact
{"foo": {"bar": null}}
{"foo": null}                           # [bar] evalueert naar null, waardoor het hele object verdwijnt.
{"foo": {"bar1": 1, "bar2": 2}}         # ? is "optional pair".
{"foo": {"bar1": 1}}
{"foo": {}}                             # Geen attribute-value-pair? Dan krijg je een leeg object.
{"foo": [{"bar": 1}, {"bar": 2}]}
{"foo": [{"bar": 1}]}
{"foo": []}                             # Met blokhaken krijg je zonder één object een lege array.
{"foo": [{"bar": 1}, {"bar": 2}]}       # Met haakjes evalueert de reeks automatisch tot array.
{"foo": {"bar": 1}}                     # De reeks, uiteindelijk één object, blijft ook een object.
{"foo": null}
{"foo": [[{"bar": 1}], [{"bar": 2}]]}   # Elk object van de reeks wordt een array en dit evalueert tot weer een array.
{"foo": [{"bar": 1}]}
{"foo": null}
{"foo": [{"bar": 1}, {"bar": 2}]}       # De hele reeks wordt een array.
{"foo": [{"bar": 1}]}
{"foo": []}                             # Zonder te controleren of $b minimaal één object heeft krijg je weer een lege array.
{"foo": [{"bar": 1}, {"bar": 2}]}
{"foo": [{"bar": 1}]}
{"foo": null}                           # De enige manier voor de eis "Eén of meerdere objecten? Array. Nul objecten? null.

$ xidel -se '
  let $a:={"a":1,"b":2},
      $b:={"a":"x","b":"y"}
  return (
    {"foo":$a[b]/{"bar":b}},
    {"foo":$a[exists(b)]/{"bar":b}},
    {"foo":$b[b]/{"bar":b}},
    {"foo":$b[exists(b)]/{"bar":b}},
    {"foo":$a[c]/{"bar":c}},
    {"foo":$b[c]/{"bar":c}}
  )
' --printed-json-format=compact
{"foo": null}                           # $a[b] evalueert naar $a[2], maar er is geen 2e object, dus krijg je null.
{"foo": {"bar": 2}}                     # Als de waarde van het attribuut dat je checkt een integer is, dan is exists() vereist.
{"foo": {"bar": "y"}}                   # $b/b is een string en dus is exists() niet vereist.
{"foo": {"bar": "y"}}
{"foo": null}
{"foo": null}

================================================================================================

[Base conversions]

Decimal     (Base 10)    31 = (3*10^1)+(1*10^0)                       = 30+1       = 31
Binary      (Base  2) 11111 = (1*2^4)+(1*2^3)+(1*2^2)+(1*2^1)+(1*2^0) = 16+8+4+2+1 = 31
Hexadecimal (Base 16)    1F = (1*16^1)+(15*16^0)                      = 16+15      = 31

Dec to Bin/Hex:

$ xidel -se 'x:integer-to-base(31,2)'
11111

$ xidel -se 'x:integer-to-base(31,16)'
1F

Bin/Hex to Dec:

$ xidel -se 'x:integer("11111",2)'
$ xidel -se 'x:integer("0b11111")'
31

$ xidel -se 'x:integer("1F",16)'
$ xidel -se 'x:integer("0x1F")'
31

Bin to Hex:

$ xidel -se 'x:integer-to-base(x:integer("11111",2),16)'
$ xidel -se 'x:integer-to-base(x:integer("0b11111"),16)'
1F

Hex to Bin:

$ xidel -se 'x:integer-to-base(x:integer("1F",16),2)'
$ xidel -se 'x:integer-to-base(x:integer("0x1F"),2)'
11111

------------------------------------------------------------------------------------------------

Unsigned (32bit) Hex to Dec:

xidel -se "x:integer('0xffffff88')"
4294967176

Signed (32bit) Hex to Dec:

https://www.digital-detective.net/manual-identification-of-suspect-computer-time-zone-2/
http://core.ecu.edu/csci/wirthj/Basen/signBin-c.html
https://stackoverflow.com/q/5826818
https://stackoverflow.com/q/33629416

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Check of de decimale waarde groter is dan 2^31:

- Tel het aantal bits.

  $ xidel -se '(string-length("0xffffff88") - 2) * 4'
  $ xidel -se 'string-length("ffffff88") * 4'
  32

  x4, want F_16 is 1111_2 (4 bits):
  $ xidel -se 'x:integer-to-base(x:integer("0xf"),2)'
  1111

- Converteer als unsigned 32bit Hex en trek daar 2^(aantal bits) van af.

  $ xidel -se 'math:pow(2,(string-length("0xffffff88") - 2) * 4)'
  4.294967296E9

  $ xidel -se 'integer(math:pow(2,(string-length("0xffffff88") - 2) * 4))'
  4294967296

  $ xidel -se 'x:integer("0xffffff88") - integer(math:pow(2,(string-length("0xffffff88") - 2) * 4))'
  -120

- Dit geldt alleen voor 0x80000000 en hoger. Converteer 0x7fffffff en lager als unsigned 32bit Hex!

  $ xidel -se 'x:integer("0x80000000")'
  2147483648

  $ xidel -se 'integer(math:pow(2,(string-length("0x80000000") - 2) * 4 - 1))'
  2147483648   # 2^31

  $ xidel -se 'integer(math:pow(2,(string-length("0x80000000") - 2) * 4)) div 2'
  2147483648

  $ xidel -se 'let $a:=x:integer("0x80000000"),$b:=integer(math:pow(2,(string-length("0x80000000") - 2) * 4)) return if ($a gt $b div 2) then $a - $b else $a'
  -2147483648

  $ xidel -se 'let $a:=x:integer("0x7fffffff"),$b:=integer(math:pow(2,(string-length("0x7fffffff") - 2) * 4)) return if ($a gt $b div 2) then $a - $b else $a'
  2147483647

  $ xidel -se 'let $a:=x:integer("0xffffff88"),$b:=integer(math:pow(2,(string-length("0xffffff88") - 2) * 4)) return if ($a gt $b div 2) then $a - $b else $a'
  -120

$ xidel -se 'declare function local:shex-to-dec($shex as string) as integer {let $a:=x:integer($shex),$b:=integer(math:pow(2,(string-length($shex) - 2) * 4)) return if ($a gt $b div 2) then $a - $b else $a}; local:shex-to-dec("0xffffff88")'
-120

declare function xivid:shex-to-dec($shex as string) as integer {
  let $a:=x:integer($shex),
      $b:=integer(math:pow(2,(string-length($shex) - 2) * 4))
  return
  if ($a gt $b div 2) then
    $a - $b
  else
    $a
};

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Check of de hoeveelheid bits groter is dan 31:

- Tel het aantal bits.

  $ xidel -se 'x:integer-to-base(x:integer("0xffffff88"),2)'
  11111111111111111111111110001000

  $ xidel -se 'string-length(x:integer-to-base(x:integer("0xffffff88"),2))'
  32

- Converteer als unsigned 32bit Hex en trek daar 2^(aantal bits) van af.

  $ xidel -se 'math:pow(2,string-length(x:integer-to-base(x:integer("0xffffff88"),2)))'
  4.294967296E9

  $ xidel -se 'integer(math:pow(2,string-length(x:integer-to-base(x:integer("0xffffff88"),2))))'
  4294967296

  $ xidel -se 'let $a:=x:integer("0xffffff88") return $a - integer(math:pow(2,string-length(x:integer-to-base($a,2))))'
  -120

- Dit geldt alleen voor 0x80000000 en hoger. Converteer 0x7fffffff en lager als unsigned 32bit Hex!

  $ xidel -se 'x:integer-to-base(x:integer("0x80000000"),2)'
  10000000000000000000000000000000

  $ xidel -se 'x:integer-to-base(x:integer("0x7fffffff"),2)'
  1111111111111111111111111111111

  $ xidel -se 'let $a:=x:integer("0x80000000"),$b:=x:integer-to-base($a,2) return if (string-length($b) gt 31) then $a - integer(math:pow(2,string-length($b))) else $a'
  -2147483648

  $ xidel -se 'let $a:=x:integer("0x7fffffff"),$b:=x:integer-to-base($a,2) return if (string-length($b) gt 31) then $a - integer(math:pow(2,string-length($b))) else $a'
  2147483647   # 2^31

  $ xidel -se 'let $a:=x:integer("0xffffff88"),$b:=x:integer-to-base($a,2) return if (string-length($b) gt 31) then $a - integer(math:pow(2,string-length($b))) else $a'
  -120

$ xidel -se 'declare function local:shex-to-dec($shex as string) as integer {let $a:=x:integer($shex),$b:=x:integer-to-base($a,2) return if (string-length($b) gt 31) then $a - integer(math:pow(2,string-length($b))) else $a}; local:shex-to-dec("0xffffff88")'
-120

declare function xivid:shex-to-dec($shex as string) as integer {
  let $a:=x:integer($shex),
      $b:=x:integer-to-base($a,2)
  return
  if (string-length($b) gt 31) then
    $a - integer(math:pow(2,string-length($b)))
  else
    $a
};

------------------------------------------------------------------------------------------------

Genereer een willekeurig 128bit hexadecimaal getal:

$ xidel -se 'join((1 to 32))'
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32

$ xidel -se 'random-seed(),join((1 to 32) ! random(16))'
8 5 3 4 15 0 13 7 15 2 7 3 13 1 10 8 6 7 11 5 5 8 9 3 11 5 5 1 10 8 0 1

$ xidel -se 'random-seed(),join((1 to 32) ! x:integer-to-base(random(16),16))'
8 5 3 4 F 0 D 7 F 2 7 3 D 1 A 8 6 7 B 5 5 8 9 3 B 5 5 1 A 8 0 1

$ xidel -se 'random-seed(),string-join((1 to 32) ! x:integer-to-base(random(16),16))'
8534F0D7F273D1A867B55893B551A801

------------------------------------------------------------------------------------------------

Base64:

https://en.wikipedia.org/wiki/Base64

$ xidel -se 'string-to-base64Binary("Xivid")'
WGl2aWQ=

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

String to Base64 (zonder string-to-base64Binary() ):

----------------------------------------------------------------

Base64 tekens:

$ xidel -se 'string-join((for $x in (65 to 90,97 to 122,48 to 57) return x:cps($x),"+","/"))'
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/
|        65 t/m 90       ||        97 t/m 122      ||48 t/m57|     # Codepoints in ASCII tabel.
0                                                              63  # 64 tekens, range: 0-63.

Principe:

X        i        v        i        d                  # van teken
88       105      118      105      100                # naar codepoint/decimaal
01011000 01101001 01110110 01101001 01100100           # naar binair
010110 000110 100101 110110 011010 010110 0100[00]     # opdelen in groepjes van 6 bits
22     6      37     54     26     22     16           # naar decimaal/codepoint
W      G      l      2      a      W      Q        =   # naar base64 met eventuele padding

----------------------------------------------------------------

$ xidel -se 'join(string-to-codepoints("Xivid"))'
$ xidel -se 'join(x:cps("Xivid"))'
88 105 118 105 100

$ xidel -se 'join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2)))'
01011000 01101001 01110110 01101001 01100100

$ xidel -se 'string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2)))'
0101100001101001011101100110100101100100

Deze string moet opgedeeld worden in substrings met een lengte van 6 tekens.

$ xidel -se 'let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) return substring($bin,1,6)'
010110

$ xidel -se 'let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) return substring($bin,37,6)'
0100

Dus opdelen op de indexes 1, 7, 13, 19, 25, 31, 37.

$ xidel -se 'let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) return join((1 to string-length($bin)) ! .[. mod 6 eq 1])'
$ xidel -s --xquery 'let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) return join(for $x in 1 to string-length($bin) where $x mod 6 eq 1 return $x)'
1 7 13 19 25 31 37

$ xidel -s --xquery 'join(let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 return substring($bin,$x,6))'
010110 000110 100101 110110 011010 010110 0100

De binaire getallen dienen altijd 6 bits te bevatten.

$ xidel -s --xquery 'join(let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 let $a:=substring($bin,$x,6) return substring($a||"0000",1,6))'
010110 000110 100101 110110 011010 010110 010000

De extra nullen worden later als padding (=) toegevoegd. 00 wordt =, 0000 wordt ==.

$ xidel -s --xquery 'join(let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 let $a:=substring($bin,$x,6) return string-length($a))'
6 6 6 6 6 6 4

$ xidel -s --xquery 'join(let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 let $a:=substring($bin,$x,6) return (1 to (6 - string-length($a)[. ne 6]) div 2) ! "=")'
=

$ xidel -s --xquery 'join(let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 let $a:=substring($bin,$x,6) return (substring($a||"0000",1,6),(1 to (6 - string-length($a)[. ne 6]) div 2) ! "="))'
010110 000110 100101 110110 011010 010110 010000 =

$ xidel -s --xquery 'join(let $bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 let $a:=substring($bin,$x,6) return (x:integer(substring($a||"0000",1,6),2),(1 to (6 - string-length($a)[. ne 6]) div 2) ! "="))'
22 6 37 54 26 22 16 =

$ xidel -s --xquery 'join(let $base64:=(for $x in (65 to 90,97 to 122,48 to 57) return codepoints-to-string($x),"+","/"),$bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 let $a:=substring($bin,$x,6) return ($base64[x:integer(substring($a||"0000",1,6),2) + 1],(1 to (6 - string-length($a)[. ne 6]) div 2) ! "="))'
W G l 2 a W Q =

$ xidel -s --xquery 'string-join(let $base64:=(for $x in (65 to 90,97 to 122,48 to 57) return codepoints-to-string($x),"+","/"),$bin:=string-join(x:cps("Xivid") ! ("0"||x:integer-to-base(.,2))) for $x in 1 to string-length($bin) where $x mod 6 eq 1 let $a:=substring($bin,$x,6) return ($base64[x:integer(substring($a||"0000",1,6),2) + 1],(1 to (6 - string-length($a)[. ne 6]) div 2) ! "="))'
WGl2aWQ=

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Base64 to string:

$ xidel -se 'binary-to-string(base64Binary("WGl2aWQ="))'
Xivid

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

File to Base64:

$ xidel -se 'file:read-binary("nl.png")'   # Nederlandse vlag van 18 bij 12 pixels.
iVBORw0KGgoAAAANSUhEUgAAABIAAAAMCAIAAADgcHrrAAAAG0lEQVQoz2P4z8BABmIYGtrIAkND21CJAjIQAF2WZqj5EZlfAAAAAElFTkSuQmCC

File to Base64 (html):

$ xidel -s --xquery 'concat("<img src=&quot;data:image/png;base64,",file:read-binary("nl.png"),"&quot;>")'
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAMCAIAAADgcHrrAAAAG0lEQVQoz2P4z8BABmIYGtrIAkND21CJAjIQAF2WZqj5EZlfAAAAAElFTkSuQmCC">

Base64 to file:

$ xidel -se 'file:write-binary("nl.png",base64Binary("iVBORw0KGgoAAAANSUhEUgAAABIAAAAMCAIAAADgcHrrAAAAG0lEQVQoz2P4z8BABmIYGtrIAkND21CJAjIQAF2WZqj5EZlfAAAAAElFTkSuQmCC"))'

================================================================================================

[Exclusieve disjunctie (exclusive or / xor)]

Zolang Xidel de "EXPath Binary Module" (met bin:xor()) niet aan boord heeft is een zelfgemaakte functie nodig.
Zie https://github.com/benibela/xidel/issues/54.

$ echo $((33 ^ 73))
104

$ xidel -se 'let $a:=33,$b:=73 return system(x"bash -c ""printf $(({$a} ^ {$b}))""")'
104

33_10  = 0100001_2
73_10  = 1001001_2
         ------- XOR
104_10 = 1101000_2 # Output is alleen 1 als input 0 én 1 of 1 én 0 is.

$ xidel -se '(33,73) ! x:integer-to-base(.,2)'
100001
1001001

$ xidel -se 'let $bin:=(33,73) ! x:integer-to-base(.,2) return $bin ! string-length()'
6
7

$ xidel -se 'let $bin:=(33,73) ! x:integer-to-base(.,2) return max($bin ! string-length())'
7

$ xidel -se 'let $bin:=(33,73) ! x:integer-to-base(.,2),$len:=max($bin ! string-length()) return $bin ! concat(string-join((1 to $len - string-length()) ! 0),.)'
0100001
1001001

$ xidel -se 'let $bin:=(33,73) ! x:integer-to-base(.,2),$len:=max($bin ! string-length()),$val:=$bin ! concat(string-join((1 to $len - string-length()) ! 0),.) return string-join(for $x in 1 to $len return if (substring($val[1],$x,1) eq substring($val[2],$x,1)) then 0 else 1)'
1101000

$ xidel -se 'let $bin:=(33,73) ! x:integer-to-base(.,2),$len:=max($bin ! string-length()),$val:=$bin ! concat(string-join((1 to $len - string-length()) ! 0),.) return x:integer(string-join(for $x in 1 to $len return if (substring($val[1],$x,1) eq substring($val[2],$x,1)) then 0 else 1),2)'
104

$ xidel -se 'declare function local:bin-xor($a,$b){let $bin:=($a,$b) ! x:integer-to-base(.,2),$len:=max($bin ! string-length()),$val:=$bin ! concat(string-join((1 to $len - string-length()) ! 0),.) return x:integer(string-join(for $x in 1 to $len return if (substring($val[1],$x,1) eq substring($val[2],$x,1)) then 0 else 1),2)}; local:bin-xor(33,73)'
104

------------------------------------------------------------------------------------------------

$ time xidel -se 'declare function local:bin-xor($a,$b){let $bin:=($a,$b) ! x:integer-to-base(.,2),$len:=max($bin ! string-length()),$val:=$bin ! concat(string-join((1 to $len - string-length()) ! 0),.) return x:integer(string-join(for $x in 1 to $len return if (substring($val[1],$x,1) eq substring($val[2],$x,1)) then 0 else 1),2)}; ((1 to 100000) ! local:bin-xor(33,73))[1]'
104

real    0m25.563s
user    0m0.015s
sys     0m0.015s

$ time xidel -se 'declare function local:bin-xor($a,$b){let $bin:=($a,$b) ! x:integer-to-base(.,2),$len:=max($bin ! string-length()),$val:=$bin ! concat(string-join((1 to $len - string-length()) ! 0),.),$v1:=$val[1],$v2:=$val[2] return x:integer(string-join(for $x in 1 to $len return if (substring($v1,$x,1) eq substring($v2,$x,1)) then 0 else 1),2)}; ((1 to 100000) ! local:bin-xor(33,73))[1]'
104

real    0m23.109s
user    0m0.015s
sys     0m0.000s

let $v1:=$val[1] return substring($v1,$x,1)
...is dus iets sneller dan...
substring($val[1],$x,1)

------------------------------------------------------------------------------------------------

declare function xivid:bin-xor($a as integer,$b as integer) as integer {
  let $bin:=($a,$b) ! x:integer-to-base(.,2),
      $len:=max($bin ! string-length()),
      $val:=$bin ! concat(
        string-join((1 to $len - string-length()) ! 0),
        .
      ),
      $v1:=$val[1],
      $v2:=$val[2]
  return
  x:integer(
    string-join(
      for $x in 1 to $len return
      if (substring($v1,$x,1) eq substring($v2,$x,1)) then 0 else 1
    ),
    2
  )
};

================================================================================================

[Codepoints en tekensets]

https://nl.wikipedia.org/wiki/ASCII_%28tekenset%29
https://nl.wikipedia.org/wiki/ISO_8859-1
https://en.wikipedia.org/wiki/Control_character

ASCII 7bit (2^7=128), 0 t/m 127:

- 0 t/m 127 in 16 rijen van 8.

  $ xidel -se 'for $x in 0 to 15 return join((0 to 127)[. mod 16 eq $x])'
  0 16 32 48 64 80 96 112
  1 17 33 49 65 81 97 113
  2 18 34 50 66 82 98 114
  3 19 35 51 67 83 99 115
  4 20 36 52 68 84 100 116
  5 21 37 53 69 85 101 117
  6 22 38 54 70 86 102 118
  7 23 39 55 71 87 103 119
  8 24 40 56 72 88 104 120
  9 25 41 57 73 89 105 121
  10 26 42 58 74 90 106 122
  11 27 43 59 75 91 107 123
  12 28 44 60 76 92 108 124
  13 29 45 61 77 93 109 125
  14 30 46 62 78 94 110 126
  15 31 47 63 79 95 111 127

- Uitlijnen. I.p.v. if ((. eq 0) or (. eq 1) or ...) then... geeft een vergelijking met een reeks ook een boolean.

  $ xidel -se 'for $x in 0 to 15 return join((0 to 127)[. mod 16 eq $x] ! (if (. = (0 to 9,96 to 99)) then " "||. else .))'
   0 16 32 48 64 80  96 112
   1 17 33 49 65 81  97 113
   2 18 34 50 66 82  98 114
   3 19 35 51 67 83  99 115
   4 20 36 52 68 84 100 116
   5 21 37 53 69 85 101 117
   6 22 38 54 70 86 102 118
   7 23 39 55 71 87 103 119
   8 24 40 56 72 88 104 120
   9 25 41 57 73 89 105 121
  10 26 42 58 74 90 106 122
  11 27 43 59 75 91 107 123
  12 28 44 60 76 92 108 124
  13 29 45 61 77 93 109 125
  14 30 46 62 78 94 110 126
  15 31 47 63 79 95 111 127

- Hexadecimale getallen erbij, met | als scheiding en een extra 0 voor 0 t/m 9.

  $ xidel -se 'for $x in 0 to 15 return join((0 to 127)[. mod 16 eq $x] ! (concat(if (. = (0 to 9,96 to 99)) then " "||. else .,"|",x:integer-to-base(.,16) ! (if (string-length(.) eq 1) then "0"||. else .))))'
   0|00 16|10 32|20 48|30 64|40 80|50  96|60 112|70
   1|01 17|11 33|21 49|31 65|41 81|51  97|61 113|71
   2|02 18|12 34|22 50|32 66|42 82|52  98|62 114|72
   3|03 19|13 35|23 51|33 67|43 83|53  99|63 115|73
   4|04 20|14 36|24 52|34 68|44 84|54 100|64 116|74
   5|05 21|15 37|25 53|35 69|45 85|55 101|65 117|75
   6|06 22|16 38|26 54|36 70|46 86|56 102|66 118|76
   7|07 23|17 39|27 55|37 71|47 87|57 103|67 119|77
   8|08 24|18 40|28 56|38 72|48 88|58 104|68 120|78
   9|09 25|19 41|29 57|39 73|49 89|59 105|69 121|79
  10|0A 26|1A 42|2A 58|3A 74|4A 90|5A 106|6A 122|7A
  11|0B 27|1B 43|2B 59|3B 75|4B 91|5B 107|6B 123|7B
  12|0C 28|1C 44|2C 60|3C 76|4C 92|5C 108|6C 124|7C
  13|0D 29|1D 45|2D 61|3D 77|4D 93|5D 109|6D 125|7D
  14|0E 30|1E 46|2E 62|3E 78|4E 94|5E 110|6E 126|7E
  15|0F 31|1F 47|2F 63|3F 79|4F 95|5F 111|6F 127|7F

- Tekens erbij, maar vervang 0, 7, 8, 9, 10 en 13 met spaties, omdat dit beheertekens (control characters) betreft.

  $ xidel -se 'for $x in 0 to 15 return join((0 to 127)[. mod 16 eq $x] ! (concat(if (. = (0 to 9,96 to 99)) then " "||. else .,"|",x:integer-to-base(.,16) ! (if (string-length(.) eq 1) then "0"||. else .)),if (. = (0,7,8,9,10,13)) then " " else x:cps(.)))'
   0|00   16|10 ► 32|20   48|30 0 64|40 @ 80|50 P  96|60 ` 112|70 p
   1|01 ☺ 17|11 ◄ 33|21 ! 49|31 1 65|41 A 81|51 Q  97|61 a 113|71 q
   2|02 ☻ 18|12 ↕ 34|22 " 50|32 2 66|42 B 82|52 R  98|62 b 114|72 r
   3|03 ♥ 19|13 ‼ 35|23 # 51|33 3 67|43 C 83|53 S  99|63 c 115|73 s
   4|04 ♦ 20|14 ¶ 36|24 $ 52|34 4 68|44 D 84|54 T 100|64 d 116|74 t
   5|05 ♣ 21|15 § 37|25 % 53|35 5 69|45 E 85|55 U 101|65 e 117|75 u
   6|06 ♠ 22|16 ▬ 38|26 & 54|36 6 70|46 F 86|56 V 102|66 f 118|76 v
   7|07   23|17 ↨ 39|27 ' 55|37 7 71|47 G 87|57 W 103|67 g 119|77 w
   8|08   24|18 ↑ 40|28 ( 56|38 8 72|48 H 88|58 X 104|68 h 120|78 x
   9|09   25|19 ↓ 41|29 ) 57|39 9 73|49 I 89|59 Y 105|69 i 121|79 y
  10|0A   26|1A → 42|2A * 58|3A : 74|4A J 90|5A Z 106|6A j 122|7A z
  11|0B ♂ 27|1B ← 43|2B + 59|3B ; 75|4B K 91|5B [ 107|6B k 123|7B {
  12|0C ♀ 28|1C ∟ 44|2C , 60|3C < 76|4C L 92|5C \ 108|6C l 124|7C |
  13|0D   29|1D ↔ 45|2D - 61|3D = 77|4D M 93|5D ] 109|6D m 125|7D }
  14|0E ♫ 30|1E ▲ 46|2E . 62|3E > 78|4E N 94|5E ^ 110|6E n 126|7E ~
  15|0F ☼ 31|1F ▼ 47|2F / 63|3F ? 79|4F O 95|5F _ 111|6F o 127|7F ⌂

ALT+<cp> voor weergave (Windows).   # ALT 1 of ALT 127.
&#<cp>; / &#x<hex> voor HTML.       # &#1; / &#x01; of &#127; / &#x7F;.
\x<hex> voor Javascript.            # \x01 of \x7F.
\u00<hex> voor JSON.                # \u0001 of \u007F.

- De beheertekens (control characters).

 0|NUL \0 &#0;  null
 7|BEL \a &#7;  bell
 8|BS  \b &#8;  backspace
 9|HT  \t &#9;  horizontal tab
10|LF  \n &#10; line feed
13|CR  \r &#13; carriage return

------------------------------------------------------------------------------------------------

Extended ASCII 8bit (2^8=256), 127 t/m 255:

- ISO 8859-1 / Latin-1 / "Unicode" in charmap.exe (Character Map).

  $ xidel -se 'for $x in 0 to 15 return join((128 to 255)[. mod 16 eq $x] ! (concat(.,"|",x:integer-to-base(.,16)),x:cps(.)))' [--output-encoding=oem]
  $ xidel -se 'for $x in 0 to 15 return join((128 to 255)[. mod 16 eq $x] ! (concat(.,"|",x:integer-to-base(.,16)),binary-to-string(xs:hexBinary(x:integer-to-base(.,16)),"latin1")))'
  128|80 ? 144|90 ? 160|A0   176|B0 ° 192|C0 A 208|D0 D 224|E0 à 240|F0 d
  129|81 ? 145|91 ? 161|A1 ¡ 177|B1 ± 193|C1 A 209|D1 Ñ 225|E1 á 241|F1 ñ
  130|82 ? 146|92 ? 162|A2 ¢ 178|B2 ² 194|C2 A 210|D2 O 226|E2 â 242|F2 ò
  131|83 ? 147|93 ? 163|A3 £ 179|B3 3 195|C3 A 211|D3 O 227|E3 a 243|F3 ó
  132|84 ? 148|94 ? 164|A4 ☼ 180|B4 ' 196|C4 Ä 212|D4 O 228|E4 ä 244|F4 ô
  133|85 ? 149|95 ? 165|A5 ¥ 181|B5 µ 197|C5 Å 213|D5 O 229|E5 å 245|F5 o
  134|86 ? 150|96 ? 166|A6 ▌ 182|B6 ¶ 198|C6 Æ 214|D6 Ö 230|E6 æ 246|F6 ö
  135|87 ? 151|97 ? 167|A7 § 183|B7 · 199|C7 Ç 215|D7 x 231|E7 ç 247|F7 ÷
  136|88 ? 152|98 ? 168|A8 " 184|B8 , 200|C8 E 216|D8 O 232|E8 è 248|F8 o
  137|89 ? 153|99 ? 169|A9 c 185|B9 1 201|C9 É 217|D9 U 233|E9 é 249|F9 ù
  138|8A ? 154|9A ? 170|AA ª 186|BA º 202|CA E 218|DA U 234|EA ê 250|FA ú
  139|8B ? 155|9B ? 171|AB « 187|BB » 203|CB E 219|DB U 235|EB ë 251|FB û
  140|8C ? 156|9C ? 172|AC ¬ 188|BC ¼ 204|CC I 220|DC Ü 236|EC ì 252|FC ü
  141|8D ? 157|9D ? 173|AD - 189|BD ½ 205|CD I 221|DD Y 237|ED í 253|FD y
  142|8E ? 158|9E ? 174|AE r 190|BE _ 206|CE I 222|DE _ 238|EE î 254|FE _
  143|8F ? 159|9F ? 175|AF _ 191|BF ¿ 207|CF I 223|DF ß 239|EF ï 255|FF ÿ

  128 t/m 159 zijn beheertekens. ANSI / Windows-1252 / "Windows: Western" in charmap.exe heeft deze vervangen met de volgende grafische tekens:

    128|80 € 144|90 
    129|81   145|91 ‘
    130|82 ‚ 146|92 ’
    131|83 ƒ 147|93 “
    132|84 „ 148|94 ”
    133|85 … 149|95 •
    134|86 † 150|96 –
    135|87 ‡ 151|97 —
    136|88 ˆ 152|98 ˜
    137|89 ‰ 153|99 ™
    138|8A Š 154|9A š
    139|8B ‹ 155|9B ›
    140|8C Œ 156|9C œ
    141|8D   157|9D 
    142|8E Ž 158|9E ž
    143|8F   159|9F Ÿ

  "latin1" heeft ze dus niet, maar het "Raster Fonts" in CMD (en dus Cygwin Bash) ondersteunt ze ook niet.

  Geldige opties voor $encoding: utf8, utf-32le, oem, utf-8, latin1, utf-16, utf-16be, utf-32be, utf-32.

ALT+0<cp> voor weergave (Windows).   # ALT 0163 of ALT 0255.
&#<cp>; / &#x<hex> voor HTML.        # &#163; / &#xA3; of &#255; / &#xFF;.
\x<hex> voor Javascript.             # \xA3 of \xFF.
\u00<hex> voor JSON.                 # \u00A3 of \u00FF.

- Code page 437 / CP437 / OEM-US / "DOS: United States" in charmap.exe.

  $ xidel -se 'for $x in 0 to 15 return join((128 to 255)[. mod 16 eq $x] ! (concat(.,"|",x:integer-to-base(.,16)),x:cps(.)))' --output-encoding=latin1
  $ xidel -se 'for $x in 0 to 15 return join((128 to 255)[. mod 16 eq $x] ! (concat(.,"|",x:integer-to-base(.,16)),binary-to-string(xs:hexBinary(x:integer-to-base(.,16)),"oem")))'
  128|80 Ç 144|90 É 160|A0 á 176|B0 ░ 192|C0 └ 208|D0 ╨ 224|E0 α 240|F0 ≡
  129|81 ü 145|91 æ 161|A1 í 177|B1 ▒ 193|C1 ┴ 209|D1 ╤ 225|E1 ß 241|F1 ±
  130|82 é 146|92 Æ 162|A2 ó 178|B2 ▓ 194|C2 ┬ 210|D2 ╥ 226|E2 Γ 242|F2 ≥
  131|83 â 147|93 ô 163|A3 ú 179|B3 │ 195|C3 ├ 211|D3 ╙ 227|E3 π 243|F3 ≤
  132|84 ä 148|94 ö 164|A4 ñ 180|B4 ┤ 196|C4 ─ 212|D4 ╘ 228|E4 Σ 244|F4 ⌠
  133|85 à 149|95 ò 165|A5 Ñ 181|B5 ╡ 197|C5 ┼ 213|D5 ╒ 229|E5 σ 245|F5 ⌡
  134|86 å 150|96 û 166|A6 ª 182|B6 ╢ 198|C6 ╞ 214|D6 ╓ 230|E6 µ 246|F6 ÷
  135|87 ç 151|97 ù 167|A7 º 183|B7 ╖ 199|C7 ╟ 215|D7 ╫ 231|E7 τ 247|F7 ≈
  136|88 ê 152|98 ÿ 168|A8 ¿ 184|B8 ╕ 200|C8 ╚ 216|D8 ╪ 232|E8 Φ 248|F8 °
  137|89 ë 153|99 Ö 169|A9 ⌐ 185|B9 ╣ 201|C9 ╔ 217|D9 ┘ 233|E9 Θ 249|F9 ∙
  138|8A è 154|9A Ü 170|AA ¬ 186|BA ║ 202|CA ╩ 218|DA ┌ 234|EA Ω 250|FA ·
  139|8B ï 155|9B ¢ 171|AB ½ 187|BB ╗ 203|CB ╦ 219|DB █ 235|EB δ 251|FB √
  140|8C î 156|9C £ 172|AC ¼ 188|BC ╝ 204|CC ╠ 220|DC ▄ 236|EC ∞ 252|FC ⁿ
  141|8D ì 157|9D ¥ 173|AD ¡ 189|BD ╜ 205|CD ═ 221|DD ▌ 237|ED φ 253|FD ²
  142|8E Ä 158|9E ₧ 174|AE « 190|BE ╛ 206|CE ╬ 222|DE ▐ 238|EE ε 254|FE ■
  143|8F Å 159|9F ƒ 175|AF » 191|BF ┐ 207|CF ╧ 223|DF ▀ 239|EF ∩ 255|FF  

  CMD (en dus Cygwin Bash) is standaard afgesteld op CHCP 437 (oem). Hierdoor krijg je dit rare tafereel dat --output-encoding precies andersom werkt.

ALT+<cp> voor weergave (Windows).   # ALT 128 of ALT 253.

================================================================================================

[Epoch/tijd/tijdzone conversies]

"The Unix epoch (or Unix time or POSIX time or Unix timestamp) is the number of seconds that have elapsed since January 1, 1970." (https://www.epochconverter.com/)

$ date -d 2019-07-01T01:00:00 +%s
1561935600

$ date -d @1561935600 +%FT%T
$ printf '%(%FT%T)T\n' 1561935600
2019-07-01T01:00:00

$ date -d @1561935600 +%d-%m-%Y
$ printf '%(%d-%m-%Y)T\n' 1561935600
01-07-2019

$ xidel -se '1561935600 * duration("PT1S") + dateTime("1970-01-01T00:00:00")'
2019-06-30T23:00:00   # UTC tijd.

I.t.t date/printf geeft Xidel bij het converteren van epoch naar datetime de UTC tijd weer.
Je zult dus zelf de lokale tijdzone er in moeten verwerken.

$ date +%:z
+02:00   # UTC+2 (GMT+2), zomertijd in Nederland.

$ xidel -se 'time("00:00:00") - time("00:00:00'$(date +%:z)'")'   # Was nodig vóórdat implicit-timezone() werkte.
$ xidel -se 'implicit-timezone()'   # xidel-0.9.9.7433-8b7ba70 en nieuwer.
PT2H   # Tijdzone als dayTimeDuration().

$ xidel -se '1561935600 * duration("PT1S") + implicit-timezone() + dateTime("1970-01-01T00:00:00")'
2019-07-01T01:00:00   # UTC+2 zonder tijdzone.

----------------------------------------------------------------

$ xidel -se 'adjust-dateTime-to-timezone(dateTime("1970-01-01T00:00:00"),implicit-timezone())'
1970-01-01T00:00:00+02:00

$ xidel -se '1561935600 * duration("PT1S") + implicit-timezone() + adjust-dateTime-to-timezone(dateTime("1970-01-01T00:00:00"),implicit-timezone())'
2019-07-01T01:00:00+02:00   # UTC+2 met tijdzone.

----------------------------------------------------------------

$ xidel -se 'format-date(1561935600 * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]")'
01-07-2019

$ xidel -se '(dateTime("2019-07-01T01:00:00") - dateTime("1970-01-01T00:00:00") - implicit-timezone()) div dayTimeDuration("PT1S")'
1561935600

Voor een deling is expliciet dayTimeDuration() nodig. Zie https://sourceforge.net/p/videlibri/mailman/videlibri-xidel/thread/7e952f3d-18d5-ede8-17df-8480b2594b7c%40benibela.de/#msg36722060.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Bij het weergeven van de actuele tijd is Xidel wel bewust van de tijdzone.

$ xidel -se '"'$(date +%FT%T)'",current-dateTime()'
2020-07-31T19:15:50
2020-07-31T19:15:50.687+02:00

------------------------------------------------------------------------------------------------

Aanroepen externe programma's:

$ xidel -se 'let $a:=1561935600 return [system(x"date -d @{$a} +%FT%T")]'
["2019-07-01T01:00:00\n"]

$ xidel -se 'let $a:=1561935600 return [replace(system(x"date -d @{$a} +%FT%T"),"\n","")]'
$ xidel -se 'let $a:=1561935600 return [x:lines(system(x"date -d @{$a} +%FT%T"))[1]]'
["2019-07-01T01:00:00"]

Date, zoals bijna elk programma, voegt een nieuwe regel (Unix:'\n', Windows:'\r\n') toe aan het einde.

$ xidel -se         'let $a:=1561935600 return system(x"bash -c ""echo -n $(date -d @{$a} +%FT%T)""")'
$ xidel -se         'let $a:=1561935600 return system(x"bash -c ""printf '\''%(%FT%T)T'\'' {$a}""")'
$ xidel -se         'let $a:=1561935600 return system(x"bash -c ""printf """"%(%FT%T)T"""" {$a}""")'
$ xidel -s --xquery 'let $a:=1561935600 return system(x"bash -c ""printf &apos;%(%FT%T)T&apos; {$a}""")'
2019-07-01T01:00:00

Printf en echo (met de '-n' optie) voegen geen nieuwe regel toe.
I.t.t. date zijn printf en echo geen programma's, maar functies van Bash, waardoor ze d.m.v. een nieuwe aanroep van bash aangeroepen moeten worden.

------------------------------------------------------------------------------------------------

Tekst naar datum:

$ xidel -se 'x:parse-date("17 february 2019  7:45","dd mmmm yyyy")'
2019-02-17

$ xidel -se 'x:parse-dateTime("17 february 2019  7:45","dd mmmm yyyy  h:nn")'
2019-02-17T07:45:00

Het Pascal format (https://www.freepascal.org/docs-html/rtl/sysutils/formatchars.html) komt heel precies,
MAAR Xidel ondersteunt (op dit moment) alleen Engels en Duits:

$ xidel -se 'x:parse-date("17 februari 2019  7:45","dd mmmm yyyy")'
Error:
err:FORG0001: Invalid conversion from 17 februari 2019  7:45 to date format dd mmmm yyyy

Het kan ook handmatig:

$ xidel -se 'tokenize("17 februari 2019  7:45","\s+")'
17
februari
2019
7:45

$ xidel -se 'extract("17 februari 2019  7:45","(\d+)\s+([a-z]+)\s+(\d{4})",(1 to 3))'
17
februari
2019

$ xidel -se 'let $a:={"januari":"01","februari":"02","maart":"03","april":"04","mei":"05","juni":"06","juli":"07","augustus":"08","september":"09","oktober":"10","november":"11","december":"12"},$b:=extract("17 februari 2019  7:45","(\d+)\s+([a-z]+)\s+(\d{4})",(1 to 3)) return (if ($b[1] lt 10) then "0"||$b[1] else $b[1],$a($b[2]),$b[3])'
17
02
2019

$ xidel -se 'let $a:={"januari":"01","februari":"02","maart":"03","april":"04","mei":"05","juni":"06","juli":"07","augustus":"08","september":"09","oktober":"10","november":"11","december":"12"},$b:=extract("17 februari 2019  7:45","(\d+)\s+([a-z]+)\s+(\d{4})",(1 to 3)) return join((if ($b[1] lt 10) then "0"||$b[1] else $b[1],$a($b[2]),$b[3]),"-")'
17-02-2019

declare function xivid:txt-to-date($txt as string) as string {
  let $a:={
        "januari":"01","februari":"02","maart":"03",
        "april":"04","mei":"05","juni":"06",
        "juli":"07","augustus":"08","september":"09",
        "oktober":"10","november":"11","december":"12"
      },
      $b:=extract($txt,"(\d+)\s+([a-z]+)\s+(\d{4})",(1 to 3))
  return
  join(
    (
      if ($b[1] lt 10) then "0"||$b[1] else $b[1],
      $a($b[2]),
      $b[3]
    ),
    "-"
  )
};

------------------------------------------------------------------------------------------------

Afronden:

$ xidel -se 'format-time(time("00:19:06.040"),"[H01]:[m01]:[s01]")'
00:19:06

$ xidel -se 'format-time(time("00:19:06.540"),"[H01]:[m01]:[s01]")'
00:19:06

$ xidel -se 'format-time(time("00:19:06.540") + duration("PT0.5S"),"[H01]:[m01]:[s01]")'
00:19:07

================================================================================================

[Batch escape characters voor prettification]

https://www.robvanderwoude.com/escapechars.php

Query (Unix quoting):

-e '
  let $a:=string-join(
        tokenize($raw) ! x:integer-to-base(.,16)
      ),
      $b:=x:integer($a,16)
  return
  concat("<^| ",$a," & ",$b," |%>")
'

Query (Windows quoting):

-e "
  let $a:=string-join(
        tokenize($raw) ! x:integer-to-base(.,16)
      ),
      $b:=x:integer($a,16)
  return
  concat('<^| ',$a,' & ',$b,' |%>')
"

------------------------------------------------------------------------------------------------

Directe commando:

SET "var=11 7 14 3"
ECHO %var% | xidel -s - ^
-e ^"^
  let $a:=string-join(^
        tokenize($raw) ! x:integer-to-base(.,16)^
      ),^
      $b:=x:integer($a,16)^
  return^
  concat('^<^^^| ',$a,' ^& ',$b,' ^|%%^>')^
"

- In het geval van een Unix query dienen de aanhalingstekens omgedraaid te worden (Windows quoting). ' wordt " en andersom.
- De dubbele aanhalingstekens dienen ge-escaped te worden: ^". Die aan het einde query NIET. Tenzij er een spatie vóór zit.
- De tekens % & < > ^ | dienen "ge-escaped" te worden: %% ^& ^< ^> ^^ ^|.
- Het einde van iedere regel, behalve de laatste, dient ge-escaped te worden.
  Begint de nieuwe regel NIET met een spatie, dan moet er nog een statie vóór de ^.

Output commando:
<^| B7E3 & 47075 |%>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Unix --> Windows in Bash:

$ sed -n 810,817p xivid_notes.txt
$ xidel -se 'file:read-text-lines("xivid_notes.txt")[position() = 810 to 817]'
-e '
  let $a:=string-join(
        tokenize($raw) ! x:integer-to-base(.,16)
      ),
      $b:=x:integer($a,16)
  return
  concat("<^| ",$a," & ",$b," |%>")
'

----------------------------------------------------------------

$ xidel -se 'let $a:=file:read-text-lines("xivid_notes.txt")[position() = 810 to 817] return (replace($a[1],"'\''","^""")||"^",replace($a[last()],"'\''",""""))'
$ xidel -s --xquery 'let $a:=file:read-text-lines("xivid_notes.txt") return (replace($a[810],"&apos;","^&quot;")||"^",replace($a[817],"&apos;","&quot;"))'
-e ^"^
"

----------------------------------------------------------------

$ xidel -s --xquery 'let $a:=file:read-text-lines("xivid_notes.txt") return (replace($a[810],"&apos;","^&quot;")||"^",$a[position() = 811 to 816] ! (replace(replace(replace(.,"%","%%"),"&quot;","&apos;"),"([&amp;<>^|])","^$1")||"^"),replace($a[817],"&apos;","&quot;"))'
-e ^"^
  let $a:=string-join(^
        tokenize($raw) ! x:integer-to-base(.,16)^
      ),^
      $b:=x:integer($a,16)^
  return^
  concat('^<^^^| ',$a,' ^& ',$b,' ^|%%^>')^
"

Een here-string als input werkt ook, maar de $ moet dan wel ge-escaped worden:

$ xidel -s - --xquery 'let $a:=x:lines($raw) return (replace($a[1],"&apos;","^&quot;")||"^",$a[position() = 2 to last() - 1] ! (replace(replace(replace(.,"%","%%"),"&quot;","&apos;"),"([&amp;<>^|])","^$1")||"^"),replace($a[last()],"&apos;","&quot;"))' <<EOF
-e '
  let \$a:=string-join(
        tokenize(\$raw) ! x:integer-to-base(.,16)
      ),
      \$b:=x:integer(\$a,16)
  return
  concat("<^| ",\$a," & ",\$b," |%>")
'
EOF
-e ^"^
  let $a:=string-join(^
        tokenize($raw) ! x:integer-to-base(.,16)^
      ),^
      $b:=x:integer($a,16)^
  return^
  concat('^<^^^| ',$a,' ^& ',$b,' ^|%%^>')^
"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Unix --> Windows in Batch:

----------------------------------------------------------------

xidel -se "let $a:=file:read-text-lines('xivid_notes.txt')[position() = 810 to 817] return (replace($a[1],'''','^\"')^|^|'^',replace($a[last()],'''','\"'))"
xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[810],'&apos;','^&quot;'),replace($a[817],'&apos;','&quot;'))"
-e ^"^
"

----------------------------------------------------------------

xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[810],'&apos;','^&quot;')||'^',$a[position() = 811 to 816] ! (replace(replace(replace(.,'%','%%'),'&quot;','&apos;'),'([&amp;<>^|])','^$1')||'^'),replace($a[817],'&apos;','&quot;'))"
-e ^"^
  let $a:=string-join(^
        tokenize($raw) ! x:integer-to-base(.,16)^
      ),^
      $b:=x:integer($a,16)^
  return^
  concat('^<^^^| ',$a,' ^& ',$b,' ^|%%^>')^
"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Windows --> Windows in Batch:

----------------------------------------------------------------

xidel -se "let $a:=file:read-text-lines('xivid_notes.txt')[position() = 821 to 828] return (replace($a[1],'\"','^^\"')||'^',$a[last()])"
xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[821],'&quot;','^&quot;')||'^',$a[828])"
-e ^"^
"

----------------------------------------------------------------

xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[821],'&quot;','^&quot;')||'^',$a[position() = 822 to 827] ! (replace(replace(.,'%','%%'),'([&amp;<>^|])','^$1')||'^'),$a[828])"
-e ^"^
  let $a:=string-join(^
        tokenize($raw) ! x:integer-to-base(.,16)^
      ),^
      $b:=x:integer($a,16)^
  return^
  concat('^<^^^| ',$a,' ^& ',$b,' ^|%%^>')^
"

------------------------------------------------------------------------------------------------

Directe commando (delayed expansion):

SET "var=11 7 14 3"
SETLOCAL ENABLEDELAYEDEXPANSION
ECHO !var! | xidel -s - ^
-e ^"^
  let $a:=string-join(^
        tokenize($raw) ^^! x:integer-to-base(.,16)^
      ),^
      $b:=x:integer($a,16)^
  return^
  concat('^<^^^^^| ',$a,' ^& ',$b,' ^|%%^>')^
"

- Zie hier boven.
- Het uitroepteken dient dubbel ge-escaped te worden: ^^!.
- Het dakje (accent circonflexe) dient nóg een keer ge-escaped te worden: ^^^^.

Output commando:
<^| B7E3 & 47075 |%>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Unix --> Windows in Bash:

$ xidel -s --xquery 'let $a:=file:read-text-lines("xivid_notes.txt") return (replace($a[810],"&apos;","^&quot;")||"^",$a[position() = 811 to 816] ! (replace(replace(replace(replace(replace(.,"%","%%"),"&quot;","&apos;"),"\^","^^"),"!","^!"),"([&amp;<>^|])","^$1")||"^"),replace($a[817],"&apos;","&quot;"))'

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Unix --> Windows in Batch:

xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[810],'&apos;','^&quot;')||'^',$a[position() = 811 to 816] ! (replace(replace(replace(replace(replace(.,'%','%%'),'&quot;','&apos;'),'\^','^^'),'!','^!'),'([&amp;<>^|])','^$1')||'^'),replace($a[817],'&apos;','&quot;'))"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Windows --> Windows in Batch:

xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[821],'&quot;','^&quot;')||'^',$a[position() = 822 to 827] ! (replace(replace(replace(replace(.,'%','%%'),'\^','^^'),'!','^!'),'([&amp;<>^|])','^$1')||'^'),$a[828])"

------------------------------------------------------------------------------------------------

Commando in FOR loop:

SET "var=11 7 14 3"
FOR /F "delims=" %%A IN ('ECHO %var% ^| xidel -s -
-e ^"
  let $a:^=string-join^(
        tokenize^($raw^) ! x:integer-to-base^(.^,16^)
      ^)^,
      $b:^=x:integer^($a^,16^)
  return
  var:^=concat^('^<^^^| '^,$a^,' ^& '^,$b^,' ^|%%^>'^)
^" --output-format^=cmd') DO %%A
ECHO %var%

- Naast de escape characters, % & < > ^ |, dienen ook de delimiters, , ; = én " ( ) ge-escaped te worden.
- Het hele rijtje wordt dus: % & < > ^ | , ; = " ( ).
- Het einde van een regel hoeft niet ge-escaped te worden.

Output commando:
SET var=^<^^^| B7E3 ^& 47075 ^|%^>
ECHO <^| B7E3 & 47075 |%>

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Unix --> Windows in Bash:

$ xidel -s --xquery 'let $a:=file:read-text-lines("xivid_notes.txt") return (replace($a[810],"&apos;","^&quot;"),$a[position() = 811 to 816] ! replace(replace(replace(.,"%","%%"),"&quot;","&apos;"),"([&amp;<>^|,;=()])","^$1"),replace($a[817],"&apos;","^&quot;"))'

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Unix --> Windows in Batch:

xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[810],'&apos;','^&quot;'),$a[position() = 811 to 816] ! replace(replace(replace(.,'%','%%'),'&quot;','&apos;'),'([&amp;<>^|,;=()])','^$1'),replace($a[817],'&apos;','^&quot;'))"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Xidel commando Windows --> Windows in Batch:

xidel -s --xquery "let $a:=file:read-text-lines('xivid_notes.txt') return (replace($a[821],'&quot;','^&quot;'),$a[position() = 822 to 827] ! replace(replace(.,'%','%%'),'([&amp;<>^|,;=()])','^$1'),replace($a[828],'&quot;','^&quot;'))"

================================================================================================

[xivid -i, video informatie optie]

Alle attribuut-namen:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e '$json()'
name
date
duration
start
end
formats

Alle attribuut-namen met een waarde die NIET null is:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e '$json()[$json(.)]'
name
date
duration
start
end
formats

Vertaalslag van attribuut-naam naar string:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"} return $a()[$json(.)] ! $a(.)'
Naam:
Datum:
Tijdsduur:
Begin:
Einde:
Formaten:

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Aantal tekens:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"} return $a()[$json(.)] ! $a(.) ! string-length()'
5
6
10
6
6
9

String + spaties tot de lengte van de langste string + 1 spatie speling:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=$a()[$json(.)] ! $a(.) ! string-length() for $x at $i in $a()[$json(.)] return $a($x)||string-join((1 to max($b) - $b[$i] + 1) ! "-")'
Naam:------     # 10 - 5 + 1 = 6 spaties
Datum:-----     # 10 - 6 + 1 = 5 spaties
Tijdsduur:-     # etc.
Begin:-----
Einde:-----
Formaten:--

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Aantal tekens van de langste string:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"} return max($a()[$json(.)] ! $a(.) ! string-length())'
10

String + 10 spaties:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()) return $a()[$json(.)] ! ($a(.)||string-join((1 to $b) ! "-"))'
Naam:----------
Datum:----------
Tijdsduur:----------
Begin:----------
Einde:----------
Formaten:----------

String + 10 spaties, afgeknot na 10 + 1 = 11 tekens:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()) return $a()[$json(.)] ! substring($a(.)||string-join((1 to $b) ! "-"),1,$b + 1)'
Naam:------
Datum:-----
Tijdsduur:-
Begin:-----
Einde:-----
Formaten:--

Met de attribuut-waarden erbij:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()) return $a()[$json(.)] ! concat(substring($a(.)||string-join((1 to $b) ! " "),1,$b + 1),$json(.))'
Naam:      NOS Journaal: STOP! Verkeerslicht voor telefoonverslaafde
Datum:     14-02-2017
Tijdsduur: 00:01:05
Begin:     00:09:02
Einde:     00:10:07
Formaten:

------------------------------------------------------------------------------------------------

De attribuut-namen die we in deze volgorde willen weergeven (dus niet "label" of "url"):

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"}] return $a(1)()'
id
format
language
resolution
samplerate
bitrate

Van de legenda en de "formats"-objecten maken we één array voor het makkelijker achterhalen van de langste string per te vormen kolom.
Alle aanwezige attribuut-namen in de "formats"-objecten met een waarde die NIET null is:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()] return $a(1)() ! distinct-values(for $x in $a()[position() gt 1] return .[$x(.)])'
id
format
language
resolution
bitrate

Per attribuut-naam / kolom het aantal tekens van de langste string:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$b:=$a(1)() ! distinct-values(for $x in $a()[position() gt 1] return .[$x(.)]) return $b ! max($a()(.) ! string-length())'
5
14
4
9
12

Per object alle attribuut-waarden achter elkaar:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$b:=$a(1)() ! distinct-values(for $x in $a()[position() gt 1] return .[$x(.)]) return $a() ! string-join(for $x in $b return .($x))'
idformaattaalresolutiebitrate
sub-1vttnl
hls-0m3u8[manifest]
hls-1m3u8[aac]64kbps
hls-2m3u8[aac]128kbps
hls-3m3u8[h264+aac]480x270209|64kbps
hls-4m3u8[h264+aac]640x360517|128kbps
hls-5m3u8[h264+aac]768x432721|128kbps
hls-6m3u8[h264+aac]1024x5761027|128kbps

String + (5, 14, 4, 9, of 12) spaties + 2 spaties speling, afgeknot na (5, 14, 4, 9, of 12) + 2 tekens:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - --xquery 'let $a:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$b:=$a(1)() ! distinct-values(for $x in $a()[position() gt 1] return .[$x(.)]),$c:=$b ! max($a()(.) ! string-length()) return $a() ! string-join(for $x at $i in $b return substring(.($x)||string-join((1 to $c[$i] + 2) ! "-"),1,$c[$i] + 2))'
id-----formaat---------taal--resolutie--bitrate-------
sub-1--vtt-------------nl-----------------------------
hls-0--m3u8[manifest]---------------------------------
hls-1--m3u8[aac]------------------------64kbps--------
hls-2--m3u8[aac]------------------------128kbps-------
hls-3--m3u8[h264+aac]--------480x270----209|64kbps----
hls-4--m3u8[h264+aac]--------640x360----517|128kbps---
hls-5--m3u8[h264+aac]--------768x432----721|128kbps---
hls-6--m3u8[h264+aac]--------1024x576---1027|128kbps--

------------------------------------------------------------------------------------------------

Alles bij elkaar. Als "formats"="formats", dan verwerk "formats"-objecten, anders geef attribuut-waarde terug:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()),$c:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$d:=$c(1)() ! distinct-values(for $x in $c()[position() gt 1] return .[$x(.)]),$e:=$d ! max($c()(.) ! string-length()) return $a()[$json(.)] ! concat(substring($a(.)||string-join((1 to $b) ! "-"),1,$b + 1),if (.=$a()[last()]) then $c() ! string-join(for $x at $i in $d return substring(.($x)||string-join((1 to $e[$i] + 2) ! "-"),1,$e[$i] + 2)) else $json(.))'
Error:
err:XPTY0004: Invalid conversion from ("id-----formaat---------taal--resolutie--bitrate-------", [...] "hls-6--m3u8[h264+aac]--------1024x576---1027|128kbps--") to type singleton

concat() verwacht één enkele string, maar de tabel is een reeks van strings.
Dit is op te lossen door van de tabel één string te maken m.b.v. new-line-characters (en weer wat spaties):

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()),$c:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$d:=$c(1)() ! distinct-values(for $x in $c()[position() gt 1] return .[$x(.)]),$e:=$d ! max($c()(.) ! string-length()) return $a()[$json(.)] ! concat(substring($a(.)||string-join((1 to $b) ! "-"),1,$b + 1),if (.=$a()[last()]) then join($c() ! string-join(for $x at $i in $d return substring(.($x)||string-join((1 to $e[$i] + 2) ! "-"),1,$e[$i] + 2)),"&#10;"||string-join((1 to $b + 1) ! "-")) else $json(.))'
Naam:------NOS Journaal: STOP! Verkeerslicht voor telefoonverslaafde
Datum:-----14-02-2017
Tijdsduur:-00:01:05
Begin:-----00:09:02
Einde:-----00:10:07
Formaten:--id-----formaat---------taal--resolutie--bitrate-------
-----------sub-1--vtt-------------nl-----------------------------
-----------hls-0--m3u8[manifest]---------------------------------
-----------hls-1--m3u8[aac]------------------------64kbps--------
-----------hls-2--m3u8[aac]------------------------128kbps-------
-----------hls-3--m3u8[h264+aac]--------480x270----209|64kbps----
-----------hls-4--m3u8[h264+aac]--------640x360----517|128kbps---
-----------hls-5--m3u8[h264+aac]--------768x432----721|128kbps---
-----------hls-6--m3u8[h264+aac]--------1024x576---1027|128kbps--

Als gearriveerd bij laatste attribuut-waarde, dan plak " (best)" er achter, anders voeg spaties toe voor uitlijning:

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()),$c:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$d:=$c(1)() ! distinct-values(for $x in $c()[position() gt 1] return .[$x(.)]),$e:=$d ! max($c()(.) ! string-length()) return $a()[$json(.)] ! concat(substring($a(.)||string-join((1 to $b) ! " "),1,$b + 1),if (.=$a()[last()]) then join($c() ! string-join(for $x at $i in $d return if (position() eq count($c()) and $i eq count($d)) then .($x)||" (best)" else substring(.($x)||string-join((1 to $e[$i] + 2) ! " "),1,$e[$i] + 2)),"&#10;"||string-join((1 to $b + 1) ! " ")) else $json(.))'
Naam:      NOS Journaal: STOP! Verkeerslicht voor telefoonverslaafde
Datum:     14-02-2017
Tijdsduur: 00:01:05
Begin:     00:09:02
Einde:     00:10:07
Formaten:  id     formaat         taal  resolutie  bitrate
           sub-1  vtt             nl
           hls-0  m3u8[manifest]
           hls-1  m3u8[aac]                        64kbps
           hls-2  m3u8[aac]                        128kbps
           hls-3  m3u8[h264+aac]        480x270    209|64kbps
           hls-4  m3u8[h264+aac]        640x360    517|128kbps
           hls-5  m3u8[h264+aac]        768x432    721|128kbps
           hls-6  m3u8[h264+aac]        1024x576   1027|128kbps (best)

------------------------------------------------------------------------------------------------

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e '$json[start]/(start,duration)'
00:09:02   # Begin.
00:01:05   # Tijdsduur.

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e '$json[start]/(start,duration) ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S"))'
542   # Begin in sec.
65    # Tijdsduur in sec.

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:=$json[start]/(start,duration) ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S")) return ($a[1] - $a[1] mod 30,$a[1] mod 30,$a[2])'
540   # Begin op 30 sec nauwkeurig.
2     # Begin restant.
65    # Tijdsduur.

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - -e 'let $a:=$json[start]/(start,duration) ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S")) return concat("Download: ffmpeg -ss ",$a[1] - $a[1] mod 30," -i <url> -ss ",$a[1] mod 30," -t ",$a[2]," [...]")'
Download: ffmpeg -ss 540 -i <url> -ss 2 -t 65 [...]

Begin 00:00:29 :

$ xidel -se 'let $a:=("00:00:29","00:00:10") ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S")) return concat("Download: ffmpeg",($a[1] - $a[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -i <url> -ss ",$a[1] mod 30," -t ",$a[2]," [...]")'
Download: ffmpeg -i <url> -ss 29 -t 10 [...]

Begin 00:00:30 :

$ xidel -se 'let $a:=("00:00:30","00:00:10") ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S")) return concat("Download: ffmpeg",($a[1] - $a[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -i <url>",($a[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -t ",$a[2]," [...]")'
Download: ffmpeg -ss 30 -i <url> -t 10 [...]

00:00:29 --> ffmpeg -i <url> -ss 29 -t 10 [...]
00:00:30 --> ffmpeg -ss 30 -i <url> -t 10 [...]
00:00:31 --> ffmpeg -ss 30 -i <url> -ss 1 -t 10 [...]

------------------------------------------------------------------------------------------------

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()),$c:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$d:=$c(1)() ! distinct-values(for $x in $c()[position() gt 1] return .[$x(.)]),$e:=$d ! max($c()(.) ! string-length()) return ($a()[$json(.)] ! concat(substring($a(.)||string-join((1 to $b) ! " "),1,$b + 1),if (.=$a()[last()]) then join($c() ! string-join(for $x at $i in $d return if (position() eq count($c()) and $i eq count($d)) then .($x)||" (best)" else substring(.($x)||string-join((1 to $e[$i] + 2) ! " "),1,$e[$i] + 2)),"&#10;"||string-join((1 to $b + 1) ! " ")) else $json(.)),$json[start]/("",let $f:=(start,duration) ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S")) return concat(substring("Download:"||string-join((1 to $b) ! " "),1,$b + 1),"ffmpeg",($f[1] - $f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -i <url>",($f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -t ",$f[2]," [...]")))'
Datum:     14-02-2017
Tijdsduur: 00:01:05
Begin:     00:09:02
Einde:     00:10:07
Formaten:  id     formaat         taal  resolutie  bitrate
           sub-1  vtt             nl
           hls-0  m3u8[manifest]
           hls-1  m3u8[aac]                        64kbps
           hls-2  m3u8[aac]                        128kbps
           hls-3  m3u8[h264+aac]        480x270    209|64kbps
           hls-4  m3u8[h264+aac]        640x360    517|128kbps
           hls-5  m3u8[h264+aac]        768x432    721|128kbps
           hls-6  m3u8[h264+aac]        1024x576   1027|128kbps (best)

Download:  ffmpeg -ss 540 -i <url> -ss 2 -t 65 [...]

$ sed -n 3040,3045p xivid_notes.txt | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()),$c:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$d:=$c(1)() ! distinct-values(for $x in $c()[position() gt 1] return .[$x(.)]),$e:=$d ! max($c()(.) ! string-length()) return ($a()[$json(.)] ! concat(substring($a(.)||string-join((1 to $b) ! " "),1,$b + 1),if (.=$a()[last()]) then if ($c(2)) then join($c() ! string-join(for $x at $i in $d return if (position() eq count($c()) and $i eq count($d)) then .($x)||" (best)" else substring(.($x)||string-join((1 to $e[$i] + 2) ! " "),1,$e[$i] + 2)),"&#10;"||string-join((1 to $b + 1) ! " ")) else "-" else $json(.)),$json[start]/("",let $f:=(start,duration) ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S")) return concat(substring("Download:"||string-join((1 to $b) ! " "),1,$b + 1),"ffmpeg",($f[1] - $f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -i <url>",($f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -t ",$f[2]," [...]")))'
Naam:      Flikken Maastricht: Virtus et justitia
Datum:     01-03-2019
Tijdsduur: 00:47:27
Formaten:  -

$ sed -n '4311,4322p;4324,4338p;4340,4349p' xivid_notes.txt | xidel -s - --xquery '[...]'
Naam:      Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
Datum:     01-02-2019
Tijdsduur: 00:18:13
Formaten:  id       formaat        resolutie       frequentie  bitrate
           pg-1     mp4[h264+aac]  640x360                     489kbps
           pg-3     mp4[h264+aac]  1280x720                    1603kbps
           dash-1   mp4[aac]                       44.1kHz     131kbps
           dash-14  mp4[h264]      1280x720@50fps              2866kbps (best)

------------------------------------------------------------------------------------------------

$ sed -n 2948,3010p xivid_notes.txt | xidel -s - --xquery 'declare function local:info($json as object()) as string* {let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","formats":"Formaten:"},$b:=max($a()[$json(.)] ! $a(.) ! string-length()),$c:=[{"id":"id","format":"formaat","language":"taal","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$d:=$c(1)() ! distinct-values(for $x in $c()[position() gt 1] return .[$x(.)]),$e:=$d ! max($c()(.) ! string-length()) return ($a()[$json(.)] ! concat(substring($a(.)||string-join((1 to $b) ! " "),1,$b + 1),if (.=$a()[last()]) then if ($c(2)) then join($c() ! string-join(for $x at $i in $d return if (position() eq count($c()) and $i eq count($d)) then .($x)||" (best)" else substring(.($x)||string-join((1 to $e[$i] + 2) ! " "),1,$e[$i] + 2)),"&#10;"||string-join((1 to $b + 1) ! " ")) else "-" else $json(.)),$json[start]/("",let $f:=(start,duration) ! ((time(.) - time("00:00:00")) div dayTimeDuration("PT1S")) return concat(substring("Download:"||string-join((1 to $b) ! " "),1,$b + 1),"ffmpeg",($f[1] - $f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -i <url>",($f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.)," -t ",$f[2]," [...]")))}; local:info($json)'

declare function xivid:info($json as object()) as string* {
  let $a:={
        "name":"Naam:",
        "date":"Datum:",
        "duration":"Tijdsduur:",
        "start":"Begin:",
        "end":"Einde:",
        "expdate":"Gratis tot:",
        "formats":"Formaten:"
      },
      $b:=max(
        $a()[$json(.)] ! $a(.) ! string-length()
      ),
      $c:=[
        {
          "id":"id",
          "format":"formaat",
          "language":"taal",
          "resolution":"resolutie",
          "samplerate":"frequentie",
          "bitrate":"bitrate"
        },
        $json/(formats)()
      ],
      $d:=$c(1)() ! distinct-values(
        for $x in $c()[position() gt 1] return
        .[$x(.)]
      ),
      $e:=$d ! max($c()(.) ! string-length())
  return (
    $a()[$json(.)] ! concat(
      substring(
        $a(.)||string-join((1 to $b) ! " "),
        1,$b + 1
      ),
      if (.=$a()[last()]) then
        if ($c(2)) then
          join(
            $c() ! string-join(
              for $x at $i in $d return
              if (position() eq count($c()) and $i eq count($d)) then
                .($x)||" (best)"
              else
                substring(
                  .($x)||string-join((1 to $e[$i] + 2) ! " "),
                  1,$e[$i] + 2
                )
            ),
            "&#10;"||string-join((1 to $b + 1) ! " ")
          )
        else
          "-"
      else
        $json(.)
    ),
    $json[start]/(
      "",
      let $f:=(start,duration) ! (
        (time(.) - time("00:00:00")) div dayTimeDuration("PT1S")
      ) return
      concat(
        substring(
          "Download:"||string-join((1 to $b) ! " "),
          1,$b + 1
        ),
        "ffmpeg",
        ($f[1] - $f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.),
        " -i <url>",
        ($f[1] mod 30) ! (if (. eq 0) then () else " -ss "||.),
        " -t ",
        $f[2],
        " [...]"
      )
    )
  )
};

================================================================================================

[HLS master playlist ontleding]

'rtl_6beababa-dadb-3506-ac9c-c9ee2701f05c.m3u8':

#EXTM3U
#EXT-X-VERSION:1
## Created with Unified Streaming Platform(version=1.6.6)
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=1245963,CODECS="mp4a.40.2,avc1.77.31",RESOLUTION=711x400
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437-video=1050000.m3u8
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=2489343,CODECS="mp4a.40.2,avc1.100.41",RESOLUTION=912x512
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437-video=2223000.m3u8
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=4386743,CODECS="mp4a.40.2,avc1.100.41",RESOLUTION=1280x720
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437-video=4013000.m3u8
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=132963,CODECS="mp4a.40.2"
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437.m3u8

$ xidel -s rtl_6beababa-dadb-3506-ac9c-c9ee2701f05c.m3u8 --xquery 'for $x at $i in extract($raw,"#EXT-X-STREAM-INF.+?m3u8",0,"s*") order by extract($x,"BANDWIDTH=(\d+)",1) count $i return ($i,$x)'
1
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=132963,CODECS="mp4a.40.2"
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437.m3u8
2
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=1245963,CODECS="mp4a.40.2,avc1.77.31",RESOLUTION=711x400
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437-video=1050000.m3u8
3
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=2489343,CODECS="mp4a.40.2,avc1.100.41",RESOLUTION=912x512
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437-video=2223000.m3u8
4
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=4386743,CODECS="mp4a.40.2,avc1.100.41",RESOLUTION=1280x720
http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437-video=4013000.m3u8

$ xidel -s rtl_6beababa-dadb-3506-ac9c-c9ee2701f05c.m3u8 --json-mode=deprecated --xquery 'let $url:="http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c.m3u8" return [{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-STREAM-INF.+?m3u8",0,"s*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)(?:-video.+?(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else round($br div 1000),"kbps"),"url":extract($x,".+m3u8")}]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c.m3u8"
  },
  {
    "id": "hls-1",
    "format": "m3u8[aac]",
    "resolution": null,
    "bitrate": "125kbps",
    "url": "http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437.m3u8"
  },
  [...]
  {
    "id": "hls-4",
    "format": "m3u8[h264+aac]",
    "resolution": "1280x720",
    "bitrate": "4013|125kbps",
    "url": "http://manifest.us.rtl.nl/[...]/6beababa-dadb-3506-ac9c-c9ee2701f05c-audio=125437-video=4013000.m3u8"
  }
]


------------------------------------------------------------------------------------------------

'kijk_zCoXEMbeJeD.m3u8':

#EXTM3U
#EXT-X-VERSION:1
## Created with Unified Streaming Platform (version=1.10.18-20255)

# variants
#EXT-X-STREAM-INF:BANDWIDTH=563000,CODECS="mp4a.40.2,avc1.77.30",RESOLUTION=448x252,FRAME-RATE=25,VIDEO-RANGE=SDR
zCoXEMbeJeD-index-audio=160000-video=370236.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=955000,CODECS="mp4a.40.2,avc1.77.30",RESOLUTION=640x360,FRAME-RATE=25,VIDEO-RANGE=SDR
zCoXEMbeJeD-index-audio=160000-video=740168.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=1782000,CODECS="mp4a.40.2,avc1.77.30",RESOLUTION=768x432,FRAME-RATE=25,VIDEO-RANGE=SDR
zCoXEMbeJeD-index-audio=160000-video=1520499.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=3392000,CODECS="mp4a.40.2,avc1.77.31",RESOLUTION=1280x720,FRAME-RATE=25,VIDEO-RANGE=SDR
zCoXEMbeJeD-index-audio=160000-video=3039252.m3u8

# variants
#EXT-X-STREAM-INF:BANDWIDTH=170000,CODECS="mp4a.40.2"
zCoXEMbeJeD-index-audio=160000.m3u8

$ xidel -s kijk_zCoXEMbeJeD.m3u8 --json-mode=deprecated --xquery 'let $url:="https://vod-kijk2-prod.talpatvcdn.nl/[...]/zCoXEMbeJeD.m3u8?filter=(systemBitrate%3C3500000)" return [{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-STREAM-INF.+?m3u8",0,"s*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x,"RESOLUTION=([\dx]+)",1)[.],extract($x,"FRAME-RATE=(\d+)",1)[.] ! concat("@",.,"fps"))[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)(?:-video.+?(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else round($br div 1000),"kbps"),"url":resolve-uri(extract($x,".+m3u8"),$url)}]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://vod-kijk2-prod.talpatvcdn.nl/[...]/zCoXEMbeJeD.m3u8?filter=(systemBitrate%3C3500000)"
  },
  {
    "id": "hls-1",
    "format": "m3u8[aac]",
    "resolution": null,
    "bitrate": "160kbps",
    "url": "https://vod-kijk2-prod.talpatvcdn.nl/[...]/zCoXEMbeJeD-index-audio=160000.m3u8"
  },
  [...]
  {
    "id": "hls-5",
    "format": "m3u8[h264+aac]",
    "resolution": "1280x720@25fps",
    "bitrate": "3039|160kbps",
    "url": "https://vod-kijk2-prod.talpatvcdn.nl/[...]/zCoXEMbeJeD-index-audio=160000-video=3039252.m3u8"
  }
]

------------------------------------------------------------------------------------------------

'ofr-live_01082020.m3u8':

#EXTM3U
#EXT-X-VERSION:3


#EXT-X-STREAM-INF:BANDWIDTH=2418592,CODECS="avc1.64001f,mp4a.40.2",RESOLUTION=1280x720,FRAME-RATE=25.000
720p/prog_index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=1526776,CODECS="avc1.64001e,mp4a.40.2",RESOLUTION=854x480,FRAME-RATE=25.000
540p/prog_index.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=636608,CODECS="avc1.640015,mp4a.40.2",RESOLUTION=426x240,FRAME-RATE=25.000
270p/prog_index.m3u8

#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=2000000,CODECS="avc1.64001f",RESOLUTION=1280x720,URI="720p/iframe_prog_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=1200000,CODECS="avc1.64001e",RESOLUTION=854x480,URI="540p/iframe_prog_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=400000,CODECS="avc1.640015",RESOLUTION=426x240,URI="270p/iframe_prog_index.m3u8"

$ xidel -se '(25,23.976,25.000) ! round-half-to-even(.,3)'
25
23.976
25

$ xidel -s ofr-live_01082020.m3u8 --json-mode=deprecated --xquery 'let $url:="https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/stream04/index.m3u8" return [{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-STREAM-INF.+?m3u8",0,"s*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x,"RESOLUTION=([\dx]+)",1)[.],extract($x,"FRAME-RATE=([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)(?:-video.+?(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else round($br div 1000),"kbps"),"url":resolve-uri(extract($x,".+m3u8"),$url)}]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/stream04/index.m3u8"
  },
  {
    "id": "hls-1",
    "format": "m3u8[h264+aac]",
    "resolution": "426x240@25fps",
    "bitrate": "637kbps",
    "url": "https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/stream04/270p/prog_index.m3u8"
  },
  [...]
  {
    "id": "hls-3",
    "format": "m3u8[h264+aac]",
    "resolution": "1280x720@25fps",
    "bitrate": "2419kbps",
    "url": "https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/stream04/720p/prog_index.m3u8"
  }
]

------------------------------------------------------------------------------------------------

'npo_POW_03373320.m3u8':

#EXTM3U
#EXT-X-VERSION:4
## Created with Unified Streaming Platform(version=1.7.25)

# AUDIO groups
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-64",NAME="audio",AUTOSELECT=YES,DEFAULT=YES,CHANNELS="2"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-128",NAME="audio",AUTOSELECT=YES,DEFAULT=YES,CHANNELS="2"

# variants
#EXT-X-STREAM-INF:BANDWIDTH=290000,CODECS="mp4a.40.2,avc1.42C01E",RESOLUTION=480x270,AUDIO="audio-aacl-64",CLOSED-CAPTIONS=NONE
POW_03373320_v4-audio=64000-video=209000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=684000,CODECS="mp4a.40.2,avc1.42C01E",RESOLUTION=640x360,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
POW_03373320_v4-audio=128000-video=517000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=900000,CODECS="mp4a.40.2,avc1.42C01F",RESOLUTION=768x432,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
POW_03373320_v4-audio=128000-video=721000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=1225000,CODECS="mp4a.40.2,avc1.42C029",RESOLUTION=1024x576,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
POW_03373320_v4-audio=128000-video=1027000.m3u8

# variants
#EXT-X-STREAM-INF:BANDWIDTH=68000,CODECS="mp4a.40.2",AUDIO="audio-aacl-64"
POW_03373320_v4-audio=64000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=136000,CODECS="mp4a.40.2",AUDIO="audio-aacl-128"
POW_03373320_v4-audio=128000.m3u8

# keyframes
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=28000,CODECS="avc1.42C01E",RESOLUTION=480x270,URI="keyframes/POW_03373320_v4-video=209000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=69000,CODECS="avc1.42C01E",RESOLUTION=640x360,URI="keyframes/POW_03373320_v4-video=517000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=96000,CODECS="avc1.42C01F",RESOLUTION=768x432,URI="keyframes/POW_03373320_v4-video=721000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=137000,CODECS="avc1.42C029",RESOLUTION=1024x576,URI="keyframes/POW_03373320_v4-video=1027000.m3u8"

$ xidel -s npo_POW_03373320.m3u8 --json-mode=deprecated --xquery 'let $url:="https://npo.prd.cdn.bcms.kpn.com/[...]/playlist.m3u8" return [{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-STREAM-INF.+?m3u8",0,"s*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x,"RESOLUTION=([\dx]+)",1)[.],extract($x,"FRAME-RATE=([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x,"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else round($br div 1000),"kbps"),"url":resolve-uri(extract($x,".+m3u8"),$url)}]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/playlist.m3u8"
  },
  {
    "id": "hls-1",
    "format": "m3u8[aac]",
    "resolution": null,
    "bitrate": "64kbps",
    "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=64000.m3u8"
  },
  [...]
  {
    "id": "hls-6",
    "format": "m3u8[h264+aac]",
    "resolution": "1024x576",
    "bitrate": "1027|128kbps",
    "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=128000-video=1027000.m3u8"
  }
]

------------------------------------------------------------------------------------------------

'ad_10065499.m3u8':

#EXTM3U
#EXT-X-INDEPENDENT-SEGMENTS
#EXT-X-STREAM-INF:BANDWIDTH=2510000,FRAME-RATE=30,RESOLUTION=1280x720,AVERAGE-BANDWIDTH=2360000,CODECS="mp4a.40.2, avc1.64001f"
https://dcs-vod.apis.anvato.net/vod/p/2510000/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
#EXT-X-STREAM-INF:BANDWIDTH=1775000,FRAME-RATE=30,RESOLUTION=1280x720,AVERAGE-BANDWIDTH=1660000,CODECS="mp4a.40.2, avc1.64001f"
https://dcs-vod.apis.anvato.net/vod/p/1775000/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
#EXT-X-STREAM-INF:BANDWIDTH=1145000,FRAME-RATE=30,RESOLUTION=640x360,AVERAGE-BANDWIDTH=1060000,CODECS="mp4a.40.2, avc1.64001e"
https://dcs-vod.apis.anvato.net/vod/p/1145000/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
#EXT-X-STREAM-INF:BANDWIDTH=796400,FRAME-RATE=30,RESOLUTION=640x360,AVERAGE-BANDWIDTH=728000,CODECS="mp4a.40.2, avc1.64001e"
https://dcs-vod.apis.anvato.net/vod/p/796400/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
#EXT-X-STREAM-INF:BANDWIDTH=481400,FRAME-RATE=30,RESOLUTION=320x180,AVERAGE-BANDWIDTH=428000,CODECS="mp4a.40.2, avc1.64000d"
https://dcs-vod.apis.anvato.net/vod/p/481400/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=2360000,RESOLUTION=1280x720,CODECS="avc1.64001f",URI="https://dcs-vod.apis.anvato.net/vod/p/2360000/iframes.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=1660000,RESOLUTION=1280x720,CODECS="avc1.64001f",URI="https://dcs-vod.apis.anvato.net/vod/p/1660000/iframes.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=1060000,RESOLUTION=640x360,CODECS="avc1.64001e",URI="https://dcs-vod.apis.anvato.net/vod/p/1060000/iframes.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=728000,RESOLUTION=640x360,CODECS="avc1.64001e",URI="https://dcs-vod.apis.anvato.net/vod/p/728000/iframes.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=428000,RESOLUTION=320x180,CODECS="avc1.64000d",URI="https://dcs-vod.apis.anvato.net/vod/p/428000/iframes.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0"

$ xidel -s ad_10065499.m3u8 --xquery 'for $x at $i in extract($raw,"#EXT-X-STREAM-INF.+?m3u8.*?$",0,"ms*") order by extract($x,"BANDWIDTH=(\d+)",1) count $i return ($i,$x)'
1
#EXT-X-STREAM-INF:BANDWIDTH=481400,FRAME-RATE=30,RESOLUTION=320x180,AVERAGE-BANDWIDTH=428000,CODECS="mp4a.40.2, avc1.64000d"
https://dcs-vod.apis.anvato.net/vod/p/481400/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
2
#EXT-X-STREAM-INF:BANDWIDTH=796400,FRAME-RATE=30,RESOLUTION=640x360,AVERAGE-BANDWIDTH=728000,CODECS="mp4a.40.2, avc1.64001e"
https://dcs-vod.apis.anvato.net/vod/p/796400/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
3
#EXT-X-STREAM-INF:BANDWIDTH=1145000,FRAME-RATE=30,RESOLUTION=640x360,AVERAGE-BANDWIDTH=1060000,CODECS="mp4a.40.2, avc1.64001e"
https://dcs-vod.apis.anvato.net/vod/p/1145000/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
4
#EXT-X-STREAM-INF:BANDWIDTH=1775000,FRAME-RATE=30,RESOLUTION=1280x720,AVERAGE-BANDWIDTH=1660000,CODECS="mp4a.40.2, avc1.64001f"
https://dcs-vod.apis.anvato.net/vod/p/1775000/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3
5
#EXT-X-STREAM-INF:BANDWIDTH=2510000,FRAME-RATE=30,RESOLUTION=1280x720,AVERAGE-BANDWIDTH=2360000,CODECS="mp4a.40.2, avc1.64001f"
https://dcs-vod.apis.anvato.net/vod/p/2510000/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3

$ xidel -s ad_10065499.m3u8 --json-mode=deprecated --xquery 'let $url:="https://tkx.apis.anvato.net/rest/v2/mcp/video/10065499~~syv8ed1JI0T0eA/master.m3u8?anvack=yjqOEWaqi37WK2u26oMesa6LMGiJNeZl" return [{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-STREAM-INF.+?m3u8.*?$",0,"ms*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x,"RESOLUTION=([\dx]+)",1)[.],extract($x,"FRAME-RATE=([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x,"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else round($br div 1000),"kbps"),"url":resolve-uri(extract($x,".+m3u8.*?$","m"),$url)}]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://tkx.apis.anvato.net/rest/v2/mcp/video/10065499~~syv8ed1JI0T0eA/master.m3u8?anvack=yjqOEWaqi37WK2u26oMesa6LMGiJNeZl"
  },
  {
    "id": "hls-1",
    "format": "m3u8[h264+aac]",
    "resolution": "320x180@30fps",
    "bitrate": "481kbps",
    "url": "https://dcs-vod.apis.anvato.net/vod/p/481400/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3"
  },
  [...]
  {
    "id": "hls-5",
    "format": "m3u8[h264+aac]",
    "resolution": "1280x720@30fps",
    "bitrate": "2510kbps",
    "url": "https://dcs-vod.apis.anvato.net/vod/p/2510000/prog.m3u8?i=i177995803-n1a98e8e5-00aa-4252-9c7e-c3e23ea87ea0&anvtrid=97c39460bebcfff373ceade45edacbe3"
  }
]

------------------------------------------------------------------------------------------------

'npo_POW_04059460.m3u8':

#EXTM3U
#EXT-X-VERSION:4
## Created with Unified Streaming Platform(version=1.7.18) - generated by HMG

# AUDIO groups
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-128",LANGUAGE="en",NAME="English",DEFAULT=YES,AUTOSELECT=YES,URI="a1/a1.m3u8"

# variants
#EXT-X-STREAM-INF:BANDWIDTH=1526000,AVERAGE-BANDWIDTH=1398000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=768x432,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v4/v4.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=707000,AVERAGE-BANDWIDTH=658000,CODECS="avc1.4D401F,mp4a.40.2",RESOLUTION=480x270,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v5/v5.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=882000,AVERAGE-BANDWIDTH=815000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=480x270,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v6/v6.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=446000,AVERAGE-BANDWIDTH=412000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=320x180,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v7/v7.m3u8

# keyframes
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=439000,AVERAGE-BANDWIDTH=197000,CODECS="avc1.42C01E",RESOLUTION=768x432,URI="v4/iframe_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=227000,AVERAGE-BANDWIDTH=102000,CODECS="avc1.4D401F",RESOLUTION=480x270,URI="v5/iframe_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=312000,AVERAGE-BANDWIDTH=106000,CODECS="avc1.42C01E",RESOLUTION=480x270,URI="v6/iframe_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=134000,AVERAGE-BANDWIDTH=48000,CODECS="avc1.42C01E",RESOLUTION=320x180,URI="v7/iframe_index.m3u8"

$ xidel -s npo_POW_04059460.m3u8 --xquery 'for $x at $i in extract($raw,"#EXT-X-(?:MEDIA:TYPE=AUDIO|STREAM-INF).+?m3u8.*?$",0,"ms*") order by extract($x,"BANDWIDTH=(\d+)",1) count $i return ($i,$x)'
1
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-128",LANGUAGE="en",NAME="English",DEFAULT=YES,AUTOSELECT=YES,URI="a1/a1.m3u8"
2
#EXT-X-STREAM-INF:BANDWIDTH=446000,AVERAGE-BANDWIDTH=412000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=320x180,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v7/v7.m3u8
3
#EXT-X-STREAM-INF:BANDWIDTH=707000,AVERAGE-BANDWIDTH=658000,CODECS="avc1.4D401F,mp4a.40.2",RESOLUTION=480x270,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v5/v5.m3u8
4
#EXT-X-STREAM-INF:BANDWIDTH=882000,AVERAGE-BANDWIDTH=815000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=480x270,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v6/v6.m3u8
5
#EXT-X-STREAM-INF:BANDWIDTH=1526000,AVERAGE-BANDWIDTH=1398000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=768x432,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
v4/v4.m3u8

$ xidel -s npo_POW_04059460.m3u8 --json-mode=deprecated --xquery 'let $url:="https://nl-ams-p22-am3.cdn.streamgate.nl/[...]/POW_04059460_v1563215505/playlist.m3u8" return [{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-(?:MEDIA:TYPE=AUDIO|STREAM-INF).+?m3u8.*?$",0,"ms*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x,"RESOLUTION=([\dx]+)",1)[.],extract($x,"FRAME-RATE=([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x,"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else (round($br[.] div 1000),extract($x,"GROUP-ID=.+?-(\d+)",1)[.]),"kbps"),"url":resolve-uri(extract($x,"(?:.+URI=&quot;)?(.+m3u8(?:\?.+?$)?)",1,"m"),$url)}]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://nl-ams-p22-am3.cdn.streamgate.nl/[...]/POW_04059460_v1563215505/playlist.m3u8"
  },
  {
    "id": "hls-1",
    "format": "m3u8[aac]",
    "resolution": null,
    "bitrate": "128kbps",
    "url": "https://nl-ams-p22-am3.cdn.streamgate.nl/[...]/POW_04059460_v1563215505/a1/a1.m3u8"
  },
  [...]
  {
    "id": "hls-5",
    "format": "m3u8[h264+aac]",
    "resolution": "768x432",
    "bitrate": "1526kbps",
    "url": "https://nl-ams-p22-am3.cdn.streamgate.nl/[...]/POW_04059460_v1563215505/v4/v4.m3u8"
  }
]

------------------------------------------------------------------------------------------------

'twitch_esl_csgo.m3u8':

#EXTM3U
#EXT-X-TWITCH-INFO:NODE="video-edge-c55efc.ams02",MANIFEST-NODE-TYPE="weaver_cluster",MANIFEST-NODE="video-weaver.ams02",SUPPRESS="true",SERVER-TIME="1573922640.92",TRANSCODESTACK="2017TranscodeEvent_V2",USER-IP="x.x.x.x",SERVING-ID="c1a092ae8e644510873ee3fac41e41e2",CLUSTER="ams02",ABS="false",VIDEO-SESSION-ID="3757567538117581635",BROADCAST-ID="178058097",STREAM-TIME="2064.919954",B="false",USER-COUNTRY="NL",MANIFEST-CLUSTER="ams02"
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="chunked",NAME="1080p60 (source)",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=6964137,RESOLUTION=1920x1080,CODECS="avc1.4D402A,mp4a.40.2",VIDEO="chunked"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="720p60",NAME="720p60",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=3459825,RESOLUTION=1280x720,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="720p60"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="720p30",NAME="720p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=2409825,RESOLUTION=1280x720,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="720p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="480p30",NAME="480p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=1464825,RESOLUTION=852x480,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="480p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="360p30",NAME="360p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=630000,RESOLUTION=640x360,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="360p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="160p30",NAME="160p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=230000,RESOLUTION=284x160,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="160p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="audio_only",NAME="audio_only",AUTOSELECT=NO,DEFAULT=NO
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=195072,CODECS="mp4a.40.2",VIDEO="audio_only"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8

$ xidel -s twitch_esl_csgo.m3u8 --xquery 'for $x at $i in extract($raw,"#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",0,"ms*") order by extract($x,"BANDWIDTH=(\d+)",1) count $i return ($i,$x)'
1
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="audio_only",NAME="audio_only",AUTOSELECT=NO,DEFAULT=NO
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=195072,CODECS="mp4a.40.2",VIDEO="audio_only"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
2
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="160p30",NAME="160p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=230000,RESOLUTION=284x160,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="160p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
3
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="360p30",NAME="360p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=630000,RESOLUTION=640x360,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="360p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
4
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="480p30",NAME="480p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=1464825,RESOLUTION=852x480,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="480p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
5
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="720p30",NAME="720p",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=2409825,RESOLUTION=1280x720,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="720p30"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
6
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="720p60",NAME="720p60",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=3459825,RESOLUTION=1280x720,CODECS="avc1.4D401F,mp4a.40.2",VIDEO="720p60"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8
7
#EXT-X-MEDIA:TYPE=VIDEO,GROUP-ID="chunked",NAME="1080p60 (source)",AUTOSELECT=YES,DEFAULT=YES
#EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=6964137,RESOLUTION=1920x1080,CODECS="avc1.4D402A,mp4a.40.2",VIDEO="chunked"
https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8

$ xidel -s twitch_esl_csgo.m3u8 --json-mode=deprecated --xquery 'let $url:="https://usher.ttvnw.net/api/channel/hls/esl_csgo.m3u8?[...]" return [{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-(?:MEDIA|STREAM-INF).+?m3u8.*?$",0,"ms*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x,"RESOLUTION=([\dx]+)",1)[.],extract($x,"(?:FRAME-RATE=|GROUP-ID.+p)([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x,"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else (round($br[.] div 1000),extract($x,"GROUP-ID=.+?-(\d+)",1)[.]),"kbps"),"url":resolve-uri(extract($x,"(?:.+URI=&quot;)?(.+m3u8(?:\?.+?$)?)",1,"m"),$url)}]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://usher.ttvnw.net/api/channel/hls/esl_csgo.m3u8?[...]"
  },
  {
    "id": "hls-1",
    "format": "m3u8[aac]",
    "resolution": null,
    "bitrate": "195kbps",
    "url": "https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8"
  },
  [...]
  {
    "id": "hls-7",
    "format": "m3u8[h264+aac]",
    "resolution": "1920x1080@60fps",
    "bitrate": "6964kbps",
    "url": "https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/[...].m3u8"
  }
]

------------------------------------------------------------------------------------------------

'tw_1188986316194635777.m3u8':

#EXTM3U
#EXT-X-INDEPENDENT-SEGMENTS
#EXT-X-MEDIA:TYPE=SUBTITLES,GROUP-ID="subs",NAME="en",DEFAULT=NO,FORCED=NO,URI="/amplify_video/1188974444523315201/pl/s0/3sjE70yJdGgqp0g1.m3u8",LANGUAGE="en",AUTOSELECT=YES,CHARACTERISTICS="twitter.show-text-when-muted"
#EXT-X-STREAM-INF:BANDWIDTH=288000,RESOLUTION=648x270,CODECS="mp4a.40.2,avc1.4d001f",SUBTITLES="subs"
/amplify_video/1188974444523315201/pl/648x270/O7Yd4NsLa4hRURCX.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=832000,RESOLUTION=866x360,CODECS="mp4a.40.2,avc1.4d001f",SUBTITLES="subs"
/amplify_video/1188974444523315201/pl/866x360/ExSrz_uR9F_iO7O_.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=2176000,RESOLUTION=1732x720,CODECS="mp4a.40.2,avc1.64002a",SUBTITLES="subs"
/amplify_video/1188974444523315201/pl/1732x720/yG0_asM0v9yBC-Xd.m3u8

$ xidel -s tw_1188986316194635777.m3u8 -e 'extract($raw,"#EXT-X-MEDIA:TYPE=SUBTITLES.+")'
#EXT-X-MEDIA:TYPE=SUBTITLES,GROUP-ID="subs",NAME="en",DEFAULT=NO,FORCED=NO,URI="/amplify_video/1188974444523315201/pl/s0/3sjE70yJdGgqp0g1.m3u8",LANGUAGE="en",AUTOSELECT=YES,CHARACTERISTICS="twitter.show-text-when-muted"

$ xidel -s tw_1188986316194635777.m3u8 --xquery 'for $x at $i in extract($raw,"#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",0,"ms*") order by extract($x,"BANDWIDTH=(\d+)",1) count $i return ($i,$x)'
1
#EXT-X-STREAM-INF:BANDWIDTH=288000,RESOLUTION=648x270,CODECS="mp4a.40.2,avc1.4d001f",SUBTITLES="subs"
/amplify_video/1188974444523315201/pl/648x270/O7Yd4NsLa4hRURCX.m3u8
2
#EXT-X-STREAM-INF:BANDWIDTH=832000,RESOLUTION=866x360,CODECS="mp4a.40.2,avc1.4d001f",SUBTITLES="subs"
/amplify_video/1188974444523315201/pl/866x360/ExSrz_uR9F_iO7O_.m3u8
3
#EXT-X-STREAM-INF:BANDWIDTH=2176000,RESOLUTION=1732x720,CODECS="mp4a.40.2,avc1.64002a",SUBTITLES="subs"
/amplify_video/1188974444523315201/pl/1732x720/yG0_asM0v9yBC-Xd.m3u8

$ xidel -s tw_1188986316194635777.m3u8 --json-mode=deprecated --xquery 'let $url:="https://video.twimg.com/amplify_video/1188974444523315201/pl/OTSOTGtTUnYMAVnX.m3u8?tag=13" return [extract($raw,"#EXT-X-MEDIA:TYPE=SUBTITLES.+")[.] ! {"id":"sub-1","format":"m3u8[vtt]","language":extract(.,"LANGUAGE=&quot;(.+?)&quot;",1),"url":resolve-uri(extract(.,"URI=&quot;(.+?)&quot;",1),$url)},{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in extract($raw,"#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",0,"ms*") let $br:=extract($x,"BANDWIDTH=(\d+)",1) order by $br count $i return {"id":"hls-"||$i,"format":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x,"RESOLUTION=([\dx]+)",1)[.],extract($x,"(?:FRAME-RATE=|GROUP-ID.+p)([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x,"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else (round($br[.] div 1000),extract($x,"GROUP-ID=.+?-(\d+)",1)[.]),"kbps"),"url":resolve-uri(extract($x,"(?:.+URI=&quot;)?(.+m3u8(?:\?.+?$)?)",1,"m"),$url)}]'
[
  {
    "id": "sub-1",
    "format": "m3u8[vtt]",
    "language": "en",
    "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/s0/3sjE70yJdGgqp0g1.m3u8"
  },
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/OTSOTGtTUnYMAVnX.m3u8?tag=13"
  },
  {
    "id": "hls-1",
    "format": "m3u8[h264+aac]",
    "resolution": "648x270",
    "bitrate": "288kbps",
    "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/648x270/O7Yd4NsLa4hRURCX.m3u8"
  },
  [...]
  {
    "id": "hls-3",
    "format": "m3u8[h264+aac]",
    "resolution": "1732x720",
    "bitrate": "2176kbps",
    "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/1732x720/yG0_asM0v9yBC-Xd.m3u8"
  }
]

------------------------------------------------------------------------------------------------

'dm_x5aa1uc.m3u8':

#EXTM3U
#EXT-X-STREAM-INF:BANDWIDTH=246440,CODECS="mp4a.40.5,avc1.42000d",RESOLUTION=320x184,NAME="240",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_ld_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_ld_1.m3u8#cell=core&qos_part=1&qos_stail=1
#EXT-X-STREAM-INF:BANDWIDTH=246440,CODECS="mp4a.40.5,avc1.42000d",RESOLUTION=320x184,NAME="240",PROGRESSIVE-URI="https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_ld_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_ld_1.m3u8#cell=core&qos_part=1&qos_stail=1
#EXT-X-STREAM-INF:BANDWIDTH=105040,CODECS="mp4a.40.5,avc1.42000b",RESOLUTION=192x112,NAME="144",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.m3u8#cell=core&qos_part=1&qos_stail=1
#EXT-X-STREAM-INF:BANDWIDTH=105040,CODECS="mp4a.40.5,avc1.42000b",RESOLUTION=192x112,NAME="144",PROGRESSIVE-URI="https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.m3u8#cell=core&qos_part=1&qos_stail=1
#EXT-X-STREAM-INF:BANDWIDTH=460560,CODECS="mp4a.40.5,avc1.420016",RESOLUTION=512x288,NAME="380",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_1.m3u8#cell=core&qos_part=1&qos_stail=1
#EXT-X-STREAM-INF:BANDWIDTH=460560,CODECS="mp4a.40.5,avc1.420016",RESOLUTION=512x288,NAME="380",PROGRESSIVE-URI="https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_1.m3u8#cell=core&qos_part=1&qos_stail=1
#EXT-X-STREAM-INF:BANDWIDTH=836280,CODECS="mp4a.40.2,avc1.64001f",RESOLUTION=640x360,NAME="480",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.m3u8#cell=core&qos_part=1&qos_stail=1
#EXT-X-STREAM-INF:BANDWIDTH=836280,CODECS="mp4a.40.2,avc1.64001f",RESOLUTION=640x360,NAME="480",PROGRESSIVE-URI="https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-022.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.m3u8#cell=core&qos_part=1&qos_stail=1

$ xidel -s dm_x5aa1uc.m3u8 --xquery 'let $streams:=extract($raw,"#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",0,"ms*") for $x at $i in $streams let $br:=extract($x[1],"BANDWIDTH=(\d+)",1) group by $br count $i return ($i,$x[1])'
1
#EXT-X-STREAM-INF:BANDWIDTH=105040,CODECS="mp4a.40.5,avc1.42000b",RESOLUTION=192x112,NAME="144",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.m3u8#cell=core&qos_part=1&qos_stail=1
2
#EXT-X-STREAM-INF:BANDWIDTH=246440,CODECS="mp4a.40.5,avc1.42000d",RESOLUTION=320x184,NAME="240",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_ld_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_ld_1.m3u8#cell=core&qos_part=1&qos_stail=1
3
#EXT-X-STREAM-INF:BANDWIDTH=460560,CODECS="mp4a.40.5,avc1.420016",RESOLUTION=512x288,NAME="380",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_1.m3u8#cell=core&qos_part=1&qos_stail=1
4
#EXT-X-STREAM-INF:BANDWIDTH=836280,CODECS="mp4a.40.2,avc1.64001f",RESOLUTION=640x360,NAME="480",PROGRESSIVE-URI="https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.mp4#cell=core&qos_part=1&qos_stail=1"
https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.m3u8#cell=core&qos_part=1&qos_stail=1

$ xidel -s dm_x5aa1uc.m3u8 --json-mode=deprecated --xquery 'let $streams:=extract($raw,"#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",0,"ms*") return [for $x at $i in $streams[contains(.,"PROGRESSIVE-URI")] let $br:=extract($x,"BANDWIDTH=(\d+)",1) group by $br count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":extract($x[1],"RESOLUTION=([\dx]+)",1),"bitrate":round($br div 1000)||"kbps","url":extract($x[1],"URI=&quot;(.+mp4)(?:#.+)?&quot;",1)}]'
[
  {
    "id": "pg-1",
    "format": "mp4[h264+aac]",
    "resolution": "192x112",
    "bitrate": "105kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.mp4"
  },
  {
    "id": "pg-2",
    "format": "mp4[h264+aac]",
    "resolution": "320x184",
    "bitrate": "246kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_ld_1.mp4"
  },
  {
    "id": "pg-3",
    "format": "mp4[h264+aac]",
    "resolution": "512x288",
    "bitrate": "461kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_1.mp4"
  },
  {
    "id": "pg-4",
    "format": "mp4[h264+aac]",
    "resolution": "640x360",
    "bitrate": "836kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.mp4"
  }
]

$ xidel -s dm_x5aa1uc.m3u8 --json-mode=deprecated --xquery 'let $url:="https://www.dailymotion.com/cdn/manifest/video/x5aa1uc.m3u8?sec=eyMNx4dh_i1GpAS8KZdvuLpv_OYPeXseQRrYAtoqvsjKaTEW2g4-03MeQmu4oIC1",$streams:=extract($raw,"#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",0,"ms*") return [extract($raw,"#EXT-X-MEDIA:TYPE=SUBTITLES.+")[.] ! {"id":"sub-1","format":"m3u8[vtt]","language":extract(.,"LANGUAGE=&quot;(.+?)&quot;",1),"url":resolve-uri(extract(.,"URI=&quot;(.+?)&quot;",1),$url)},for $x at $i in $streams[contains(.,"PROGRESSIVE-URI")] let $br:=extract($x[1],"BANDWIDTH=(\d+)",1) group by $br count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":extract($x[1],"RESOLUTION=([\dx]+)",1),"bitrate":round($br div 1000)||"kbps","url":extract($x[1],"URI=&quot;(.+mp4)(?:#.+)?&quot;",1)},{"id":"hls-0","format":"m3u8[manifest]","url":$url},for $x at $i in $streams let $br:=extract($x[1],"BANDWIDTH=(\d+)",1) group by $br count $i return {"id":"hls-"||$i,"format":if (contains($x[1],"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x[1],"RESOLUTION=([\dx]+)",1)[.],extract($x[1],"(?:FRAME-RATE=|GROUP-ID.+p)([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x[1],"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else (round($br[.] div 1000),extract($x[1],"GROUP-ID=.+?-(\d+)",1)[.]),"kbps"),"url":resolve-uri(extract($x[1],"(?:.+URI=&quot;)?(.+m3u8(?:\?.+?$)?)",1,"m"),$url)}]'
[
  {
    "id": "pg-1",
    "format": "mp4[h264+aac]",
    "resolution": "192x112",
    "bitrate": "105kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.mp4"
  },
  [...]
  {
    "id": "pg-4",
    "format": "mp4[h264+aac]",
    "resolution": "640x360",
    "bitrate": "836kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.mp4"
  },
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://www.dailymotion.com/cdn/manifest/video/x5aa1uc.m3u8?sec=eyMNx4dh_i1GpAS8KZdvuLpv_OYPeXseQRrYAtoqvsjKaTEW2g4-03MeQmu4oIC1"
  },
  {
    "id": "hls-1",
    "format": "m3u8[h264+aac]",
    "resolution": "192x112",
    "bitrate": "105kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_l2_1.m3u8"
  },
  [...]
  {
    "id": "hls-4",
    "format": "m3u8[h264+aac]",
    "resolution": "640x360",
    "bitrate": "836kbps",
    "url": "https://proxy-019.dc3.dailymotion.com/[...]/319595988_mp4_h264_aac_hq_1.m3u8"
  }
]

------------------------------------------------------------------------------------------------

$ xidel -se 'x:request({"url":"https://streams.rtvoost.nl/video/tv/hls.m3u8","error-handling":"4xx=accept"})/url'
https://mediacdn.rtvoost.nl/live/rtvoost/tv-oost/index.m3u8

$ xidel -se 'x:request({"url":"https://tkx.apis.anvato.net/rest/v2/mcp/video/10065499~~syv8ed1JI0T0eA/master.m3u8?anvack=yjqOEWaqi37WK2u26oMesa6LMGiJNeZl","error-handling":"4xx=accept"})/url'
https://dcs-vod.apis.anvato.net/vod/p/master.m3u8?encp=i57yUPHvLu2RUlFLg_QKoA:2VA_PSLbbNUp302PxtXXfQENkIA4s9mOL2qycWG-NZbrTMfVlwL05yCZg3q5VcghXoYLrAHSl9xn0eHZBymWIjmtnJpc005GKCimwfnYHEoEJFeuwBPwdMe5Qmb-OvhlSoUTRA6xZt2HSmFnt8wb8ayty9Wt2XQb9mL_arnk0OEQ7XOn7dUNXsLRg1RIjWVf18vhZOSNhMBrN3-hEIcJKb75fwIYhqdAD9w85IexSrYAJqcYmenrqAoyUZGeuCN3Hlc3PJgs6jV_qw_-wOen6neNGZBT8CFmNma85Vfdw7bt8y3-DtDkx70xjb8bhOmOESzetf7Aels7NghNP-WhI0iYyc7pL14p2pyJYoyW_QV_CxpktikfJ8GJ5BOghLBueYwcSiGwIkkt2z2TCTghCnHuRimM03xi292D4mp62uqM_7-iRlRHhztQVPlCu3jV4aSKNUNCo40I3c-mB2A2Nyr-hIJMmbThTIe-Hp1hMq2EX5BDKKGCdaqfjg4KYa7X_ERbjJNGcQ1cMmyMswvXY-uY8H9wBcEPQvuoEPXy5gRzFdORfgJiYRZJBk_DOjufq1Dxiy_55Bhmw-Bw2hRnMoHFz2j1eZ_UyIolJ76Xz1nsOjOt_AxY0eineGSHmmSF-kEUKGLRetXgEhuvR0UoX31Y3vtMG0v8PI-XPvgKATdBHc7jj9di2fZyQhukmjnQC1sEu9MM3nnHOqrSmbkvQtADsfFcuyTcfdJlnhcufU9QgdzjWsS3-EKq9-kcvf3TtqNQX1yWDLQPSfSjHEzkdZDAccx6FmXESQkfMeRluufUitGistOucgu89xRLty9--SlGxMpvvZs_uw_4hVC6ba7-vUsLO0bB4cP66tKb809uM9uqy2dVHwoBLSnYKGKti0RvRVkotgPpo1SsYBA49fq9IBTnFiBqKQMlm2IsNQthun1fM4WdI3MhePl68upVzm61qcCpwKIYEF55Bb3bzA&anvtrid=2c422506e010d9c092ad6564d06c7c9a&anvauth=tb=0~te=1570918109~sgn=422231fded672998b6d2cc3f7031c8a08349df211a8c303c79b28d44a3c441a4&t=1570918019

- Creëer de JSON met de redirected-url door 'x:request()' toe te voegen, maar gebruik de initiële url als de redirected-url vreselijk lang is, bijv. door een lang token.

'kijk_4KH25s3dZRH.m3u8'   # Met de nieuwe "theplatform" api wordt het helaas bij de HLS playlist pas duidelijk dat de video beveiligd is met DRM.

#EXTM3U
#EXT-X-VERSION:4
## Created with Unified Streaming Platform (version=1.10.18-20255)
#EXT-X-SESSION-KEY:METHOD=SAMPLE-AES,URI="skd://fairplay.entitlement.theplatform.eu/fpls/web/FairPlay",KEYFORMAT="com.apple.streamingkeydelivery",KEYFORMATVERSIONS="1"
[...]

- Filter deze in de 'x:request()' er al uit met 'not(contains(.,"#EXT-X-SESSION-KEY:METHOD=SAMPLE-AES"))'.

- Creëer een m3u8-to-json functie van deze query.

$ xidel -s --json-mode=deprecated --xquery 'declare function local:m3u8-to-json($url as string?) as object()* {let $m3u8:=x:request({"url":$url,"error-handling":"4xx=accept"}[url])[doc[not(contains(.,"#EXT-X-SESSION-KEY:METHOD=SAMPLE-AES"))]],$m3u8Url:=if (string-length($m3u8/url) lt 512) then $m3u8/url else $url,$streams:=extract($m3u8/doc,"#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",0,"ms*") return (extract($m3u8/doc,"#EXT-X-MEDIA:TYPE=SUBTITLES.+")[.] ! {"id":"sub-1","format":"m3u8[vtt]","language":extract(.,"LANGUAGE=&quot;(.+?)&quot;",1),"url":resolve-uri(extract(.,"URI=&quot;(.+?)&quot;",1),$m3u8Url)},for $x at $i in $streams[contains(.,"PROGRESSIVE-URI")] let $br:=extract($x[1],"BANDWIDTH=(\d+)",1) group by $br count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":extract($x[1],"RESOLUTION=([\dx]+)",1),"bitrate":round($br div 1000)||"kbps","url":extract($x[1],"URI=&quot;(.+mp4)(?:#.+)?&quot;",1)},{"id":"hls-0","format":"m3u8[manifest]","url":$m3u8Url}[url],for $x at $i in $streams let $br:=extract($x[1],"BANDWIDTH=(\d+)",1) group by $br count $i return {"id":"hls-"||$i,"format":if (contains($x[1],"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":concat(extract($x[1],"RESOLUTION=([\dx]+)",1)[.],extract($x[1],"(?:FRAME-RATE=|GROUP-ID.+p)([\d\.]+)",1)[.] ! concat("@",round-half-to-even(.,3),"fps"))[.],"bitrate":let $a:=extract($x[1],"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return concat(if ($a[1]) then join((round($a[2][.] div 1000),round($a[1] div 1000)),"|") else (round($br[.] div 1000),extract($x[1],"GROUP-ID=.+?-(\d+)",1)[.]),"kbps"),"url":resolve-uri(extract($x[1],"(?:.+URI=&quot;)?(.+m3u8(?:\?.+?$)?)",1,"m"),$m3u8Url)})}; local:m3u8-to-json(<url>)'

string    # Een string.
string+   # Eén of meerdere strings.
string*   # Nul of meerdere strings.
string?   # Nul of één string.

------------------------------------------------------------------------------------------------

declare function xivid:m3u8-to-json($url as string?) as object()* {
  let $m3u8:=x:request(
        {"url":$url,"error-handling":"4xx=accept"}[url]
      )[doc[not(contains(.,"#EXT-X-SESSION-KEY:METHOD=SAMPLE-AES"))]],
      $m3u8Url:=if (string-length($m3u8/url) lt 512) then $m3u8/url else $url,
      $streams:=extract(
        $m3u8/doc,
        "#EXT-X-(?:MEDIA:TYPE=(?:AUDIO|VIDEO)|STREAM-INF).+?m3u8.*?$",
        0,"ms*"
      )
  return (
    extract($m3u8/doc,"#EXT-X-MEDIA:TYPE=SUBTITLES.+")[.] ! {
      "id":"sub-1",
      "format":"m3u8[vtt]",
      "language":extract(.,"LANGUAGE=&quot;(.+?)&quot;",1),
      "url":resolve-uri(
        extract(.,"URI=&quot;(.+?)&quot;",1),
        $m3u8Url
      )
    },
    for $x at $i in $streams[contains(.,"PROGRESSIVE-URI")]
    let $br:=extract($x[1],"BANDWIDTH=(\d+)",1)
    group by $br
    count $i
    return {
      "id":"pg-"||$i,
      "format":"mp4[h264+aac]",
      "resolution":extract($x[1],"RESOLUTION=([\dx]+)",1),
      "bitrate":round($br div 1000)||"kbps",
      "url":extract($x[1],"URI=&quot;(.+mp4)(?:#.+)?&quot;",1)
    },
    {
      "id":"hls-0",
      "format":"m3u8[manifest]",
      "url":$m3u8Url
    }[url],
    for $x at $i in $streams
    let $br:=extract($x[1],"BANDWIDTH=(\d+)",1)
    group by $br
    count $i
    return {
      "id":"hls-"||$i,
      "format":if (contains($x[1],"avc1")) then
        "m3u8[h264+aac]"
      else
        "m3u8[aac]",
      "resolution":concat(
        extract($x[1],"RESOLUTION=([\dx]+)",1)[.],
        extract($x[1],"(?:FRAME-RATE=|GROUP-ID.+p)([\d\.]+)",1)[.] !
          concat("@",round-half-to-even(.,3),"fps")
      )[.],
      "bitrate":let $a:=extract($x[1],"audio.*?=(\d+)(?:-video.*?=(\d+))?",(1,2)) return
      concat(
        if ($a[1]) then
          join((round($a[2][.] div 1000),round($a[1] div 1000)),"|")
        else
          (
            round($br[.] div 1000),
            extract($x[1],"GROUP-ID=.+?-(\d+)",1)[.]
          ),
        "kbps"
      ),
      "url":resolve-uri(
        extract($x[1],"(?:.+URI=&quot;)?(.+m3u8(?:\?.+?$)?)",1,"m"),
        $m3u8Url
      )
    }
  )
};

================================================================================================

[TTML naar SRT]

https://en.wikipedia.org/wiki/Timed_Text_Markup_Language
https://trac.ffmpeg.org/ticket/4859

TTML, of "Timed Text Markup Language", wordt (nog) niet door FFmpeg ondersteund.
Het is een op XML gebaseerd formaat waardoor Xidel bij uitstek geschikt is voor een conversie naar SRT.

O.a. Youtube gebruikt dit formaat voor haar video's. Dit is een (ingekort) voorbeeld:
----------------------------------------------------------------
<?xml version="1.0" encoding="utf-8" ?><transcript><text start="49.76" dur="4.28">Ik geloof dat ik voor een paar
dagen de stad moet ontvluchten.</text><text start="56.36" dur="1.84">Het heeft niets met
[...]
niets over in de mainstream media?</text><text start="5114.4" dur="3.88">Je vraag is je antwoord!</text><text start="5182.68" dur="1.72">Daar sta ik dan...</text><text start="5184.56" dur="3.2">…net zo slim als toen ik begon.</text></transcript>
----------------------------------------------------------------

$ xidel -s "<TTML-url>" -e '//text[contains(.,"&")][1]'
&#39;s avonds ben ik ook erg
aan mijn bed toe.

$ xidel -s "<TTML-url>" -e '//text[contains(.,"&")][1] ! parse-xml(.)'
's avonds ben ik ook erg
aan mijn bed toe.

$ xidel -s "<TTML-url>" --xquery '
  for $x at $i in //text
  return (
    $i,
    concat(
      format-time(
        $x/@start * duration("PT1S"),
        "[H01]:[m01]:[s01],[f001]"
      ),
      " --> ",
      format-time(
        $x/(@start + @dur) * duration("PT1S"),
        "[H01]:[m01]:[s01],[f001]"
      )
    ),
    parse-xml($x),
    ""
  )
'
1
00:00:49,760 --> 00:00:54,040
Ik geloof dat ik voor een paar
dagen de stad moet ontvluchten.

2
00:00:56,360 --> 00:00:58,200
Het heeft niets met
geld of tijd te maken.

[...]

896
01:26:24,560 --> 01:26:27,760
…net zo slim als toen ik begon.

================================================================================================

[npo-live]

https://www.npostart.nl/live/npo-1 (huidige API)

$ xidel -s -H "X-Requested-With: XMLHttpRequest" "https://www.npostart.nl/api/token" -e '$json'
of
$ xidel -se 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json'
{
  "token": "dXbagD2EBAsa43aAQ1lEDMp1ZvUpQbHs0SEPAByt"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json'
{
  "token": "eyJ0eXA[...]5i_G9mk",
  "embedUrl": "https://start-player.npo.nl/embed/eyJ0eXA[...]5i_G9mk",
  "embedCode": "<script>var urlForIframe = \"https://start-player.npo.nl/embed/eyJ0eXA[...]5i_G9mk\"; var elementId = \"player-LI_NL1_4188102\"; var mediaId = \"LI_NL1_4188102\";</script><script src=\"https://start-player.npo.nl/js/embed.js\"></script>"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(doc(embedUrl)//script/extract(.,"var video =(.+);",1)[.])'
{
  "id": "LI_NL1_4188102",
  "type": "livetv",
  "title": "NPO 1",
  "subtitles": [],
  "episodeTitle": "",
  "franchiseTitle": "",
  "description": "",
  "duration": null,
  "age_rating": null,
  "still_image_url": "https://www-assets.npo.nl/uploads/tv_channel/263/guide_highlight/regular_2018_-_NPO1_IDENT_-_PAUW.jpg",
  "orig_image_url": "https://www-assets.npo.nl/uploads/tv_channel/263/logo/logo-npo1.png",
  "post_play_url": "https://www-assets.npo.nl/uploads/tv_channel/263/guide_highlight/regular_2018_-_NPO1_IDENT_-_PAUW.jpg",
  "share_text": "Bekijk NPO 1 op https://www.npostart.nl/LI_NL1_4188102",
  "share_url": "https://www.npostart.nl/LI_NL1_4188102",
  "broadcasters": [],
  "broadcastDate": "2019-03-15T15:44:20Z",
  "nextAsset": null,
  "qualityOptions": [
    {
      "bitrate": "0",
      "label": "Hoogste",
      "resolution": "1080p",
      "platform": "npo"
    },
    {
      "bitrate": "643000",
      "label": "Hoog",
      "resolution": "720p",
      "platform": "npo"
    },
    {
      "bitrate": "491000",
      "label": "Medium",
      "resolution": "576p",
      "platform": "npo"
    },
    {
      "bitrate": "248000",
      "label": "Laag",
      "resolution": "360p",
      "platform": "npo"
    }
  ],
  "visualRadio": null,
  "episodeNumber": null,
  "seriesId": null,
  "net": null,
  "genres": "",
  "ster": {
    "uri": "https://adconfig.ster.nl/adurl/$$identifier$$?ncc=$$ncc$$&cust_params=1%3D1%26programma_titel%3D%26afleverings_titel%3Dnpo1%26genre%3D%26subgenre%3D%26video_duur%3D0%26prid%3DLI_NL1_4188102%26srid%3D%26net%3D%26omroep%3D%26os%3D$$os$$%26osversion%3D$$osversion$$%26player%3D$$player$$%26playerversion%3D$$playerversion$$%26site%3D$$site$$%26ai%3D$$ai$$%26referrer_url%3D$$referrer_url$$%26description_url%3D$$description_url$$",
    "customParameters": {
      "prid": "LI_NL1_4188102",
      "srid": null
    },
    "placeholderValues": {
      "$$netwerk_id$$": "9233",
      "$$genre$$": null,
      "$$subgenre$$": "",
      "$$video_duur$$": 0,
      "$$net$$": null,
      "$$omroep$$": "",
      "$$programma_titel$$": "",
      "$$programmanaam$$": "",
      "$$stationid$$": "npo",
      "$$afleverings_titel$$": "npo1"
    }
  },
  "recommender": "ts-base",
  "startAt": null,
  "parentId": null,
  "channel": null
}

https://start-player.npo.nl/js/app.js:
[...]
var n = {
        "com.apple.fps.1_0": "hls",
        "com.widevine.alpha": "dash-widevine",
        "com.microsoft.playready": "dash-playready",
        silverlight: "smooth"
    },
[...]

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(concat("https://start-player.npo.nl/video/",$a,"/streams?profile=hls&quality=npo&tokenId=",token))'
{
  "stream": {
    "src": "https://pedgewarer28a.video.kpnstreaming.nl/session/7c2dbe1c-4735-11e9-8e3b-1458d0420170/ywkf3i/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/playlist.m3u8?token=9dd8d1315b7d124fb4584a64922f5c29_1552749465_1552749465",
    "type": "application/vnd.apple.mpegurl",
    "protection": {
      "keySystem": "com.apple.fps.1_0",
      "certificateUrl": "https://s3-eu-west-1.amazonaws.com/24i-npo-stream/fairplay.cer",
      "licenseUrl": "https://npo-drm-gateway.samgcloud.nepworldwide.nl/authentication?custom_data=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJucG8iLCJpYXQiOjE1NTI2NjMwNTUsImRybV90eXBlIjoiZmFpcnBsYXkiLCJsaWNlbnNlX3Byb2ZpbGUiOiJ3ZWIiLCJjbGllbnRfaXAiOiI4MC4xMDEuNDkuNSJ9.MrJkJRhFG4lww9Nz7BOJ3NiVb7DyoprVGT4qyMkaFNw"
    }
  },
  "catchupAvailable": true
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -f 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(concat("https://start-player.npo.nl/video/",$a,"/streams?profile=hls&quality=npo&tokenId=",token))/stream/src' -e '$raw'
[...]
#EXT-X-SESSION-KEY:METHOD=SAMPLE-AES,URI="skd://60f29d98-6526-e8e6-02cd-1a6cc037f599",KEYFORMAT="com.apple.streamingkeydelivery",KEYFORMATVERSIONS="1"
[...]

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s --module=xivid.xqm "https://www.npostart.nl/live/npo-1" -e 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(concat("https://start-player.npo.nl/video/",$a,"/streams?profile=hls&amp;quality=npo&amp;tokenId=",token))/stream/[xivid:m3u8-to-json(src)]'
[
  {
    "id": "hls-0",
    "format": "m3u8[manifest]",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/playlist.m3u8?token=ee2a3e8377aa5c6670c36cecbaa4d0c8_1552751413_1552751413"
  },
  {
    "id": "hls-1",
    "format": "m3u8[aac]",
    "resolution": null,
    "bitrate": "128kbps",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000.m3u8"
  },
  [...]
  {
    "id": "hls-5",
    "format": "m3u8[h264+aac]",
    "resolution": "1024x576",
    "bitrate": "1800|128kbps",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8"
  }
]

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ ffmpeg -hide_banner -i "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8"
[https @ 057cf540] Opening 'https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8' for reading
[hls,applehttp @ 051494c0] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 051494c0] Failed to open segment 194083138 of playlist 0
[hls,applehttp @ 051494c0] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 051494c0] Failed to open segment 194083139 of playlist 0
[hls,applehttp @ 051494c0] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 051494c0] Failed to open segment 194083140 of playlist 0
[...]
[hls,applehttp @ 051494c0] Error when loading first segment 'https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000-194083139.ts'

(https://github.com/e2iplayer/hlsdl/releases)
$ hlsdl "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8" -v
> START media_playlist_get_links
> END media_playlist_get_links
HLS Stream is SAMPLE-AES encrypted.
Media Playlist parsed successfully.
{"d_t":"live"}
DownloUpdate thread started
ading part 194092232
Error: Getting key-file [https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8/../skd://60f29d98-6526-e8e6-02cd-1a6cc037f599] failed http_code[502].
{"t_d":32,"d_d":7,"d_s":1896544}
Downloading part 194092233
Error: Getting key-file [https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8/../skd://60f29d98-6526-e8e6-02cd-1a6cc037f599] failed http_code[502].
{"t_d":32,"d_d":15,"d_s":3760564}
Downloading part 194092234
Error: Getting key-file [https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8/../skd://60f29d98-6526-e8e6-02cd-1a6cc037f599] failed http_code[502].
[...]

------------------------------------------------------------------------------------------------

https://www.npostart.nl/live/npo-1 (oude API)

$ xidel -s "http://ida.omroep.nl/app.php/auth" -e '$json'
{
  "token": "6qm1ivpj8q4vm6c4s4fs4cb7i2"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))'
{
  "limited": false,
  "site": null,
  "items": [
    [
      {
        "label": "Live",
        "contentType": "live",
        "url": "https://livestreams.omroep.nl/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8?hash=dfd2fbbc1487ca2af5fb88419e178759&token=3e47c7ec3116134d97460ef058cac2ab&type=jsonp&protection=url",
        "format": "hls"
      }
    ]
  ]
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/json(replace(.//url,"jsonp","json"))'
https://smoote2a.omroep.nl/urishieldv2/l2fm69153f3570e8b83a005c8ce825000000.fee9019baad2e00387eb856a885cd3c8/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

https://www.npostart.nl/live/npo-1-extra

$ xidel -s "https://www.npostart.nl/live/npo-1-extra" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/json(replace(.//url,"jsonp","json"))'
Error:
err:FODC0002: Internet/HTTP Error: 404
when talking to: https://livestreams.omroep.nl/live/npo/thematv/101tv/101tv.isml/101tv.m3u8?hash=cdfe301d72cedc0452845b56c413f99c&token=a6a9cc4f8699d6f410749a9fe984a984&type=json&protection=url

$ xidel -s "https://www.npostart.nl/live/npo-1-extra" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/x:request({"url":replace(.//url,"jsonp","json"),"error-handling":"4xx=accept"})'
{
  "url": "https://livestreams.omroep.nl/live/npo/thematv/101tv/101tv.isml/101tv.m3u8?hash=0b20e3bd652dd5b1c856d20e8db432a1&token=fd1013ba8bdcfa3ab1a8d2c864472745&type=json&protection=url",
  "type": "text/html; charset=UTF-8",
  "headers": [
    "HTTP/1.1 404 Not Found",
    "Date: Sat, 16 Mar 2019 13:19:14 GMT",
    "Content-Type: text/html; charset=UTF-8",
    "Transfer-Encoding: chunked",
    "Vary: Accept-Encoding",
    "Server: nginx",
    "Vary: Accept-Encoding",
    "X-stream-message: flow_valid_livestream: 0: 'Livestream not found in cache or configured as not-available'",
    "Via: 1.1 google",
    ""
  ],
  "raw": "",
  "doc": null
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/x:request({"url":replace(.//url,"jsonp","json"),"error-handling":"4xx=accept"})[json]'
{
  "url": "https://livestreams.omroep.nl/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8?hash=7b77c52239cc1a95354ce79e4e639993&token=8e1c0abf06439fd6ce84f7305fd0d972&type=json&protection=url",
  "type": "application/json",
  "headers": [
    "HTTP/1.1 200 OK",
    "Date: Sat, 16 Mar 2019 23:58:11 GMT",
    "Content-Type: application/json",
    "Transfer-Encoding: chunked",
    "Vary: Accept-Encoding",
    "Server: nginx",
    "Vary: Accept-Encoding",
    "X-stream-message: flow_cluster_instance: 0: 'Success. Used the default NPO cluster'",
    "Via: 1.1 google",
    ""
  ],
  "raw": "\"https:\\/\\/smoote2h.omroep.nl\\/urishieldv2\\/l2fm7efa778b39f993a2005c8d8d93000000.058fc1c4f40aaffb538624957b900806\\/live\\/npo\\/tvlive\\/npo1\\/npo1.isml\\/npo1.m3u8\"",
  "json": "https://smoote2h.omroep.nl/urishieldv2/l2fm7efa778b39f993a2005c8d8d93000000.058fc1c4f40aaffb538624957b900806/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8"
}

$ xidel -s --module=xivid.xqm "https://www.npostart.nl/live/npo-1" -e '{"name":replace(//title," - Live tv",": Livestream"),"date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/x:request({"url":replace(.//url,"jsonp","json"),"error-handling":"4xx=accept"})[json]/xivid:m3u8-to-json(json)}'
{
  "name": "NPO 1: Livestream",
  "date": "16-03-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1-audio=128000.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1800|128kbps",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1-audio=128000-video=1800000.m3u8"
    }
  ]
}

$ xidel -s "https://www.npostart.nl/live/npo-1-extra" -e '[...]'
{
  "name": "NPO 1 extra: Livestream",
  "date": "16-03-2019",
  "formats": null
}

Update 08-04-2019: Werkt inmiddels niet meer.

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))'
Error:
err:FODC0002: Internet/HTTP Error: 500
when talking to: http://ida.omroep.nl/app.php/LI_NL1_4188102?token=3r9d72h0opmhc1invqm9a58hl0
[...]

================================================================================================

[npo] (oude API, per 28-02-2019)

https://www.npostart.nl/nos-journaal/15-03-2019/POW_04059374

$ xidel -se 'json(concat("http://ida.omroep.nl/app.php/POW_04059374?token=",json("http://ida.omroep.nl/app.php/auth")/token))'
{
  "limited": false,
  "site": null,
  "items": [
    [
      {
        "label": "Adaptive",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/adaptive/a40fc245d68bbd6ade6fee8b87006187/5c8d0c0b/POW_04059374/1?extension=m3u8&type=jsonp&callback=?",
        "format": "hls"
      },
      {
        "label": "Hoog",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/h264_std/2f7433794cbff513f772501b34b71b3b/5c8d0c0b/POW_04059374/1?type=jsonp&callback=?",
        "format": "mp4"
      },
      {
        "label": "Normaal",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/h264_bb/ef0a10051d3de9560e78ecccd83bb38c/5c8d0c0b/POW_04059374/1?type=jsonp&callback=?",
        "format": "mp4"
      },
      {
        "label": "Laag",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/h264_sb/dd0bbb0bfa1194b20513f311e34c84f9/5c8d0c0b/POW_04059374/1?type=jsonp&callback=?",
        "format": "mp4"
      }
    ]
  ]
}

$ xidel -se 'json(concat("http://ida.omroep.nl/app.php/POW_04059374?token=",json("http://ida.omroep.nl/app.php/auth")/token))//url ! json(replace(.,"jsonp","json"))/url'
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/adaptive/2b39f51e5a4d9e865fe7c95340ffd0af/5c8d0c98/POW_04059374/1?extension=m3u8&type=json&callback=?
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/h264_std/6d301b8d73b7e8ef4eab42845f536eff/5c8d0c98/POW_04059374/1?type=json&callback=?
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/h264_bb/6ce7a8fe765d62925943cd3ba8d0dcc2/5c8d0c98/POW_04059374/1?type=json&callback=?
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/h264_sb/25e8a3d0cd41c7e396b368b0dcd3d424/5c8d0c98/POW_04059374/1?type=json&callback=?

================================================================================================

[npo] (huidige API)

$ url=https://www.npostart.nl/nos-journaal/28-02-2017/POW_03375558 (laatste NOS Journaal 20:00 zonder DRM)

$ xidel -se 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json return $token2'
{
  "token": "eyJ0eXA[...]fFLtQQU",
  "embedUrl": "https://start-player.npo.nl/embed/eyJ0eXA[...]fFLtQQU",
  "embedCode": "<script async>if (typeof(NPOFrame) === \"function\") { NPOFrame('player-POW_03375558',  'https://start-player.npo.nl/embed/eyJ0eXA[...]fFLtQQU', 'POW_03375558'); } else { var el = document.createElement('script'); el.src = 'https://start-player.npo.nl/js/embed.min.js'; el.onload = function(){NPOFrame('player-POW_03375558',  'https://start-player.npo.nl/embed/eyJ0eXA[...]fFLtQQU', 'POW_03375558');};document.getElementById('player-POW_03375558').appendChild(el);}</script>"
}

$ xidel -se 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]) return $info'
{
  "id": "POW_03375558",
  "type": "broadcast",
  "title": "NOS Journaal",
  "subtitles": [
    {
      "label": "Nederlands",
      "default": false,
      "language": "nl",
      "src": "https://assetscdn.npostart.nl/subtitles/original/nl/POW_03375558.vtt"
    }
  ],
  "seasonNumber": 44,
  "episodeTitle": "NOS Journaal",
  "franchiseTitle": "NOS Journaal 20.00 uur",
  "description": "Met het laatste nieuws, gebeurtenissen van nationaal en internationaal belang en de weersverwachting voor de avond en komende dagen.",
  "duration": 1537,
  "age_rating": null,
  "still_image_url": "https://images.npo.nl/tile/1280x720/870755.jpg",
  "orig_image_url": "https://images.npo.nl/tile/original/870755.jpg",
  "post_play_url": "https://images.npo.nl/tile/256x144/870755.jpg",
  "grid_image_url": "https://images.npo.nl/tile/320x180/870755.jpg",
  "share_text": "Bekijk NOS Journaal op https://www.npostart.nl/POW_03375558",
  "share_url": "https://www.npostart.nl/POW_03375558",
  "broadcasters": ["NOS"],
  "broadcastersLogo": {
    "NOS": "https://www-assets.npo.nl/uploads/broadcaster/32/logo/nos-large.png"
  },
  "broadcastDate": "2017-02-28T19:00:00Z",
  "nextAsset": [...],
  "qualityOptions": [
    {
      "bitrate": "0",
      "label": "Hoogste",
      "resolution": "1080p",
      "platform": "npo"
    },
    {
      "bitrate": "643000",
      "label": "Hoog",
      "resolution": "720p",
      "platform": "npo"
    },
    {
      "bitrate": "491000",
      "label": "Medium",
      "resolution": "576p",
      "platform": "npo"
    },
    {
      "bitrate": "248000",
      "label": "Laag",
      "resolution": "360p",
      "platform": "npo"
    }
  ],
  "visualRadio": null,
  "isVisualRadio": false,
  "episodeNumber": 42,
  "seriesId": "NOSjnl2000",
  "net": null,
  "genres": "informatief,nieuws/actualiteiten",
  "ster": {
    "uri": "https://asd09ikggk5r.nl/adurl/[...]",
    "customParameters": {
      "prid": "POW_03375558",
      "srid": "NOSjnl2000"
    },
    "placeholderValues": {
      "$$netwerk_id$$": "9233",
      "$$genre$$": "informatief",
      "$$subgenre$$": "nieuws/actualiteiten",
      "$$video_duur$$": 1537,
      "$$net$$": null,
      "$$omroep$$": "nos",
      "$$programma_titel$$": "nosjournaal2000uur",
      "$$programmanaam$$": "nosjournaal2000uur",
      "$$stationid$$": "npo",
      "$$afleverings_titel$$": "nosjournaal"
    }
  },
  "recommender": "ts-base",
  "startAt": null,
  "parentId": null,
  "channel": "NED1"
  "playerTitle": "NOS Journaal 20.00 uur",
  "playerSubTitle": "Seizoen 44 Afl. 42 - NOS Journaal"
}

$ xidel -se 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$stream:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&quality=npo&tokenId=",$token2/token)) return $stream'
{
  "metadata": {
    "live": false,
    "supportSeeking": true,
    "catchupAvailable": false
  },
  "stream": {
    "src": "https://npo.prd.cdn.bcms.kpn.com/[...]/playlist.m3u8",
    "type": "application/vnd.apple.mpegurl"
  },
  "selectedQuality": "npo",
  "debug": {
    "skipCatalog": false,
    "skipAds": false,
    "selectedQuality": "npo",
    "profile": "hls",
    "stream": "https://npo.prd.cdn.bcms.kpn.com/[...]/playlist.m3u8",
    "streamType": "hls_unencrypted"
  }
}

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$stream:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&quality=npo&tokenId=",$token2/token))/stream/src return $info/{"name":concat(franchiseTitle,if (contains(franchiseTitle,title)) then () else ": "||title),"date":format-date(dateTime(broadcastDate) + implicit-timezone(),"[D01]-[M01]-[Y]"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[(subtitles)()/{"id":"sub-1","format":"vtt","language":language,"label":label,"url":src},xivid:m3u8-to-json($stream)]}'
{
  "name": "NOS Journaal 20.00 uur",
  "date": "28-02-2017",
  "duration": "00:25:37",
  "formats": [
    {
      "id": "sub-1",
      "format": "vtt",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://assetscdn.npostart.nl/subtitles/original/nl/POW_03375558.vtt"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://nl-ams-p11-am3.cdn.streamgate.nl/[...]/playlist.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "64kbps",
      "url": "https://nl-ams-p11-am3.cdn.streamgate.nl/[...]/POW_03375558_v4-audio=64000.m3u8"
    },
    [...]
    {
      "id": "hls-6",
      "format": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1109|128kbps",
      "url": "https://nl-ams-p11-am3.cdn.streamgate.nl/[...]/POW_03375558_v4-audio=128000-video=1109000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

$ url=https://www.npostart.nl/nos-journaal/25-07-2020/POW_04508531 (video met DRM)

$ xidel -se 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$stream:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&quality=npo&tokenId=",$token2/token)) return $stream'
{
  "metadata": {
    "live": false,
    "supportSeeking": true,
    "catchupAvailable": false
  },
  "stream": {
    "src": "https://nl-ams-p22-am3.cdn.streamgate.nl/[...]/playlist.m3u8",
    "type": "application/vnd.apple.mpegurl",
    "protection": {
      "keySystem": "com.apple.fps.1_0",
      "certificateUrl": "https://s3-eu-west-1.amazonaws.com/24i-npo-stream/fairplay.cer",
      "licenseUrl": "https://npo-drm-gateway.samgcloud.nepworldwide.nl/authentication?custom_data=eyJ0eXA[...]_eEOSDA"
    }
  },
  "selectedQuality": "npo",
  "debug": {
    "skipCatalog": false,
    "skipAds": false,
    "selectedQuality": "npo",
    "profile": "hls",
    "stream": "https://nl-ams-p22-am3.cdn.streamgate.nl/[...]/playlist.m3u8",
    "streamType": "hls_fairplay"
  }
}

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$stream:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&quality=npo&tokenId=",$token2/token))/stream/src return $info/{"name":concat(franchiseTitle,if (contains(franchiseTitle,title)) then () else ": "||title),"date":format-date(dateTime(broadcastDate) + implicit-timezone(),"[D01]-[M01]-[Y]"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[(subtitles)()/{"id":"sub-1","format":"vtt","language":language,"label":label,"url":src},xivid:m3u8-to-json($stream)]}'
{
  "name": "NOS Journaal 20.00 uur",
  "date": "25-07-2020",
  "duration": "00:22:51",
  "formats": [
    {
      "id": "sub-1",
      "format": "vtt",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://assetscdn.npostart.nl/subtitles/original/nl/POW_04508531.vtt"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/playlist.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/a1/a1.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "960x540",
      "bitrate": "2326kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/v4/v4.m3u8"
    }
  ]
}

$ ffmpeg -hide_banner -i "https://npo.prd.cdn.bcms.kpn.com/c358e6551168f1112522bc46e0027992_1595804237/vod/npo/fps/TEST/npo/hls/POW_04508531_v1595701604/v4/v4.m3u8"
[hls @ 050e8b80] Skip ('#EXT-X-VERSION:5')
[hls @ 050e8b80] Skip ('## Created with Unified Streaming Platform(version=1.7.18)')
[hls @ 050e8b80] Skip ('#EXT-X-INDEPENDENT-SEGMENTS')
[hls @ 050e8b80] Skip ('#USP-X-MEDIA:BANDWIDTH=2194000,AVERAGE-BANDWIDTH=1990000,TYPE=VIDEO,GROUP-ID="video-avc1-1921",LANGUAGE="en",NAME="English",AUTOSELECT=YES,CODECS="avc1.4D401F",RESOLUTION=960x540')
[hls @ 050e8b80] SAMPLE-AES encryption is not supported yet
[hls @ 050e8b80] Failed to open segment 0 of playlist 0
[hls @ 050e8b80] SAMPLE-AES encryption is not supported yet
[hls @ 050e8b80] Failed to open segment 1 of playlist 0
[...]
[hls @ 050e8b80] SAMPLE-AES encryption is not supported yet
[hls @ 050e8b80] Failed to open segment 171 of playlist 0
[hls @ 050e8b80] Error when loading first segment 'https://npo.prd.cdn.bcms.kpn.com/c358e6551168f111
2522bc46e0027992_1595804237/vod/npo/fps/TEST/npo/hls/POW_04508531_v1595701604/v4/v4.ts'

In de praktijk wordt SAMPLE-AES alleen voor DRM gebruikt, dus de FFmpeg community zal dit nooit toevoegen.

Controleer in het "stream"-object op de aanwezigheid van het "protection"-object om beveiligde/versleutelde video's er uit te filteren:
-e "[...]$c:=[...]/stream[not(protection)]/src
                         ^~~~~~~~~~~~~~~~~

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$stream:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&quality=npo&tokenId=",$token2/token))/stream[not(protection)]/src return $info/{"name":concat(franchiseTitle,if (contains(franchiseTitle,title)) then () else ": "||title),"date":format-date(dateTime(broadcastDate) + implicit-timezone(),"[D01]-[M01]-[Y]"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[(subtitles)()/{"id":"sub-1","format":"vtt","language":language,"label":label,"url":src},xivid:m3u8-to-json($stream)]}'
{
  "name": "NOS Journaal 20.00 uur",
  "date": "25-07-2020",
  "duration": "00:22:51",
  "formats": [
    {
      "id": "sub-1",
      "format": "vtt",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://assetscdn.npostart.nl/subtitles/original/nl/POW_04508531.vtt"
    }
  ]
}

------------------------------------------------------------------------------------------------

$ url=https://www.npostart.nl/stop-verkeerslicht-voor-telefoonverslaafde/14-02-2017/POMS_NOS_7332477 (videofragment)

$ xidel -se 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]) return $info'
{
  "id": "POMS_NOS_7332477",
  "type": "fragment",
  "title": "STOP! Verkeerslicht voor telefoonverslaafde",
  "subtitles": [],
  "seasonNumber": null,
  "episodeTitle": "",
  "franchiseTitle": "NOS Journaal",
  "description": "Een verkeerslicht in de stoep, om zo voetgangers die in gedachten verzonken op hun smartphone zitten te kijken extra te waarschuwen.",
  "duration": 65,
  "age_rating": null,
  "still_image_url": "https://images.npo.nl/tile/1280x720/865203.jpg",
  "orig_image_url": "https://images.npo.nl/tile/original/865203.jpg",
  "post_play_url": "https://images.npo.nl/tile/256x144/865203.jpg",
  "grid_image_url": "https://images.npo.nl/tile/320x180/865203.jpg",
  "share_text": "Bekijk STOP! Verkeerslicht voor telefoonverslaafde op https://www.npostart.nl/POMS_NOS_7332477",
  "share_url": "https://www.npostart.nl/POMS_NOS_7332477",
  "broadcasters": ["NOS"],
  "broadcastersLogo": {
    "NOS": "https://www-assets.npo.nl/uploads/broadcaster/32/logo/nos-large.png"
  },
  "broadcastDate": "2017-02-14T12:00:00Z",
  "nextAsset": null,
  "nextAssetId": null,
  "prevAssetId": null,
  "qualityOptions": [
    {
      "bitrate": "0",
      "label": "Hoogste",
      "resolution": "1080p",
      "platform": "npo"
    },
    {
      "bitrate": "643000",
      "label": "Hoog",
      "resolution": "720p",
      "platform": "npo"
    },
    {
      "bitrate": "491000",
      "label": "Medium",
      "resolution": "576p",
      "platform": "npo"
    },
    {
      "bitrate": "248000",
      "label": "Laag",
      "resolution": "360p",
      "platform": "npo"
    }
  ],
  "visualRadio": null,
  "isVisualRadio": false,
  "episodeNumber": null,
  "seriesId": "NOSJournaal",
  "net": null,
  "genres": "Informatief,Nieuws/actualiteiten",
  "ster": {
    "uri": "https://asd09ikggk5r.nl/adurl/[...]",
    "customParameters": {
      "prid": "POMS_NOS_7332477",
      "srid": "NOSJournaal"
    },
    "placeholderValues": {
      "$$netwerk_id$$": "9233",
      "$$genre$$": "informatief",
      "$$subgenre$$": "nieuws/actualiteiten",
      "$$video_duur$$": 65,
      "$$net$$": null,
      "$$omroep$$": "nos",
      "$$programma_titel$$": "nosjournaal",
      "$$programmanaam$$": "nosjournaal",
      "$$stationid$$": "npo",
      "$$afleverings_titel$$": "stopverkeerslichtvoortelefoonverslaafde"
    }
  },
  "recommender": "ts-base",
  "startAt": 542,
  "parentId": "POW_03373320",
  "channel": "NED1",
  "playerTitle": "Fragment: NOS Journaal  14 feb 2017 13:00",
  "playerSubTitle": null
}

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$stream:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&quality=npo&tokenId=",$token2/token))/stream[not(protection)]/src return $info/{"name":concat(franchiseTitle,if (contains(franchiseTitle,title)) then () else ": "||title),"date":format-date(dateTime(broadcastDate) + implicit-timezone(),"[D01]-[M01]-[Y]"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"start":if (startAt) then format-time(startAt * duration("PT1S"),"[H01]:[m01]:[s01]") else (),"end":if (startAt) then format-time((startAt + duration) * duration("PT1S"),"[H01]:[m01]:[s01]") else (),"formats":[(if (not((subtitles)()) and parentId) then json(doc(x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||parentId})/json/embedUrl)//script/extract(.,"var video =(.+);",1)[.]) else .)/(subtitles)()/{"id":"sub-1","format":"vtt","language":language,"label":label,"url":src},xivid:m3u8-to-json($stream)]}'
{
  "name": "NOS Journaal: STOP! Verkeerslicht voor telefoonverslaafde",
  "date": "14-02-2017",
  "duration": "00:01:05",
  "start": "00:09:02",
  "end": "00:10:07",
  "formats": [
    {
      "id": "sub-1",
      "format": "vtt",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://assetscdn.npostart.nl/subtitles/original/nl/POW_03373320.vtt"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/playlist.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "64kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=64000.m3u8"
    },
    {
      "id": "hls-2",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=128000.m3u8"
    },
    {
      "id": "hls-3",
      "format": "m3u8[aac]",
      "resolution": "480x270",
      "bitrate": "209|64kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=64000-video=209000.m3u8"
    },
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "517|128kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=128000-video=517000.m3u8"
    },
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "721|128kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=128000-video=721000.m3u8"
    },
    {
      "id": "hls-6",
      "format": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1027|128kbps",
      "url": "https://npo.prd.cdn.bcms.kpn.com/[...]/POW_03373320_v4-audio=128000-video=1027000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

$ url=https://www.npostart.nl/flikken-maastricht/01-03-2019/AT_2105037

$ xidel -se 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json return unparsed-text($token2/embedUrl)'
<!DOCTYPE html>
<html>
<head>
    <title>Flikken Maastricht</title>
    <link href="/styles/video-js.css" rel="stylesheet">
    <link href="/styles/main.css" rel="stylesheet">
            <link href="https://www.npostart.nl/styles/player.css" rel="stylesheet">
    </head>

<body>
<div class="npo-player-overlay" id="npo-player-exclusive" style="background-image: url('https://images.npo.nl/tile/1280x720/1195341.jpg');" >
    <div class="npo-player-overlay-bg"></div>
    <div class="npo-player-overlay-message">
                    <p class="code-41">Dit programma is alleen te zien met een NPO Plus account (41).</p>


                <p></p>
    </div>
</div>
</body>
</html>

Geen JSON en dus geen enkele video-informatie (van deze DRM video). De hoofdpagina heeft die wel.

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'let $prid:=extract("'$url'",".+/([\w_]+)",1),$token:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/token,$token2:=x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$prid})/json,$info:=json(doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$stream:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&quality=npo&tokenId=",$token2/token))/stream[not(protection)]/src return {|if ($info) then $info/{"name":concat(franchiseTitle,if (contains(franchiseTitle,title)) then () else ": "||title),"date":format-date(dateTime(broadcastDate) + implicit-timezone(),"[D01]-[M01]-[Y]"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"start":if (startAt) then format-time(startAt * duration("PT1S"),"[H01]:[m01]:[s01]") else (),"end":if (startAt) then format-time((startAt + duration) * duration("PT1S"),"[H01]:[m01]:[s01]") else ()} else doc("https://www.npostart.nl/"||$prid)/(let $info:=json(//script[@type="application/ld+json"]) return {"name"://npo-player-header/concat(@main-title,": ",@share-title),"date":format-date(dateTime($info/uploadDate),"[D01]-[M01]-[Y]"),"duration":format-time(duration($info/duration),"[H01]:[m01]:[s01]")}),{"formats":[(if (not($info/(subtitles)()) and $info/parentId) then json(doc(x:request({"post":"_token="||$token,"url":"https://www.npostart.nl/player/"||$info/parentId})/json/embedUrl)//script/extract(.,"var video =(.+);",1)[.]) else $info)/(subtitles)()/{"id":"sub-1","format":"vtt","language":language,"label":label,"url":src},xivid:m3u8-to-json($stream)]}|}'
{
  "name": "Flikken Maastricht: Virtus et justitia",
  "date": "01-03-2019",
  "duration": "00:47:27",
  "formats": []
}

------------------------------------------------------------------------------------------------

declare function xivid:npo($url as string) as object()? {
  let $prid:=extract($url,".+/([\w_]+)",1),
      $token:=x:request({
        "header":"X-Requested-With: XMLHttpRequest",
        "url":"https://www.npostart.nl/api/token"
      })/json/token,
      $token2:=x:request({
        "post":"_token="||$token,
        "url":"https://www.npostart.nl/player/"||$prid
      })/json,
      $info:=json(
        doc($token2/embedUrl)//script/extract(.,"var video =(.+);",1)[.]
      ),
      $stream:=json(
        concat(
          "https://start-player.npo.nl/video/",
          $prid,
          "/streams?profile=hls&amp;quality=npo&amp;tokenId=",
          $token2/token
        )
      )/stream[not(protection)]/src
  return {|
    if ($info) then $info/{
      "name":concat(
        franchiseTitle,
        if (contains(franchiseTitle,title)) then () else ": "||title
      ),
      "date":format-date(
        dateTime(broadcastDate) + implicit-timezone(),
        "[D01]-[M01]-[Y]"
      ),
      "duration":format-time(
        duration * duration("PT1S"),
        "[H01]:[m01]:[s01]"
      ),
      "start":if (startAt) then
        format-time(
          startAt * duration("PT1S"),
          "[H01]:[m01]:[s01]"
        )
      else
        (),
      "end":if (startAt) then
        format-time(
          (startAt + duration) * duration("PT1S"),
          "[H01]:[m01]:[s01]"
        )
      else
        ()
    } else
      doc("https://www.npostart.nl/"||$prid)/(
        let $info:=json(//script[@type="application/ld+json"]) return {
          "name"://npo-player-header/concat(
            @main-title,
            ": ",
            @share-title
          ),
          "date":format-date(
            dateTime($info/uploadDate),
            "[D01]-[M01]-[Y]"
          ),
          "duration":format-time(
            duration($info/duration),
            "[H01]:[m01]:[s01]"
          )
        }
      ),
    {
      "formats":[
        (
          if (not($info/(subtitles)()) and $info/parentId) then
            json(
              doc(
                x:request({
                  "post":"_token="||$token,
                  "url":"https://www.npostart.nl/player/"||$info/parentId
                })/json/embedUrl
              )//script/extract(.,"var video =(.+);",1)[.]
            )
          else
            $info
        )/(subtitles)()/{
          "id":"sub-1",
          "format":"vtt",
          "language":language,
          "label":label,
          "url":src
        },
        xivid:m3u8-to-json($stream)
      ]
    }
  |}
};

================================================================================================

[rtl]

# oude, maar nog steeds werkende api:

$ url=https://www.rtlxl.nl/programma/rtl-nieuws/cefbd40f-34a0-3f94-b3d8-1705119c79f4/ (RTL Nieuws van 18-05-2019 19:30, met expiration-date "18-05-2020 06:52:29")

$ xidel -se 'concat("http://www.rtl.nl/system/s4m/vfd/version=2/uuid=",extract("'$url'",".+/(.+)",1),"/fmt=adaptive/")'
http://www.rtl.nl/system/s4m/vfd/version=2/uuid=cefbd40f-34a0-3f94-b3d8-1705119c79f4/fmt=adaptive/

$ xidel -se 'json(concat("http://www.rtl.nl/system/s4m/vfd/version=2/uuid=",extract("'$url'",".+/(.+)",1),"/fmt=adaptive/"))'
{
  "meta": {
    [...]
    "nr_of_videos_total": 0,
    "nr_of_videos_onpage": 0,
    [...]
  },
  [...]
}

$ url=https://www.rtlxl.nl/programma/rtl-nieuws/bf475894-02ce-3724-9a6f-91de543b8a4c (RTL Nieuws van 26-06-2020 19:30)

$ xidel -se 'json(concat("http://www.rtl.nl/system/s4m/vfd/version=2/uuid=",extract("'$url'",".+/(.+)",1),"/fmt=adaptive/"))[meta/nr_of_videos_total gt 0]'
{
  "meta": {
    "jsonp": "0",
    "sort": "date desc",
    "product": "rtlxl",
    "context": "nocontext",
    "output": "json",
    "uuid": "bf475894-02ce-3724-9a6f-91de543b8a4c",
    "fmt": "adaptive",
    "fun": "abstract",
    "pg": "1",
    "supports_drm": "0",
    "version": "2",
    "d": "pc",
    "videohost": "http://manifest.us.rtl.nl",
    "nr_of_videos_total": 1,
    "nr_of_videos_onpage": 1,
    "nicam_base_url": "http://data.rtl.nl/active/s4mlib/nicam/xl3/*.png",
    "proglogo_base_url": "http://logos.rtl.nl/logo/s/240/",
    "thumb_base_url": "http://screenshots.rtl.nl/sz=355x200/uuid=",
    "poster_base_url": "http://screenshots.rtl.nl/sz=720x404/uuid=",
    "cover_base_url": "http://covers.rtl.nl/system/cover/l/pc/"
  },
  "classes": [
    {
      "abstract_key": "",
      "classname": "uitzending",
      "display": "afleveringen",
      "sko_ty": "tv.ep"
    }
  ],
  "genres": [],
  "collection": {
    "key": "132237",
    "name": "RTL Nieuws",
    "rtl_source": "rtlnieuws"
  },
  "abstracts": [
    {
      "key": "132237",
      "on_page": true,
      "name": "RTL Nieuws",
      "progsubtype": "nieuws",
      "is_telekids": false,
      "is_sport": false,
      "website": "http://www.rtl.nl/actueel/rtlnieuws/",
      "alias": "journaal",
      "synopsis": "Dagelijks het laatste nieuws uit binnen- en buitenland. Voor nog meer nieuws kunt u ook gebruikmaken van onze mobiele apps."
    }
  ],
  "seasons": [
    {
      "key": "504188",
      "abstract_key": "132237",
      "on_page": true,
      "name": "19:30 uur",
      "synopsis": "Dagelijks het laatste nieuws uit binnen- en buitenland. Voor nog meer nieuws kunt u ook gebruikmaken van onze mobiele apps.",
      "website": "",
      "volgnr": 122
    }
  ],
  "episodes": [
    {
      "key": "504366",
      "name": "19:30 uur",
      "volgnr": 178,
      "nicam": "",
      "genre": "",
      "product_genre": "Nieuws En Actualiteit",
      "prodyear": "",
      "synopsis": "Dagelijks het laatste nieuws uit binnen- en buitenland. Voor nog meer nieuws kunt u ook gebruikmaken van onze mobiele apps."
    }
  ],
  "material": [
    {
      "uuid": "bf475894-02ce-3724-9a6f-91de543b8a4c",
      "abstract_key": "132237",
      "season_key": "504188",
      "episode_key": "504366",
      "classname": "uitzending",
      "duration": "00:21:10.120",
      "image": "bf475894-02ce-3724-9a6f-91de543b8a4c",
      "title": "",
      "nicam": "",
      "display_date": 1593192600,
      "original_date": 1593192600,
      "ddr_audience": "DRM",
      "ddr_tariff": "AVOD",
      "ddr_model": "AVOD",
      "quality": "HD",
      "fov": "",
      "station": "RTL4",
      "ddr_allow_sharing": true,
      "thumb_id": "0",
      "marketing_params": [...],
      "videopath": "/rtlxl/v166/network/pc/adaptive/components/actueel/rtlnieuws/504188/bf475894-02ce-3724-9a6f-91de543b8a4c.ssm/bf475894-02ce-3724-9a6f-91de543b8a4c.m3u8",
      "user_rating": "",
      "date_source": "broadcasted",
      "breakpoints": [],
      "ddr_timeframes": [
        {
          "start": 1593192638,
          "stop": 1624728638,
          "tariff": 0,
          "is_preview": false,
          "expiration": "1x",
          "model": "AVOD"
        }
      ],
      "keywords": "",
      "synopsis": ""
    }
  ]
}

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'json(concat("http://www.rtl.nl/system/s4m/vfd/version=2/uuid=",extract("'$url'",".+/(.+)",1),"/fmt=adaptive/"))[meta/nr_of_videos_total gt 0]/{"name":concat(.//station,": ",abstracts/name," - ",if (.//classname="uitzending") then episodes/name else .//title),"date":format-date((material)()/original_date * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":format-time(time((material)()/duration) + duration("PT0.5S"),"[H01]:[m01]:[s01]"),"expdate":format-dateTime((.//ddr_timeframes)()[model="AVOD"]/stop * duration("PT1S") + implicit-timezone() + dateTime("1970-01-01T00:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json(.//videohost||.//videopath)}'
{
  "name": "RTL4: RTL Nieuws - 19:30 uur",
  "date": "26-06-2020",
  "duration": "00:21:10",
  "expdate": "26-06-2021 19:30:38",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "http://manifest.us.rtl.nl/rtlxl/v166/network/pc/adaptive/components/actueel/rtlnieuws/[...]/bf475894-02ce-3724-9a6f-91de543b8a4c.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/[...]/bf475894-02ce-3724-9a6f-91de543b8a4c-audio=125437.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3819|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/[...]/bf475894-02ce-3724-9a6f-91de543b8a4c-audio=125437-video=3819000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

$ url=https://www.rtlnieuws.nl/nieuws/video/video/5167967/snel-dooiende-permafrost-tikkende-klimaattijdbom

$ xidel -se 'concat("http://www.rtl.nl/system/s4m/vfd/version=2/uuid=",if (contains("'$url'","rtlnieuws.nl")) then doc("'$url'")//@data-uuid else extract("'$url'",".+/(.+)",1),"/fmt=adaptive/")'
http://www.rtl.nl/system/s4m/vfd/version=2/uuid=91625309-23cd-4ea2-84a2-aeceaa9920a3/fmt=adaptive/

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'json(concat("http://www.rtl.nl/system/s4m/vfd/version=2/uuid=",if (contains("'$url'","rtlnieuws.nl")) then doc("'$url'")//@data-uuid else extract("'$url'",".+/(.+)",1),"/fmt=adaptive/"))[meta/nr_of_videos_total gt 0]/{"name":concat(.//station,": ",abstracts/name," - ",if (.//classname="uitzending") then episodes/name else .//title),"date":format-date((material)()/original_date * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":format-time(time((material)()/duration) + duration("PT0.5S"),"[H01]:[m01]:[s01]"),"expdate":format-dateTime((.//ddr_timeframes)()[model="AVOD"]/stop * duration("PT1S") + implicit-timezone() + dateTime("1970-01-01T00:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json(.//videohost||.//videopath)}'
{
  "name": "RTL4: RTL Nieuws - Snel dooiende permafrost is tikkende klimaattijdbom",
  "date": "26-06-2020",
  "duration": "00:02:19",
  "expdate": null,
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "http://manifest.us.rtl.nl/rtlxl/v166/network/pc/adaptive/components/actueel/rtlnieuws/[...]/91625309-23cd-4ea2-84a2-aeceaa9920a3.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/[...]/91625309-23cd-4ea2-84a2-aeceaa9920a3-audio_eng=125413.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3291|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/[...]/91625309-23cd-4ea2-84a2-aeceaa9920a3-audio_eng=125413-video=3291000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

declare function xivid:rtl($url as string) as object()? {
  json(
    concat(
      "http://www.rtl.nl/system/s4m/vfd/version=2/uuid=",
      if (contains($url,"rtlnieuws.nl")) then
        doc($url)//@data-uuid
      else
        extract($url,".+/(.+)",1),
      "/fmt=adaptive/"
    )
  )[meta/nr_of_videos_total gt 0]/{
    "name":concat(
      .//station,
      ": ",
      abstracts/name,
      " - ",
      if (.//classname="uitzending") then episodes/name else .//title
    ),
    "date":format-date(
      (material)()/original_date * duration("PT1S") +
      implicit-timezone() + date("1970-01-01"),
      "[D01]-[M01]-[Y]"
    ),
    "duration":format-time(
      time((material)()/duration) + duration("PT0.5S"),
      "[H01]:[m01]:[s01]"
    ),
    "expdate":format-dateTime(
      (.//ddr_timeframes)()[model="AVOD"]/stop * duration("PT1S") +
      implicit-timezone() + dateTime("1970-01-01T00:00:00"),
      "[D01]-[M01]-[Y] [H01]:[m01]:[s01]"
    ),
    "formats":xivid:m3u8-to-json(.//videohost||.//videopath)
  }
};

================================================================================================

[kijk]

$ url=https://www.kijk.nl/programmas/wegmisbruikers/C5IYffeeRR8/seizoen/122814504378/afleveringen/video/empty_episode-wegmisbruikers-s25-e10-2020-03-22/p6jYhd96olD

$ xidel -se 'let $json:=json(doc("'$url'")//script[@type="application/json"])/props return $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)]'
Program:129350184257
Program:129350184257.media.0
Program:129350184257.media.0.mediaContent.0
Program:129350184257.media.0.mediaContent.1
Program:129350184257.media.0.mediaContent.2
Program:129350184257.media.0.mediaContent.3
Program:129350184257.media.0.mediaContent.4
Program:129350184257.imageMedia.0
Program:129350184257.sources.0
Program:129350184257.sources.1
Program:129350184257.sources.2
Program:129350184257.tracks.0
Program:129350184257.tracks.1
Program:129350184257.ratings.0

$ xidel -se 'let $json:=json(doc("'$url'")//script[@type="application/json"])/props return ($json/pageProps/format,for $x in $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)] return $json/(apolloState)($x))'
{
  "id": "108132904109",
  "guid": "C5IYffeeRR8",
  "slug": "wegmisbruikers",
  "tvSeasonId": "122814504378",
  "type": "SERIES",
  "title": "Wegmisbruikers",
  "description": "Aan de hand van videobeelden van de Nationale Politie worden automobilisten, motorrijders, vrachtwagenchauffeurs en fietsers met de mogelijke gevolgen van hun gevaarlijke rijgedrag geconfronteerd.",
  "epgDate": null,
  "longDescription": "Aan de hand van videobeelden van de Nationale Politie worden automobilisten, motorrijders, vrachtwagenchauffeurs en fietsers met de mogelijke gevolgen van hun gevaarlijke rijgedrag geconfronteerd.",
  "shortDescription": "Aan de hand van videobeelden van de Nationale Politie worden automobilisten, motorrijders, vrachtwagenchauffeurs en fietsers met de mogelijke gevolgen van hun gevaarlijke rijgedrag geconfronteerd.",
  "displayGenre": "Reality",
  "tvSeasonEpisodeNumber": null,
  "seasonNumber": null,
  "seriesEpisodeNumber": null,
  "seriesId": null,
  "duration": null,
  "episodeTitleGenerator": "EPISODE_TITLE",
  "updated": 1579104755000,
  [...]
}
{
  "id": "129350184257",
  "slug": "empty_episode-wegmisbruikers-s25-e10-2020-03-22",
  "seriesId": "http://data.entertainment.tv.theplatform.eu/entertainment/data/Program/guid/2707491435/C5IYffeeRR8",
  "tvSeasonId": "http://data.entertainment.tv.theplatform.eu/entertainment/data/TvSeason/122814504378",
  "seasonNumber": 25,
  "tvSeasonEpisodeNumber": 10,
  "shortDescription": "Aan de hand van videobeelden van de Nationale Politie worden automobilisten, motorrijders, vrachtwagenchauffeurs en fietsers met de mogelijke gevolgen van hun gevaarlijke rijgedrag geconfronteerd.",
  "duration": 2380.96,
  "epgDate": 1584835200000,
  [...]
  "__typename": "Program",
  "guid": "p6jYhd96olD",
  "type": "EPISODE",
  "title": null,
  "description": "Aan de hand van videobeelden van de Nationale Politie worden automobilisten, motorrijders, vrachtwagenchauffeurs en fietsers met de mogelijke gevolgen van hun gevaarlijke rijgedrag geconfronteerd.",
  "longDescription": "Aan de hand van videobeelden van de Nationale Politie worden automobilisten, motorrijders, vrachtwagenchauffeurs en fietsers met de mogelijke gevolgen van hun gevaarlijke rijgedrag geconfronteerd.",
  "displayGenre": "Scripted Reality",
  "seriesEpisodeNumber": 434,
  "series": {
    "type": "id",
    "generated": false,
    "id": "Program:108132904109",
    "typename": "Program"
  },
  "updated": 1584458350000,
  "metadata": {
    "type": "json",
    "json": {
      "media_datecreated": 1584400800000,
      "media_datemodified": 1584458350000,
      "media_datepublished": 1584905400000,
      "media_duration": 2380.96,
      "media_genre": "Scripted Reality",
      "media_id": "p6jYhd96olD",
      "media_name": null,
      "media_program_episodenumber": 10,
      "media_program_name": "EMPTY_Episode: Wegmisbruikers - S:25 - E:10 - 2020-03-22",
      "media_program_season": 25,
      "media_videotype": "episode",
      "player_embedurl": "https://www.kijk.nl/video/p6jYhd96olD",
      "c_media_duration_type": "long",
      "c_media_live": null,
      "c_media_playbacktype": "vod",
      "c_media_genre_code": "Overige",
      "c_sko_ty": "tv.ep",
      "c_sko_stid": null,
      "c_sko_t": null,
      "c_sko_dt": null,
      "c_sko_gen": null,
      "c_sko_pr": null,
      "c_sko_prid": null
    }
  },
  [...]
}
[...]
{
  "type": "dash",
  "file": "https://vod-kijk2-prod.talpatvcdn.nl/p6jYhd96olD/ffc9e6f7-f998-0b73-2838-eb18a27226e6/p6jYhd96olD-index.ism/p6jYhd96olD.mpd?filter=(systemBitrate%3C3500000)",
  "drm": null,
  "__typename": "Source"
}
{
  "type": "ism",
  "file": "https://vod-kijk2-prod.talpatvcdn.nl/p6jYhd96olD/ffc9e6f7-f998-0b73-2838-eb18a27226e6/p6jYhd96olD-index.ism/p6jYhd96olD.ismc?filter=(systemBitrate%3C3500000)",
  "drm": null,
  "__typename": "Source"
}
{
  "type": "m3u8",
  "file": "https://vod-kijk2-prod.talpatvcdn.nl/p6jYhd96olD/ffc9e6f7-f998-0b73-2838-eb18a27226e6/p6jYhd96olD-index.ism/p6jYhd96olD.m3u8?filter=(systemBitrate%3C3500000)",
  "drm": null,
  "__typename": "Source"
}
{
  "type": "webvtt",
  "file": "https://vod-kijk2-prod.talpatvcdn.nl/webvtt/772248E1.vtt",
  "kind": "captions",
  "label": "Nederlands",
  "__typename": "Track"
}
{
  "type": "webvtt",
  "file": "https://vod-kijk2-prod.talpatvcdn.nl/webvtt/772248E1OPE.vtt",
  "kind": "captions",
  "label": "Doven en Slechthorenden",
  "__typename": "Track"
}
[...]

$ xidel -s --module=xivid.xqm --json-mode=deprecated --xquery 'let $json:=json(doc("'$url'")//script[@type="application/json"])/props,$info:=for $x in $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)] return $json/(apolloState)($x) return {"name":"Kijk: "||$info[__typename="Program"]/concat($json/pageProps/format/title," S",seasonNumber ! (if (. lt 10) then "0"||. else .),"E",tvSeasonEpisodeNumber ! (if (. lt 10) then "0"||. else .)),"date":format-date($info[__typename="Program"]//media_datepublished div 1000 * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":round($info[__typename="Program"]/duration) * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $info[type="webvtt"] order by $x/label descending count $i return $x/{"id":"sub-"||$i,"format":"vtt","language":"nl","label":label,"url":file},xivid:m3u8-to-json($info[type="m3u8"]/extract(file,".+m3u8"))]}'
{
  "name": "Kijk: Wegmisbruikers S25E10",
  "date": "22-03-2020",
  "duration": "00:39:41",
  "formats": [
    {
      "id": "sub-1",
      "format": "vtt",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/webvtt/772248E1.vtt"
    },
    {
      "id": "sub-2",
      "format": "vtt",
      "language": "nl",
      "label": "Doven en Slechthorenden",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/webvtt/772248E1OPE.vtt"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/p6jYhd96olD/ffc9e6f7-f998-0b73-2838-eb18a27226e6/p6jYhd96olD-index.ism/p6jYhd96olD.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "160kbps",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/p6jYhd96olD/ffc9e6f7-f998-0b73-2838-eb18a27226e6/p6jYhd96olD-index.ism/p6jYhd96olD-index-audio=160000.m3u8"
    },
    [...]
    {
      "id": "hls-7",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080@25fps",
      "bitrate": "6077|160kbps",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/p6jYhd96olD/ffc9e6f7-f998-0b73-2838-eb18a27226e6/p6jYhd96olD-index.ism/p6jYhd96olD-index-audio=160000-video=6077279.m3u8"
    }
  ]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

$ url=https://www.kijk.nl/films/video/pulp-fiction/q7p76rNvQyx (video met DRM)

$ xidel -se 'let $json:=json(doc("'$url'")//script[@type="application/json"])/props return ($json/pageProps/format,for $x in $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)] return $json/(apolloState)($x))'
{
  "id": "107752488190",
  "guid": "q7p76rNvQyx",
  "title": "Pulp Fiction",
  "slug": "pulp-fiction",
  "epgDate": 1596758400000,
  "shortDescription": "Jules en Vincent werken voor de machtige misdadiger Marsellus Wallace. Vincent komt in de problemen als hij Mia, de vrouw van Wallace, een avondje gezelschap moet houden.",
  "duration": 8554.04,
  [...]
  "__typename": "Program",
  "tvSeasonId": null,
  "type": "MOVIE",
  "description": "Jules en Vincent werken voor de machtige misdadiger Marsellus Wallace. Vincent komt in de problemen als hij Mia, de vrouw van Wallace, een avondje gezelschap moet houden. Ondertussen is Wallace verwikkeld in een deal met de bokser Butch, die Wallace belazert en er met z'n geld vandoor gaat.",
  "longDescription": "Jules en Vincent werken voor de machtige misdadiger Marsellus Wallace. Vincent komt in de problemen als hij Mia, de vrouw van Wallace, een avondje gezelschap moet houden. Ondertussen is Wallace verwikkeld in een deal met de bokser Butch, die Wallace belazert en er met z'n geld vandoor gaat.",
  "displayGenre": "Crime",
  "tvSeasonEpisodeNumber": null,
  "seasonNumber": null,
  "seriesId": null,
  "updated": 1596320337000,
  "metadata": {
    "type": "json",
    "json": {
      "media_datecreated": 1564653199000,
      "media_datemodified": 1596320337000,
      "media_datepublished": 1596825003000,
      "media_duration": 8554.04,
      "media_genre": "Crime",
      "media_id": "q7p76rNvQyx",
      "media_name": null,
      "media_program_episodenumber": null,
      "media_program_name": "Pulp Fiction",
      "media_program_season": null,
      "media_videotype": "movie",
      "player_embedurl": "https://www.kijk.nl/video/q7p76rNvQyx",
      "c_media_duration_type": "long",
      "c_media_live": null,
      "c_media_playbacktype": "vod",
      "c_media_genre_code": "Misdaad",
      "c_sko_ty": "tv.ep",
      "c_sko_stid": null,
      "c_sko_t": null,
      "c_sko_dt": null,
      "c_sko_gen": null,
      "c_sko_pr": null,
      "c_sko_prid": null
    }
  },
  [...]
}
[...]
{
  "type": "m3u8",
  "file": "https://vod-kijk2-prod.talpatvcdn.nl/q7p76rNvQyx/16716a11-b040-b006-68d0-8bba50dbe995/q7p76rNvQyx_1570005369323.ism/master.m3u8?filter=(systemBitrate%3C3500000)",
  "drm": {
    "type": "json",
    "json": {
      "fairplay": {
        "releasePid": "GkqfqVRivPjr",
        "url": null,
        "certificateUrl": "https://vod-kijk2-prod.talpatvcdn.nl/fairplay.cer",
        "processSpcUrl": "https://fairplay.entitlement.theplatform.eu/fpls/web/FairPlay?releasePid=GkqfqVRivPjr&form=json&schema=1.0"
      }
    }
  },
  "__typename": "Source"
}
[...]

$ xidel -s --module=xivid.xqm --json-mode=deprecated --xquery 'let $json:=json(doc("'$url'")//script[@type="application/json"])/props,$info:=for $x in $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)] return $json/(apolloState)($x) return {"name":"Kijk: "||$info[__typename="Program"]/(if (type="MOVIE") then title else concat($json/pageProps/format/title," S",seasonNumber ! (if (. lt 10) then "0"||. else .),"E",tvSeasonEpisodeNumber ! (if (. lt 10) then "0"||. else .))),"date":format-date($info[__typename="Program"]//media_datepublished div 1000 * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":round($info[__typename="Program"]/duration) * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $info[type="webvtt"] order by $x/label descending count $i return $x/{"id":"sub-"||$i,"format":"vtt","language":"nl","label":label,"url":file},xivid:m3u8-to-json($info[type="m3u8" and not(drm)]/extract(file,".+m3u8"))]}'
{
  "name": "Kijk: Pulp Fiction",
  "date": "07-08-2020",
  "duration": "02:22:34",
  "formats": [
    {
      "id": "sub-1",
      "format": "vtt",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/webvtt/686999E1.vtt"
    }
  ]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

$ url=https://www.kijk.nl/programmas/the-king-of-queens/2GZVeOKkUQq/seizoen/147382824350/afleveringen/video/dog-days/YA4tYzxFNyk

$ xidel -se 'let $json:=json(doc("'$url'")//script[@type="application/json"])/props return ($json/pageProps/format,for $x in $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)] return $json/(apolloState)($x))'
{
  "id": "144131624301",
  "guid": "2GZVeOKkUQq",
  "slug": "the-king-of-queens",
  "tvSeasonId": "149352488010",
  "type": "SERIES",
  "title": "The King of Queens",
  "description": "Doug en Carrie Heffernan zijn een gelukkig echtpaar in Queens, New York, die hun huishouden delen met Carries excentrieke vader Arthur. Doug is een wijsneuzige pakketbezorger met een liefde voor sport, tv, junkfood en natuurlijk zijn cynische vrouw Carrie.",
  "epgDate": null,
  "longDescription": "Doug en Carrie Heffernan zijn een gelukkig echtpaar in Queens, New York, die hun huishouden delen met Carries excentrieke vader Arthur. Doug is een wijsneuzige pakketbezorger met een liefde voor sport, tv, junkfood en natuurlijk zijn cynische vrouw Carrie.",
  "shortDescription": "Doug en Carrie Heffernan zijn een gelukkig echtpaar uit Queens, New York, die hun huishouden delen met Carries excentrieke vader Arthur.",
  "displayGenre": "Comedyserie",
  "tvSeasonEpisodeNumber": null,
  "seasonNumber": null,
  "seriesEpisodeNumber": null,
  "seriesId": null,
  "duration": null,
  "episodeTitleGenerator": null,
  "updated": 1597241967000,
  "__typename": "Program",
  [...]
}
{
  "id": "149861928246",
  "slug": "dog-days",
  "seriesId": "http://data.entertainment.tv.theplatform.eu/entertainment/data/Program/guid/2707491435/2GZVeOKkUQq",
  "tvSeasonId": "http://data.entertainment.tv.theplatform.eu/entertainment/data/TvSeason/147382824350",
  "seasonNumber": 1,
  "tvSeasonEpisodeNumber": 14,
  "shortDescription": "De hond van de nieuwe buren houdt Doug en Carrie de hele nacht wakker.",
  "duration": 1264.48,
  "epgDate": 1597881600000,
  [...]
  "__typename": "Program"
}
{
  "availableDate": "1597940158000",
  "mediaContent": [...],
  "__typename": "Media"
}
{
  "sourceUrl": "https://vod-kijk2-prod.talpatvcdn.nl/webvtt/784340E1.vtt",
  "__typename": "MediaFile"
}
{
  "sourceUrl": "https://vod-kijk2-prod.talpatvcdn.nl/YA4tYzxFNyk/c1ea2603-2e68-aca0-b932-23eb24be4958/YA4tYzxFNyk-index.ism/YA4tYzxFNyk.m3u8",
  "__typename": "MediaFile"
}
[...]

$ xidel -s --module=xivid.xqm --json-mode=deprecated --xquery 'let $json:=json(doc("'$url'")//script[@type="application/json"])/props,$info:=for $x in $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)] return $json/(apolloState)($x) return {"name":"Kijk: "||$info[__typename="Program"]/(if (type="MOVIE") then title else concat($json/pageProps/format/title," S",seasonNumber ! (if (. lt 10) then "0"||. else .),"E",tvSeasonEpisodeNumber ! (if (. lt 10) then "0"||. else .))),"date":format-date(($info[__typename="Program"]//media_datepublished,$info[__typename="Media"]/availableDate)[1] div 1000 * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":round($info[__typename="Program"]/duration) * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in (if ($info[type="webvtt"]) then $info[type="webvtt"]/file else $info[ends-with(sourceUrl,"vtt")]/sourceUrl) order by $x count $i return {"id":"sub-"||$i,"format":"vtt","language":"nl","label":if (contains($x,"OPE")) then "Doven en Slechthorenden" else "Nederlands","url":$x},xivid:m3u8-to-json(($info[type="m3u8" and not(drm)]/extract(file,".+m3u8"),$info[ends-with(sourceUrl,"m3u8")]/sourceUrl)[1])]}'
{
  "name": "Kijk: The King of Queens S01E14",
  "date": "20-08-2020",
  "duration": "00:21:04",
  "formats": [
    {
      "id": "sub-1",
      "format": "vtt",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/webvtt/784340E1.vtt"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/YA4tYzxFNyk/c1ea2603-2e68-aca0-b932-23eb24be4958/YA4tYzxFNyk-index.ism/YA4tYzxFNyk.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "160kbps",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/YA4tYzxFNyk/c1ea2603-2e68-aca0-b932-23eb24be4958/YA4tYzxFNyk-index.ism/YA4tYzxFNyk-index-audio=160000.m3u8"
    },
    [...]
    {
      "id": "hls-7",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080@25fps",
      "bitrate": "6096|160kbps",
      "url": "https://vod-kijk2-prod.talpatvcdn.nl/YA4tYzxFNyk/c1ea2603-2e68-aca0-b932-23eb24be4958/YA4tYzxFNyk-index.ism/YA4tYzxFNyk-index-audio=160000-video=6095691.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

declare function xivid:kijk($url as string) as object()? {
  let $json:=json(doc($url)//script[@type="application/json"])/props,
      $info:=for $x in $json/(apolloState)()[starts-with(.,"Program:"||$json/pageProps/video/id)] return $json/(apolloState)($x)
  return {
    "name":"Kijk: "||$info[__typename="Program"]/(
      if (type="MOVIE") then
        title
      else
        concat(
          $json/pageProps/format/title,
          " S",
          seasonNumber ! (if (. lt 10) then "0"||. else .),
          "E",
          tvSeasonEpisodeNumber ! (if (. lt 10) then "0"||. else .)
        )
    ),
    "date":format-date(
      (
        $info[__typename="Program"]//media_datepublished,
        $info[__typename="Media"]/availableDate
      )[1] div 1000 * duration("PT1S") + implicit-timezone() + date("1970-01-01"),
      "[D01]-[M01]-[Y]"
    ),
    "duration":round($info[__typename="Program"]/duration) * duration("PT1S") + time("00:00:00"),
    "formats":[
      for $x at $i in (
        if ($info[type="webvtt"]) then
          $info[type="webvtt"]/file
        else
          $info[ends-with(sourceUrl,"vtt")]/sourceUrl
      )
      order by $x
      count $i
      return {
        "id":"sub-"||$i,
        "format":"vtt",
        "language":"nl",
        "label":if (contains($x,"OPE")) then
          "Doven en Slechthorenden"
        else
          "Nederlands",
        "url":$x
      },
      xivid:m3u8-to-json(
        (
          $info[type="m3u8" and not(drm)]/extract(file,".+m3u8"),
          $info[ends-with(sourceUrl,"m3u8")]/sourceUrl
        )[1]
      )
    ]
  }
};

================================================================================================

[tvblik,uitzendinggemist]

$ xidel -se '
  for $x in (
    "https://tvblik.nl/nos-journaal/21-augustus-2020",
    "https://tvblik.nl/rtl-nieuws/0630-uur-545",
    "https://tvblik.nl/hart-van-nederland/21-augustus-2020"
  ) return
  doc($x)//div[@id="embed-player"]/(@data-episode,a/@href)
'
//www.npostart.nl/embed/nos-journaal/21-08-2020/POW_04508799
http://www.rtlxl.nl/#!/_rtl-nieuws-132237/c061ef9a-1fb9-356d-87b0-df9ca473ca7c?utm_medium=refferal&utm_source=tvblik
//embed.kijk.nl/?width=640&height=360&video=rik02l1H0Fl&autoplay=1

$ xidel -se '
  for $x in (
    "https://www.uitzendinggemist.net/aflevering/526238/Nos_Journaal.html",
    "https://www.uitzendinggemist.net/aflevering/526267/Rtl_Nieuws_1930_Uur.html",
    "https://www.uitzendinggemist.net/aflevering/521164/Hart_Van_Nederland.html"
  ) return
  doc($x)//(div[@class="video_thumb"]//@onclick,iframe[@class="sbsEmbed"]/@src)
'
window.open('http://www.npo.nl/aa-aa/01-01-2015/POW_04508799','winname',"directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=yes,resizable=no,width=760,height=600");
window.open('http://www.rtlxl.nl/#!/zzzz/7b0ef07f-359f-3c3c-a784-47398a3dab25','winname',"directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=yes,resizable=no,width=840,height=600");
https://embed.kijk.nl/?width=720&height=410&video=NFH6Mbjln35

$ xidel -se '
  for $x in (
    "https://tvblik.nl/nos-journaal/21-augustus-2020",
    "https://tvblik.nl/rtl-nieuws/0630-uur-545",
    "https://tvblik.nl/hart-van-nederland/21-augustus-2020",
    "https://www.uitzendinggemist.net/aflevering/526238/Nos_Journaal.html",
    "https://www.uitzendinggemist.net/aflevering/526267/Rtl_Nieuws_1930_Uur.html",
    "https://www.uitzendinggemist.net/aflevering/521164/Hart_Van_Nederland.html"
  ) return
  join(
    extract(
      doc($x)//(
        div[@id="embed-player"]/(@data-episode,a/@href),
        div[@class="video_thumb"]//@onclick,
        iframe[@class="sbsEmbed"]/@src
      ),
      "(npo|rtl|kijk).+(?:/|video=)([\w-]+)",
      (1,2)
    )
  )
'
npo POW_04508799
rtl c061ef9a-1fb9-356d-87b0-df9ca473ca7c
kijk rik02l1H0Fl
npo POW_04508799
rtl 7b0ef07f-359f-3c3c-a784-47398a3dab25
kijk NFH6Mbjln35

$ xidel -s --xquery '
  for $x in (
    "https://tvblik.nl/nos-journaal/21-augustus-2020",
    "https://tvblik.nl/rtl-nieuws/0630-uur-545",
    "https://tvblik.nl/hart-van-nederland/21-augustus-2020",
    "https://www.uitzendinggemist.net/aflevering/526238/Nos_Journaal.html",
    "https://www.uitzendinggemist.net/aflevering/526267/Rtl_Nieuws_1930_Uur.html",
    "https://www.uitzendinggemist.net/aflevering/521164/Hart_Van_Nederland.html"
  )
  let $host:=extract(
    doc($x)//(
      div[@id="embed-player"]/(@data-episode,a/@href),
      div[@class="video_thumb"]//@onclick,
      iframe[@class="sbsEmbed"]/@src
    ),
    "(npo|rtl|kijk).+(?:/|video=)([\w-]+)",
    (1,2)
  )
  return
  if ($host[1]="npo") then
    "xivid:npo(""https://www.npostart.nl/"||$host[2]||""")"
  else if ($host[1]="rtl") then
    "xivid:rtl(""https://www.rtlxl.nl/video/"||$host[2]||""")"
  else
    "xivid:kijk(""https://kijk.nl/video/"||$host[2]||""")"
'
xivid:npo("https://www.npostart.nl/POW_04508799")
xivid:rtl("https://www.rtlxl.nl/video/c061ef9a-1fb9-356d-87b0-df9ca473ca7c")
xivid:kijk("https://kijk.nl/video/rik02l1H0Fl")
xivid:npo("https://www.npostart.nl/POW_04508799")
xivid:rtl("https://www.rtlxl.nl/video/7b0ef07f-359f-3c3c-a784-47398a3dab25")
xivid:kijk("https://kijk.nl/video/NFH6Mbjln35")

------------------------------------------------------------------------------------------------

declare function xivid:tvblik($url as string) as object()? {
  let $host:=extract(
    doc($url)//(
      div[@id="embed-player"]/(@data-episode,a/@href),
      div[@class="video_thumb"]//@onclick,
      iframe[@class="sbsEmbed"]/@src
    ),
    "(npo|rtl|kijk).+(?:/|video=)([\w-]+)",
    (1,2)
  ) return
  if ($host[1]="npo") then
    xivid:npo("https://www.npostart.nl/"||$host[2])
  else if ($host[1]="rtl") then
    xivid:rtl("https://www.rtlxl.nl/video/"||$host[2])
  else
    xivid:kijk("https://kijk.nl/video/"||$host[2])
};

================================================================================================

[youtube]

https://www.youtube.com/watch?v=nG_LtCRRZ20 (normaal toegankelijke video)

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e '(//meta[@property="og:title"]/@content,//meta[@itemprop="datePublished"]/@content,//meta[@itemprop="duration"]/@content)'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
2019-02-01
PT18M13S

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e '{"name"://meta[@property="og:title"]/@content,"date":format-date(date(//meta[@itemprop="datePublished"]/@content),"[D01]-[M01]-[Y]"),"duration":duration(//meta[@itemprop="duration"]/@content) + time("00:00:00")}'
{
  "name": "Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)",
  "date": "01-02-2019",
  "duration": "00:18:13"
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Formaten uit de "player_response" JSON:

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return $b/streamingData'
{
  "expiresInSeconds": "21540",
  "formats": [
    {
      "itag": 18,
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=18[...]",
      "mimeType": "video/mp4; codecs=\"avc1.42001E, mp4a.40.2\"",
      "bitrate": 488787,
      "width": 640,
      "height": 360,
      "lastModified": "1548978609684393",
      "contentLength": "66756108",
      "quality": "medium",
      "qualityLabel": "360p",
      "projectionType": "RECTANGULAR",
      "averageBitrate": 488759,
      "audioQuality": "AUDIO_QUALITY_LOW",
      "approxDurationMs": "1092661",
      "audioSampleRate": "44100",
      "audioChannels": 2
    },
    {
      "itag": 22,
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=22[...]",
      "mimeType": "video/mp4; codecs=\"avc1.64001F, mp4a.40.2\"",
      "bitrate": 1602845,
      "width": 1280,
      "height": 720,
      "lastModified": "1548979118812685",
      "quality": "hd720",
      "qualityLabel": "720p",
      "projectionType": "RECTANGULAR",
      "audioQuality": "AUDIO_QUALITY_MEDIUM",
      "approxDurationMs": "1092638",
      "audioSampleRate": "44100",
      "audioChannels": 2
    },
    {
      "itag": 43,
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=43[...]",
      "mimeType": "video/webm; codecs=\"vp8.0, vorbis\"",
      "bitrate": 2147483647,
      "width": 640,
      "height": 360,
      "lastModified": "1548982696251964",
      "contentLength": "104456295",
      "quality": "medium",
      "qualityLabel": "360p",
      "projectionType": "RECTANGULAR",
      "audioQuality": "AUDIO_QUALITY_MEDIUM"
    }
  ],
  "adaptiveFormats": [
    {
      "itag": 136,
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=136[...]",
      "mimeType": "video/mp4; codecs=\"avc1.4d4016\"",
      "bitrate": 2310000,
      "width": 1280,
      "height": 720,
      "lastModified": "1548978905736975",
      "quality": "hd720",
      "fps": 25,
      "qualityLabel": "720p",
      "projectionType": "RECTANGULAR",
      "type": "FORMAT_STREAM_TYPE_OTF"
    },
    [...]
  ],
  "dashManifestUrl": "https://manifest.googlevideo.com/api/manifest/dash/[...]"
}

https://github.com/ytdl-org/youtube-dl/blob/c2d125d99f81aa33429b2158acd9a90524575378/youtube_dl/extractor/youtube.py#L1948: "# bitrate for itag 43 is always 2147483647".

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return [for $x at $i in $b/streamingData/(formats)() order by $x/width count $i return {"id":"pg-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)\..+ (\w+)(?:\.|&quot;)",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat($x/width,"x",$x/height),"bitrate":$x[itag ne 43]/bitrate ! concat(round(. div 1000),"kbps"),"url":$x/url}]'
[
  {
    "id": "pg-1",
    "format": "mp4[h264+aac]",
    "resolution": "640x360",
    "bitrate": "489kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=18[...]"
  },
  {
    "id": "pg-2",
    "format": "webm[vp8+vorbis]",
    "resolution": "640x360",
    "bitrate": null,
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=43[...]"
  },
  {
    "id": "pg-3",
    "format": "mp4[h264+aac]",
    "resolution": "1280x720",
    "bitrate": "1603kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=22[...]"
  }
]

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return [for $x at $i in $b/streamingData/(adaptiveFormats)() order by $x/boolean(width),$x/bitrate count $i return {"id":"dash-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)",(1,2)) return concat($a[1],"[",if ($a[2]="avc1") then "h264" else if ($a[2]="mp4a") then "aac" else $a[2],"]"),"resolution":$x/width ! concat(.,"x",$x/height,"@",$x/fps,"fps"),"samplerate":$x/audioSampleRate ! concat(. div 1000,"kHz"),"bitrate":round($x/bitrate div 1000)||"kbps","url":$x/url}]'
[
  {
    "id": "dash-1",
    "format": "mp4[aac]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "131kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=140[...]"
  },
  {
    "id": "dash-2",
    "format": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "134kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=251[...]"
  },
  [...]
  {
    "id": "dash-14",
    "format": "mp4[h264]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "2866kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=298[...]"
  }
]

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return {"name"://meta[@property="og:title"]/@content,"date":format-date(date(//meta[@itemprop="datePublished"]/@content),"[D01]-[M01]-[Y]"),"duration":duration(//meta[@itemprop="duration"]/@content) + time("00:00:00"),"formats":[for $x at $i in $b/streamingData/(formats)() order by $x/width count $i return {"id":"pg-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)\..+ (\w+)(?:\.|&quot;)",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat($x/width,"x",$x/height),"bitrate":$x[itag ne 43]/bitrate ! concat(round(. div 1000),"kbps"),"url":$x/url},for $x at $i in $b/streamingData/(adaptiveFormats)() order by $x/boolean(width),$x/bitrate count $i return {"id":"dash-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)",(1,2)) return concat($a[1],"[",if ($a[2]="avc1") then "h264" else if ($a[2]="mp4a") then "aac" else $a[2],"]"),"resolution":$x/width ! concat(.,"x",$x/height,"@",$x/fps,"fps"),"samplerate":$x/audioSampleRate ! concat(. div 1000,"kHz"),"bitrate":round($x/bitrate div 1000)||"kbps","url":$x/url}]}'
{
  "name": "Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)",
  "date": "01-02-2019",
  "duration": "00:18:13",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "489kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=18[...]"
    },
    [...]
    {
      "id": "dash-14",
      "format": "mp4[h264]",
      "resolution": "1280x720@50fps",
      "samplerate": null,
      "bitrate": "2866kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=298[...]"
    }
  ]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Formaten uit het "url_encoded_fmt_stream_map"- en "adaptive_fmts"-attribuut:

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args return (tokenize($a/url_encoded_fmt_stream_map,","),tokenize($a/fmt_list,","))'
itag=22&quality=hd720&type=video%2Fmp4%3B+codecs%3D%22avc1.64001F%2C+mp4a.40.2%22&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]
itag=43&quality=medium&type=video%2Fwebm%3B+codecs%3D%22vp8.0%2C+vorbis%22&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]
itag=18&quality=medium&type=video%2Fmp4%3B+codecs%3D%22avc1.42001E%2C+mp4a.40.2%22&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]
22/1280x720
43/640x360
18/640x360

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args for $x at $i in tokenize($a/url_encoded_fmt_stream_map,",") return (tokenize($a/fmt_list,",")[$i],$x)'
22/1280x720
itag=22&quality=hd720&type=video%2Fmp4%3B+codecs%3D%22avc1.64001F%2C+mp4a.40.2%22&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]
43/640x360
itag=43&quality=medium&type=video%2Fwebm%3B+codecs%3D%22vp8.0%2C+vorbis%22&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]
18/640x360
itag=18&quality=medium&type=video%2Fmp4%3B+codecs%3D%22avc1.42001E%2C+mp4a.40.2%22&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args for $x at $i in tokenize($a/url_encoded_fmt_stream_map,",") return {|let $a:=extract(tokenize($a/fmt_list,",")[$i],"/(\d+)x(\d+)",(1,2)) return ({"width":$a[1]},{"height":$a[2]}),for $y in tokenize($x,"&amp;") let $a:=tokenize($y,"=") return {if ($a[1]="type") then "mimeType" else $a[1]:uri-decode($a[2])}|}'
{
->"width": "1280",
->"height": "720",
  "itag": "22",
  "quality": "hd720",
->"mimeType": "video/mp4; codecs=\"avc1.64001F, mp4a.40.2\"",
  "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=22[...]"
}
{
  "width": "640",
  "height": "360",
  "itag": "43",
  "quality": "medium",
  "mimeType": "video/webm; codecs=\"vp8.0, vorbis\"",
  "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=43[...]"
}
{
  "width": "640",
  "height": "360",
  "itag": "18",
  "quality": "medium",
  "mimeType": "video/mp4; codecs=\"avc1.42001E, mp4a.40.2\"",
  "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=18[...]"
}

Nu de attributen van deze reeks dezelfde naam hebben als die in de "player_response" JSON kan voor de te creëren JSON (bijna) dezelfde query gebruikt worden.

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=for $x at $i in tokenize($a/url_encoded_fmt_stream_map,",") return {|let $a:=extract(tokenize($a/fmt_list,",")[$i],"/(\d+)x(\d+)",(1,2)) return ({"width":$a[1]},{"height":$a[2]}),for $y in tokenize($x,"&amp;") let $a:=tokenize($y,"=") return {if ($a[1]="type") then "mimeType" else $a[1]:uri-decode($a[2])}|} return [for $x at $i in reverse($b) order by $x/width count $i return {"id":"pg-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)\..+ (\w+)(?:\.|&quot;)",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat($x/width,"x",$x/height),"bitrate":$x[itag ne 43]/bitrate ! concat(round(. div 1000),"kbps"),"url":$x/url}]'
[
  {
    "id": "pg-1",
    "format": "mp4[h264+aac]",
    "resolution": "640x360",
    "bitrate": null,
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=18[...]"
  },
  {
    "id": "pg-2",
    "format": "webm[vp8+vorbis]",
    "resolution": "640x360",
    "bitrate": null,
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=43[...]"
  },
  {
    "id": "pg-3",
    "format": "mp4[h264+aac]",
    "resolution": "1280x720",
    "bitrate": null,
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=22[...]"
  }
]

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args return tokenize($a/adaptive_fmts,",")'
fps=25&itag=136&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]&index=0-0&stream_type=3&xtags=&projection_type=1&type=video%2Fmp4%3B+codecs%3D%22avc1.4d4016%22&clen=0&quality_label=720p&init=0-0&lmt=1548978905736975&size=1280x720&bitrate=2310000
fps=25&itag=247&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]&index=0-0&stream_type=3&xtags=&projection_type=1&type=video%2Fwebm%3B+codecs%3D%22vp9%22&clen=0&quality_label=720p&init=0-0&lmt=1548978905736975&size=1280x720&bitrate=1505280
fps=50&itag=298&url=https%3A%2F%2Fr4---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]&index=764-3363&xtags=&projection_type=1&type=video%2Fmp4%3B+codecs%3D%22avc1.4d4020%22&clen=214600383&quality_label=720p50&init=0-763&lmt=1548978905736975&size=1280x720&bitrate=2866450
[...]

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args return tokenize($a/adaptive_fmts,",") ! {|for $x in tokenize(.,"&amp;") let $a:=tokenize($x,"=") return if ($a[1]="size") then let $a:=tokenize($a[2],"x") return ({"width":$a[1]},{"height":$a[2]}) else {if ($a[1]="type") then "mimeType" else if ($a[1]="audio_sample_rate") then "audioSampleRate" else $a[1]:uri-decode($a[2])}|}'
{
  "fps": "25",
  "itag": "136",
  "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?itag=[...]136[...]",
  "index": "0-0",
  "stream_type": "3",
  "xtags": "",
  "projection_type": "1",
->"mimeType": "video/mp4; codecs=\"avc1.4d4016\"",
  "clen": "0",
  "quality_label": "720p",
  "init": "0-0",
  "lmt": "1548978905736975",
->"width": "1280",
->"height": "720",
  "bitrate": "2310000"
}
[...]
{
  "itag": "140",
  "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?itag=[...]140[...]",
  "index": "656-2007",
  "xtags": "",
->"audioSampleRate": "44100",
  "projection_type": "1",
->"mimeType": "audio/mp4; codecs=\"mp4a.40.2\"",
  "clen": "17683882",
  "init": "0-655",
  "audio_channels": "2",
  "lmt": "1548978771474489",
  "bitrate": "131421"
}

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=tokenize($a/adaptive_fmts,",") ! {|for $x in tokenize(.,"&amp;") let $a:=tokenize($x,"=") return if ($a[1]="size") then let $a:=tokenize($a[2],"x") return ({"width":$a[1]},{"height":$a[2]}) else {if ($a[1]="type") then "mimeType" else if ($a[1]="audio_sample_rate") then "audioSampleRate" else $a[1]:uri-decode($a[2])}|} return [for $x at $i in $b order by $x/boolean(width),$x/bitrate count $i return {"id":"dash-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)",(1,2)) return concat($a[1],"[",if ($a[2]="avc1") then "h264" else if ($a[2]="mp4a") then "aac" else $a[2],"]"),"resolution":$x/width ! concat(.,"x",$x/height,"@",$x/fps,"fps"),"samplerate":$x/audioSampleRate ! concat(. div 1000,"kHz"),"bitrate":round($x/bitrate div 1000)||"kbps","url":$x/url}]'
[
  {
    "id": "dash-1",
    "format": "mp4[aac]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "131kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=140[...]"
  },
  {
    "id": "dash-2",
    "format": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "134kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=251[...]"
  },
  [...]
  {
    "id": "dash-14",
    "format": "mp4[h264]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "2866kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=298[...]"
  }
]

Combineer queries voor beide bronnen.

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response),$c:=for $x at $i in tokenize($a/url_encoded_fmt_stream_map,",") return {|let $a:=extract(tokenize($a/fmt_list,",")[$i],"/(\d+)x(\d+)",(1,2)) return ({"width":$a[1]},{"height":$a[2]}),for $y in tokenize($x,"&amp;") let $a:=tokenize($y,"=") return {if ($a[1]="type") then "mimeType" else $a[1]:uri-decode($a[2])}|},$d:=tokenize($a/adaptive_fmts,",") ! {|for $x in tokenize(.,"&amp;") let $a:=tokenize($x,"=") return if ($a[1]="size") then let $a:=tokenize($a[2],"x") return ({"width":$a[1]},{"height":$a[2]}) else {if ($a[1]="type") then "mimeType" else if ($a[1]="audio_sample_rate") then "audioSampleRate" else $a[1]:uri-decode($a[2])}|} return {"name"://meta[@property="og:title"]/@content,"date":format-date(date(//meta[@itemprop="datePublished"]/@content),"[D01]-[M01]-[Y]"),"duration":duration(//meta[@itemprop="duration"]/@content) + time("00:00:00"),"formats":[for $x at $i in if ($b/streamingData/formats) then $b/streamingData/(formats)() else reverse($c) order by $x/width count $i return {"id":"pg-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)\..+ (\w+)(?:\.|&quot;)",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat($x/width,"x",$x/height),"bitrate":$x[itag ne 43]/bitrate ! concat(round(. div 1000),"kbps"),"url":$x/url},for $x at $i in if ($b/streamingData/adaptiveFormats) then $b/streamingData/(adaptiveFormats)() else $d order by $x/boolean(width),$x/bitrate count $i return {"id":"dash-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)",(1,2)) return concat($a[1],"[",if ($a[2]="avc1") then "h264" else if ($a[2]="mp4a") then "aac" else $a[2],"]"),"resolution":$x/width ! concat(.,"x",$x/height,"@",$x/fps,"fps"),"samplerate":$x/audioSampleRate ! concat(. div 1000,"kHz"),"bitrate":round($x/bitrate div 1000)||"kbps","url":$x/url}]}'
{
  "name": "Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)",
  "date": "01-02-2019",
  "duration": "00:18:13",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "489kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=18[...]"
    },
    [...]
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "1603kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=22[...]"
    },
    {
      "id": "dash-1",
      "format": "mp4[aac]",
      "resolution": null,
      "samplerate": "44.1kHz",
      "bitrate": "131kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=140[...]"
    },
    [...]
    {
      "id": "dash-14",
      "format": "mp4[h264]",
      "resolution": "1280x720@50fps",
      "samplerate": null,
      "bitrate": "2866kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=298[...]"
    }
  ]
}

I.p.v. if ($b/formats) then $b/(formats)() else reverse($c),        werkt ([$b/(formats)()],[reverse($c)])[.][1]() ook.
I.p.v. if ($b/adaptiveFormats) then $b/(adaptiveFormats)() else $d, werkt ([$b/(adaptiveFormats)()],[$d])[.][1]()  ook.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Formaten uit het Dash manifest (voor als dat hier boven nog niet genoeg is):

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args return $a/json(player_response)/streamingData/dashManifestUrl'
https://manifest.googlevideo.com/api/manifest/dash/[...]

----------------------------------------------------------------

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=doc($a/json(player_response)/streamingData/dashManifestUrl) return join($b//Representation/@id)'
139 140 133 134 135 160 136 298 242 243 244 278 247 302   # De itags.

$ xidel -s "https://www.youtube.com/watch?v=21X5lGlDOfg" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=doc($a/json(player_response)/streamingData/dashManifestUrl) return join($b//Representation/@id)'
139 140 133 134 135 160 136 298 rawcc en   # De itags van een livestream.

Alleen de nummers zijn audio- en videostreams. Die moeten er dus uit.
Omdat het strings zijn kan het niet met "instance of", maar moet het met "castable as".

$ xidel -s "https://www.youtube.com/watch?v=21X5lGlDOfg" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=doc($a/json(player_response)/streamingData/dashManifestUrl) return join($b//Representation[@id castable as integer]/@id)'
139 140 133 134 135 160 136 298

Voor livestreams wordt het Dash manifest niet benaderd, maar mocht dit bij andere videostreams wel voorkomen, dan zijn ze er op deze manier dus uit te filteren.

----------------------------------------------------------------

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return [for $x at $i in doc($b/streamingData/dashManifestUrl)//Representation[@id castable as integer] order by $x/boolean(@width),$x/@bandwidth count $i return {"id":"dash-"||$i,"format":concat(substring-after($x/../@mimeType,"/"),"[",extract($x/@codecs,"(^[\w]+)",1) ! (if (.="mp4a") then "aac" else if (.="avc1") then "h264" else .),"]"),"resolution":$x/@width ! concat(.,"x",$x/@height,"@",$x/@frameRate,"fps"),"samplerate":$x/@audioSamplingRate ! concat(. div 1000,"kHz"),"bitrate":round($x/@bandwidth div 1000)||"kbps","url":$x/BaseUrl}]'
[
  {
    "id": "dash-1",
    "format": "mp4[aac]",
    "resolution": null,
    "samplerate": "22.05kHz",
    "bitrate": "51kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/[...]/itag/139/[...]"
  },
  {
    "id": "dash-2",
    "format": "mp4[aac]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "131kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/[...]/itag/140/[...]"
  },
  [...]
  {
    "id": "dash-14",
    "format": "mp4[h264]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "2866kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/[...]/itag/298/[...]"
  }
]

Zonder "disable_polymer" (doc($a/json(player_response)/streamingData/dashManifestUrl||"/disable_polymer/true")) waren de DASH streams tot voor kort niet te openen met FFmpeg, of MPC-HC (zie https://github.com/rg3/youtube-dl/issues/14083). Dat lijkt nu niet meer het geval te zijn.

------------------------------------------------------------------------------------------------

https://www.youtube.com/watch?v=2U5mf_fEKiU (leeftijds beperkte video) (https://github.com/rg3/youtube-dl/issues/17604#issuecomment-422367440)

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" -e 'outer-html(//meta[@property="og:restrictions:age"])'
<meta property="og:restrictions:age" content="18+">

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" -e 'concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts)'
https://www.youtube.com/get_video_info?video_id=2U5mf_fEKiU&eurl=https%3A%2F%2Fyoutube.googleapis.com%2Fv%2F2U5mf_fEKiU&sts=17940

Wat deze url teruggeeft is een volledige url-encoded "ytplayer.config"-json in query-string formaat (application/x-www-form-urlencoded). Om daar eerst weer de json van te maken:

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" --xquery 'let $a:=concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&amp;eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&amp;sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts) return {|for $x in tokenize(unparsed-text($a),"&amp;") let $a:=tokenize($x,"=") return {$a[1]:uri-decode($a[2])}|}'

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" --xquery 'let $a:=if (//meta[@property="og:restrictions:age"]) then {|for $x in tokenize(unparsed-text(concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&amp;eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&amp;sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts)),"&amp;") let $a:=tokenize($x,"=") return {$a[1]:uri-decode($a[2])}|} else json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=[...]'
{
  "name": "Allow embedding, Age restriction",
  "date": "18-09-2018",
  "duration": "00:00:21",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "740kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback?[...]itag=18[...]"
    },
    [...]
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2697kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback?[...]itag=22[...]"
    },
    {
      "id": "dash-1",
      "format": "mp4[aac]",
      "resolution": null,
      "samplerate": "44.1kHz",
      "bitrate": "130kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback?[...]itag=140[...]"
    },
    [...]
    {
      "id": "dash-17",
      "format": "mp4[h264]",
      "resolution": "1920x1080@60fps",
      "samplerate": null,
      "bitrate": "5809kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback?[...]itag=299[...]"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.youtube.com/watch?v=21X5lGlDOfg (live videostream)

$ xidel -s "https://www.youtube.com/watch?v=21X5lGlDOfg" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return $b/streamingData/hlsManifestUrl'
https://manifest.googlevideo.com/api/manifest/hls_variant/[...]/index.m3u8

$ xidel -s --module=xivid.xqm "https://www.youtube.com/watch?v=21X5lGlDOfg" --xquery '[...] return if ($b/videoDetails/isLive) then {"name"://meta[@property="og:title"]/@content,"date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($b/streamingData/hlsManifestUrl)} else {[...]}'
{
  "name": "NASA Live: Official Stream of NASA TV",
  "date": "01-08-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://manifest.googlevideo.com/api/manifest/hls_variant/[...]/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "256x144@30fps",
      "bitrate": "197kbps",
      "url": "https://manifest.googlevideo.com/api/manifest/hls_playlist/[...]/itag/91/[...]/index.m3u8"
    },
    [...]
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720@60fps",
      "bitrate": "3806kbps",
      "url": "https://manifest.googlevideo.com/api/manifest/hls_playlist/[...]/itag/300/[...]/index.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.youtube.com/watch?v=GuoxLggqI_g (video met ondertiteling én signature)

$ xidel -s "https://www.youtube.com/watch?v=GuoxLggqI_g" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return ($b//captionTracks)()[languageCode="nl"]'
{
  "baseUrl": "https://www.youtube.com/api/timedtext?[...]lang=nl",
  "name": {
    "simpleText": "Nederlands"
  },
  "vssId": ".nl",
  "languageCode": "nl",
  "isTranslatable": true
}

$ xidel -s "https://www.youtube.com/watch?v=GuoxLggqI_g" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return $b/videoDetails'
{
  "videoId": "GuoxLggqI_g",
  [...]
  "useCipher": true,
  [...]
}

Deze video's hebben een "signature" waar een ingewikkeld algoritme overheen gaat om ze te kunnen afspelen/downloaden.
Youtube-dl maakt gebruik van een of andere Javascript runtime, zonder de code te hoeven ontleden. Die luxe heb ik niet.
Ondanks geslaagde pogingen is het nog niet te automatiseren... zie hier onder.
Deze beveiligde video's moeten er dus vooralsnog uit worden gefilterd. if ($b/videoDetails/useCipher) then ... zou kunnen,
maar omdat de "player_response" JSON misschien niet altijd gebruikt wordt is het beter om die check een stap later te doen.

$ xidel -s "https://www.youtube.com/watch?v=GuoxLggqI_g" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response) return $b/streamingData/((formats)(1),(adaptiveFormats)(1))'
{
  "itag": 18,
  "mimeType": "video/mp4; codecs=\"avc1.42001E, mp4a.40.2\"",
  "bitrate": 451938,
  "width": 640,
  "height": 360,
  "lastModified": "1541631987878336",
  "contentLength": "299745842",
  "quality": "medium",
  "qualityLabel": "360p",
  "projectionType": "RECTANGULAR",
  "averageBitrate": 451933,
  "audioQuality": "AUDIO_QUALITY_LOW",
  "approxDurationMs": "5306015",
  "audioSampleRate": "44100",
  "audioChannels": 2,
  "cipher": "sp=sig&url=https%3A%2F%2Fr2---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]itag%3D18[...]"
}
{
  "itag": 137,
  "mimeType": "video/mp4; codecs=\"avc1.640028\"",
  "bitrate": 4825703,
  "width": 1920,
  "height": 1080,
  "initRange": {
    "start": "0",
    "end": "765"
  },
  "indexRange": {
    "start": "766",
    "end": "13313"
  },
  "lastModified": "1541643237721896",
  "contentLength": "740553746",
  "quality": "hd1080",
  "fps": 25,
  "qualityLabel": "1080p",
  "projectionType": "RECTANGULAR",
  "averageBitrate": 1116561,
  "approxDurationMs": "5305960",
  "cipher": "sp=sig&url=https%3A%2F%2Fr2---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]itag%3D137[...]"
}

De formaten in de "player_response" JSON hebben geen "url"-attribuut; $b/streamingData/(formats)()[url] en $b/streamingData/(adaptiveFormats)()[url].

$ xidel -s "https://www.youtube.com/watch?v=GuoxLggqI_g" -e 'let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response),$c:=for $x at $i in tokenize($a/url_encoded_fmt_stream_map,",") return {|let $a:=extract(tokenize($a/fmt_list,",")[$i],"/(\d+)x(\d+)",(1,2)) return ({"width":$a[1]},{"height":$a[2]}),for $y in tokenize($x,"&amp;") let $a:=tokenize($y,"=") return {if ($a[1]="type") then "mimeType" else $a[1]:uri-decode($a[2])}|},$d:=tokenize($a/adaptive_fmts,",") ! {|for $x in tokenize(.,"&amp;") let $a:=tokenize($x,"=") return if ($a[1]="size") then let $a:=tokenize($a[2],"x") return ({"width":$a[1]},{"height":$a[2]}) else {if ($a[1]="type") then "mimeType" else if ($a[1]="audio_sample_rate") then "audioSampleRate" else $a[1]:uri-decode($a[2])}|} return ($c[1],$d[1])'
{
  "width": "1280",
  "height": "720",
  "mimeType": "video/mp4; codecs=\"avc1.64001F, mp4a.40.2\"",
  "sp": "sig",
  "url": "https://r2---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=22[...]",
  "itag": "22",
  "s": "fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==",
  "quality": "hd720"
}
{
  "mimeType": "video/mp4; codecs=\"avc1.640028\"",
  "url": "https://r2---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=137[...]",
  "xtags": "",
  "itag": "137",
  "lmt": "1541643237721896",
  "width": "1920",
  "height": "1080",
  "s": "pLpLALgxI2wwRQIgb0FJSOz1A7YzW0u6P1RK4PWTPG6qWoxgoBMzE03Yh-UCIQCPTs0XRd4P2iuegLs0eVu2pk3l7NZnHdTRyQMNTgO3AA======",
  "bitrate": "4825703",
  "index": "766-13313",
  "sp": "sig",
  "quality_label": "1080p",
  "init": "0-765",
  "fps": "25",
  "projection_type": "1",
  "clen": "740553746"
}

De formaten uit het "url_encoded_fmt_stream_map"- en "adaptive_fmts"-attribuut hebben wel een "url"-attribuut, maar de signature ook; $c[not(s)] en $d[not(s)].

$ xidel -s --module=xivid.xqm "https://www.youtube.com/watch?v=GuoxLggqI_g" --xquery 'let $a:=if (//meta[@property="og:restrictions:age"]) then {|for $x in tokenize(unparsed-text(concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&amp;eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&amp;sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts)),"&amp;") let $a:=tokenize($x,"=") return {$a[1]:uri-decode($a[2])}|} else json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,$b:=$a/json(player_response),$c:=for $x at $i in tokenize($a/url_encoded_fmt_stream_map,",") return {|let $a:=extract(tokenize($a/fmt_list,",")[$i],"/(\d+)x(\d+)",(1,2)) return ({"width":$a[1]},{"height":$a[2]}),for $y in tokenize($x,"&amp;") let $a:=tokenize($y,"=") return {if ($a[1]="type") then "mimeType" else $a[1]:uri-decode($a[2])}|},$d:=tokenize($a/adaptive_fmts,",") ! {|for $x in tokenize(.,"&amp;") let $a:=tokenize($x,"=") return if ($a[1]="size") then let $a:=tokenize($a[2],"x") return ({"width":$a[1]},{"height":$a[2]}) else {if ($a[1]="type") then "mimeType" else if ($a[1]="audio_sample_rate") then "audioSampleRate" else $a[1]:uri-decode($a[2])}|} return if ($b/videoDetails/isLive) then {"name"://meta[@property="og:title"]/@content,"date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($b/streamingData/hlsManifestUrl)} else {"name"://meta[@property="og:title"]/@content,"date":format-date(date(//meta[@itemprop="datePublished"]/@content),"[D01]-[M01]-[Y]"),"duration":duration(//meta[@itemprop="duration"]/@content) + time("00:00:00"),"formats":[($b//captionTracks)()[languageCode="nl"]/{"id":"sub-1","format":"ttml","language":"nl","label":name/simpleText,"url":baseUrl},for $x at $i in if ($b/streamingData/formats) then $b/streamingData/(formats)()[url] else reverse($c[not(s)]) order by $x/width count $i return {"id":"pg-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)\..+ (\w+)(?:\.|&quot;)",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat($x/width,"x",$x/height),"bitrate":$x[itag ne 43]/bitrate ! concat(round(. div 1000),"kbps"),"url":$x/url},for $x at $i in if ($b/streamingData/adaptiveFormats) then $b/streamingData/(adaptiveFormats)()[url] else $d[not(s)] order by $x/boolean(width),$x/bitrate count $i return {"id":"dash-"||$i,"format":let $a:=extract($x/mimeType,"/(.+);.+&quot;(\w+)",(1,2)) return concat($a[1],"[",if ($a[2]="avc1") then "h264" else if ($a[2]="mp4a") then "aac" else $a[2],"]"),"resolution":$x/width ! concat(.,"x",$x/height,"@",$x/fps,"fps"),"samplerate":$x/audioSampleRate ! concat(. div 1000,"kHz"),"bitrate":round($x/bitrate div 1000)||"kbps","url":$x/url}]}'
{
  "name": "The Uncertainty Has Settled (Full film)",
  "date": "07-11-2018",
  "duration": "01:28:26",
  "formats": [
    {
      "id": "sub-1",
      "format": "ttml",
      "language": "nl",
      "label": "Nederlands",
      "url": "https://www.youtube.com/api/timedtext?[...]&lang=nl"
    }
  ]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

"Decipher" poging:

https://www.quora.com/How-can-I-make-a-YouTube-video-downloader-web-application-from-scratch
https://allforios.wordpress.com/2018/01/22/downloading-from-youtube-a-weekend-project/
https://github.com/ytdl-org/youtube-dl/blob/c2d125d99f81aa33429b2158acd9a90524575378/youtube_dl/extractor/youtube.py#L1321-L1339
maar vooral:
https://tyrrrz.me/Blog/Reverse-engineering-YouTube

$ xidel -s "https://www.youtube.com/watch?v=GuoxLggqI_g" -e 'outer-html(//script[@name="player_ias/base"])'
<script src="/yts/jsbin/player_ias-vflPI0brM/nl_NL/base.js" name="player_ias/base"></script>

$ xidel -s "https://www.youtube.com/watch?v=GuoxLggqI_g" -f '//script[@name="player_ias/base"]/@src' -e '$raw' > GuoxLggqI_g_player_ias-vflPI0brM.js

youtube.py#L1325: (?P<sig>[a-zA-Z0-9$]+)\s*=\s*function\(\s*a\s*\)\s*{\s*a\s*=\s*a\.split\(\s*""\s*\)
- "?P<sig>" weg, omdat Xidel voor zover ik weet geen "Named Capture Groups" ondersteunt.
- "{" escapen; "\{".
- De dubbele aanhalingstekens aan het eind verdubbelen, of &quot; met --xquery.

$ xidel -s GuoxLggqI_g_player_ias-vflPI0brM.js -e 'extract($raw,"([a-zA-Z0-9$]+)\s*=\s*function\(\s*a\s*\)\s*\{\s*a\s*=\s*a\.split\(\s*""""\s*\)",1)'
Lv

'GuoxLggqI_g_player_ias-vflPI0brM.js':
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[...]
Lv=function(a){a=a.split("");Kv.up(a,2);Kv.y9(a,23);Kv.y9(a,22);Kv.Rp(a,52);Kv.up(a,3);Kv.y9(a,1);Kv.up(a,1);Kv.Rp(a,63);Kv.up(a,2);return a.join("")};
[...]
Kv={y9:function(a,b){var c=a[0];a[0]=a[b%a.length];a[b%a.length]=c},
up:function(a,b){a.splice(0,b)},
Rp:function(a){a.reverse()}};
[...]
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s GuoxLggqI_g_player_ias-vflPI0brM.js -e 'extract($raw,"Kv=\{(.+?)\};",1,"s")'
y9:function(a,b){var c=a[0];a[0]=a[b%a.length];a[b%a.length]=c},
up:function(a,b){a.splice(0,b)},
Rp:function(a){a.reverse()}

$ xidel -s GuoxLggqI_g_player_ias-vflPI0brM.js -e 'extract($raw,"Lv=.+?;(.+);return",1)'
Kv.up(a,2);Kv.y9(a,23);Kv.y9(a,22);Kv.Rp(a,52);Kv.up(a,3);Kv.y9(a,1);Kv.up(a,1);Kv.Rp(a,63);Kv.up(a,2)

----------------------------------------------------------------

- String bewerking.

  $ xidel -se '
    let $sig:="fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==",
        $a:=substring($sig,3),                          # Kv.up(a,2)
        $b:=replace($a,"^(.)(.{22})(.)","$3$2$1"),      # Kv.y9(a,23)
        $c:=replace($b,"^(.)(.{21})(.)","$3$2$1"),      # Kv.y9(a,22)
        $d:=codepoints-to-string(reverse(x:cps($c))),   # Kv.Rp(a,52)
        $e:=substring($d,4),                            # Kv.up(a,3)
        $f:=replace($e,"^(.)(.{0})(.)","$3$2$1"),       # Kv.y9(a,1)
        $g:=substring($f,2),                            # Kv.up(a,1)
        $h:=codepoints-to-string(reverse(x:cps($g))),   # Kv.Rp(a,63)
        $i:=substring($h,3)                             # Kv.up(a,2)
    return ($sig,$a,$b,$c,$d,$e,$f,$g,$h,$i)
  '
  fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==
  fLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==
  -LALgxI2wwRgIhANxVrUOkAfmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==
  ALALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==
  ==g==gK6KROiP912gjvYgKMKu3mV6XSSyjoo2zV_AqOUbaRnAEiAgBFrTIf3T1QCzvUXgjHJSzPzM7hUlZasXmf-kOUrVxNAhIgRww2IxgLALA
  ==gK6KROiP912gjvYgKMKu3mV6XSSyjoo2zV_AqOUbaRnAEiAgBFrTIf3T1QCzvUXgjHJSzPzM7hUlZasXmf-kOUrVxNAhIgRww2IxgLALA
  ==gK6KROiP912gjvYgKMKu3mV6XSSyjoo2zV_AqOUbaRnAEiAgBFrTIf3T1QCzvUXgjHJSzPzM7hUlZasXmf-kOUrVxNAhIgRww2IxgLALA
  =gK6KROiP912gjvYgKMKu3mV6XSSyjoo2zV_AqOUbaRnAEiAgBFrTIf3T1QCzvUXgjHJSzPzM7hUlZasXmf-kOUrVxNAhIgRww2IxgLALA
  ALALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=

  $ xidel -se '
    let $sig:="fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==" return
    substring($sig,3) ! replace(.,"^(.)(.{22})(.)","$3$2$1") ! replace(.,"^(.)(.{21})(.)","$3$2$1") !
    codepoints-to-string(reverse(x:cps(.))) ! substring(.,4) ! replace(.,"^(.)(.{0})(.)","$3$2$1") !
    substring(.,2) ! codepoints-to-string(reverse(x:cps(.))) ! substring(.,3)
  '
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=

  I.p.v. replace($a,"^(.)(.{22})(.)","$3$2$1") werkt concat(substring($a,24,1),substring($a,2,22),substring($a,1,1),substring($a,25)) ook.

----------------------------------------------------------------

- Sequence (reeks) bewerking.

  $ xidel -se '
    let $sig:=x:cps("fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g=="),
        $a:=subsequence($sig,3),
        $b:=($a[24],subsequence($a,2,22),$a[1],subsequence($a,25)),
        $c:=($b[23],subsequence($b,2,21),$b[1],subsequence($b,24)),
        $d:=reverse($c),
        $e:=subsequence($d,4),
        $f:=($e[2],subsequence($e,2,0),$e[1],subsequence($e,3)),
        $g:=subsequence($f,2),
        $h:=reverse($g),
        $i:=subsequence($h,3)
    return codepoints-to-string($i)
  '
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=

  $ xidel -se '
    let $sig:="fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==" return
    subsequence(x:cps($sig),3) ! (.[24],subsequence(.,2,22),.[1],subsequence(.,25)) ...
  
  Dit werkt niet, omdat met ! de reeks is opengebroken waardoor positionering niet meer mogelijk is.
  Deze omslachtige methode, telkens een array ervan maken om de positionering te behouden, werkt wel:

  $ xidel -se '
    let $sig:="fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==" return
    [subsequence(x:cps($sig),3)] ! [.(24),subsequence(.(),2,22),.(1),subsequence(.(),25)] ! [.(23),subsequence(.(),2,21),.(1),subsequence(.(),24)] !
    [reverse(.())] ! [subsequence(.(),4)] ! [.(2),subsequence(.(),2,0),.(1),subsequence(.(),3)] ! [subsequence(.(),2)] ! [reverse(.())] !
    [subsequence(.(),3)] ! codepoints-to-string(.())'
  '
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=

----------------------------------------------------------------

- Functies (string):

  declare function local:swap($a,$b){replace($a,x"^(.)(.{{{$b - 1}}})(.)","$3$2$1")};
  declare function local:swap($a,$b){replace($a,"^(.)(.{"||$b - 1||"})(.)","$3$2$1")};
  declare function local:swap($a,$b){replace($a,concat("^(.)(.{",$b - 1,"})(.)"),"$3$2$1")};
  of
  declare function local:swap($a,$b){concat(substring($a,$b + 1,1),substring($a,2,$b - 1),substring($a,1,1),substring($a,$b + 2))};

  declare function local:reverse($a){codepoints-to-string(reverse(x:cps($a)))};

  $ xidel -s --xquery '
    declare function local:swap($a,$b){replace($a,x"^(.)(.{{{$b - 1}}})(.)","$3$2$1")};
    declare function local:reverse($a){codepoints-to-string(reverse(x:cps($a)))};
    let $sig:="fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==" return
    substring($sig,2 + 1) ! local:swap(.,23) ! local:swap(.,22) ! local:reverse(.) ! substring(.,3 + 1) ! local:swap(.,1) !
    substring(.,1 + 1) ! local:reverse(.) ! substring(.,2 + 1)
  '
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=

----------------------------------------------------------------

- Functies (sequence):

  declare function local:swap($a,$b){($a[$b + 1],subsequence($a,2,$b - 1),$a[1],subsequence($a,$b + 2))};

  $ xidel -s GuoxLggqI_g.json --xquery '
    declare function local:swap($a,$b){($a[$b + 1],subsequence($a,2,$b - 1),$a[1],subsequence($a,$b + 2))};
    let $sig:="fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g==" return (
      [subsequence(x:cps($sig),3)] ! local:swap(.,23) ! local:swap(.,22) ! [reverse(.())] ! [subsequence(.(),4)] ! local:swap(.,1) !
      [subsequence(.(),2)] ! [reverse(.())] ! [subsequence(.(),3)] ! codepoints-to-string(.()),
      codepoints-to-string(subsequence(reverse(subsequence(local:swap(subsequence(reverse(local:swap(local:swap(subsequence(x:cps($sig),2 + 1),23),22)),3 + 1),1),1 + 1)),2 + 1)),
      codepoints-to-string(
        subsequence(
          reverse(
            subsequence(
              local:swap(
                subsequence(
                  reverse(
                    local:swap(
                      local:swap(
                        subsequence(x:cps($sig),2 + 1),
                        23
                      ),
                      22
                    )
                  ),
                  3 + 1
                ),
                1
              ),
              1 + 1
            )
          ),
          2 + 1
        )
      )
    )
  '
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=

----------------------------------------------------------------

- itag=22 uit de "player_response" JSON als voorbeeld:

  $ xidel -s GuoxLggqI_g.json --xquery 'let $a:=$json/args,$b:=$a/json(player_response) return $b/streamingData/(formats)()[itag eq 22]/cipher'
  sp=sig&url=https%3A%2F%2Fr2---sn-mn4vg5aa-5hns.googlevideo.com%2Fvideoplayback%3F[...]itag%3D22[...]

  $ xidel -s GuoxLggqI_g.json --xquery 'let $a:=$json/args,$b:=$a/json(player_response) return $b/streamingData/(formats)()[itag eq 22]/{|for $x in tokenize(cipher,"&amp;") let $a:=tokenize($x,"=") return {$a[1]:uri-decode($a[2])}|}'
  {
    "sp": "sig",
    "url": "https://r2---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?expire=1564689970&ei=0vFCXdm5Buaz8gOSt56YDg&ip=x.x.x.x&id=o-AM1ibvM0Feuk9dfaoOg3JIDE2bGsRFvUjonCfjXC4doV&itag=22&source=youtube&requiressl=yes&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7l&ms=au%2Crdu&mv=m&mvi=1&pl=15&initcwndbps=1722500&mime=video%2Fmp4&ratebypass=yes&dur=5306.015&lmt=1541644163348912&mt=1564668289&fvip=2&beids=23806810&c=WEB&txp=5531432&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cmime%2Cratebypass%2Cdur%2Clmt&lsparams=mm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AHylml4wRAIgYgfiMLa-3zEHAFw3G3NVL2b-nktzrDnHqm-dMZoGkjsCIFgGrQFtuM9R3IwnKUpJ_k476H49zDJDOqhU0-6DodfL",
    "s": "fLfLALgxI2wwRgIhANxVrUOkA-mXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg==g=="
  }

  $ xidel -s GuoxLggqI_g.json --xquery 'declare function local:swap($a,$b){replace($a,x"^(.)(.{{{$b - 1}}})(.)","$3$2$1")}; declare function local:reverse($a){codepoints-to-string(reverse(x:cps($a)))}; let $a:=$json/args,$b:=$a/json(player_response),$c:=$b/streamingData/(formats)()[itag eq 22]/{|for $x in tokenize(cipher,"&amp;") let $a:=tokenize($x,"=") return {$a[1]:uri-decode($a[2])}|} return substring($c/s,2 + 1) ! local:swap(.,23) ! local:swap(.,22) ! local:reverse(.) ! substring(.,3 + 1) ! local:swap(.,1) ! substring(.,1 + 1) ! local:reverse(.) ! substring(.,2 + 1)'
  ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg=

  $ xidel -s GuoxLggqI_g.json --xquery 'declare function local:swap($a,$b){replace($a,x"^(.)(.{{{$b - 1}}})(.)","$3$2$1")}; declare function local:reverse($a){codepoints-to-string(reverse(x:cps($a)))}; let $a:=$json/args,$b:=$a/json(player_response) return $b/streamingData/(formats)()[itag eq 22]/{"id":"pg-1","format":let $a:=extract(mimeType,"/(.+);.+&quot;(\w+)\..+ (\w+)(?:\.|&quot;)",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat(width,"x",height),"bitrate":.[itag ne 43]/bitrate ! concat(round(. div 1000),"kbps"),"url":if (cipher) then let $a:={|for $x in tokenize(cipher,"&amp;") let $a:=tokenize($x,"=") return {$a[1]:uri-decode($a[2])}|} return concat($a/url,"&amp;sig=",substring($a/s,2 + 1) ! local:swap(.,23) ! local:swap(.,22) ! local:reverse(.) ! substring(.,3 + 1) ! local:swap(.,1) ! substring(.,1 + 1) ! local:reverse(.) ! substring(.,2 + 1)) else url}'
  {
    "id": "pg-1",
    "format": "mp4[h264+aac]",
    "resolution": "1280x720",
    "bitrate": "825kbps",
    "url": "https://r2---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?[...]itag=22[...]&sig=ALgxI2wwRgIhANxVrUOk-fmXsaZlUh7MzPzSJHjgXUvzCQ1T3fITrFBgAiEAnRabUOqA_Vz2oojySSX6Vm3uKMKgYvjg219PiORK6Kg="
  }

  $ xidel -s "https://www.youtube.com/watch?v=GuoxLggqI_g" --xquery '[...]let $a:=json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args,[...]'

  De url die hier uit rolt werkt warempel. Dit automatiseren wordt knap lastig!

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Oudere "decipher" poging:

$ xidel -s "https://www.youtube.com/watch?v=evb_kmd9kFM" -e 'outer-html(//script[@name="player_ias/base"])'
<script src="/yts/jsbin/player_ias-vfl25EWhw/nl_NL/base.js" name="player_ias/base"></script>

$ xidel -s "https://www.youtube.com/watch?v=evb_kmd9kFM" -f '//script[@name="player_ias/base"]/@src' -e '$raw' > evb_kmd9kFM_player_ias-vfl25EWhw.js

youtube.py#L1325: (?P<sig>[a-zA-Z0-9$]+)\s*=\s*function\(\s*a\s*\)\s*{\s*a\s*=\s*a\.split\(\s*""\s*\)
- "?P<sig>" weg, omdat Xidel voor zover ik weet geen "Named Capture Groups" ondersteunt.
- "{" escapen; "\{".
- De dubbele aanhalingstekens aan het eind verdubbelen, of &quot; met --xquery.

$ xidel -s evb_kmd9kFM_player_ias-vfl25EWhw.js -e 'extract($raw,"([a-zA-Z0-9$]+)\s*=\s*function\(\s*a\s*\)\s*\{\s*a\s*=\s*a\.split\(\s*""""\s*\)",1)'
iv

'evb_kmd9kFM_player_ias-vfl25EWhw.js':
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
[...]
iv=function(a){a=a.split("");hv.Qe(a,38);hv.w1(a,63);hv.Qe(a,7);hv.Qe(a,18);hv.w1(a,80);hv.Qe(a,21);return a.join("")};
[...]
hv={xC:function(a,b){a.splice(0,b)},
Qe:function(a,b){var c=a[0];a[0]=a[b%a.length];a[b%a.length]=c},
w1:function(a){a.reverse()}};
[...]
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s evb_kmd9kFM_player_ias-vfl25EWhw.js -e 'extract($raw,"hv=\{(.+?)\};",1,"s")'
xC:function(a,b){a.splice(0,b)},
Qe:function(a,b){var c=a[0];a[0]=a[b%a.length];a[b%a.length]=c},
w1:function(a){a.reverse()}

$ xidel -s evb_kmd9kFM_player_ias-vfl25EWhw.js -e 'extract($raw,"iv=.+?;(.+);return",1)'
hv.Qe(a,38);hv.w1(a,63);hv.Qe(a,7);hv.Qe(a,18);hv.w1(a,80);hv.Qe(a,21)

----------------------------------------------------------------

- String bewerking.

  $ xidel -se '
    let $sig:="8710A392B27B0B768805F4FE07A1FADA816278E6.532DEA360BAD3768AD2EF61152A9932FF3CAC796",
        $a:=replace($sig,"^(.)(.{37})(.)","$3$2$1"),    # hv.Qe(a,38)
        $b:=codepoints-to-string(reverse(x:cps($a))),   # hv.w1(a,63)
        $c:=replace($b,"^(.)(.{6})(.)","$3$2$1"),       # hv.Qe(a,7)
        $d:=replace($c,"^(.)(.{17})(.)","$3$2$1"),      # hv.Qe(a,18)
        $e:=codepoints-to-string(reverse(x:cps($d))),   # hv.w1(a,80)
        $f:=replace($e,"^(.)(.{20})(.)","$3$2$1")       # hv.Qe(a,21)
    return ($sig,$a,$b,$c,$d,$e,$f)
  '
  8710A392B27B0B768805F4FE07A1FADA816278E6.532DEA360BAD3768AD2EF61152A9932FF3CAC796
  E710A392B27B0B768805F4FE07A1FADA81627886.532DEA360BAD3768AD2EF61152A9932FF3CAC796
  697CAC3FF2399A25116FE2DA8673DAB063AED235.68872618ADAF1A70EF4F508867B0B72B293A017E
  F97CAC36F2399A25116FE2DA8673DAB063AED235.68872618ADAF1A70EF4F508867B0B72B293A017E
  697CAC36F2399A2511FFE2DA8673DAB063AED235.68872618ADAF1A70EF4F508867B0B72B293A017E
  E710A392B27B0B768805F4FE07A1FADA81627886.532DEA360BAD3768AD2EFF1152A9932F63CAC796
  4710A392B27B0B768805FEFE07A1FADA81627886.532DEA360BAD3768AD2EFF1152A9932F63CAC796

----------------------------------------------------------------

- Sequence (reeks) bewerking.

  $ xidel -se '
    let $sig:=x:cps("8710A392B27B0B768805F4FE07A1FADA816278E6.532DEA360BAD3768AD2EF61152A9932FF3CAC796"),
        $a:=($sig[39],subsequence($sig,2,37),$sig[1],subsequence($sig,40)),
        $b:=reverse($a),
        $c:=($b[8],subsequence($b,2,6),$b[1],subsequence($b,9)),
        $d:=($c[19],subsequence($c,2,17),$c[1],subsequence($c,20)),
        $e:=reverse($d),
        $f:=($e[22],subsequence($e,2,20),$e[1],subsequence($e,23))
    return codepoints-to-string($f)
  '
  4710A392B27B0B768805FEFE07A1FADA81627886.532DEA360BAD3768AD2EFF1152A9932F63CAC796

------------------------------------------------------------------------------------------------

--xquery '
  let $a:=if (//meta[@property="og:restrictions:age"]) then
        {|
          for $x in tokenize(
            unparsed-text(
              concat(
                "https://www.youtube.com/get_video_info?video_id=",
                //meta[@itemprop="videoId"]/@content,
                "&amp;eurl=",
                uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),
                "&amp;sts=",
                json(
                  doc(
                    "https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content
                  )//script/extract(.,"setConfig\((.+?)\)",1,"*")[3]
                )//sts
              )
            ),
            "&amp;"
          )
          let $a:=tokenize($x,"=") return {$a[1]:uri-decode($a[2])}
        |}
      else
        json(
          //script/extract(.,"ytplayer.config = (.+?\});",1)[.]
        )/args,
      $b:=$a/json(player_response),
      $c:=for $x at $i in tokenize($a/url_encoded_fmt_stream_map,",") return {|
        let $a:=extract(
          tokenize($a/fmt_list,",")[$i],
          "/(\d+)x(\d+)",
          (1,2)
        ) return ({"width":$a[1]},{"height":$a[2]}),
        for $y in tokenize($x,"&amp;")
        let $a:=tokenize($y,"=")
        return
        {if ($a[1]="type") then "mimeType" else $a[1]:uri-decode($a[2])}
      |},
      $d:=tokenize($a/adaptive_fmts,",") ! {|
        for $x in tokenize(.,"&amp;")
        let $a:=tokenize($x,"=")
        return
        if ($a[1]="size") then
          let $a:=tokenize($a[2],"x") return ({"width":$a[1]},{"height":$a[2]})
        else {
          if ($a[1]="type") then
            "mimeType"
          else if ($a[1]="audio_sample_rate") then
            "audioSampleRate"
          else
            $a[1]:uri-decode($a[2])
        }
      |}
  return
  if ($b/videoDetails/isLive) then {
    "name"://meta[@property="og:title"]/@content,
    "date":format-date(current-date(),"[D01]-[M01]-[Y]"),
    "formats":xivid:m3u8-to-json($b/streamingData/hlsManifestUrl)
  } else {
    "name"://meta[@property="og:title"]/@content,
    "date":format-date(
      date(//meta[@itemprop="datePublished"]/@content),
      "[D01]-[M01]-[Y]"
    ),
    "duration":duration(//meta[@itemprop="duration"]/@content) + time("00:00:00"),
    "formats":[
      ($b//captionTracks)()[languageCode="nl"]/{
        "id":"sub-1",
        "format":"ttml",
        "language":"nl",
        "label":name/simpleText,
        "url":baseUrl
      },
      for $x at $i in if ($b/streamingData/formats) then $b/streamingData/(formats)()[url] else reverse($c[not(s)])
      order by $x/width
      count $i
      return {
        "id":"pg-"||$i,
        "format":let $a:=extract(
          $x/mimeType,
          "/(.+);.+&quot;(\w+)\..+ (\w+)(?:\.|&quot;)",
          (1 to 3)
        ) return
        concat(
          if ($a[1]="3gpp") then "3gp" else $a[1],
          "[",
          if ($a[2]="avc1") then "h264" else $a[2],
          "+",
          if ($a[3]="mp4a") then "aac" else $a[3],
          "]"
        ),
        "resolution":concat($x/width,"x",$x/height),
        "bitrate":$x[itag ne 43]/bitrate ! concat(round(. div 1000),"kbps"),
        "url":$x/url
      },
      for $x at $i in if ($b/streamingData/adaptiveFormats) then $b/streamingData/(adaptiveFormats)()[url] else $d[not(s)]
      order by $x/boolean(width),$x/bitrate
      count $i
      return {
        "id":"dash-"||$i,
        "format":let $a:=extract(
          $x/mimeType,
          "/(.+);.+&quot;(\w+)",
          (1,2)
        ) return
        concat(
          $a[1],
          "[",
          if ($a[2]="avc1") then "h264" else if ($a[2]="mp4a") then "aac" else $a[2],
          "]"
        ),
        "resolution":$x/width ! concat(.,"x",$x/height,"@",$x/fps,"fps"),
        "samplerate":$x/audioSampleRate ! concat(. div 1000,"kHz"),
        "bitrate":round($x/bitrate div 1000)||"kbps",
        "url":$x/url
      }
    ]
  }
'

================================================================================================

[vimeo]

https://vimeo.com/195782736

$ xidel -s "https://vimeo.com/195782736" -e 'json(//script/extract(.,"clip_page_config = (.+);",1)[.])'
{
  "clip": {
    "id": 195782736,
    "title": "Sony Cyber-shot RX100 V sample movie: Daylight handheld / 4k / 24p",
    "description": "<p class=\"first\">Sample movie filmed with a Sony Cyber-shot RX100 V in 4k / 24p using the Standard Creative Style and with Picture Profiles Off. This video is part of my RX100 V review at Camera Labs. You can find my review at:</p>\n<p><a href=\"http://www.cameralabs.com/reviews/Sony_Cyber-shot_RX100_V/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cameralabs.com/reviews/Sony_Cyber-shot_RX100_V/</a></p>\n<p>Feel free to download the original file for evaluation on your own computer, but please don&#039;t upload it to another website without permission from <a href=\"http://www.cameralabs.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">cameralabs.com/</a>  Thanks!</p>",
    "uploaded_on": "2016-12-15 07:10:44",
    "uploaded_on_relative": "2 years ago",
    "uploaded_on_full": "Thursday, December 15, 2016 at 7:10 AM EST",
    "is_spatial": false,
    "is_hdr": false,
    "privacy": {
      "is_public": true,
      "type": "anybody",
      "description": "Public"
    },
    "duration": {
      "raw": 19,
      "formatted": "00:19"
    },
    "is_liked": false,
    "is_unavailable": false,
    "likes_url": "/195782736/likes",
    "is_live": false,
    "unlisted_hash": null
  },
  [...]
  "player": {
    "config_url": "https://player.vimeo.com/video/195782736/config?autopause=1&byline=0&collections=1&context=Vimeo%5CController%5CClipController.main&default_to_hd=1&outro=nothing&portrait=0&share=1&title=0&watch_trailer=0&s=367ed06735a602d6e3e5c20f0713f42c4a46ecbf_1564856655",
    "player_url": "player.vimeo.com",
    "dimensions": {
      "height": 540,
      "width": 960
    },
    "poster": {
      "url": "https://i.vimeocdn.com/video/608090569.jpg?mw=2000&mh=1080&q=70"
    }
  },
  [...]
}

$ xidel -s "https://vimeo.com/195782736" -e 'json(//script/extract(.,"clip_page_config = (.+);",1)[.])/player/json(config_url)'
{
  "cdn_url": "https://f.vimeocdn.com",
  "vimeo_api_url": "api.vimeo.com",
  "request": {
    "files": {
      "dash": {
        "separate_av": true,
        "streams": [
          {
            "profile": 119,
            "quality": "1080p",
            "id": 656588355,
            "fps": 23
          },
          [...]
          {
            "profile": 174,
            "quality": "720p",
            "id": 656588395,
            "fps": 23
          }
        ],
        "cdns": {
          "akfire_interconnect_quic": {
            "url": "https://137skyfiregce-vimeo.akamaized.net/exp=1564760602~acl=%2F195782736%2F%2A~hmac=ab204b26e281653916a435156a98ceafe3e40d05b144e42867e57e38fab34177/195782736/sep/video/656588398,656588401,656588395,656588393,656588355,656588334/master.json?base64_init=1",
            "origin": "gcs"
          },
          "fastly_skyfire": {
            "url": "https://skyfire.vimeocdn.com/1564760602-0x27d00b2e48ee30536284cb9f76fd59643e77f5ae/195782736/sep/video/656588398,656588401,656588395,656588393,656588355,656588334/master.json?base64_init=1",
            "origin": "gcs"
          }
        },
        "default_cdn": "fastly_skyfire"
      },
      "hls": {
        "separate_av": false,
        "default_cdn": "fastly_skyfire",
        "cdns": {
          "akfire_interconnect_quic": {
            "url": "https://137skyfiregce-vimeo.akamaized.net/exp=1564760602~acl=%2F195782736%2F%2A~hmac=ab204b26e281653916a435156a98ceafe3e40d05b144e42867e57e38fab34177/195782736/video/656588398,656588401,656588395,656588393,656588355,656588334/master.m3u8",
            "origin": "gcs"
          },
          "fastly_skyfire": {
            "url": "https://skyfire.vimeocdn.com/1564760602-0x27d00b2e48ee30536284cb9f76fd59643e77f5ae/195782736/video/656588398,656588401,656588395,656588393,656588355,656588334/master.m3u8",
            "origin": "gcs"
          }
        }
      },
      "progressive": [
        {
          "profile": 170,
          "width": 2560,
          "mime": "video/mp4",
          "fps": 23,
          "url": "https://gcs-vimeo.akamaized.net/exp=1564760602~acl=%2A%2F656588401.mp4%2A~hmac=1fe49184540fbb4774b99e21a01af79049471011467213644a895d5eb19b293c/vimeo-prod-skyfire-std-us/01/4156/7/195782736/656588401.mp4",
          "cdn": "akamai_interconnect",
          "quality": "1440p",
          "id": 656588401,
          "origin": "gcs",
          "height": 1440
        },
        [...]
        {
          "profile": 165,
          "width": 960,
          "mime": "video/mp4",
          "fps": 23,
          "url": "https://gcs-vimeo.akamaized.net/exp=1564760602~acl=%2A%2F656588334.mp4%2A~hmac=f0e4bf3f128a2bed654e37027b30fb29a0066e36918d49f207f9719f2215174c/vimeo-prod-skyfire-std-us/01/4156/7/195782736/656588334.mp4",
          "cdn": "akamai_interconnect",
          "quality": "540p",
          "id": 656588334,
          "origin": "gcs",
          "height": 540
        }
      ]
    },
    [...]
    }
  },
  [...]
}

$ xidel -s --module=xivid.xqm "https://vimeo.com/195782736" -e 'json(//script/extract(.,"clip_page_config = (.+);",1)[.])/{"name":clip/title,"date":replace(clip/uploaded_on,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":clip/duration/raw * duration("PT1S") + time("00:00:00"),"formats":player/json(config_url)//files/(for $x at $i in (progressive)() order by $x/width count $i return $x/{"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat(width,"x",height,"@",fps,"fps"),"url":url},xivid:m3u8-to-json((hls//url)[1]))}'
{
  "name": "Sony Cyber-shot RX100 V sample movie: Daylight handheld / 4k / 24p",
  "date": "15-12-2016",
  "duration": "00:00:19",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360@23fps",
      "url": "https://gcs-vimeo.akamaized.net/exp=1564760854~acl=%2A%2F656588398.mp4%2A~hmac=1caf16b81674ac295cd421a91b8729374b7b9cf283bf15cc15bf8f85763076e1/vimeo-prod-skyfire-std-us/01/4156/7/195782736/656588398.mp4"
    },
    [...]
    {
      "id": "hls-6",
      "format": "m3u8[h264+aac]",
      "resolution": "3840x2160@23.976fps",
      "bitrate": "22273kbps",
      "url": "https://137skyfiregce-vimeo.akamaized.net/exp=1564760854~acl=%2F195782736%2F%2A~hmac=19a32934b6a2f5474b50c73ba1e33ef8d00bede1296e6d4256972bf4af35247b/195782736/video/656588393/playlist.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  json(
    //script/extract(.,"clip_page_config = (.+);",1)[.]
  )/{
    "name":clip/title,
    "date":replace(
      clip/uploaded_on,
      "(\d+)-(\d+)-(\d+).+",
      "$3-$2-$1"
    ),
    "duration":clip/duration/raw * duration("PT1S") + time("00:00:00"),
    "formats":player/json(config_url)//files/(
      for $x at $i in (progressive)()
      order by $x/width
      count $i
      return
      $x/{
        "id":"pg-"||$i,
        "format":"mp4[h264+aac]",
        "resolution":concat(width,"x",height,"@",fps,"fps"),
        "url":url
      },
      xivid:m3u8-to-json((hls//url)[1])
    )
  }
'

================================================================================================

[nos]

https://nos.nl/video/2308356-van-nieuwenhuizen-biedt-excuses-aan-voor-fouten-stint.html

$ xidel -s "https://nos.nl/video/2308356-van-nieuwenhuizen-biedt-excuses-aan-voor-fouten-stint.html" -e 'json(//script[ends-with(@data-ssr-name,"VideoPlayer")])'
{
  "id": 2308356,
  "title": "Van Nieuwenhuizen biedt excuses aan voor fouten stint",
  "poster": "https://nos.nl/data/image/2019/10/30/588578/xxl.jpg",
  "formats": [
    {
      "width": 640,
      "height": 360,
      "name": "360p",
      "label": "Laag - 360p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F10%2F30%2F246849-76251f8d49b26b36aaea7dadebcc599b%2F246849-76251f8d49b26b36aaea7dadebcc599b.ism%2F246849-76251f8d49b26b36aaea7dadebcc599b.m3u8"
      }
    },
    {
      "width": 1280,
      "height": 720,
      "name": "720p",
      "label": "HD - 720p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F10%2F30%2F246849-76251f8d49b26b36aaea7dadebcc599b%2F246849-76251f8d49b26b36aaea7dadebcc599b.ism%2F246849-76251f8d49b26b36aaea7dadebcc599b.m3u8"
      }
    },
    {
      "width": 848,
      "height": 480,
      "name": "480p",
      "label": "Normaal - 480p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F10%2F30%2F246849-76251f8d49b26b36aaea7dadebcc599b%2F246849-76251f8d49b26b36aaea7dadebcc599b.ism%2F246849-76251f8d49b26b36aaea7dadebcc599b.m3u8"
      }
    },
    {
      "width": 960,
      "height": 540,
      "name": "540p",
      "label": "Hoog - 540p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F10%2F30%2F246849-76251f8d49b26b36aaea7dadebcc599b%2F246849-76251f8d49b26b36aaea7dadebcc599b.ism%2F246849-76251f8d49b26b36aaea7dadebcc599b.m3u8"
      }
    }
  ],
  "geoProtected": false,
  "adConfig": "https://adconfig.ster.nl/adurl/[identifier]?ncc=[noCommercialCookies]&cust_params=omroep%3Dnos%26genre%3Dnieuws%26video_duur%3D61%26afleverings_titel%3Dvannieuwenhuizenbiedtexcusesaanvoorfoutenstint%26programma_titel%3Dnieuws",
  "duration": 61,
  "owner": "nieuws",
  "showCaption": false
}

De m3u8-urls zijn allemaal hetzelfde! Het betreft hier het manifest.

$ xidel -s --module=xivid.xqm "https://nos.nl/video/2308356-van-nieuwenhuizen-biedt-excuses-aan-voor-fouten-stint.html" -e 'let $a:=json(//script[ends-with(@data-ssr-name,"VideoPlayer")]) return {"name":"NOS: "||$a/title,"date":format-date(dateTime(replace(//@datetime,"(.+)(\d{2})","$1:$2")),"[D01]-[M01]-[Y]"),"duration":$a/duration * duration("PT1S") + time("00:00:00"),"formats":xivid:m3u8-to-json($a/(formats)(1)/url/mp4)}'
{
  "name": "NOS: Van Nieuwenhuizen biedt excuses aan voor fouten stint",
  "date": "30-10-2019",
  "duration": "00:01:01",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m24be6d585b79227f005dc9f0cc000000.8bc28d1245f96afbbf7719c4a5a9f2f1/o/nos/content/video/2019/10/30/246849-76251f8d49b26b36aaea7dadebcc599b/246849-76251f8d49b26b36aaea7dadebcc599b.ism/246849-76251f8d49b26b36aaea7dadebcc599b.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "412|128kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m24be6d585b79227f005dc9f0cc000000.8bc28d1245f96afbbf7719c4a5a9f2f1/o/nos/content/video/2019/10/30/246849-76251f8d49b26b36aaea7dadebcc599b/246849-76251f8d49b26b36aaea7dadebcc599b.ism/246849-76251f8d49b26b36aaea7dadebcc599b-audio_eng=128000-video_eng=412000.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "1814|128kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m24be6d585b79227f005dc9f0cc000000.8bc28d1245f96afbbf7719c4a5a9f2f1/o/nos/content/video/2019/10/30/246849-76251f8d49b26b36aaea7dadebcc599b/246849-76251f8d49b26b36aaea7dadebcc599b.ism/246849-76251f8d49b26b36aaea7dadebcc599b-audio_eng=128000-video_eng=1814000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://nos.nl/artikel/2311824-tesla-verkoopt-tienduizenden-cybertrucks-ondanks-kapotte-ruiten.html

$ xidel -s https://nos.nl/artikel/2311824-tesla-verkoopt-tienduizenden-cybertrucks-ondanks-kapotte-ruiten.html -e 'json(//script[ends-with(@data-ssr-name,"VideoPlayer") or @data-ssr-name="pages/Article/Article"])/(.//video,.)[1]'
{
  "id": 2311563,
  "title": "Tesla medewerker gooit nieuwe auto kapot",
  "description": "Tesla medewerker gooit nieuwe auto kapot",
  "geoprotection": false,
  "pre_roll": "https://pubads.g.doubleclick.net/gampad/ads?sz=720x404&iu=/9233/npoplayer.nl/nosnieuws&ciu_szs&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&description_url=[description_url]&correlator=[timestamp]&ad_rule=1&cust_params=omroep%3Dnos%26genre%3Dnos",
  "pre_rolls": {
    "consent": "https://pubads.g.doubleclick.net/gampad/ads?sz=720x404&iu=/9233/npoplayer.nl/nosnieuws&ciu_szs&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&description_url=[description_url]&correlator=[timestamp]&ad_rule=1&cust_params=omroep%3Dnos%26genre%3Dnos",
    "no_consent": "https://sterdfpproxy.ster.nl/gampad/ads?sz=720x404&iu=/9233/npoplayer.nl/nosnieuws&ciu_szs&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&url=[referrer_url]&description_url=[description_url]&correlator=[timestamp]&ad_rule=1&cust_params=omroep%3Dnos%26genre%3Dnos",
    "ad_config": "https://adconfig.ster.nl/adurl/[identifier]?ncc=[noCommercialCookies]&cust_params=omroep%3Dnos%26genre%3Djeugd%26video_duur%3D51%26afleverings_titel%3Dteslamedewerkergooitnieuweautokapot%26programma_titel%3Djeugdjournaal"
  },
  "formats": [
    {
      "width": 640,
      "height": 360,
      "name": "360p",
      "label": "Laag - 360p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F11%2F22%2F248007-89413149430dd806a2ac05266c0d6592%2F248007-89413149430dd806a2ac05266c0d6592.ism%2F248007-89413149430dd806a2ac05266c0d6592.m3u8&legacy=resolve.php"
      }
    },
    {
      "width": 848,
      "height": 480,
      "name": "480p",
      "label": "Normaal - 480p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F11%2F22%2F248007-89413149430dd806a2ac05266c0d6592%2F248007-89413149430dd806a2ac05266c0d6592.ism%2F248007-89413149430dd806a2ac05266c0d6592.m3u8&legacy=resolve.php"
      }
    },
    {
      "width": 1280,
      "height": 720,
      "name": "720p",
      "label": "HD - 720p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F11%2F22%2F248007-89413149430dd806a2ac05266c0d6592%2F248007-89413149430dd806a2ac05266c0d6592.ism%2F248007-89413149430dd806a2ac05266c0d6592.m3u8&legacy=resolve.php"
      }
    },
    {
      "width": 960,
      "height": 540,
      "name": "540p",
      "label": "Hoog - 540p",
      "mimetype": "application/vnd.apple.mpegurl",
      "url": {
        "mp4": "https://resolver.streaming.api.nos.nl/adaptive?url=%2Fcontent%2Fvideo%2F2019%2F11%2F22%2F248007-89413149430dd806a2ac05266c0d6592%2F248007-89413149430dd806a2ac05266c0d6592.ism%2F248007-89413149430dd806a2ac05266c0d6592.m3u8&legacy=resolve.php"
      }
    }
  ],
  "image": {...},
  "published_at": "2019-11-22T15:42:37+0100",
  "duration": 51,
  "related": [...]
}

$ xidel -s --module=xivid.xqm "https://nos.nl/artikel/2311824-tesla-verkoopt-tienduizenden-cybertrucks-ondanks-kapotte-ruiten.html" -e 'let $a:=json(//script[ends-with(@data-ssr-name,"VideoPlayer") or @data-ssr-name="pages/Article/Article"])/(.//video,.)[1] return {"name":"NOS: "||$a/title,"date":format-date(dateTime(replace(($a/published_at,//@datetime)[1],"(.+)(\d{2})","$1:$2")),"[D01]-[M01]-[Y]"),"duration":$a/duration * duration("PT1S") + time("00:00:00"),"formats":xivid:m3u8-to-json($a/(formats)(1)/url/mp4)}'
{
  "name": "NOS: Tesla medewerker gooit nieuwe auto kapot",
  "date": "22-11-2019",
  "duration": "00:00:51",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://adaptive-e05c1h.npostreaming.nl/urishieldv2/l27m68c577c43d54b6ef005ddaa16c000000.49671f276b296a3fa48581894a4eb1e4/o/nos/content/video/2019/11/22/248007-89413149430dd806a2ac05266c0d6592/248007-89413149430dd806a2ac05266c0d6592.ism/248007-89413149430dd806a2ac05266c0d6592.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "414|128kbps",
      "url": "https://adaptive-e05c1h.npostreaming.nl/urishieldv2/l27m68c577c43d54b6ef005ddaa16c000000.49671f276b296a3fa48581894a4eb1e4/o/nos/content/video/2019/11/22/248007-89413149430dd806a2ac05266c0d6592/248007-89413149430dd806a2ac05266c0d6592.ism/248007-89413149430dd806a2ac05266c0d6592-audio_eng=128000-video_eng=414000.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "1835|128kbps",
      "url": "https://adaptive-e05c1h.npostreaming.nl/urishieldv2/l27m68c577c43d54b6ef005ddaa16c000000.49671f276b296a3fa48581894a4eb1e4/o/nos/content/video/2019/11/22/248007-89413149430dd806a2ac05266c0d6592/248007-89413149430dd806a2ac05266c0d6592.ism/248007-89413149430dd806a2ac05266c0d6592-audio_eng=128000-video_eng=1835000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://nos.nl/livestream/npo-nieuws.html

$ xidel -s --module=xivid.xqm "https://nos.nl/livestream/npo-nieuws.html" -e 'let $a:=json(//script[ends-with(@data-ssr-name,"VideoPlayer") or @data-ssr-name="pages/Article/Article"])/(.//video,.)[1] return if (//video/@data-type="livestream") then {"name":concat("NOS: ",//h1[ends-with(@class,"__title")]," Livestream"),"date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(//@data-stream)} else {"name":"NOS: "||$a/title,"date":format-date(dateTime(replace(($a/published_at,//@datetime)[1],"(.+)(\d{2})","$1:$2")),"[D01]-[M01]-[Y]"),"duration":$a/duration * duration("PT1S") + time("00:00:00"),"formats":xivid:m3u8-to-json($a/(formats)(1)/url/mp4)}'
{
  "name": "NOS: NPO Nieuws Livestream",
  "date": "24-11-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://pedgewarer24a.video.kpnstreaming.nl/session/6d85d332-0ec6-11ea-9fac-1458d041afa8/qkakz5/b2b/live/npo/live/npo/thematv/journaal24/journaal24.isml/journaal24.m3u8?token=33a164933a6705ea8695e357069c3d82_1574691999_1574691999"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://pedgewarer24a.video.kpnstreaming.nl/session/6d85d332-0ec6-11ea-9fac-1458d041afa8/qkakz5/b2b/live/npo/live/npo/thematv/journaal24/journaal24.isml/journaal24-audio_nld=128000.m3u8"
    },
    [...]
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "1024x576@25fps",
      "bitrate": "1400|128kbps",
      "url": "https://pedgewarer24a.video.kpnstreaming.nl/session/6d85d332-0ec6-11ea-9fac-1458d041afa8/qkakz5/b2b/live/npo/live/npo/thematv/journaal24/journaal24.isml/journaal24-audio_nld=128000-video=1400000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

-e '
  let $a:=json(
    //script[ends-with(@data-ssr-name,"VideoPlayer") or @data-ssr-name="pages/Article/Article"]
  )/(.//video,.)[1] return
  if (//video/@data-type="livestream") then {
    "name":concat(
      "NOS: ",
      //h1[ends-with(@class,"__title")],
      " Livestream"
    ),
    "date":format-date(current-date(),"[D01]-[M01]-[Y]"),
    "formats":xivid:m3u8-to-json(//@data-stream)
  } else {
    "name":"NOS: "||$a/title,
    "date":format-date(
      dateTime(
        replace(
          ($a/published_at,//@datetime)[1],
          "(.+)(\d{2})",
          "$1:$2"
        )
      ),
      "[D01]-[M01]-[Y]"
    ),
    "duration":$a/duration * duration("PT1S") + time("00:00:00"),
    "formats":xivid:m3u8-to-json($a/(formats)(1)/url/mp4)
  }
'

================================================================================================

[dumpert]

$ url=https://www.dumpert.nl/item/7971943_ce706a57

$ xidel -se 'doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]'
"{\"ads\":{\"kachingInstance\":null,\"kachingInitialized\":false,\"adsShowBlockerConsent\":true},\"items\":{\"item\":{\"item\":{\"date\":\"2020-08-22T10:22:56+02:00\",\"description\":\"Lekker begin van de dag ouwe\",\"id\":\"7971943_ce706a57\",[...]}"

$ xidel -se 'json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.])'
{"ads":{"kachingInstance":null,"kachingInitialized":false,"adsShowBlockerConsent":true},"items":{"item":{"item":{"date":"2020-08-22T10:22:56+02:00","description":"Lekker begin van de dag ouwe","id":"7971943_ce706a57",[...]}

$ xidel -se 'json(json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))/items/item/item'
{
  "date": "2020-08-22T10:22:56+02:00",
  "description": "Lekker begin van de dag ouwe",
  "id": "7971943_ce706a57",
  "media": [
    {
      "description": "",
      "duration": 30,
      "mediatype": "VIDEO",
      "variants": [
        {
          "uri": "https://media.dumpert.nl/tablet/ce706a57_Fietser_Impact.mp4.mp4.mp4",
          "version": "tablet"
        },
        {
          "uri": "https://media.dumpert.nl/mobile/ce706a57_Fietser_Impact.mp4.mp4.mp4",
          "version": "mobile"
        },
        {
          "uri": "https://media.dumpert.nl/720p/ce706a57_Fietser_Impact.mp4.mp4.mp4",
          "version": "720p"
        }
      ]
    }
  ],
  [...]
  "title": "Telefoon checken tijdens het fietsen",
  [...]
}

Dumpert formaten van lage naar hoge resolutie: "mobile","tablet","720p","original", ook al zie je die laatste niet vaak.

$ xidel -s --xquery 'json(json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))/items/item/item/{"name":"Dumpert: "||title,"date":format-date(dateTime(date),"[D01]-[M01]-[Y]"),"duration":(media)()/duration * duration("PT1S") + time("00:00:00"),"formats":for $x at $i in ("mobile","tablet","720p","original") let $vid:=(.//variants)()[version=$x]/uri return {"id":"pg-"||$i,"format":"mp4[h264+aac]","url":$vid}[url]}'
{
  "name": "Dumpert: Telefoon checken tijdens het fietsen",
  "date": "22-08-2020",
  "duration": "00:00:30",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://media.dumpert.nl/mobile/ce706a57_Fietser_Impact.mp4.mp4.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "url": "https://media.dumpert.nl/tablet/ce706a57_Fietser_Impact.mp4.mp4.mp4"
    },
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "url": "https://media.dumpert.nl/720p/ce706a57_Fietser_Impact.mp4.mp4.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

$ url=https://www.dumpert.nl/item/7971991_95a8ef78 (foto, geen video)

$ xidel -se 'json(json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))/items/item/item'
{
  "date": "2020-08-22T11:47:46+02:00",
  "description": "FB gebruikert spotte ze veel <a href=\"https://www.dumpert.nl/item/7970941_6d833581\" target=\"_blank\">vaker</a>!",
  "id": "7971991_95a8ef78",
  "media": [
    {
      "description": "",
      "duration": 0,
      "mediatype": "FOTO",
      "variants": [
        {
          "uri": "https://media.dumpert.nl/foto/95a8ef78_Schermafbeelding_2020_08_22_om_11.43.19.png.png",
          "version": "foto"
        }
      ]
    }
  ],
  [...]
  "title": "Onschuldige dames zijn stiekem rellertjes",
  [...]
}

[(media)()[mediatype="VIDEO"]] om alleen de video's te ontleden.

------------------------------------------------------------------------------------------------

$ url=https://www.dumpert.nl/item/7944807_3df1ea7a (embedded youtube video)

$ xidel -se 'json(json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))/items/item/item[(media)()[mediatype="VIDEO"]]'
{
  "date": "2020-08-03T17:00:39+02:00",
  "description": "Alle sadisten opgelet: er staat weer een nieuwe #FAIL-compilatie voor je klaar. Genieten!",
  "id": "7944807_3df1ea7a",
  "media": [
    {
      "description": "",
      "duration": 382,
      "mediatype": "VIDEO",
      "variants": [
        {
          "uri": "youtube:uF1ztwahGeA",
          "version": "embed"
        }
      ]
    }
  ],
  [...]
  "title": "Deze mensen kunnen echt helemaal niks! #FAIL (6) | Dumpert Tags",
  [...]
}

$ xidel -s --xquery 'json(json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))/items/item/item[(media)()[mediatype="VIDEO"]]/{"name":"Dumpert: "||title,"date":format-date(dateTime(date),"[D01]-[M01]-[Y]"),"duration":(media)()/duration * duration("PT1S") + time("00:00:00"),"formats":for $x at $i in ("mobile","tablet","720p","original") let $vid:=(.//variants)()[version=$x]/uri return {"id":"pg-"||$i,"format":"mp4[h264+aac]","url":$vid}[url]}'
{
  "name": "Dumpert: De weg naar VeeKay's eerste Indy 500",
  "date": "21-08-2020",
  "duration": "00:01:44",
  "formats": null
}

$ url=https://www.dumpert.nl/item/7971823_1f7a4dfc (embedded twitter video)

$ xidel -se 'json(json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))/items/item/item[(media)()[mediatype="VIDEO"]]'
{
  "date": "2020-08-21T21:43:10+02:00",
  "description": "Scoort zijn tweede in de finale",
  "id": "7971823_1f7a4dfc",
  "media": [
    {
      "description": "",
      "duration": 67,
      "mediatype": "VIDEO",
      "variants": [
        {
          "uri": "twitter:1296893972804247552",
          "version": "embed"
        }
      ]
    }
  ],
  [...]
  "title": "Kopbaas de Jong",
  [...]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Nog te doen: af laten handelen door xivid:youtube() en xivid:twitter() als die klaar zijn.

$ xidel -s --xquery 'json(json(doc("'$url'")//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))/items/item/item[(media)()[mediatype="VIDEO"]]/(if ((.//variants)()/version="embed") then (.//variants)()/(if (starts-with(uri,"youtube")) then xivid:youtube(replace(uri,"youtube:","https://youtu.be/")) else xivid:twitter(replace(uri,"twitter:","https://twitter.com/i/status/"))) else {"name":"Dumpert: "||title,"date":format-date(dateTime(date),"[D01]-[M01]-[Y]"),"duration":(media)()/duration * duration("PT1S") + time("00:00:00"),"formats":for $x at $i in ("mobile","tablet","720p","original") let $vid:=(.//variants)()[version=$x]/uri return {"id":"pg-"||$i,"format":"mp4[h264+aac]","url":$vid}[url]})'

------------------------------------------------------------------------------------------------

declare function xivid:dumpert($url as string) as object()? {
  json(
    json(
      doc($url)//script/extract(.,"JSON\.parse\((.+)\)",1)[.]
    )
  )/items/item/item[(media)()[mediatype="VIDEO"]]/{
    "name":"Dumpert: "||title,
    "date":format-date(dateTime(date),"[D01]-[M01]-[Y]"),
    "duration":(media)()/duration * duration("PT1S") + time("00:00:00"),
    "formats":for $x at $i in ("mobile","tablet","720p","original")
    let $vid:=(.//variants)()[version=$x]/uri
    return {
      "id":"pg-"||$i,
      "format":"mp4[h264+aac]",
      "url":$vid
    }[url]
  }
};

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Opsomming van alle Dumpert toppers video's, gewoon voor de fun:

$ xidel -s "https://www.dumpert.nl" -e 'json(json(//script/extract(.,"JSON\.parse\((.+)\)",1)[.]))//toppers/(list)()/(media)()[mediatype="VIDEO"]/(for $x in ("mobile","tablet","720p","original","embed") return (variants)()[version=$x]/(if (starts-with(uri,"youtube")) then replace(uri,"youtube:","https://youtu.be/") else if (starts-with(uri,"twitter")) then replace(uri,"twitter:","https://twitter.com/i/status/") else uri))[last()]'
https://media.dumpert.nl/tablet/2e296d00_IMG_4411.MP4.mp4.mp4
https://media.dumpert.nl/tablet/cfae0e8c_httpsadmin.dumpert.nlmediabaseoriginal035b620d_IMG_1850.MP4._online_video_cutter.com.mp4.mp4.mp4
https://media.dumpert.nl/tablet/cc620f7d_IMG_3907.MP4.mp4.mp4
https://media.dumpert.nl/720p/ce706a57_Fietser_Impact.mp4.mp4.mp4
https://media.dumpert.nl/tablet/112679e2_Gorilla_s_observeren_een_rups_Videoman.mp4.mp4.mp4
https://media.dumpert.nl/tablet/80225d59_Quand_vais_je_perdre_mon_pucelage_.mp4.mp4.mp4
https://media.dumpert.nl/tablet/c7a3a5d0_WhatsApp_Video_2020_08_21_at_00.38.28.mp4.mp4.mp4
https://media.dumpert.nl/tablet/8a4f1964_WhatsApp_Video_2020_08_21_at_18.46.30.mp4.mp4.mp4
https://youtu.be/NSuaUok-wTY
https://media.dumpert.nl/tablet/9e026ec0_Michael_Jackson_____pr0gramm.com_____Die_Datingplattform_fu__r_Kel.mp4.mp4.mp4
https://media.dumpert.nl/tablet/7cc27945_26a12e159420b0d25e2336840f1277fe.mp4.mp4.mp4
https://media.dumpert.nl/tablet/606bfb07_96596306_561359294796030_4278977649484383195_n.mp4.mp4.mp4
https://media.dumpert.nl/tablet/8ef9229a_Een_Formule_1_coureur_test_zijn_reflexen_voor_de_race_Videom.mp4.mp4.mp4
https://media.dumpert.nl/720p/393c40ad_Fooled_by_salt...or_a_nipple___Mario_Lopez_on_Penn___Teller_Fool_Us_.mp4.mp4.mp4
https://media.dumpert.nl/720p/6d833581_Icm_ETN7ZF_pb_ta.mp4.mp4.mp4
https://media.dumpert.nl/tablet/18b27a35_SC7T7uxg_wNS07at_online_video_cutter.com.mp4.mp4.mp4
https://media.dumpert.nl/tablet/b479e8c3_awww_____pr0gramm.com_____Die_Datingplattform_fu__r_Kellerkinder.mp4.mp4.mp4
https://media.dumpert.nl/tablet/6dd1846e_teenagestepmother_118247223_189511735880161_4429800162563342589_n.mp4.mp4.mp4
https://media.dumpert.nl/tablet/_79e3b6af_YTDL_1.mp4.mp4.mp4
https://twitter.com/i/status/1296893972804247552
https://media.dumpert.nl/tablet/30388844_De_ninjamoeder_Videoman.mp4.mp4.mp4
https://media.dumpert.nl/tablet/_9bfd3dc6_YTDL_1.mp4.mp4.mp4

================================================================================================

[omrop fryslân]

https://www.omropfryslan.nl/live/omrop-fryslan-tv

$ xidel -s "https://www.omropfryslan.nl/live/omrop-fryslan-tv" -e '//meta[@itemprop="embedURL"]/extract(@content,".+(http.+xml)",1)'
https://omropfryslan.bbvms.com/mediaclip/2970835.xml

$ xidel -s --module=xivid.xqm "https://www.omropfryslan.nl/live/omrop-fryslan-tv" -e '{"name"://meta[@itemprop="name"]/@content||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(doc(//meta[@itemprop="embedURL"]/extract(@content,".+(http.+xml)",1))//asset/@src)}'
{
  "name": "Omrop Fryslân TV: Livestream",
  "date": "02-08-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/stream04/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "426x240@25fps",
      "bitrate": "528kbps",
      "url": "https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/stream04/400/prog_index.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720@25fps",
      "bitrate": "2128kbps",
      "url": "https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/stream04/2000/prog_index.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.omropfryslan.nl/utstjoering/fryslan-hjoed-fan-21-maart-2019-1700

$ xidel -s "https://www.omropfryslan.nl/utstjoering/fryslan-hjoed-fan-21-maart-2019-1700" -e '//meta[@itemprop="embedURL"]/extract(@content,"defaultMediaAssetPath=(.+?)&.+clipXmlUrl=(.+?)&",(1,2))'
https://d3pvma9xb2775h.cloudfront.net
https://omropfryslan.bbvms.com/mediaclip/3277401.xml

$ xidel -s "https://www.omropfryslan.nl/utstjoering/fryslan-hjoed-fan-21-maart-2019-1700" --xquery '{"name":"Omrop Fryslân: "||normalize-space(//h1),"date":replace(//meta[@itemprop="dateModified"]/@content,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":duration("P"||//meta[@itemprop="duration"]/@content) + time("00:00:00"),"formats":[let $a:=//meta[@itemprop="embedURL"]/extract(@content,"defaultMediaAssetPath=(.+?)&amp;.+clipXmlUrl=(.+?)&amp;",(1,2)) for $x at $i in doc($a[2])//asset order by $x/@bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/@width,"x",$x/@height),"bitrate":$x/@bandwidth||"kbps","url":resolve-uri($x/@src,$a[1])}]}'
{
  "name": "Omrop Fryslân: Fryslân Hjoed fan 21 maart 2019 17:00",
  "date": "21-03-2019",
  "duration": "00:28:24",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "480x272",
      "bitrate": "525kbps",
      "url": "https://d3pvma9xb2775h.cloudfront.net/omropfryslan/video/2019/03/21/Asset_iPOD_FRYSLANHJOED_2019-03-21.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "720x400",
      "bitrate": "1126kbps",
      "url": "https://d3pvma9xb2775h.cloudfront.net/omropfryslan/video/2019/03/21/Asset_SD_FRYSLANHJOED_2019-03-21.mp4"
    },
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "6142kbps",
      "url": "https://d3pvma9xb2775h.cloudfront.net/omropfryslan/video/2019/03/21/Asset_HD_FRYSLANHJOED_2019-03-21.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

Eén query voor beide videostreams:

$ xidel -s --module=xivid.xqm "https://www.omropfryslan.nl/utstjoering/fryslan-hjoed-fan-21-maart-2019-1700" --xquery 'let $a:=//meta[@itemprop="embedURL"]/extract(@content,"defaultMediaAssetPath=(.+?)&amp;.+clipXmlUrl=(.+?)&amp;",(1,2)),$b:=doc($a[2]) return if ($b//@sourcetype="live") then {"name"://meta[@itemprop="name"]/@content||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($b//asset/@src)} else {"name":"Omrop Fryslân: "||normalize-space(//h1),"date":replace(//meta[@itemprop="dateModified"]/@content,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":duration("P"||//meta[@itemprop="duration"]/@content) + time("00:00:00"),"formats":[for $x at $i in $b//asset order by $x/@bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/@width,"x",$x/@height),"bitrate":$x/@bandwidth||"kbps","url":resolve-uri($x/@src,$a[1])}]}'

------------------------------------------------------------------------------------------------

--xquery '
  let $a:=//meta[@itemprop="embedURL"]/extract(
        @content,
        "defaultMediaAssetPath=(.+?)&amp;.+clipXmlUrl=(.+?)&amp;",
        (1,2)
      ),
      $b:=doc($a[2])
  return
  if ($b//@sourcetype="live") then {
    "name"://meta[@itemprop="name"]/@content||": Livestream",
    "date":format-date(current-date(),"[D01]-[M01]-[Y]"),
    "formats":xivid:m3u8-to-json($b//asset/@src)
  } else {
    "name":"Omrop Fryslân: "||normalize-space(//h1),
    "date":replace(
      //meta[@itemprop="dateModified"]/@content,
      "(\d+)-(\d+)-(\d+).+",
      "$3-$2-$1"
    ),
    "duration":duration(
      "P"||//meta[@itemprop="duration"]/@content
    ) + time("00:00:00"),
    "formats":[
      for $x at $i in $b//asset
      order by $x/@bandwidth
      count $i
      return {
        "id":"pg-"||$i,
        "format":"mp4[h264+aac]",
        "resolution":concat($x/@width,"x",$x/@height),
        "bitrate":$x/@bandwidth||"kbps",
        "url":resolve-uri($x/@src,$a[1])
      }
    ]
  }
'

================================================================================================

[rtv noord, drenthe, oost, omroep gelderland, omroep west, rtv rijnmond, omroep zeeland, omroep brabant en l1]

https://www.rtvnoord.nl/televisie

$ xidel -s "https://www.rtvnoord.nl/televisie" -e '//@data-media-url'
/media/bluebillywigplayeroptions/static/Tv.json

$ xidel -s "https://www.rtvnoord.nl/televisie" -e 'let $a:=json(resolve-uri(//@data-media-url)) return $a/(clipData/(assets)()/src,publicationData/defaultMediaAssetPath)'
/live/rtvnoord/tv/index.m3u8
https://media.rtvnoord.nl

$ xidel -s --module=xivid.xqm "https://www.rtvnoord.nl/televisie" -e 'let $a:=json(resolve-uri(//@data-media-url)),$b:=$a/resolve-uri(clipData/(assets)()/src,publicationData/defaultMediaAssetPath) return {"name":$a/publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($b)}'
{
  "name": "RTV Noord: Livestream",
  "date": "02-08-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://media.rtvnoord.nl/live/rtvnoord/tv/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "627kbps",
      "url": "https://media.rtvnoord.nl/live/rtvnoord/tv/6a46cbb2-57ee-4192-b55a-de7b4575b19b/index.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "6096kbps",
      "url": "https://media.rtvnoord.nl/live/rtvnoord/tv/3e8fe3c1-0868-49b0-b2f3-7dd6eb30651f/index.m3u8"
    }
  ]
}

https://www.rtvdrenthe.nl/tv

$ xidel -s --module=xivid.xqm "https://www.rtvdrenthe.nl/tv" -e '[...]'
{
  "name": "RTV Drenthe: Livestream",
  "date": "02-08-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://cdn.rtvdrenthe.nl/live/rtvdrenthe/tv/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "640x360@25fps",
      "bitrate": "1192kbps",
      "url": "https://cdn.rtvdrenthe.nl/live/rtvdrenthe/tv/360p/prog_index.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080@25fps",
      "bitrate": "5192kbps",
      "url": "https://cdn.rtvdrenthe.nl/live/rtvdrenthe/tv/1080p/prog_index.m3u8"
    }
  ]
}

https://www.rtvoost.nl/tv

$ xidel -s "https://www.rtvoost.nl/tv" -e 'let $a:=json(resolve-uri(//@data-media-url)) return $a/resolve-uri(clipData/(assets)()/src,publicationData/defaultMediaAssetPath)'
https://streams.rtvoost.nl/video/tv/hls.m3u8

$ xidel -s --module=xivid.xqm "https://www.rtvoost.nl/tv" -e 'let $a:=json(resolve-uri(//@data-media-url)) return {"name":$a/publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($a/resolve-uri(clipData/(assets)()/src,publicationData/defaultMediaAssetPath))}'
{
  "name": "RTV Oost: Livestream",
  "date": "14-04-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://mediacdn.rtvoost.nl/live/rtvoost/tv-oost/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "416x234",
      "bitrate": "613kbps",
      "url": "https://mediacdn.rtvoost.nl/live/rtvoost/tv-oost/e8a15a5f-a530-432e-a025-6dffc1426309/index.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2566kbps",
      "url": "https://mediacdn.rtvoost.nl/live/rtvoost/tv-oost/46ce631a-6155-4fcc-ac24-2b2e252f4f94/index.m3u8"
    }
  ]
}

https://www.omroepgelderland.nl/tvx # Via Google gevonden. Kopje "Live TV" verwijst vreemd genoeg https://www.omroepgelderland.nl/tv.

$ xidel -s --module=xivid.xqm "https://www.omroepgelderland.nl/tvx" -e '[...]'
{
  "name": "Omroep Gelderland: Livestream",
  "date": "28-04-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://ngx.cr6.streamzilla.xlcdn.com/session/304370bd56340c8246aab2abb5868726/sz/omroepgelderland/wowza4/live/livetv/playlist.m3u8?token=nw0E8DqmVNvMagzw-3fIQg&time=1556673255"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2633kbps",
      "url": "https://ngx.cr6.streamzilla.xlcdn.com/session/304370bd56340c8246aab2abb5868726/sz/omroepgelderland/wowza4/live/livetv/chunklist.m3u8"
    }
  ]
}

https://www.omroepwest.nl/tv

$ xidel -s "https://www.omroepwest.nl/tv" -e '//@data-media-url'
//omroepwest.bbvms.com/p/regiogrid/c/2054317.js

$ xidel -s "https://www.omroepwest.nl/tv" -e 'let $a:=//@data-media-url,$b:=json(if (ends-with($a,"json")) then resolve-uri($a) else extract(unparsed-text($a),"var opts = (.+);",1)) return $b/clipData/(assets)()'
{
  "mediatype": "MP4_MAIN",
  "id": "1347006347173657",
  "status": "active",
  "src": "//d2dslh4sd7yvc1.cloudfront.net/live/omroepwest/ngrp:tv-feed_all/playlist.m3u8",
  "length": "",
  "exactlength": "",
  "width": "671",
  "height": "377",
  "bandwidth": "800"
}
{
  "mediatype": "MP4_IPOD",
  "id": "1347007455980753",
  "status": "active",
  "src": "//d2dslh4sd7yvc1.cloudfront.net/live/omroepwest/ngrp:tv-feed_mobile/playlist.m3u8",
  "length": "",
  "exactlength": "",
  "width": "480",
  "height": "270",
  "bandwidth": "400"
}

$ xidel -s "https://www.omroepwest.nl/tv" -e 'let $a:=//@data-media-url,$b:=json(if (ends-with($a,"json")) then resolve-uri($a) else extract(unparsed-text($a),"var opts = (.+);",1)) return $b/(protocol,clipData/(assets)(1)/src)'
https://
//d2dslh4sd7yvc1.cloudfront.net/live/omroepwest/ngrp:tv-feed_all/playlist.m3u8

$ xidel -s "https://www.omroepwest.nl/tv" -e 'let $a:=x:request({"url"://@data-media-url})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return $a/clipData/(assets)(1)/(if (starts-with(src,"//")) then $a/protocol||substring-after(src,"//") else resolve-uri(src,$a/publicationData/defaultMediaAssetPath))'
https://d2dslh4sd7yvc1.cloudfront.net/live/omroepwest/ngrp:tv-feed_all/playlist.m3u8

$ xidel -s --module=xivid.xqm "https://www.omroepwest.nl/tv" -e 'let $a:=x:request({"url"://@data-media-url})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":$a/publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($a/clipData/(assets)(1)/(if (starts-with(src,"//")) then $a/protocol||substring-after(src,"//") else resolve-uri(src,$a/publicationData/defaultMediaAssetPath)))}'
{
  "name": "Omroep West: Livestream",
  "date": "22-04-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d2dslh4sd7yvc1.cloudfront.net/live/omroepwest/ngrp:tv-feed_all/playlist.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "712x400",
      "bitrate": "571kbps",
      "url": "https://d2dslh4sd7yvc1.cloudfront.net/live/omroepwest/ngrp:tv-feed_all/chunklist_b531072.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "4227kbps",
      "url": "https://d2dslh4sd7yvc1.cloudfront.net/live/omroepwest/ngrp:tv-feed_all/chunklist_b4227072.m3u8"
    }
  ]
}

https://www.rijnmond.nl/tv

$ xidel -s --module=xivid.xqm "https://www.rijnmond.nl/tv" -e '[...]'
{
  "name": "RTV Rijnmond: Livestream",
  "date": "02-08-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d3r4bk4fg0k2xi.cloudfront.net/rijnmondTv/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "142kbps",
      "url": "https://d3r4bk4fg0k2xi.cloudfront.net/rijnmondTv/1563277487-au-index.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3817kbps",
      "url": "https://d3r4bk4fg0k2xi.cloudfront.net/rijnmondTv/1563277487-faster-1920-1080-3500000-index.m3u8"
    }
  ]
}

https://www.omroepzeeland.nl/livetv

$ xidel -s "https://www.omroepzeeland.nl/livetv" -e 'outer-html(//iframe)'
<iframe src="https://omroepzeeland.bbvms.com/p/regiogridautoplay/l/1491828714434033.html" style="width:100%;" frameborder="0" allowfullscreen="true"></iframe>

$ xidel -s "https://www.omroepzeeland.nl/livetv" -f '//iframe/@src' -e '//@src'
/p/regiogridautoplay/l/1491828714434033.js?dummy=

$ xidel -s --module=xivid.xqm "https://www.omroepzeeland.nl/livetv" -e 'let $a:=x:request({"url":(//@data-media-url,resolve-uri(doc(//iframe/@src)//@src))})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":$a/publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($a/clipData/(assets)(1)/(if (starts-with(src,"//")) then $a/protocol||substring-after(src,"//") else resolve-uri(src,$a/publicationData/defaultMediaAssetPath)))}'
{
  "name": "Omroep Zeeland: Livestream",
  "date": "04-05-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d3isaxd2t6q8zm.cloudfront.net/live/omroepzeeland/tv/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "142kbps",
      "url": "https://d3isaxd2t6q8zm.cloudfront.net/live/omroepzeeland/tv/1550416322-au-index.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "5917kbps",
      "url": "https://d3isaxd2t6q8zm.cloudfront.net/live/omroepzeeland/tv/1550416322-fast-1920-1080-5500000-index.m3u8"
    }
  ]
}

https://www.omroepbrabant.nl/tv

$ xidel -s --module=xivid.xqm "https://www.omroepbrabant.nl/tv" -e '[...]'
{
  "name": "Omroep Brabant: Livestream",
  "date": "05-05-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d3slqp9xhts6qb.cloudfront.net/live/omroepbrabant/tv/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "142kbps",
      "url": "https://d3slqp9xhts6qb.cloudfront.net/live/omroepbrabant/tv/1556267641-au-index.m3u8"
    },
    [...]
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3030kbps",
      "url": "https://d3slqp9xhts6qb.cloudfront.net/live/omroepbrabant/tv/1556267641-fast-1920-1080-2750000-index.m3u8"
    }
  ]
}

https://l1.nl/live-l1-tv

$ xidel -s "https://l1.nl/live-l1-tv" -e '//div[@class="bbwLive-player"]//@src'
//l1.bbvms.com/p/video_autoplay/c/3247576.js

$ xidel -s --module=xivid.xqm "https://l1.nl/live-l1-tv" -e 'let $a:=x:request({"url":(//@data-media-url,//div[@class="bbwLive-player"]//@src,resolve-uri(doc(//iframe/@src)//@src))})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":$a/publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($a/clipData/(assets)(1)/(if (starts-with(src,"//")) then $a/protocol||substring-after(src,"//") else resolve-uri(src,$a/publicationData/defaultMediaAssetPath)))}'
{
  "name": "L1: Livestream",
  "date": "05-05-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d34pj260kw1xmk.cloudfront.net/live/l1/tv/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "142kbps",
      "url": "https://d34pj260kw1xmk.cloudfront.net/live/l1/tv/1553845279-au-index.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3817kbps",
      "url": "https://d34pj260kw1xmk.cloudfront.net/live/l1/tv/1553845279-fast-1280-720-3500000-index.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.rtvnoord.nl/tv/programma/10010/Noord-Vandaag/aflevering/22811

$ xidel -s "https://www.rtvnoord.nl/tv/programma/10010/Noord-Vandaag/aflevering/22811" -e 'let $a:=x:request({"url"://@data-media-url})/json return {"name":concat($a/publicationData/label,": ",//div[@class="media-details"]/h3),"date":format-date(dateTime($a/clipData/publisheddate),"[D01]-[M01]-[Y]"),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url":$a/resolve-uri(clipData/(assets)()/src,publicationData/defaultMediaAssetPath)}]}'
{
  "name": "RTV Noord: Noord Vandaag",
  "date": "29-03-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://media.rtvnoord.nl/video/2019/190329/190329_NVREC_XHQ.mp4"
    }
  ]
}

https://www.rtvdrenthe.nl/tv/programma/10/Drenthe-Nu/aflevering/42540

$ xidel -s "https://www.rtvdrenthe.nl/tv/programma/10/Drenthe-Nu/aflevering/42540" -e '[...]'
{
  "name": "RTV Drenthe: Drenthe Nu",
  "date": "31-03-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://av.rtvdrenthe.nl/media/drnl20190331-hhuitz.mp4"
    }
  ]
}

https://www.rtvdrenthe.nl/nieuws/145732/Ondernemen-in-Drenthe-Duurzaam-handwerken-bij-Wol-zo-eerlijk

$ xidel -s "https://www.rtvdrenthe.nl/nieuws/145732/Ondernemen-in-Drenthe-Duurzaam-handwerken-bij-Wol-zo-eerlijk" -e 'outer-html(//div[@class="video-title"])'
<div class="video-title">
                                Eerlijke wol uit Vries
                        </div>

$ xidel -s "https://www.rtvdrenthe.nl/nieuws/145732/Ondernemen-in-Drenthe-Duurzaam-handwerken-bij-Wol-zo-eerlijk" -e 'let $a:=x:request({"url"://@data-media-url})/json return {"name":concat($a/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,//div[@class="video-title"]))),"date":format-date(dateTime($a/clipData/publisheddate),"[D01]-[M01]-[Y]"),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url":$a/resolve-uri(clipData/(assets)()/src,publicationData/defaultMediaAssetPath)}]}'
{
  "name": "RTV Drenthe: Eerlijke wol uit Vries",
  "date": "31-03-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://av.rtvdrenthe.nl/media/nws20190331-ondernemen_in_drenthe_website_0002.mp4"
    }
  ]
}

https://www.rtvoost.nl/tv/programma/63/Overijssel-Vandaag/aflevering/503428

$ xidel -s "https://www.rtvoost.nl/tv/programma/63/Overijssel-Vandaag/aflevering/503428" -e '[...]'
{
  "name": "RTV Oost: Overijssel Vandaag",
  "date": "13-04-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://tvarchief.rtvoost.nl/hi/503428.mp4"
    }
  ]
}

https://www.omroepgelderland.nl/tv/programma/232488309/GLD-Nieuws/aflevering/39012

$ xidel -s "https://www.omroepgelderland.nl/tv/programma/232488309/GLD-Nieuws/aflevering/39012" -e '[...]'
{
  "name": "Omroep Gelderland: GLD Nieuws",
  "date": "28-04-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://d2od87akyl46nm.cloudfront.net/epg/prod/media/videos/JkevaDM7lXm.mp4"
    }
  ]
}

https://www.omroepgelderland.nl/nieuws/2407417/UPDATE-Dramatisch-einde-Koningsdagfeest-Doetinchem-auto-schept-feestvierders

$ xidel -s "https://www.omroepgelderland.nl/nieuws/2407417/UPDATE-Dramatisch-einde-Koningsdagfeest-Doetinchem-auto-schept-feestvierders" -e '//div[starts-with(@class,"inlinemedia")]/@data-accept'
<iframe src="/media/player/30018" style="width:100%;" frameborder="0" allowfullscreen="true"></iframe>

$ xidel -s "https://www.omroepgelderland.nl/nieuws/2407417/UPDATE-Dramatisch-einde-Koningsdagfeest-Doetinchem-auto-schept-feestvierders" -f 'parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src' -e 'outer-html(//div[@class="video-title"])'
<div class="video-title">
                                Feestvierders geschept Doetinchem
                        </div>

$ xidel -s "https://www.omroepgelderland.nl/nieuws/2407417/UPDATE-Dramatisch-einde-Koningsdagfeest-Doetinchem-auto-schept-feestvierders" -e 'let $a:=doc(parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src),$b:=x:request({"url":(.,$a)//@data-media-url})/json return {"name":concat($b/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,(.,$a)//div[@class="video-title"]))),"date":format-date(dateTime($b/clipData/publisheddate),"[D01]-[M01]-[Y]"),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url":$b/resolve-uri(clipData/(assets)()/src,publicationData/defaultMediaAssetPath)}]}'
{
  "name": "Omroep Gelderland: Feestvierders geschept Doetinchem",
  "date": "28-04-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://d2od87akyl46nm.cloudfront.net/items/video/2019/04/Feestgangers_geschept_WEB.mp4"
    }
  ]
}

https://www.omroepwest.nl/tv/programma/170000115/TV-West-Nieuws/aflevering/170285899

$ xidel -s "https://www.omroepwest.nl/tv/programma/170000115/TV-West-Nieuws/aflevering/170285899" --xquery 'let $a:=doc(parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src),$b:=x:request({"url":(.,$a)//@data-media-url})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":concat($b/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,(.,$a)//div[@class="video-title"]))),"date":format-date(dateTime($b/clipData/publisheddate),"[D01]-[M01]-[Y]"),"duration":$b/clipData/(assets)(1)/length * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $b/clipData/(assets)() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":resolve-uri($x/src,$b/publicationData/defaultMediaAssetPath)}]}'
{
  "name": "Omroep West: TV West Nieuws",
  "date": "19-04-2019",
  "duration": "00:16:55",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "512x288",
      "bitrate": "300kbps",
      "url": "https://d3r6frfb0ko02q.cloudfront.net/video/2019/04/19/170285899_300.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1000kbps",
      "url": "https://d3r6frfb0ko02q.cloudfront.net/video/2019/04/19/170285899_1000.mp4"
    },
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2000kbps",
      "url": "https://d3r6frfb0ko02q.cloudfront.net/video/2019/04/19/170285899_2000.mp4"
    }
  ]
}

https://www.omroepwest.nl/nieuws/3825225/Files-naar-Keukenhof-Het-is-het-allemaal-waard

$ xidel -s "https://www.omroepwest.nl/nieuws/3825225/Files-naar-Keukenhof-Het-is-het-allemaal-waard" --xquery '[...]'
{
  "name": "Omroep West: Keukenhof: 'Kies een andere dag voor een bezoek aan het park'",
  "date": "21-04-2019",
  "duration": "00:01:44",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "512x288",
      "bitrate": "300kbps",
      "url": "https://d3r6frfb0ko02q.cloudfront.net/video/2019/04/21/3825182_300.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1000kbps",
      "url": "https://d3r6frfb0ko02q.cloudfront.net/video/2019/04/21/3825182_1000.mp4"
    },
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2000kbps",
      "url": "https://d3r6frfb0ko02q.cloudfront.net/video/2019/04/21/3825182_2000.mp4"
    }
  ]
}

https://www.rijnmond.nl/tv/programma/27/Rijnmond-Nieuws/aflevering/16972

$ xidel -s "https://www.rijnmond.nl/tv/programma/27/Rijnmond-Nieuws/aflevering/16972" --xquery 'let $a:=doc(parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src),$b:=x:request({"url":(.,$a)//@data-media-url})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":concat($b/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,(.,$a)//div[@class="video-title"]))),"date":format-date(dateTime($b/clipData/publisheddate),"[D01]-[M01]-[Y]"),"duration":$b/clipData/(assets)(1)/length * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $b/clipData/(assets)() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":resolve-uri($x/src,$b/protocol||substring-after($b/publicationData/defaultMediaAssetPath,"//"))}]}'
{
  "name": "RTV Rijnmond: Rijnmond Nieuws",
  "date": "26-04-2019",
  "duration": "00:13:52",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "600kbps",
      "url": "https://dcur8bjarl5c2.cloudfront.net/2019/video/nwsvr260419_vlq.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3603kbps",
      "url": "https://dcur8bjarl5c2.cloudfront.net/rijnmond/media/2019/04/26/3300832.mp4"
    }
  ]
}

https://www.rijnmond.nl/nieuws/181081/Koningsdag-in-Maassluis-hoofd-schouder-knie-en-teen-als-opwarmer-van-de-aubade

$ xidel -s "https://www.rijnmond.nl/nieuws/181081/Koningsdag-in-Maassluis-hoofd-schouder-knie-en-teen-als-opwarmer-van-de-aubade" --xquery '[...]'
{
  "name": "RTV Rijnmond: Koningsdag in Maassluis: tompoezen, de aubade en de vrijmarkt",
  "date": "27-04-2019",
  "duration": "00:03:25",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "600kbps",
      "url": "https://dcur8bjarl5c2.cloudfront.net/2019/video/nmaassluis28_04_19_T_AA3E6C56FE0CFFA6C12583E90031D6DB_vlq.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3607kbps",
      "url": "https://dcur8bjarl5c2.cloudfront.net/upload/rijnmond/nmaassluis28_04_19_T_AA3E6C56FE0CFFA6C12583E90031D6DB.mp4"
    }
  ]
}

https://www.omroepzeeland.nl/tv/programma/370059803/Zeeland-Nu/aflevering/370182368

$ xidel -s "https://www.omroepzeeland.nl/tv/programma/370059803/Zeeland-Nu/aflevering/370182368" --xquery 'let $a:=doc(parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src),$b:=x:request({"url":(.,$a)//@data-media-url})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":concat($b/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,(.,$a)//div[@class="video-title"]))),"date":format-date(dateTime($b/clipData/publisheddate),"[D01]-[M01]-[Y]"),"duration":$b/clipData/((assets)(1)/length,length)[.] * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $b/clipData/(assets)() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":resolve-uri($x/src,$b/protocol||substring-after($b/publicationData/defaultMediaAssetPath,"//"))}]}'
{
  "name": "Omroep Zeeland: Zeeland Nu",
  "date": "02-05-2019",
  "duration": "00:13:35",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "480x272",
      "bitrate": "400kbps",
      "url": "https://d2axgm87evfsmi.cloudfront.net/omroepzeeland/media/2019/05/02/Asset_iPOD_370182368-Zeeland-Nu-02-05-2019-ZNB190502CT.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "720x400",
      "bitrate": "1000kbps",
      "url": "https://d2axgm87evfsmi.cloudfront.net/omroepzeeland/media/2019/05/02/Asset_SD_370182368-Zeeland-Nu-02-05-2019-ZNB190502CT.mp4"
    },
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2000kbps",
      "url": "https://d2axgm87evfsmi.cloudfront.net/omroepzeeland/media/2019/05/02/Asset_HD_370182368-Zeeland-Nu-02-05-2019-ZNB190502CT.mp4"
    }
  ]
}

https://www.omroepzeeland.nl/nieuws/112666/Ellende-met-buxusrupsen-Traantjes-drogen-en-opnieuw-beginnen

$ xidel -s "https://www.omroepzeeland.nl/nieuws/112666/Ellende-met-buxusrupsen-Traantjes-drogen-en-opnieuw-beginnen" --xquery '[...]'
{
  "name": "Omroep Zeeland: De buxusrups is weer terug",
  "date": "02-05-2019",
  "duration": "00:00:29",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "480x272",
      "bitrate": "400kbps",
      "url": "https://d2axgm87evfsmi.cloudfront.net/omroepzeeland/media/2019/05/02/Asset_iPOD_Buxusrups-ZNO190502HO.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "720x400",
      "bitrate": "1000kbps",
      "url": "https://d2axgm87evfsmi.cloudfront.net/omroepzeeland/media/2019/05/02/Asset_SD_Buxusrups-ZNO190502HO.mp4"
    },
    {
      "id": "pg-3",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2000kbps",
      "url": "https://d2axgm87evfsmi.cloudfront.net/omroepzeeland/media/2019/05/02/Asset_HD_Buxusrups-ZNO190502HO.mp4"
    }
  ]
}

https://www.omroepbrabant.nl/tv/programma/252/Brabant-Nieuws/aflevering/2932581

$ xidel -s "https://www.omroepbrabant.nl/tv/programma/252/Brabant-Nieuws/aflevering/2932581" --xquery 'let $a:=doc(parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src),$b:=x:request({"url":(.,$a)//@data-media-url})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":concat($b/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,(.,$a)//div[@class="video-title"]))),"date":format-date(dateTime($b/clipData/publisheddate),"[D01]-[M01]-[Y]"),"duration":$b/clipData/((assets)(1)/length,length)[.][1] * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $b/clipData/(assets)() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":resolve-uri($x/src,$b/protocol||substring-after($b/publicationData/defaultMediaAssetPath,"//"))}]}'
{
  "name": "Omroep Brabant: Brabant Nieuws",
  "date": "04-05-2019",
  "duration": "00:09:55",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "512x288",
      "bitrate": "500kbps",
      "url": "https://d1ctz4dshc0ubt.cloudfront.net/omroepbrabant/2019/video/2932581_ulq.mp4"
    },
    [...]
    {
      "id": "pg-6",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3500kbps",
      "url": "https://d1ctz4dshc0ubt.cloudfront.net/omroepbrabant/2019/video/2932581_ehq.mp4"
    }
  ]
}

https://www.omroepbrabant.nl/nieuws/2992614/Wat-zeggen-peilingen-echt-over-de-kansen-van-Duncan-Laurence-op-het-Eurovisie-Songfestival-VIDEO

$ xidel -s "https://www.omroepbrabant.nl/nieuws/2992614/Wat-zeggen-peilingen-echt-over-de-kansen-van-Duncan-Laurence-op-het-Eurovisie-Songfestival-VIDEO" --xquery '[...]'
{
  "name": "Omroep Brabant: Zo belangrijk zijn de peilingen van het Songfestival voor Duncan Laurence.",
  "date": "03-05-2019",
  "duration": "00:04:03",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "512x288",
      "bitrate": "500kbps",
      "url": "https://d1ctz4dshc0ubt.cloudfront.net/omroepbrabant/2019/video/2992318_ulq.mp4"
    },
    [...]
    {
      "id": "pg-6",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3500kbps",
      "url": "https://d1ctz4dshc0ubt.cloudfront.net/omroepbrabant/2019/video/2992318_ehq.mp4"
    }
  ]
}

https://l1.nl/l1mburg-centraal-4-mei-2019-149530

$ xidel -s "https://l1.nl/l1mburg-centraal-4-mei-2019-149530" -e 'outer-html(//div[@class="bbw bbwVideo"])'
<div class="bbw bbwVideo" data-id="3305749" data-playout="video" style="background-image:url('/img-cache/remote/bbw/3305749-1557041501.49e9508d.jpg');"> <div class="bbwVideo__inner icon-pointer-right"></div> </div>

$ xidel -s "https://l1.nl/l1mburg-centraal-4-mei-2019-149530" -e 'concat("https://l1.bbvms.com/p/video/c/",//div[@class="bbw bbwVideo"]/@data-id,".json")'
https://l1.bbvms.com/p/video/c/3305749.json

$ xidel -s "https://l1.nl/l1mburg-centraal-4-mei-2019-149530" --xquery 'let $a:=doc(parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src),$b:=x:request({"url":((.,$a)//@data-media-url,//div[@class="bbw bbwVideo"]/concat("https://l1.bbvms.com/p/video/c/",@data-id,".json"))})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))) return {"name":concat($b/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,(.,$a)//div[@class="video-title"],replace(//div[@class="overlay"]/h1,"(.+) -.+","$1")))),"date":format-date(dateTime($b/clipData/publisheddate),"[D01]-[M01]-[Y]"),"duration":$b/clipData/((assets)(1)/length,length)[.][1] * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $b/clipData/(assets)() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":resolve-uri($x/src,$b/protocol||substring-after($b/publicationData/defaultMediaAssetPath,"//"))}]}'
{
  "name": "L1: L1mburg Centraal",
  "date": "05-05-2019",
  "duration": "00:24:18",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1000kbps",
      "url": "https://d34pj260kw1xmk.cloudfront.net/video/20190504-192817-360p.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3500kbps",
      "url": "https://d34pj260kw1xmk.cloudfront.net/video/20190504-192817-720p.mp4"
    }
  ]
}

https://l1.nl/de-l1mbo-top-100-tip-van-rian-149539

$ xidel -s "https://l1.nl/de-l1mbo-top-100-tip-van-rian-149539/" --xquery '[...]'
{
  "name": "L1: De L1mbo Top 100 stemtip van Rian",
  "date": "05-05-2019",
  "duration": "00:00:32",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1000kbps",
      "url": "https://d34pj260kw1xmk.cloudfront.net/video/20190505-115121-360p.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3500kbps",
      "url": "https://d34pj260kw1xmk.cloudfront.net/video/20190505-115121-720p.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

Eén query voor beide videostreams:

$ xidel -s --module=xivid.xqm "https://l1.nl/de-l1mbo-top-100-tip-van-rian-149539" --xquery 'let $a:=doc(parse-html(//div[starts-with(@class,"inlinemedia")]/@data-accept)//@src),$b:=x:request({"url":((.,$a)//@data-media-url,//div[@class="bbwLive-player"]//@src,resolve-uri(doc(//iframe/@src)//@src),//div[@class="bbw bbwVideo"]/concat("https://l1.bbvms.com/p/video/c/",@data-id,".json"))})/(.[json]/json,.[doc]/json(extract(raw,"var opts = (.+);",1))),$c:=$b/clipData/(assets)(1)[ends-with(src,"m3u8")]/(if (starts-with(src,"//")) then $b/protocol||substring-after(src,"//") else resolve-uri(src,$b/publicationData/defaultMediaAssetPath)) return if ($c) then {"name":$b/publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($c)} else {"name":concat($b/publicationData/label,": ",normalize-space((//div[@class="media-details"]/h3,(.,$a)//div[@class="video-title"],replace(//div[@class="overlay"]/h1,"(.+) -.+","$1")))),"date":format-date(dateTime($b/clipData/publisheddate),"[D01]-[M01]-[Y]"),"duration":$b/clipData/((assets)(1)/length,length)[.][1] * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in $b/clipData/(assets)() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":resolve-uri($x/src,$b/protocol||substring-after($b/publicationData/defaultMediaAssetPath,"//"))}]}'

------------------------------------------------------------------------------------------------

--xquery '
  let $a:=doc(
        parse-html(
          //div[starts-with(@class,"inlinemedia")]/@data-accept
        )//@src
      ),
      $b:=x:request({
        "url":(
          (.,$a)//@data-media-url,
          //div[@class="bbwLive-player"]//@src,
          resolve-uri(doc(//iframe/@src)//@src),
          //div[@class="bbw bbwVideo"]/concat(
            "https://l1.bbvms.com/p/video/c/",
            @data-id,
            ".json"
          )
        )
      })/(
        .[json]/json,
        .[doc]/json(
          extract(raw,"var opts = (.+);",1)
        )
      ),
      $c:=$b/clipData/(assets)(1)[ends-with(src,"m3u8")]/(
        if (starts-with(src,"//")) then
          $b/protocol||substring-after(src,"//")
        else
          resolve-uri(src,$b/publicationData/defaultMediaAssetPath)
      )
  return
  if ($c) then {
    "name":$b/publicationData/label||": Livestream",
    "date":format-date(current-date(),"[D01]-[M01]-[Y]"),
    "formats":xivid:m3u8-to-json($c)
  } else {
    "name":concat(
      $b/publicationData/label,
      ": ",
      normalize-space(
        (
          //div[@class="media-details"]/h3,
          (.,$a)//div[@class="video-title"],
          replace(//div[@class="overlay"]/h1,"(.+) -.+","$1")
        )
      )
    ),
    "date":format-date(
      dateTime($b/clipData/publisheddate),
      "[D01]-[M01]-[Y]"
    ),
    "duration":$b/clipData/(
      (assets)(1)/length,
      length
    )[.][1] * duration("PT1S") + time("00:00:00"),
    "formats":[
      for $x at $i in $b/clipData/(assets)()
      order by $x/bandwidth
      count $i
      return {
        "id":"pg-"||$i,
        "format":"mp4[h264+aac]",
        "resolution":concat($x/width,"x",$x/height),
        "bitrate":$x/bandwidth||"kbps",
        "url":resolve-uri(
          $x/src,
          $b/protocol||substring-after($b/publicationData/defaultMediaAssetPath,"//")
        )
      }
    ]
  }
'

================================================================================================

[nh nieuws, at5]

https://www.nhnieuws.nl/tv

$ xidel -s --module=xivid.xqm "https://www.nhnieuws.nl/tv" -e '{"name":"NH Nieuws: Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(json(//script/extract(.,"INIT_DATA__ = (.+)",1)[.])/videoStream)}'
{
  "name": "NH Nieuws: Livestream",
  "date": "06-04-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://ngx.cr2.streamzilla.xlcdn.com/session/fbbbade6227f9c819319e5f479bc7d71/sz/nhnieuws/wowza4/live/live.smil/playlist.m3u8?token=-ldEgDxG4CToIPkgGvWrMQ&time=1554595001"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1153kbps",
      "url": "https://ngx.cr2.streamzilla.xlcdn.com/session/fbbbade6227f9c819319e5f479bc7d71/sz/nhnieuws/wowza4/live/live.smil/chunklist_b1048576.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3487kbps",
      "url": "https://ngx.cr2.streamzilla.xlcdn.com/session/fbbbade6227f9c819319e5f479bc7d71/sz/nhnieuws/wowza4/live/live.smil/chunklist_b3170304.m3u8"
    }
  ]
}

https://www.at5.nl/tv

$ xidel -s --module=xivid.xqm "https://www.at5.nl/tv" -e '{"name":substring-after(//title,"- ")||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(json(//script/extract(.,"INIT_DATA__ = (.+)",1)[.])/videoStream)}'
{
  "name": "AT5: Livestream",
  "date": "28-04-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://ngx.cr6.streamzilla.xlcdn.com/session/da0bb837c8a60cd2a854e5100324cc68/sz/atvijf/wowza4/live/live.smil/playlist.m3u8?token=UAx9rGaNEH2WCUT-Zc01Kw&time=1556494972"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "640x512",
      "bitrate": "1153kbps",
      "url": "https://ngx.cr6.streamzilla.xlcdn.com/session/da0bb837c8a60cd2a854e5100324cc68/sz/atvijf/wowza4/live/live.smil/chunklist_b1048576.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1536",
      "bitrate": "3460kbps",
      "url": "https://ngx.cr6.streamzilla.xlcdn.com/session/da0bb837c8a60cd2a854e5100324cc68/sz/atvijf/wowza4/live/live.smil/chunklist_b3145728.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.nhnieuws.nl/nieuws/243542/koeien-aan-de-wandel-in-kortenhoef-touw-is-losgegaan-dan-gaan-ze-op-avontuur

$ xidel -s --module=xivid.xqm "https://www.nhnieuws.nl/nieuws/243542/koeien-aan-de-wandel-in-kortenhoef-touw-is-losgegaan-dan-gaan-ze-op-avontuur" -e 'json(//script/extract(.,"INITIAL_PROPS__ = (.+)",1)[.])/{"name":(.//media)(1)/concat(source,": ",title),"date":format-date(.//updated * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json((.//media)()/videoUrl)}'
{
  "name": "NH Nieuws: Koeien aan de wandel in Kortenhoef",
  "date": "06-04-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://wos.cr1.streamzilla.xlcdn.com/session/0ccdf5595c46e2be29f3f00ad1856208/vod/_definst_/sz/nhnieuws/2019/04/06/5ca8b8ac665d65ca8b8ac66611.smil/playlist.m3u8?token=MY5sgN56qVH3sjrKyrx6GQ&time=1554596909"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "568x320",
      "bitrate": "649kbps",
      "url": "https://wos.cr1.streamzilla.xlcdn.com/session/0ccdf5595c46e2be29f3f00ad1856208/vod/_definst_/sz/nhnieuws/2019/04/06/5ca8b8ac665d65ca8b8ac66611.smil/chunklist_b589824.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "5907kbps",
      "url": "https://wos.cr1.streamzilla.xlcdn.com/session/0ccdf5595c46e2be29f3f00ad1856208/vod/_definst_/sz/nhnieuws/2019/04/06/5ca8b8ac665d65ca8b8ac66611.smil/chunklist_b5369856.m3u8"
    }
  ]
}

https://www.at5.nl/artikelen/e27519/zaterdag-27-april

$ xidel -s --module=xivid.xqm "https://www.at5.nl/artikelen/e27519/zaterdag-27-april" -e 'json(//script/extract(.,"INITIAL_PROPS__ = (.+)",1)[.])/pageData/{"name":if ((media)(1)/title) then (media)(1)/concat(source,": ",title) else concat((media)(1)/source,": ",title),"date":format-date(updated * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json((media)()/videoUrl)}'
{
  "name": "AT5: Zaterdag 27 april",   # Niet ideaal, geen "Nieuws" in de 'title'. AT5 hun schuld. Hoort gewoon in de 'title'.
  "date": "27-04-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://wos.cr2.streamzilla.xlcdn.com/session/db4039541a7405529ebb15a26faea396/vod/_definst_/sz/atvijf/2019/04/27/5cc477789eb145cc477789eb50.smil/playlist.m3u8?token=CBzIq2r8A8Vo00YTx9C4Ow&time=1556496434"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "568x320",
      "bitrate": "649kbps",
      "url": "https://wos.cr2.streamzilla.xlcdn.com/session/db4039541a7405529ebb15a26faea396/vod/_definst_/sz/atvijf/2019/04/27/5cc477789eb145cc477789eb50.smil/chunklist_b589824.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "5923kbps",
      "url": "https://wos.cr2.streamzilla.xlcdn.com/session/db4039541a7405529ebb15a26faea396/vod/_definst_/sz/atvijf/2019/04/27/5cc477789eb145cc477789eb50.smil/chunklist_b5384192.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

Eén query voor beide videostreams:

$ xidel -s --module=xivid.xqm "https://www.at5.nl/artikelen/e27519/zaterdag-27-april" -e 'let $a:=json(//script/extract(.,"INITIAL_PROPS__ = (.+)",1)[.])/pageData return {"name":if ($a) then if ($a/(media)(1)/title) then $a/(media)(1)/concat(source,": ",title) else concat($a/(media)(1)/source,": ",$a/title) else substring-after(//title,"- ")||": Livestream","date":if ($a) then format-date($a/updated * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]") else format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(if ($a) then $a/(media)()/videoUrl else json(//script/extract(.,"INIT_DATA__ = (.+)",1)[.])/videoStream)}'

------------------------------------------------------------------------------------------------

-e '
  let $a:=json(
    //script/extract(.,"INITIAL_PROPS__ = (.+)",1)[.]
  )/pageData
  return {
    "name":if ($a) then
      if ($a/(media)(1)/title) then
        $a/(media)(1)/concat(source,": ",title)
      else
        concat($a/(media)(1)/source,": ",$a/title)
    else
      substring-after(//title,"- ")||": Livestream",
    "date":if ($a) then
      format-date(
        $a/updated * duration("PT1S") +
        implicit-timezone() + date("1970-01-01"),
        "[D01]-[M01]-[Y]"
      )
    else
      format-date(current-date(),"[D01]-[M01]-[Y]"),
    "formats":xivid:m3u8-to-json(
      if ($a) then
        $a/(media)()/videoUrl
      else
        json(
          //script/extract(.,"INIT_DATA__ = (.+)",1)[.]
        )/videoStream
    )
  }
'

================================================================================================

[omroep flevoland]

https://www.omroepflevoland.nl/

$ xidel -s --module=xivid.xqm "https://www.omroepflevoland.nl/" -e '{"name":"Omroep Flevoland: Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(//div[ends-with(@class,"videoplayer")]/@data-file)}'
{
  "name": "Omroep Flevoland: Livestream",
  "date": "02-08-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d5ms27yy6exnf.cloudfront.net/live/omroepflevoland/tv/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "480x270@25fps",
      "bitrate": "528kbps",
      "url": "https://d5ms27yy6exnf.cloudfront.net/live/omroepflevoland/tv/400/prog_index.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720@25fps",
      "bitrate": "2128kbps",
      "url": "https://d5ms27yy6exnf.cloudfront.net/live/omroepflevoland/tv/2000/prog_index.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.omroepflevoland.nl/gemist/video/dit-is-flevoland-5cb0a4aa9c08a

$ xidel -s "https://www.omroepflevoland.nl/gemist/video/dit-is-flevoland-5cb0a4aa9c08a" -e '(outer-html(//h2),outer-html(//span[starts-with(@class,"t--red")]))'
<h2>

            Dit is Flevoland
        </h2>
<span class="t--red t--strong t--capitalize d--inl-block">
        Vr 12-04-2019
    </span>

$ xidel -s "https://www.omroepflevoland.nl/gemist/video/dit-is-flevoland-5cb0a4aa9c08a" -e '{"name":"Omroep Flevoland: "||normalize-space(//h2),"date":substring(normalize-space(//span[starts-with(@class,"t--red")]),4),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url"://div[ends-with(@class,"videoplayer")]/@data-file}]}'
{
  "name": "Omroep Flevoland: Dit is Flevoland",
  "date": "12-04-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://d5ms27yy6exnf.cloudfront.net/video/middel/190412_DIF.mp4"
    }
  ]
}

https://www.omroepflevoland.nl/sport/170116/team-de-corner-wint-dorpenloop

$ xidel -s "https://www.omroepflevoland.nl/sport/170116/team-de-corner-wint-dorpenloop" -e 'outer-html(//span[@class="d--block--sm"])'
<span class="d--block--sm">

                                        Za 13 april 2019 | 17:18

        </span>

$ xidel -s --module=xivid.xqm "https://www.omroepflevoland.nl/sport/170116/team-de-corner-wint-dorpenloop" -e '{"name":"Omroep Flevoland: "||normalize-space(//h2),"date":xivid:txt-to-date(//span[@class="d--block--sm"]),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url"://div[ends-with(@class,"videoplayer")]/@data-file}]}'
{
  "name": "Omroep Flevoland: Team De Corner wint dorpenloop",
  "date": "13-04-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://d5ms27yy6exnf.cloudfront.net/video/middel/190413_Dorpenloop_00000SVO.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

Eén query voor beide videostreams:

$ xidel -s --module=xivid.xqm "https://www.omroepflevoland.nl/" -e 'let $a:=//div[ends-with(@class,"videoplayer")] return if ($a/@data-page-type="home") then {"name":"Omroep Flevoland: Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json($a/@data-file)} else {"name":"Omroep Flevoland: "||normalize-space(//h2),"date":if ($a/@data-page-type="missed") then substring(normalize-space(//span[starts-with(@class,"t--red")]),4) else xivid:txt-to-date(//span[@class="d--block--sm"]),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url"://div[ends-with(@class,"videoplayer")]/@data-file}]}'

------------------------------------------------------------------------------------------------

-e '
  let $a:=//div[ends-with(@class,"videoplayer")] return
  if ($a/@data-page-type="home") then {
    "name":"Omroep Flevoland: Livestream",
    "date":format-date(current-date(),"[D01]-[M01]-[Y]"),
    "formats":xivid:m3u8-to-json($a/@data-file)
  } else {
    "name":"Omroep Flevoland: "||normalize-space(//h2),
    "date":if ($a/@data-page-type="missed") then
      substring(
        normalize-space(//span[starts-with(@class,"t--red")]),
        4
      )
    else
      xivid:txt-to-date(//span[@class="d--block--sm"]),
    "formats":[
      {
        "id":"pg-1",
        "format":"mp4[h264+aac]",
        "url"://div[ends-with(@class,"videoplayer")]/@data-file
      }
    ]
  }
'

================================================================================================

[rtv utrecht]

https://www.rtvutrecht.nl/live/rtvutrecht/

$ xidel -s --module=xivid.xqm "https://www.rtvutrecht.nl/live/rtvutrecht/" -f '//script[@async]/@src' -e 'json(extract($raw,"var opts = (.+);",1))/{"name":publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(clipData/(assets)()[mediatype="MP4_HLS"]/src)}'
{
  "name": "RTV Utrecht: Livestream",
  "date": "02-08-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://d18rwjdhpr8dcw.cloudfront.net/live/rtvutrecht/rtvutrecht/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "142kbps",
      "url": "https://d18rwjdhpr8dcw.cloudfront.net/live/rtvutrecht/rtvutrecht/1562916731-au-index.m3u8"
    },
    [...]
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3030kbps",
      "url": "https://d18rwjdhpr8dcw.cloudfront.net/live/rtvutrecht/rtvutrecht/1562916731-faster-1920-1080-2750000-index.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.rtvutrecht.nl/gemist/uitzending/rtvutrecht/unieuws/20190427-1700/

$ xidel -s "https://www.rtvutrecht.nl/gemist/uitzending/rtvutrecht/unieuws/20190427-1700/" -e 'let $a:=json(//script/extract(.,"setup\((.+)\)",1,"s")[.])//file return {"name":concat(//meta[@name="publisher"]/@content,": ",substring-before(normalize-space(//h3[@class="article-title"])," -")),"date":replace($a,".+?(\d+)/(\d+)/(\d+).+","$3-$2-$1"),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url":$a}]}'
{
  "name": "RTV Utrecht: UNieuws",
  "date": "27-04-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://content.omroep.nl/rtvutrecht/uitzendinggemist/rtvutrecht/2019/04/27/RTV1889856_MQ.mp4"
    }
  ]
}

https://www.rtvutrecht.nl/nieuws/1908421/

$ xidel -s "https://www.rtvutrecht.nl/nieuws/1908421/" -e 'let $a:=json(//script/extract(.,"setup\((.+)\)",1,"s")[.])//file return {"name":concat(//meta[@name="publisher"]/@content,": ",(substring-before(normalize-space(//h3[@class="article-title"])," -")[.],normalize-space(//h1[@class="article-title"]))[1]),"date":replace($a,".+?(\d+)/(\d+)/(\d+).+","$3-$2-$1"),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url":$a}]}'
{
  "name": "RTV Utrecht: Fantastische energie en geen wanklank: trotse burgemeester is tevreden over Koningsdag Amersfoort",
  "date": "27-04-2019",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://content.omroep.nl/rtvutrecht/reportages/video/2019/04/27/2188794_MQ.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

Eén query voor beide videostreams:

$ xidel -s --module=xivid.xqm "https://www.rtvutrecht.nl/nieuws/1908421/" -e 'if (//script[@async]) then json(extract(unparsed-text(//script[@async]/@src),"var opts = (.+);",1))/{"name":publicationData/label||": Livestream","date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(clipData/(assets)()[mediatype="MP4_HLS"]/src)} else let $a:=json(//script/extract(.,"setup\((.+)\)",1,"s")[.])//file return {"name":concat(//meta[@name="publisher"]/@content,": ",(substring-before(normalize-space(//h3[@class="article-title"])," -")[.],normalize-space(//h1[@class="article-title"]))[1]),"date":replace($a,".+?(\d+)/(\d+)/(\d+).+","$3-$2-$1"),"formats":[{"id":"pg-1","format":"mp4[h264+aac]","url":$a}]}'

------------------------------------------------------------------------------------------------

-e '
  if (//script[@async]) then
    json(
      extract(unparsed-text(//script[@async]/@src),"var opts = (.+);",1)
    )/{
      "name":publicationData/label||": Livestream",
      "date":format-date(current-date(),"[D01]-[M01]-[Y]"),
      "formats":xivid:m3u8-to-json(clipData/(assets)()[mediatype="MP4_HLS"]/src)
    }
  else
    let $a:=json(
      //script/extract(.,"setup\((.+)\)",1,"s")[.]
    )//file return {
      "name":concat(
        //meta[@name="publisher"]/@content,
        ": ",
        (
          substring-before(
            normalize-space(//h3[@class="article-title"]),
            " -"
          )[.],
          normalize-space(//h1[@class="article-title"])
        )[1]
      ),
      "date":replace($a,".+?(\d+)/(\d+)/(\d+).+","$3-$2-$1"),
      "formats":[
        {
          "id":"pg-1",
          "format":"mp4[h264+aac]",
          "url":$a
        }
      ]
    }
'

================================================================================================

[telegraaf]

$ url=https://www.telegraaf.nl/video/823947308/ordinaire-verkeersruzie-op-snelweg-a10

$ xidel -se 'concat("https://content.tmgvideo.nl/playlist/item=",json(doc("'$url'")//script/extract(.,"APOLLO_STATE__=(.+);",1)[.])/(.//videoId)[1],"/playlist.json")'
https://content.tmgvideo.nl/playlist/item=WiVkrqlbQ5OW/playlist.json

$ xidel -se 'json(concat("https://content.tmgvideo.nl/playlist/item=",json(doc("'$url'")//script/extract(.,"APOLLO_STATE__=(.+);",1)[.])/(.//videoId)[1],"/playlist.json"))/(items)()'
{
  "id": "WiVkrqlbQ5OW",
  "account": "Kx1PKc",
  "audioonly": false,
  "live": false,
  "title": "Ordinaire verkeersruzie op snelweg A10_duplicated",
  "description": "Twee automobilisten krijgen op de ring van Amsterdam dusdanig ruzie dat ze elkaar van de weg proberen te rijden. Ook iets gefilmd? Mail het ons via verkeer@telegraaf.nl ",
  "poster": "//content.tmgvideo.nl/img/account=Kx1PKc/item=WiVkrqlbQ5OW/thumbid=1/image.jpg?v=20200904190849",
  "datecreated": "2020-09-04 19:07:28",
  "duration": 53,
  "locations": {
    "progressive": [
      {
        "label": "1080p",
        "height": 1080,
        "width": 1920,
        "sources": [
          {
            "type": "video/mp4",
            "src": "https://media.tmgvideo.nl/progressive/account=Kx1PKc/item=WiVkrqlbQ5OW/file=XqFlquTLAxuy/WiVkrqlbQ5OW.mp4"
          }
        ]
      },
      [...]
      {
        "label": "270p",
        "height": 270,
        "width": 480,
        "sources": [
          {
            "type": "video/mp4",
            "src": "https://media.tmgvideo.nl/progressive/account=Kx1PKc/item=WiVkrqlbQ5OW/file=TgVlr6FLSJiS/WiVkrqlbQ5OW.mp4"
          }
        ]
      }
    ],
    "adaptive": [
      {
        "type": "application/dash+xml",
        "src": "https://media.tmgvideo.nl/dash/account=Kx1PKc/item=WiVkrqlbQ5OW/WiVkrqlbQ5OW.mpd?v=20200904190849_5"
      },
      {
        "type": "application/x-mpegURL",
        "src": "https://media.tmgvideo.nl/hls/account=Kx1PKc/item=WiVkrqlbQ5OW/WiVkrqlbQ5OW.m3u8?v=20200904190849_5"
      }
    ]
  },
  [...]
  "publishedstart": "2020-09-04 18:57:14",
  "publishedend": "2035-09-04 19:07:14",
  [...]
}

$ xidel -s --module=xivid.xqm --json-mode=deprecated -e 'json(concat("https://content.tmgvideo.nl/playlist/item=",json(doc("'$url'")//script/extract(.,"APOLLO_STATE__=(.+);",1)[.])/(.//videoId)[1],"/playlist.json"))/(items)()/{"name":"Telegraaf: "||title,"date":format-date(date(tokenize(publishedstart)[1]),"[D01]-[M01]-[Y]"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"expdate":publishedend ! format-dateTime(dateTime(replace(.,"\s","T")),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"formats":[locations/reverse((progressive)())/{"id":"pg-"||position(),"format":"mp4[h264+aac]","resolution":concat(width,"x",height),"url":.//src},xivid:m3u8-to-json(locations/(adaptive)()[type="application/x-mpegURL"]/extract(src,".+m3u8"))]}'
{
  "name": "Telegraaf: Ordinaire verkeersruzie op snelweg A10_duplicated",
  "date": "04-09-2020",
  "duration": "00:00:53",
  "expdate": "04-09-2035 19:07:14",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "480x270",
      "url": "https://media.tmgvideo.nl/progressive/account=Kx1PKc/item=WiVkrqlbQ5OW/file=TgVlr6FLSJiS/WiVkrqlbQ5OW.mp4"
    },
    [...]
    {
      "id": "pg-5",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "url": "https://media.tmgvideo.nl/progressive/account=Kx1PKc/item=WiVkrqlbQ5OW/file=XqFlquTLAxuy/WiVkrqlbQ5OW.mp4"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://media.tmgvideo.nl/hls/account=Kx1PKc/item=WiVkrqlbQ5OW/WiVkrqlbQ5OW.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "64kbps",
      "url": "https://media.tmgvideo.nl/hls/account=Kx1PKc/item=WiVkrqlbQ5OW/WiVkrqlbQ5OW-19700101_1-audio=64000.m3u8"
    },
    [...]
    {
      "id": "hls-7",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3600|128kbps",
      "url": "https://media.tmgvideo.nl/hls/account=Kx1PKc/item=WiVkrqlbQ5OW/WiVkrqlbQ5OW-19700101_1-audio=128000-video=3600000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

declare function xivid:telegraaf($url as string) as object()? {
  json(
    concat(
      "https://content.tmgvideo.nl/playlist/item=",
      json(
        doc($url)//script/extract(.,"APOLLO_STATE__=(.+);",1)[.]
      )/(.//videoId)[1],
      "/playlist.json"
    )
  )/(items)()/{
    "name":"Telegraaf: "||title,
    "date":format-date(
      date(tokenize(publishedstart)[1]),
      "[D01]-[M01]-[Y]"
    ),
    "duration":format-time(
      duration * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "expdate":publishedend ! format-dateTime(
      dateTime(replace(.,"\s","T")),
      "[D01]-[M01]-[Y] [H01]:[m01]:[s01]"
    ),
    "formats":[
      locations/reverse((progressive)())/{
        "id":"pg-"||position(),
        "format":"mp4[h264+aac]",
        "resolution":concat(width,"x",height),
        "url":.//src
      },
      xivid:m3u8-to-json(
        locations/(adaptive)()[type="application/x-mpegURL"]/extract(src,".+m3u8")
      )
    ]
  }
};

================================================================================================

[ad]

https://www.ad.nl/video/kanalen/brabants-dagblad~c416/series/korte-reportage~s962/brabantse-boeren-gaan-los-op-links-rechts-van-snollebollekes~p104067

$ xidel -s -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/video/kanalen/brabants-dagblad~c416/series/korte-reportage~s962/brabantse-boeren-gaan-los-op-links-rechts-van-snollebollekes~p104067" -e 'json(//script[@data-mc-object-type="production"])'
{
  "adsEnabled": true,
  "clickoutUrl": null,
  "clickoutUrlTimeOffset": null,
  "displayLogo": true,
  "duration": 22,
  "genreId": 10,
  "id": 104067,
  "live": false,
  "ooyalaId": null,
  "origin": "origin_online_source",
  "playerSkin": "default",
  "posterUrl": "https://imgix.mychannels.video/imgix/629c2387-cdfd-4e1d-8742-1bdb9c49587b/VVS%20Still%20links%20rechts.jpg?dpr=1&h=383&w=680&fit=cover&auto=format%2Ccompress&fm=jpg&q=75&crop=focalpoint&fp-x=0.5&fp-y=0.5",
  "publicationDate": "2019-10-01 11:59:00",
  "publication_status": "published",
  "showId": 962,
  "sources": [
    {
      "src": "https://tkx.apis.anvato.net/rest/v2/mcp/video/10065499~~syv8ed1JI0T0eA/master.m3u8?anvack=yjqOEWaqi37WK2u26oMesa6LMGiJNeZl",
      "type": "application/vnd.apple.mpegurl"
    }
  ],
  "theme": "News",
  "title": "Brabantse boeren gaan los op Links Rechts van Snollebollekes"
}

$ xidel -s --module=xivid.xqm -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/video/kanalen/brabants-dagblad~c416/series/korte-reportage~s962/brabantse-boeren-gaan-los-op-links-rechts-van-snollebollekes~p104067" -e 'json(//script[@data-mc-object-type="production"])/{"name":"AD: "||title,"date":replace(publicationDate,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json((sources)()/src)}'
{
  "name": "AD: Brabantse boeren gaan los op Links Rechts van Snollebollekes",
  "date": "01-10-2019",
  "duration": "00:00:22",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://tkx.apis.anvato.net/rest/v2/mcp/video/10065499~~syv8ed1JI0T0eA/master.m3u8?anvack=yjqOEWaqi37WK2u26oMesa6LMGiJNeZl"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "320x180@30fps",
      "bitrate": "481kbps",
      "url": "https://dcs-vod.apis.anvato.net/vod/p/481400/prog.m3u8?i=i176422914-na1f6458e-2586-4547-9491-fea1ea11c357&anvtrid=1bf60e79c0e5f3967f858c0627ead193"
    },
    [...]
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720@30fps",
      "bitrate": "2510kbps",
      "url": "https://dcs-vod.apis.anvato.net/vod/p/2510000/prog.m3u8?i=i176422914-na1f6458e-2586-4547-9491-fea1ea11c357&anvtrid=1bf60e79c0e5f3967f858c0627ead193"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.ad.nl/dossier-autotest/test-tesla-model-3-geniaal-maar-ook-onhandig~aaf9e018/

$ xidel -s -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/dossier-autotest/test-tesla-model-3-geniaal-maar-ook-onhandig~aaf9e018/" -e '//iframe[@class="mc-embed"]/@src'
https://mychannels.video/embed/66560?automute=true&autoplay=true&autoplay_onscreen=true&display_logo=true&play_ads=true&single_play=true

$ xidel -s -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/dossier-autotest/test-tesla-model-3-geniaal-maar-ook-onhandig~aaf9e018/" -f '//iframe[@class="mc-embed"]/@src' -e 'json(//script[@data-mc-object-type="production"])'
{
  "adsEnabled": true,
  "clickoutUrl": null,
  "clickoutUrlTimeOffset": null,
  "displayLogo": true,
  "duration": 544,
  "genreId": 10,
  "id": 66560,
  "live": false,
  "ooyalaId": "N0Mm43aDE6trOJW5e2SKTFb5NO9Mm7gy",
  "origin": "origin_dpn_original",
  "playerSkin": "default",
  "posterUrl": "https://imgix.mychannels.video/imgix/a022bbee-be17-4424-b208-0075cecef841/imgix_e1ff0aab-0142-4d47-a04e-08186ccfadb1_stilltesla0.jpg?dpr=1&h=383&w=680&fit=cover&auto=format%2Ccompress&fm=jpg&q=75&crop=focalpoint&fp-x=0.71&fp-y=0.04",
  "publicationDate": "2019-03-04 13:52:00",
  "publication_status": "published",
  "showId": 1630,
  "sources": [
    {
      "src": "https://video.persgroep.be/N0Mm43aDE6trOJW5e2SKTFb5NO9Mm7gy/index.m3u8",
      "type": "application/vnd.apple.mpegurl"
    }
  ],
  "theme": "News",
  "title": "Teslatest"
}

$ xidel -s --module=xivid.xqm -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/dossier-autotest/test-tesla-model-3-geniaal-maar-ook-onhandig~aaf9e018/" -f '//iframe[@class="mc-embed"]/@src' -e 'json(//script[@data-mc-object-type="production"])/{"name":"AD: "||title,"date":replace(publicationDate,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json((sources)()/src)}'
{
  "name": "AD: Teslatest",
  "date": "04-03-2019",
  "duration": "00:09:04",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://video.persgroep.be/N0Mm43aDE6trOJW5e2SKTFb5NO9Mm7gy/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "320x180@25fps",
      "bitrate": "490kbps",
      "url": "https://video.persgroep.be/N0Mm43aDE6trOJW5e2SKTFb5NO9Mm7gy/index300.m3u8"
    },
    [...]
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720@25fps",
      "bitrate": "24208kbps",
      "url": "https://video.persgroep.be/N0Mm43aDE6trOJW5e2SKTFb5NO9Mm7gy/index2200.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.ad.nl/auto/je-gaat-anders-tanken-euro-95-wordt-e10-op-1-oktober~a497450a/

$ xidel -s -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/auto/je-gaat-anders-tanken-euro-95-wordt-e10-op-1-oktober~a497450a/" -e '//script[@class="mc-embed"]/@src'
https://embed.mychannels.video/script/production/53235?options=TUTF_default&mode=iframe

$ xidel -s -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/auto/je-gaat-anders-tanken-euro-95-wordt-e10-op-1-oktober~a497450a/" -f '//script[@class="mc-embed"]/@src' --xquery 'extract($raw,"embed_uri = &apos;(.+)&apos;;",1)'
https://embed.mychannels.video/production/53235?options=TUTF_default

$ xidel -s -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/auto/je-gaat-anders-tanken-euro-95-wordt-e10-op-1-oktober~a497450a/" -f '//script[@class="mc-embed"]/@src' --follow-kind=xquery3 -f 'extract($raw,"embed_uri = &apos;(.+)&apos;;",1)' -e 'json(//script[@data-mc-object-type="production"])'
{
  "adsEnabled": true,
  "clickoutUrl": null,
  "clickoutUrlTimeOffset": null,
  "displayLogo": true,
  "duration": 30,
  "genreId": 10,
  "id": 53235,
  "live": false,
  "ooyalaId": "k3MGNmZzE62C7JZZBxHCWgECXn8756TG",
  "origin": "origin_dpn_original",
  "playerSkin": "default",
  "posterUrl": "https://imgix.mychannels.video/imgix/0b11f1d5-122e-4c07-a0f8-a5b89b2710e7/Tijdlijn.00_00_30_05.Still003.jpg?dpr=1&h=383&w=680&fit=cover&auto=format%2Ccompress&fm=jpg&q=75&crop=focalpoint&fp-x=0.5&fp-y=0.5",
  "publicationDate": "2019-02-03 20:03:57",
  "publication_status": "published",
  "showId": 911,
  "sources": [
    {
      "src": "https://video.persgroep.be/k3MGNmZzE62C7JZZBxHCWgECXn8756TG/index.m3u8",
      "type": "application/vnd.apple.mpegurl"
    }
  ],
  "theme": "News",
  "title": "De nummers op benzinepompen zijn veranderd"
}

$ xidel -s --module=xivid.xqm -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/auto/je-gaat-anders-tanken-euro-95-wordt-e10-op-1-oktober~a497450a/" -f '//script[@class="mc-embed"]/@src' --follow-kind=xquery3 -f 'extract($raw,"embed_uri = &apos;(.+)&apos;;",1)' -e 'json(//script[@data-mc-object-type="production"])/{"name":"AD: "||title,"date":replace(publicationDate,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json((sources)()/src)}'
{
  "name": "AD: De nummers op benzinepompen zijn veranderd",
  "date": "03-02-2019",
  "duration": "00:00:30",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://video.persgroep.be/k3MGNmZzE62C7JZZBxHCWgECXn8756TG/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "320x180@25fps",
      "bitrate": "450kbps",
      "url": "https://video.persgroep.be/k3MGNmZzE62C7JZZBxHCWgECXn8756TG/index300.m3u8"
    },
    [...]
    {
      "id": "hls-5",
      "format": "m3u8[h264+aac]",
      "resolution": "1280x720@25fps",
      "bitrate": "23105kbps",
      "url": "https://video.persgroep.be/k3MGNmZzE62C7JZZBxHCWgECXn8756TG/index2200.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

$ xidel -s --module=xivid.xqm -H "Cookie: pwv=2;pws=functional" "https://www.ad.nl/auto/je-gaat-anders-tanken-euro-95-wordt-e10-op-1-oktober~a497450a/" --xquery 'json((doc((extract(unparsed-text(//script[@class="mc-embed"]/@src),"embed_uri = &apos;(.+)&apos;;",1),//iframe[@class="mc-embed"]/@src)[.]),.)//script[@data-mc-object-type="production"])/{"name":"AD: "||title,"date":replace(publicationDate,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json((sources)()/src)}'

------------------------------------------------------------------------------------------------

--xquery '
  json(
    (
      doc(
        (
          extract(
            unparsed-text(//script[@class="mc-embed"]/@src),
            "embed_uri = &apos;(.+)&apos;;",
            1
          ),
          //iframe[@class="mc-embed"]/@src
        )[.]
      ),
      .
    )//script[@data-mc-object-type="production"]
  )/{
    "name":"AD: "||title,
    "date":replace(
      publicationDate,
      "(\d+)-(\d+)-(\d+).+",
      "$3-$2-$1"
    ),
    "duration":format-time(
      duration * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "formats":xivid:m3u8-to-json((sources)()/src)
  }
'

================================================================================================

[leeuwarder courant]

https://www.lc.nl/friesland/sudwest-fryslan/Wrakke-stadhuistoren-Bolsward-luid-klingelend-verscheept-naar-Sneek-24902697.html

$ xidel -s "https://www.lc.nl/friesland/sudwest-fryslan/Wrakke-stadhuistoren-Bolsward-luid-klingelend-verscheept-naar-Sneek-24902697.html" -e '//figure[@class="video"]//@src'
//ndc.bbvms.com/p/lc_videoplayer_v2/c/3422620.js   # Blue Billywig

$ xidel -s "https://www.lc.nl/friesland/sudwest-fryslan/Wrakke-stadhuistoren-Bolsward-luid-klingelend-verscheept-naar-Sneek-24902697.html" --xquery 'json(extract(unparsed-text(//figure[@class="video"]//@src),"var opts = (.+);",1))/{"name":concat("LC: ",clipData/title),"date":format-date(dateTime(clipData/publisheddate),"[D01]-[M01]-[Y]"),"duration":clipData/length * duration("PT1S") + time("00:00:00"),"formats":[for $x at $i in clipData/(assets)() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":resolve-uri($x/src,publicationData/defaultMediaAssetPath)}]}'
{
  "name": "LC: Gammele toren op transport",
  "date": "08-10-2019",
  "duration": "00:01:45",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "512x288",
      "bitrate": "400kbps",
      "url": "https://d3jbi46382yahz.cloudfront.net/ndc/media/2019/10/08/asset-3422620-1570538762646090.mp4"
    },
    [...]
    {
      "id": "pg-6",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "bitrate": "3000kbps",
      "url": "https://d3jbi46382yahz.cloudfront.net/ndc/media/2019/10/08/asset-3422620-1570538764549080.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  json(
    extract(
      unparsed-text(//figure[@class="video"]//@src),
      "var opts = (.+);",
      1
    )
  )/{
    "name":concat("LC: ",clipData/title),
    "date":format-date(
      dateTime(clipData/publisheddate),
      "[D01]-[M01]-[Y]"
    ),
    "duration":clipData/length * duration("PT1S") + time("00:00:00"),
    "formats":[
      for $x at $i in clipData/(assets)()
      order by $x/bandwidth
      count $i
      return {
        "id":"pg-"||$i,
        "format":"mp4[h264+aac]",
        "resolution":concat($x/width,"x",$x/height),
        "bitrate":$x/bandwidth||"kbps",
        "url":resolve-uri(
          $x/src,
          publicationData/defaultMediaAssetPath
        )
      }
    ]
  }
'

================================================================================================

[facebook]

$ url=https://www.facebook.com/LEGONetherlands/videos/374747990176575/   # https://nl.hardware.info/nieuws/72584/

$ xidel -s "$url" -e '(//script/substring-before(substring-after(.,"onPageletArrive("),");}));")[.])[2]'   # Alleen de tweede JSON is van belang.
{sr_revision:1002368233,bootloadable:{"XUIAmbientNUX.react":[...]dash_manifest:null,[...]

Deze video heeft ook een DASH manifest, maar zonder een user-agent wordt deze niet gegenereerd.

$ xidel -s --user-agent="Mozilla/5.0 Firefox/70.0" "$url" -e '(//script/substring-before(substring-after(.,"onPageletArrive("),");}));")[.])[2]'
{sr_revision:1002368233,bootloadable:{"XUIAmbientNUX.react":[...]dash_manifest:"\x3C?xml version=\"1.0\"?>\n\x3CMPD[...]

$ xidel -s "$url" -e 'json((//script/substring-before(substring-after(.,"onPageletArrive("),");}));")[.])[2])'
Error:
jerr:JNDY0021: Failed to parse JSON: Invalid character at line 1, pos 23354: 'x' at  (tkColon) in [...]

[...]dash_manifest:"\x3C?xml version=\"1.0\"?>\n\x3CMPD[...]
                    ^positie 23354

$ xidel -se 'join(("3C_16",x:integer("3C",16)||"_10",x:cps(x:integer("3C",16)))," = ")'
3C_16 = 60_10 = <

Alle tekens met codepoint 1 t/m 255 (Extended ASCII) dienen als "\x<hexadecimaal>" gecodeerd worden. Dus \x01 t/m \xFF.
Alle tekens met codepoint 1 t/m 65535 (Unicode) dienen als "\u<hexadecimaal>" gecodeerd worden. Dus \u0001 t/m \uFFFF.
In JSON is alleen Unicode codering toegestaan. Alle "\x" moeten dus vervangen worden door "\u00".

$ xidel -s --user-agent="Mozilla/5.0 Firefox/70.0" "$url" -e '(//script/substring-before(substring-after(.,"onPageletArrive("),");}));")[.])[2] ! json(replace(.,"\\\x","\\\u00"))/(.//videoData)()'   # Alleen de "videoData"-array is van belang.
{
  "is_hls": false,
  "video_id": "374747990176575",
  "is_live_stream": false,
  "is_servable_via_fbms": false,
  "rotation": 0,
  "is_facecast_audio": false,
  "content_category": "general",
  "is_low_latency": false,
  "desired_latency_ms": null,
  "latency_tolerance_ms": null,
  "is_predictive_dash": false,
  "is_live_trace_enabled_on_player": false,
  "p2p_settings": null,
  "ms_param": null,
  "captions_autogenerated_indicator_config": null,
  "sd_src_no_ratelimit": "https://video.fams1-2.fna.fbcdn.net/v/t42.9040-2/108049244_739098363574790_5900093428100578067_n.mp4?[...]",
  "aspect_ratio": 0.8,
  "hd_src": "https://video.fams1-2.fna.fbcdn.net/v/t39.24130-2/107979746_304302857604709_5707354064042508309_n.mp4?[...]",
  "sd_src": "https://video.fams1-2.fna.fbcdn.net/v/t42.9040-2/108049244_739098363574790_5900093428100578067_n.mp4?[...]",
  "hd_tag": "oep_hd",
  "sd_tag": "sve_sd",
  "stream_type": "dash",
  "live_routing_token": "",
  "projection": "flat",
  "subtitles_src": "https://scontent.fams1-2.fna.fbcdn.net/v/t39.2093-6/109296938_710113536438950_7732833811523707442_n.srt?[...]",
  "dash_manifest": "<?xml version=\"1.0\"?>\n<MPD [...]",
  "dash_prefetched_representation_ids": ["389951148633569v", "405461810413399a"],
  "player_version_overwrite": "pleasantville",
  "spherical_config": {},
  "is_spherical": false,
  "original_height": 1080,
  "original_width": 864,
  "video_url": "https://www.facebook.com/LEGONetherlands/videos/374747990176575/",
  "is_broadcast": false,
  "override_config": null,
  "prefetch_cache": null
}

$ xidel -s --user-agent="Mozilla/5.0 Firefox/70.0" --json-mode=deprecated "$url" --xquery 'let $a:=(//script/substring-before(substring-after(.,"onPageletArrive("),");}));")[.])[2] ! json(replace(.,"\\\x","\\\u00"))/(.//videoData)() return {"name":replace(//title,"(.+) \| (.+)","$2: $1"),"date":format-date(//code/comment() ! parse-html(.)//@data-utime * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":format-time(duration($a/parse-xml(dash_manifest)//@mediaPresentationDuration) + duration("PT0.5S"),"[H01]:[m01]:[s01]"),"formats":[{"id":"sub-1","format":"srt","url":$a/subtitles_src}[url],$a/((sd_src_no_ratelimit,sd_src)[.][1],(hd_src_no_ratelimit,hd_src)[.][1]) ! {"id":"pg-"||position(),"format":"mp4[h264+aac]","url":uri-decode(.)},for $x at $i in $a/parse-xml(dash_manifest)//Representation order by $x/boolean(@width),$x/@bandwidth count $i return {"id":"dash-"||$i,"format":concat(substring-after($x/@mimeType,"/"),"[",extract($x/@codecs,"(^[\w]+)",1) ! (if (.="avc1") then "h264" else if (.="mp4a") then "aac" else .),"]"),"resolution":$x/@width ! concat(.,"x",$x/@height),"samplerate":$x/@audioSamplingRate ! concat(. div 1000,"kHz"),"bitrate":round($x/@bandwidth div 1000)||"kbps","url":$x/uri-decode(BaseUrl)}]}'
{
  "name": "Facebook: LEGO - LEGO NES",
  "date": "14-07-2020",
  "duration": "00:01:07",
  "formats": [
    {
      "id": "sub-1",
      "format": "srt",
      "url": "https://scontent.fams1-2.fna.fbcdn.net/v/t39.2093-6/109296938_710113536438950_7732833811523707442_n.srt?[...]"
    },
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "url": "https://video.fams1-2.fna.fbcdn.net/v/t42.9040-2/108049244_739098363574790_5900093428100578067_n.mp4?[...]"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "url": "https://video.fams1-2.fna.fbcdn.net/v/t39.24130-2/107979746_304302857604709_5707354064042508309_n.mp4?[...]"
    },
    {
      "id": "dash-1",
      "format": "mp4[aac]",
      "resolution": null,
      "samplerate": "48kHz",
      "bitrate": "65kbps",
      "url": "https://video.fams1-2.fna.fbcdn.net/v/t42.1790-2/109281327_405461813746732_178858496964516997_n.mp4?[...]"
    },
    [...]
    {
      "id": "dash-5",
      "format": "mp4[h264]",
      "resolution": "720x900",
      "samplerate": null,
      "bitrate": "414kbps",
      "url": "https://video.fams1-1.fna.fbcdn.net/v/t39.25447-2/109304628_605794363632964_2667690113915675475_n.mp4?[...]"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  let $a:=(//script/substring-before(substring-after(.,"onPageletArrive("),");}));")[.])[2] ! json(
    replace(.,"\\\x","\\\u00")
  )/(.//videoData)() return {
    "name":replace(//title,"(.+) \| (.+)","$2: $1"),
    "date":format-date(
      //code/comment() ! parse-html(.)//@data-utime * duration("PT1S") +
      implicit-timezone() + date("1970-01-01"),
      "[D01]-[M01]-[Y]"
    ),
    "duration":format-time(
      duration($a/parse-xml(dash_manifest)//@mediaPresentationDuration) + duration("PT0.5S"),
      "[H01]:[m01]:[s01]"
    ),
    "formats":[
      {
        "id":"sub-1",
        "format":"srt",
        "url":$a/subtitles_src
      }[url],
      $a/(
        (sd_src_no_ratelimit,sd_src)[.][1],
        (hd_src_no_ratelimit,hd_src)[.][1]
      ) ! {
        "id":"pg-"||position(),
        "format":"mp4[h264+aac]",
        "url":uri-decode(.)
      },
      for $x at $i in $a/parse-xml(dash_manifest)//Representation
      order by $x/boolean(@width),$x/@bandwidth
      count $i
      return {
        "id":"dash-"||$i,
        "format":concat(
          substring-after($x/@mimeType,"/"),
          "[",
          extract($x/@codecs,"(^[\w]+)",1) ! (
            if (.="avc1") then "h264" else if (.="mp4a") then "aac" else .
          ),
          "]"
        ),
        "resolution":$x/@width ! concat(.,"x",$x/@height),
        "samplerate":$x/@audioSamplingRate ! concat(. div 1000,"kHz"),
        "bitrate":round($x/@bandwidth div 1000)||"kbps",
        "url":$x/uri-decode(BaseUrl)
      }
    ]
  }
'

================================================================================================

[twitter]

https://twitter.com/themandalorian/status/1188986316194635777 (https://github.com/ytdl-org/youtube-dl/issues/14977#issuecomment-551283708)

$ xidel -s "https://twitter.com/themandalorian/status/1188986316194635777" -e '(//@data-associated-tweet-id,//title,//div[@class="permalink-header"]//@data-time)'
1188986316194635777
The Mandalorian op Twitter: ""Mandalorian, look outside. They're waiting for you." Watch the brand new trailer for #TheMandalorian, an original Star Wars series. Start streaming Nov. 12, only on #DisneyPlus.. https://t.co/6sp4JYLsbg"
1572311402

https://github.com/ytdl-org/youtube-dl/blob/master/youtube_dl/extractor/twitter.py#L78-L81:
    def _call_api(self, path, video_id, query={}):
        headers = {
            'Authorization': 'Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw',
        }

Deze is blijkbaar altijd hetzelfde. Is ook te vinden in:
$ xidel -s "https://twitter.com/themandalorian/status/1188986316194635777" -e '//link[contains(@href,"init.nl")]/@href'
https://abs.twimg.com/k/nl/init.nl.5ab9653af2739d01d2b6.js

$ xidel -s --method=POST -H "Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw" "https://api.twitter.com/1.1/guest/activate.json" -e '$json'
{
  "guest_token": "1185197188525236229"
}

$ xidel -s -H "Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw" -H "x-guest-token: 1185197188525236229" "https://api.twitter.com/1.1/videos/tweet/config/1188986316194635777.json" -e '$json'
{
  "track": {
    "contentType": "media_entity",
    "publisherId": "35631163",
    "contentId": "937077800443379714",
    "durationMs": 52619,
    "playbackUrl": "https://video.twimg.com/amplify_video/937077800443379714/pl/pSmZVTKJ0QIyx7Or.m3u8",
    "playbackType": "application/x-mpegURL",
    "expandedUrl": "https://twitter.com/BellatorMMA/status/937079503297290240/video/1",
    "vmapUrl": null,
    "cta": null,
    "shouldLoop": false,
    "viewCount": "32K",
    "isEventGeoblocked": false,
    "is360": false,
    "mediaAvailability": {
      "status": "available",
      "reason": null
    }
  },
  "posterImage": "https://pbs.twimg.com/media/DQEsZvCVoAANlE1.jpg",
  "features": {
    "isEdgeEnabled": true,
    "bitrateCap": null,
    "isDebuggingEnabled": false,
    "fatalErrorRetryMax": 3,
    "isLiveTimecodeEnabled": true,
    "isClientMediaEventScribingEnabled": true
  },
  "translations": {[...]}
}

$ xidel -se 'x:request({"method":"POST","headers":"Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw","url":"https://api.twitter.com/1.1/guest/activate.json"})/json/guest_token'
1185211608508878854

$ xidel -s "https://twitter.com/themandalorian/status/1188986316194635777" -e 'declare variable $head:="Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw"; let $a:=x:request({"method":"POST","headers":$head,"url":"https://api.twitter.com/1.1/guest/activate.json"})/json/guest_token return x:request({"headers":($head,"x-guest-token: "||$a),"url":concat("https://api.twitter.com/1.1/videos/tweet/config/",//@data-associated-tweet-id,".json")})//playbackUrl'
https://video.twimg.com/amplify_video/1188974444523315201/pl/OTSOTGtTUnYMAVnX.m3u8?tag=13

$ xidel -s --module=xivid.xqm "https://twitter.com/themandalorian/status/1188986316194635777" -e 'declare variable $head:="Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw"; let $a:=x:request({"method":"POST","headers":$head,"url":"https://api.twitter.com/1.1/guest/activate.json"})/json/guest_token,$b:=x:request({"headers":($head,"x-guest-token: "||$a),"url":concat("https://api.twitter.com/1.1/videos/tweet/config/",//@data-associated-tweet-id,".json")}) return {"name"://title,"date":format-date(//div[@class="permalink-header"]//@data-time * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":format-time(round($b//durationMs div 1000) * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json($b//playbackUrl)}'
{
  "name": "The Mandalorian op Twitter: \""Mandalorian, look outside. They're waiting for you." Watch the brand new trailer for #TheMandalorian, an original Star Wars series. Start streaming Nov. 12, only on #DisneyPlus.. https://t.co/6sp4JYLsbg\"",
  "date": "29-10-2019",
  "duration": "00:01:45",
  "formats": [
    {
      "id": "sub-1",
      "format": "m3u8[vtt]",
      "language": "en",
      "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/s0/3sjE70yJdGgqp0g1.m3u8"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/OTSOTGtTUnYMAVnX.m3u8?tag=13"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "648x270",
      "bitrate": "288kbps",
      "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/648x270/O7Yd4NsLa4hRURCX.m3u8"
    },
    [...]
    {
      "id": "hls-3",
      "format": "m3u8[h264+aac]",
      "resolution": "1732x720",
      "bitrate": "2176kbps",
      "url": "https://video.twimg.com/amplify_video/1188974444523315201/pl/1732x720/yG0_asM0v9yBC-Xd.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://twitter.com/ViviEducation/status/1136534865145286656

$ xidel -s "https://twitter.com/ViviEducation/status/1136534865145286656" -e '(//@data-associated-tweet-id,//title,//div[@class="permalink-header"]//@data-time)'
1136534865145286656
Vivi op Twitter: "Vivi founder @lior_rauchy announcing our new student feedback tool live at @EduTECH_AU #EduTECH2019 https://t.co/HJOtr4djsW"
1559806002

$ xidel -s "https://twitter.com/ViviEducation/status/1136534865145286656" -e 'if (//@data-supports-broadcast-player) then (//@data-expanded-url,"https://api.twitter.com/1.1/broadcasts/show.json?ids="||extract(//@data-expanded-url,".+/(.+)",1)) else ()'
https://twitter.com/i/broadcasts/1vOGwqejwoWxB
https://api.twitter.com/1.1/broadcasts/show.json?ids=1vOGwqejwoWxB

$ xidel -s "https://twitter.com/ViviEducation/status/1136534865145286656" -e 'declare variable $head:="Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw"; let $a:=x:request({"method":"POST","headers":$head,"url":"https://api.twitter.com/1.1/guest/activate.json"})/json/guest_token return x:request({"headers":($head,"x-guest-token: "||$a),"url":"https://api.twitter.com/1.1/"||(if (//@data-supports-broadcast-player) then concat("broadcasts/show.json?ids=",extract(//@data-expanded-url,".+/(.+)",1)) else concat("videos/tweet/config/",//@data-associated-tweet-id,".json"))})/json'
{
  "broadcasts": {
    "1vOGwqejwoWxB": {
      "id": "1vOGwqejwoWxB",
      "broadcast_id": "1vOGwqejwoWxB",
      "media_key": "28_1136534646529769472",
      "media_id": "1136534646529769472",
      "created_at_ms": "1559805950116",
      "updated_at_ms": "1559807525138",
      "language": "en",
      "image_url": "[...]",
      "image_url_small": "[...]",
      "image_url_medium": "[...]",
      "status": "Vivi founder @lior_rauchy announcing our new student feedback tool live at @EduTECH_AU #EduTECH2019",
      "available_for_replay": true,
      "user_id": "1eVjYOLGkGrQL",
      "twitter_user_id": "3666125413",
      "user_display_name": "Vivi",
      "username": "ViviEducation",
      "twitter_username": "ViviEducation",
      "profile_image_url": "https://pbs.twimg.com/profile_images/1046642374481301505/k27_a-It_reasonably_small.jpg",
      "state": "ENDED",
      "is_locked": false,
      "friend_chat": false,
      "has_moderation": true,
      "height": 568,
      "width": 320,
      "camera_rotation": 0,
      "has_location": false,
      "lat": 0,
      "lng": 0,
      "tweet_id": "1136534865145286656",
      "tweet_external": true,
      "tags": ["EduTECH2019"],
      "total_watching": "0",
      "total_watched": "46",
      "start_ms": "1559806001825",
      "end_ms": "1559807524882",
      "ping_ms": "1559807522193",
      "unavailable_in_periscope": true,
      "private_chat": false,
      "version": 174
    }
  }
}

$ xidel -s "https://twitter.com/ViviEducation/status/1136534865145286656" -e 'declare variable $head:="Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw"; let $a:=x:request({"method":"POST","headers":$head,"url":"https://api.twitter.com/1.1/guest/activate.json"})/json/guest_token,$b:=x:request({"headers":($head,"x-guest-token: "||$a),"url":"https://api.twitter.com/1.1/"||(if (//@data-supports-broadcast-player) then concat("broadcasts/show.json?ids=",extract(//@data-expanded-url,".+/(.+)",1)) else concat("videos/tweet/config/",//@data-associated-tweet-id,".json"))})/json return x:request({"headers":($head,"x-guest-token: "||$a),"url":"https://api.twitter.com/1.1/live_video_stream/status/"||$b//media_key})/json'
{
  "source": {
    "location": "https://prod-fastly-ap-southeast-2.video.pscp.tv/Transcoding/v1/hls/ID3RNhDB49PL26_4bsrv2UQbsLyAQUllNt2sV1Giz9lqLUORaJfBrQdfvw-F37cIEh1lQNl9I5qXuEHDwveTMg/non_transcode/ap-southeast-2/periscope-replay-direct-prod-ap-southeast-2-public/playlist_16886936549721737423.m3u8?type=replay",
    "noRedirectPlaybackUrl": "https://prod-fastly-ap-southeast-2.video.pscp.tv/Transcoding/v1/hls/ID3RNhDB49PL26_4bsrv2UQbsLyAQUllNt2sV1Giz9lqLUORaJfBrQdfvw-F37cIEh1lQNl9I5qXuEHDwveTMg/non_transcode/ap-southeast-2/periscope-replay-direct-prod-ap-southeast-2-public/playlist_16886936549721737423.m3u8?type=replay",
    "status": "LIVE_PUBLIC",
    "streamType": "HLS"
  },
  "sessionId": "1193228350279565313",
  "chatToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhbWJpZ3VvdXNfdXNlcl9pZCI6ImV5SlVkMmwwZEdWeVZYTmxja2xrSWpveE5UY3pNekl5TnpneE5ETTFNalUwTnpCOSIsImJyb2FkY2FzdF9pZCI6IjF2T0d3cWVqd29XeEIiLCJleHAiOjE1NzM0MDkxODIsImxvd19sYXRlbmN5IjpmYWxzZSwicGFydGljaXBhbnRfaW5kZXgiOjE4MTk3ODI3NDYsInJlYWRfb25seSI6dHJ1ZX0.orM8ZApCG94r_VL39P56l8Wj4BZebqge3UynU7kH2Bs",
  "lifecycleToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJicm9hZGNhc3RfaWQiOiIxdk9Hd3FlandvV3hCIiwiY3JlYXRlZCI6MTU3MzMyMjc4MiwiZXhwIjoxNTczNDA5MTgyLCJpZ25vcmUiOmZhbHNlLCJpc19oaWdobGlnaHRzIjpmYWxzZSwiaXNfbGl2ZSI6ZmFsc2UsInBhcnRpY2lwYW50X2luZGV4IjoxODE5NzgyNzQ2LCJ0b2tlbl92ZXJzaW9uIjoxfQ.ZtrXwnHANRa7dS4O1JBuOv9XsP9g5n7mC0nAN8tzSf0",
  "shareUrl": "https://twitter.com/i/broadcasts/1vOGwqejwoWxB"
}

$ xidel -s --module=xivid.xqm "https://twitter.com/ViviEducation/status/1136534865145286656" -e 'declare variable $head:="Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw"; let $a:=x:request({"method":"POST","headers":$head,"url":"https://api.twitter.com/1.1/guest/activate.json"})/json/guest_token,$b:=x:request({"headers":($head,"x-guest-token: "||$a),"url":"https://api.twitter.com/1.1/"||(if (//@data-supports-broadcast-player) then concat("broadcasts/show.json?ids=",extract(//@data-expanded-url,".+/(.+)",1)) else concat("videos/tweet/config/",//@data-associated-tweet-id,".json"))})/json return {"name"://title,"date":format-date(//div[@class="permalink-header"]//@data-time * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":format-time(round(($b//durationMs,$b//end_ms - $b//start_ms) div 1000) * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":if ($b/broadcasts) then [{"id":"hls-1","format":"m3u8[h264+aac]","resolution":concat($b//width,"x",$b//height),"url":x:request({"headers":($head,"x-guest-token: "||$a),"url":"https://api.twitter.com/1.1/live_video_stream/status/"||$b//media_key})//location}] else xivid:m3u8-to-json($b//playbackUrl)}'
{
  "name": "Vivi op Twitter: \"Vivi founder @lior_rauchy announcing our new student feedback tool live at @EduTECH_AU #EduTECH2019 https://t.co/HJOtr4djsW\"",
  "date": "06-06-2019",
  "duration": "00:25:23",
  "formats": [
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "320x568",
      "url": "https://prod-fastly-ap-southeast-2.video.pscp.tv/Transcoding/v1/hls/ID3RNhDB49PL26_4bsrv2UQbsLyAQUllNt2sV1Giz9lqLUORaJfBrQdfvw-F37cIEh1lQNl9I5qXuEHDwveTMg/non_transcode/ap-southeast-2/periscope-replay-direct-prod-ap-southeast-2-public/playlist_16886936549721737423.m3u8?type=replay"
    }
  ]
}

------------------------------------------------------------------------------------------------

-e '
    declare variable $head:="Authorization: Bearer AAAAAAAAAAAAAAAAAAAAAPYXBAAAAAAACLXUNDekMxqa8h%2F40K4moUkGsoc%3DTYfbDKbT3jJPCEVnMYqilB28NHfOPqkca3qaAxGfsyKCs0wRbw";
    let $a:=x:request({
          "method":"POST",
          "headers":$head,
          "url":"https://api.twitter.com/1.1/guest/activate.json"
        })/json/guest_token,
        $b:=x:request({
          "headers":($head,"x-guest-token: "||$a),
          "url":"https://api.twitter.com/1.1/"||(
            if (//@data-supports-broadcast-player) then
              concat("broadcasts/show.json?ids=",extract(//@data-expanded-url,".+/(.+)",1))
            else
              concat("videos/tweet/config/",//@data-associated-tweet-id,".json")
          )
        })/json
    return {
      "name"://title,
      "date":format-date(
        //div[@class="permalink-header"]//@data-time * duration("PT1S") +
        implicit-timezone() + date("1970-01-01"),
        "[D01]-[M01]-[Y]"
      ),
      "duration":format-time(
        round(($b//durationMs,$b//end_ms - $b//start_ms) div 1000) * duration("PT1S"),
        "[H01]:[m01]:[s01]"
      ),
      "formats":if ($b/broadcasts) then
        [{
          "id":"hls-1",
          "format":"m3u8[h264+aac]",
          "resolution":concat($b//width,"x",$b//height),
          "url":x:request({
            "headers":($head,"x-guest-token: "||$a),
            "url":"https://api.twitter.com/1.1/live_video_stream/status/"||$b//media_key
          })//location
        }]
      else
        xivid:m3u8-to-json($b//playbackUrl)
    }
'

================================================================================================

[pornhub]

https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9 -e 'json(//script/extract(.,"flashvars_\d+ = (.+);",1)[.])'
{
  "maxInitialBufferLength": 40,
  "disable_sharebar": 0,
  "htmlPauseRoll": "true",
  "htmlPostRoll": "true",
  "errorReports": "https://nl.pornhub.com/video/problems/213567022",
  "autoplay": "true",
  "autoreplay": "false",
  "video_unavailable": "false",
  "pauseroll_url": "",
  "postroll_url": "",
  "embedCode": "<iframe src=\"https://nl.pornhub.com/embed/ph5c8e7e44e1da9\" frameborder=\"0\" width=\"560\" height=\"340\" scrolling=\"no\" allowfullscreen></iframe>",
  "hidePostPauseRoll": false,
  "isHD": "true",
  "video_duration": "549",
  "actionTags": "",
  "link_url": "https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9",
  "related_url": "https://nl.pornhub.com/video/player_related_datas?id=213567022",
  "image_url": "https://ci.phncdn.com/videos/201903/17/213567022/thumbs_15/(m=eaAaGwObaaaa)(mh=y9U5PUCUUhw4TvQr)11.jpg",
  "video_title": "Strongest orgasm with magic wand in my life - Mini Diva",
  "defaultQuality": [720, 480, 240, 1080],
  "vcServerUrl": "/svvt/add?stype=svv&svalue=213567022&snonce=9m0n5r1k2bxtmp16&skey=b08200ef86dfea42762dc62114170c8ba6b63bb1eac28778073798398b94bb92&stime=1571831395",
  "display_hd_upsell": true,
  "mediaDefinitions": [
    {
      "defaultQuality": false,
      "format": "mp4",
      "quality": "1080",
      "videoUrl": ""
    },
    {
      "defaultQuality": true,
      "format": "mp4",
      "quality": "720",
      "videoUrl": ""
    },
    {
      "defaultQuality": false,
      "format": "mp4",
      "quality": "480",
      "videoUrl": ""
    },
    {
      "defaultQuality": false,
      "format": "mp4",
      "quality": "240",
      "videoUrl": ""
    }
  ],
  "isVertical": "false",
  "video_unavailable_country": "false",
  "mp4_seek": "ms",
  "hotspots": [...],
  "toprated_url": "https://nl.pornhub.com/video?o=tr&t=m",
  "mostviewed_url": "https://nl.pornhub.com/video?o=mv&t=m",
  "options": "show",
  "cdn": "edgecast",
  "startLagThreshold": 1000,
  "outBufferLagThreshold": 2000,
  "appId": "1111",
  "service": "protrack",
  "cdnProvider": "ec",
  "tubesCmsPrerollConfigType": "new",
  "prerollGlobalConfig": [],
  "thumbs": {
    "samplingFrequency": 4,
    "type": "normal",
    "cdnType": "regular",
    "urlPattern": "https://ci.phncdn.com/videos/201903/17/213567022/timeline/160x90/(m=eGCaiCObaaaa)(mh=pe1wGHehMCV3C3N5)S{5}.jpg",
    "thumbHeight": "90",
    "thumbWidth": "160"
  },
  "nextVideo": {
    "thumb": "https://ci.phncdn.com/videos/201905/24/225491641/thumbs_30/(m=ecuKGgaaaa)(mh=lL3N_B5yKPww3SYA)7.jpg",
    "duration": "543",
    "title": "Playing with fake sperm and moaning loudly - Mini Diva",
    "isHD": "1",
    "nextUrl": "/view_video.php?viewkey=ph5ce838569ffa9",
    "video": "https://cw.phncdn.com/videos/201905/24/225491641/180P_225K_225491641.webm?_47_5LtAayyvs9--Ch_yRnH_BmYiCR-SUCOoCdrv-UoEd1GMXGBLdu_roHuGJ-Scd3IQs8rjfg9nUCjLRBQswhvrfQnHWptgfm-55pfKlgw9X8illq7yAOvzgFXy0okg0CNnNuQSVDBuwVn0EuWceC3iYHrqrIo1o_ii0a7qziEGZBLJDMMtYyedObvDJD7lXfmBxGG2vBY"
  },
  "language": "nl"
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Alle variabelen die beginnen met "ra":

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9 -e '//script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*")'
var rartbgld9ypsra88rartbgld9ypsra88="RTBGld9yp" + "S";var ramvideos2ra80ramvideos2ra80="m/video" +"s/2";var ray8a0qjswhqra29ray8a0qjswhqra29="Y8a0QjswhQ";var rakgtxvzjdjjra68rakgtxvzjdjjra68="kgTXvzJDjJ";var rapvnczg7gyra11rapvnczg7gyra11="Pv_NcZG" + "7gy";var ra135670221ra37ra135670221ra37="13567022/1";var ramp4sozra16ramp4sozra16=".mp4?sO_z_";var rabkfv0rnivra63rabkfv0rnivra63="bKF_v0rniv";var rajhqux87hjara11rajhqux87hjara11="jHqux87" + "Hja";var ra2z3lg3vimrra67ra2z3lg3vimrra67="2Z3lg3vimr";var ra080p4000kra70ra080p4000kra70="080P_" + "4000K";var rapzckmhujslra13rapzckmhujslra13="PzCkmhUJsl";var radbrepkflvlra44radbrepkflvlra44="dbRePKF" + "lvL";var rabdolgevyyra19rabdolgevyyra19="BDolgEVy_y";var ra1p0aupo6m2ra47ra1p0aupo6m2ra47="1p0auPo6m2";var ranu3ahwl8jdra86ranu3ahwl8jdra86="NU3Ahwl8jD";var ral0ngra13ral0ngra13="l0-Ng";var ra8py92lhycmra54ra8py92lhycmra54="8Py92LhYCM";var raaa3zsoj10jra68raaa3zsoj10jra68="Aa3zs" + "OJ10J";var razwvi9unrdhra66razwvi9unrdhra66="zwvi9UNRDH";varra213567022ra77ra213567022ra77="_2135" + "67022";var raew9u8nqr10ra63raew9u8nqr10ra63="EW9u8NQr10";var raphncdncora99raphncdncora99=".phnc" + "dn.co";var raaj5cykddvlra67raaj5cykddvlra67="Aj5cy" + "kDdvl";var raekhtgiggvmra32raekhtgiggvmra32="eKhtGiGGvM";var rahttpscvra78rahttpscvra78="https:/" + "/cv";var ra01903172ra84ra01903172ra84="01903/17/2";var raozy6wnekgra83raozy6wnekgra83="oZy6wn_ek" + "G";var radck0c1oeorra37radck0c1oeorra37="dCk0C1OEor";var quality_1080p=/* + ranu3ahwl8jdra86ranu3ahwl8jdra86 + */rahttpscvra78rahttpscvra78 + /* + ra1p0aupo6m2ra47ra1p0aupo6m2ra47 + */raphncdncora99raphncdncora99 + /* + ra1p0aupo6m2ra47ra1p0aupo6m2ra47 + */ramvideos2ra80ramvideos2ra80 + /* + ral0ngra13ral0ngra13 + */ra01903172ra84ra01903172ra84 + /* + raekhtgiggvmra32raekhtgiggvmra32 + */ra135670221ra37ra135670221ra37 + /* + raekhtgiggvmra32raekhtgiggvmra32 + */ra080p4000kra70ra080p4000kra70 + /* + rapvnczg7gyra11rapvnczg7gyra11 + */ra213567022ra77ra213567022ra77 + /* + raaa3zsoj10jra68raaa3zsoj10jra68 + */ramp4sozra16ramp4sozra16 + /* + raaj5cykddvlra67raaj5cykddvlra67 + */radbrepkflvlra44radbrepkflvlra44 + /* + ral0ngra13ral0ngra13 + */ra8py92lhycmra54ra8py92lhycmra54 + /* + rakgtxvzjdjjra68rakgtxvzjdjjra68 + */raekhtgiggvmra32raekhtgiggvmra32 + /* + raaj5cykddvlra67raaj5cykddvlra67 +*/ranu3ahwl8jdra86ranu3ahwl8jdra86 + /* + rakgtxvzjdjjra68rakgtxvzjdjjra68 + */razwvi9unrdhra66razwvi9unrdhra66 + /* + rajhqux87hjara11rajhqux87hjara11 + */rakgtxvzjdjjra68rakgtxvzjdjjra68 + /* + ranu3ahwl8jdra86ranu3ahwl8jdra86 + */rapzckmhujslra13rapzckmhujslra13 + /* + ra213567022ra77ra213567022ra77 + */raaa3zsoj10jra68raaa3zsoj10jra68 + /* + rapzckmhujslra13rapzckmhujslra13 + */radck0c1oeorra37radck0c1oeorra37 + /* + raozy6wnekgra83raozy6wnekgra83 + */rabdolgevyyra19rabdolgevyyra19 + /* + rahttpscvra78rahttpscvra78 + */ray8a0qjswhqra29ray8a0qjswhqra29 + /* + ranu3ahwl8jdra86ranu3ahwl8jdra86 + */rapvnczg7gyra11rapvnczg7gyra11 + /* + raekhtgiggvmra32raekhtgiggvmra32 + */rartbgld9ypsra88rartbgld9ypsra88 + /* + ra1p0aupo6m2ra47ra1p0aupo6m2ra47 + */ra1p0aupo6m2ra47ra1p0aupo6m2ra47 + /* + ray8a0qjswhqra29ray8a0qjswhqra29 + */raaj5cykddvlra67raaj5cykddvlra67 + /* + rahttpscvra78rahttpscvra78 + */rabkfv0rnivra63rabkfv0rnivra63 + /* + rakgtxvzjdjjra68rakgtxvzjdjjra68 + */rajhqux87hjara11rajhqux87hjara11 + /* + rabkfv0rnivra63rabkfv0rnivra63 + */raozy6wnekgra83raozy6wnekgra83 + /* + ramvideos2ra80ramvideos2ra80 + */ra2z3lg3vimrra67ra2z3lg3vimrra67 + /* + raekhtgiggvmra32raekhtgiggvmra32+ */raew9u8nqr10ra63raew9u8nqr10ra63 + /* + rartbgld9ypsra88rartbgld9ypsra88 + */ral0ngra13ral0ngra13;
[...]

Verwijder de aanhalingstekens en de +jes en sorteer op "quality":

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9 --xquery 'for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") order by extract($x,"quality_(\d+)p=",1) return $x'
var rarehueazwdra85rarehueazwdra85=rEhUeAzwD;var ra6kpoaxbjira88ra6kpoaxbjira88=6KPoAXBji;var racomvideora91racomvideora91=com/video;var radkc4qphrqra22radkc4qphrqra22=dKC4qphrQ;var rax9pj3nb5kra58rax9pj3nb5kra58=X9Pj3nB5K;var ra0k7sn1emra51ra0k7sn1emra51=0k7sN1e-M;var ra67022mp4ra80ra67022mp4ra80=67022.mp4;var ra17213567ra22ra17213567ra22=17/213567;var raw7vawsnacra62raw7vawsnacra62=W7vAWsnAC;var ra6ef3gugmbra52ra6ef3gugmbra52=6eF3gugmb;var ra76wrhm1y4ra65ra76wrhm1y4ra65=76WrHM1y4;var rackiriuxsnra64rackiriuxsnra64=ckiriUxsn;var rarda6rwms9ra66rarda6rwms9ra66=rDa6RWms9;var rainnsl34knra60rainnsl34knra60=iNnSL34kN;var rashj3zcazsra40rashj3zcazsra40=shj3ZCAZS;var ravfbq4pzgcra60ravfbq4pzgcra60=vFBq4PzGc;var ra2novmsxhjra91ra2novmsxhjra91=2NOVMSxHj;var rap17xlv136ra49rap17xlv136ra49=P17xlv136;var ras201903ra34ras201903ra34=s/201903/;var rahttpscra88rahttpscra88=https://c;var raqpfic0ln5ra88raqpfic0ln5ra88=qPfiC0lN5;var rawwvvtt5ygra83rawwvvtt5ygra83=WWVvtT5YG;var rarup7bahn5ra22rarup7bahn5ra22=Rup7baHn5;var ran7wp7zokbra15ran7wp7zokbra15=N7wP7ZOKB;var ravvefrjgnmra13ravvefrjgnmra13=VvEfRJgNM;var rawqyokfhtcra66rawqyokfhtcra66=wQYoKfhtc;var rapojsrpra90rapojsrpra90=?pojsr__p;var ra400k2135ra52ra400k2135ra52=400K_2135;var ra022240pra18ra022240pra18=022/240P_;var ravphncdnra25ravphncdnra25=v.phncdn.;var ra6nnfara49ra6nnfara49=6nNfA;var quality_240p=/* + rashj3zcazsra40rashj3zcazsra40 + */rahttpscra88rahttpscra88 + /* + ra67022mp4ra80ra67022mp4ra80 + */ravphncdnra25ravphncdnra25 + /* + rarda6rwms9ra66rarda6rwms9ra66 + */racomvideora91racomvideora91 + /* + ra76wrhm1y4ra65ra76wrhm1y4ra65 + */ras201903ra34ras201903ra34 + /* + rax9pj3nb5kra58rax9pj3nb5kra58 + */ra17213567ra22ra17213567ra22 + /* + rawqyokfhtcra66rawqyokfhtcra66 + */ra022240pra18ra022240pra18 + /* + ra400k2135ra52ra400k2135ra52 + */ra400k2135ra52ra400k2135ra52 + /* + raw7vawsnacra62raw7vawsnacra62 + */ra67022mp4ra80ra67022mp4ra80 + /* + ra67022mp4ra80ra67022mp4ra80 + */rapojsrpra90rapojsrpra90 + /* + radkc4qphrqra22radkc4qphrqra22 + */ra0k7sn1emra51ra0k7sn1emra51 + /* + rawqyokfhtcra66rawqyokfhtcra66 + */ra6kpoaxbjira88ra6kpoaxbjira88 + /* + rarda6rwms9ra66rarda6rwms9ra66 + */rarda6rwms9ra66rarda6rwms9ra66 + /* + rainnsl34knra60rainnsl34knra60 + */ravvefrjgnmra13ravvefrjgnmra13 + /* + rax9pj3nb5kra58rax9pj3nb5kra58 + */rarup7bahn5ra22rarup7bahn5ra22 + /* + racomvideora91racomvideora91 + */rackiriuxsnra64rackiriuxsnra64 + /* + rax9pj3nb5kra58rax9pj3nb5kra58 + */rawwvvtt5ygra83rawwvvtt5ygra83 + /* + rax9pj3nb5kra58rax9pj3nb5kra58 + */rax9pj3nb5kra58rax9pj3nb5kra58 + /* + racomvideora91racomvideora91 + */rashj3zcazsra40rashj3zcazsra40 + /* + radkc4qphrqra22radkc4qphrqra22 + */ra6ef3gugmbra52ra6ef3gugmbra52 + /* + rax9pj3nb5kra58rax9pj3nb5kra58 + */rarehueazwdra85rarehueazwdra85 + /* + ra022240pra18ra022240pra18 + */radkc4qphrqra22radkc4qphrqra22 + /* + ravvefrjgnmra13ravvefrjgnmra13 + */ravfbq4pzgcra60ravfbq4pzgcra60 + /* + ra6ef3gugmbra52ra6ef3gugmbra52 + */rawqyokfhtcra66rawqyokfhtcra66 + /* + racomvideora91racomvideora91 + */raw7vawsnacra62raw7vawsnacra62 + /* + rarda6rwms9ra66rarda6rwms9ra66 + */ran7wp7zokbra15ran7wp7zokbra15 + /* + ra67022mp4ra80ra67022mp4ra80 + */rainnsl34knra60rainnsl34knra60 + /* + rawwvvtt5ygra83rawwvvtt5ygra83 + */rap17xlv136ra49rap17xlv136ra49 + /* + rainnsl34knra60rainnsl34knra60 + */raqpfic0ln5ra88raqpfic0ln5ra88 + /* + rackiriuxsnra64rackiriuxsnra64 + */ra2novmsxhjra91ra2novmsxhjra91 + /* + ravphncdnra25ravphncdnra25 + */ra76wrhm1y4ra65ra76wrhm1y4ra65 + /* + ra17213567ra22ra17213567ra22 + */ra6nnfara49ra6nnfara49;
[...]

De variabele-namen-string per formaat:

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9 --xquery 'for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") order by extract($x,"quality_(\d+)p=",1) return substring-after($x,"quality_")'
240p=/* + rashj3zcazsra40rashj3zcazsra40 + */rahttpscra88rahttpscra88 + [...]
480p=/* + rargtc5dyra30rargtc5dyra30 + */rahttpsra70rahttpsra70 + [...]
720p=/* + ra3jitdoapf9ra80ra3jitdoapf9ra80 + */rahttpscvra38rahttpscvra38 + [...]
1080p=/* + ranu3ahwl8jdra86ranu3ahwl8jdra86 + */rahttpscvra78rahttpscvra78 + [...]

Een variabele-naam tussen /* [...] */ is commentaar en zorgt alleen maar voor verwarring.
Creëer een reeks van alle variabelen die er toe doen. Feitelijk die dus met */ beginnen:

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9 --xquery 'for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") order by extract($x,"quality_(\d+)p=",1) return extract($x,"\*/(\w+)",1,"*")'
rahttpscra88rahttpscra88
ravphncdnra25ravphncdnra25
racomvideora91racomvideora91
ras201903ra34ras201903ra34
ra17213567ra22ra17213567ra22
ra022240pra18ra022240pra18
ra400k2135ra52ra400k2135ra52
ra67022mp4ra80ra67022mp4ra80
rapojsrpra90rapojsrpra90
ra0k7sn1emra51ra0k7sn1emra51
ra6kpoaxbjira88ra6kpoaxbjira88
rarda6rwms9ra66rarda6rwms9ra66
ravvefrjgnmra13ravvefrjgnmra13
rarup7bahn5ra22rarup7bahn5ra22
rackiriuxsnra64rackiriuxsnra64
rawwvvtt5ygra83rawwvvtt5ygra83
rax9pj3nb5kra58rax9pj3nb5kra58
rashj3zcazsra40rashj3zcazsra40
ra6ef3gugmbra52ra6ef3gugmbra52
rarehueazwdra85rarehueazwdra85
radkc4qphrqra22radkc4qphrqra22
ravfbq4pzgcra60ravfbq4pzgcra60
rawqyokfhtcra66rawqyokfhtcra66
raw7vawsnacra62raw7vawsnacra62
ran7wp7zokbra15ran7wp7zokbra15
rainnsl34knra60rainnsl34knra60
rap17xlv136ra49rap17xlv136ra49
raqpfic0ln5ra88raqpfic0ln5ra88
ra2novmsxhjra91ra2novmsxhjra91
ra76wrhm1y4ra65ra76wrhm1y4ra65
ra6nnfara49ra6nnfara49
[...]

Zoek in $x de inhoud van deze variabelen op:

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9 --xquery 'for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") order by extract($x,"quality_(\d+)p=",1) return join(extract($x,"\*/(\w+)",1,"*") ! substring-before(substring-after($x,.||"="),";"))'
https://c v.phncdn. com/video s/201903/ 17/213567 022/240P_ 400K_2135 67022.mp4 ?pojsr__p 0k7sN1e-M 6KPoAXBji rDa6RWms9 VvEfRJgNM Rup7baHn5 ckiriUxsn WWVvtT5YG X9Pj3nB5K shj3ZCAZS 6eF3gugmb rEhUeAzwD dKC4qphrQ vFBq4PzGc wQYoKfhtc W7vAWsnAC N7wP7ZOKB iNnSL34kN P17xlv136 qPfiC0lN5 2NOVMSxHj 76WrHM1y4 6nNfA
[...]

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5c8e7e44e1da9 --xquery 'let $a:=json(//script/extract(.,"flashvars_\d+ = (.+);",1)[.]) return {"name":"Pornhub: "||$a/video_title,"date":replace($a/image_url,".+?(\d{4})(\d{2})/(\d{2}).+","$3-$2-$1"),"duration":format-time($a/video_duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") order by extract($x,"quality_(\d+)p=",1) count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":("426x240","854x480","1280x720","1920x1080")[$i],"url":string-join(extract($x,"\*/(\w+)",1,"*") ! substring-before(substring-after($x,.||"="),";"))}]}'
{
  "name": "Pornhub: Strongest orgasm with magic wand in my life - Mini Diva",
  "date": "17-03-2019",
  "duration": "00:09:09",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "426x240",
      "url": "https://cv.phncdn.com/videos/201903/17/213567022/240P_400K_213567022.mp4?pojsr__[...]y46nNfA"
    },
    [...]
    {
      "id": "pg-4",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "url": "https://cv.phncdn.com/videos/201903/17/213567022/1080P_4000K_213567022.mp4?sO_z_db[...]10l0-Ng"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://nl.pornhub.com/view_video.php?viewkey=ph5de04f60346c5

$ xidel -s https://nl.pornhub.com/view_video.php?viewkey=ph5de04f60346c5 -e '$raw' > ph5de04f60346c5.htm

$ xidel -s ph5de04f60346c5.htm --xquery 'for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") order by extract($x,"quality_(\d+)p=",1) return string-join(extract($x,"\*/(\w+)",1,"*") ! substring-before(substring-after($x,.||"="),";"))'
https://cv.phncdn.com/videos/201911/28/264884532/240P_400K_264884532.mp4?9NTnorc[...]W3RUlSA
https://ev.phncdn.com/videos/201911/28/264884532/240P_400K_264884532.mp4?validfrom=1577621517&[...]&hash=goqm8xnfG0iBP%2FpPktavpgwwTcc%3D
https://cv.phncdn.com/videos/201911/28/264884532/480P_600K_264884532.mp4?RGUDCeQ[...]Ch-o28g
https://ev.phncdn.com/videos/201911/28/264884532/480P_600K_264884532.mp4?validfrom=1577621517&[...]&hash=BGkOHmwf2fSurb4vzy4VZYQ2M4s%3D
https://cv.phncdn.com/videos/201911/28/264884532/720P_1500K_264884532.mp4?9qzEKSV[...]HHosis4
https://ev.phncdn.com/videos/201911/28/264884532/720P_1500K_264884532.mp4?validfrom=1577621517&[...]&hash=MlLcZR0es2RhmPDmWaWQ3k%2FcU6E%3D
https://cv.phncdn.com/videos/201911/28/264884532/1080P_4000K_264884532.mp4?w7RL7UG[...]ZQNJk0Q
https://ev.phncdn.com/videos/201911/28/264884532/1080P_4000K_264884532.mp4?validfrom=1577621517&[...]&hash=nev6iokXkRjOvWTVk9%2B6YnkUca8%3D

Pornhub genereert 2 type urls: één met een hele lange code als achtervoegsel en één met een achtervoegsel die begint met "validfrom" en eindigt met een hash.
Laad je deze url meerdere keren, dan genereert de website meestal of het ene type urls, of de andere, maar soms (door een foutje?) ook beide.

Met een group by verdwijnen de andere urls:

$ xidel -s ph5de04f60346c5.htm --xquery 'for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") group by $q:=extract($x,"quality_(\d+)p=",1) return string-join(extract($x,"\*/(\w+)",1,"*") ! substring-before(substring-after($x,.||"="),";"))'
https://cv.phncdn.com/videos/201911/28/264884532/240P_400K_264884532.mp4?9NTnorc[...]W3RUlSA
https://cv.phncdn.com/videos/201911/28/264884532/480P_600K_264884532.mp4?RGUDCeQ[...]Ch-o28g
https://cv.phncdn.com/videos/201911/28/264884532/720P_1500K_264884532.mp4?9qzEKSV[...]HHosis4
https://cv.phncdn.com/videos/201911/28/264884532/1080P_4000K_264884532.mp4?w7RL7UG[...]ZQNJk0Q

$ xidel -s ph5de04f60346c5.htm --xquery 'let $a:=json(//script/extract(.,"flashvars_\d+ = (.+);",1)[.]) return {"name":"Pornhub: "||$a/video_title,"date":replace($a/image_url,".+?(\d{4})(\d{2})/(\d{2}).+","$3-$2-$1"),"duration":format-time($a/video_duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[for $x at $i in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") ! replace(.,"&quot; \+ &quot;|&quot;","") group by $q:=extract($x,"quality_(\d+)p=",1) count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":("426x240","854x480","1280x720","1920x1080")[$i],"url":string-join(extract($x,"\*/(\w+)",1,"*") ! substring-before(substring-after($x,.||"="),";"))}]}'
{
  "name": "Pornhub: HOT MAID gets destroyed on the job - 4K",
  "date": "28-11-2019",
  "duration": "00:13:50",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "426x240",
      "url": "https://cv.phncdn.com/videos/201911/28/264884532/240P_400K_264884532.mp4?9NTnorc[...]W3RUlSA"
    },
    [...]
    {
      "id": "pg-4",
      "format": "mp4[h264+aac]",
      "resolution": "1920x1080",
      "url": "https://cv.phncdn.com/videos/201911/28/264884532/1080P_4000K_264884532.mp4?w7RL7UG[...]ZQNJk0Q"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  let $a:=json(//script/extract(.,"flashvars_\d+ = (.+);",1)[.]) return
  {
    "name":"Pornhub: "||$a/video_title,
    "date":replace(
      $a/image_url,
      ".+?(\d{4})(\d{2})/(\d{2}).+",
      "$3-$2-$1"
    ),
    "duration":format-time(
      $a/video_duration * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "formats":[
      for $x in //script/extract(.,"(var ra.+?quality.+?)flashvars",1,"*") !
      replace(.,"&quot; \+ &quot;|&quot;","")
      group by $q:=extract($x,"quality_(\d+)p=",1)
      count $i
      return {
        "id":"pg-"||$i,
        "format":"mp4[h264+aac]",
        "resolution":("426x240","854x480","1280x720","1920x1080")[$i],
        "url":string-join(
          extract($x,"\*/(\w+)",1,"*") ! substring-before(substring-after($x,.||"="),";")
        )
      }
    ]
  }
'

================================================================================================

[twitch]

https://www.twitch.tv/esl_csgo

$ xidel -s "https://www.twitch.tv/esl_csgo" -e '//script[contains(.,"Client-ID")]'
try{var defaultSpadeEndpoint="https://spade.twitch.tv/track"; [...] headers:{"Client-ID":"kimne78kx3ncx6brgo4mv6wki5h1ko", [...]

Deze client-id is altijd hetzelfde en is nodig voor het raadplegen van de Twitch API.

$ xidel -s -H "Client-ID: kimne78kx3ncx6brgo4mv6wki5h1ko" "http://api.twitch.tv/kraken/streams/esl_csgo?stream_type=all" -e '$json'
{
  "stream": {
    "_id": 1.75897697E8,
    "game": "Counter-Strike: Global Offensive",
    "viewers": 4457,
    "video_height": 1080,
    "average_fps": 60,
    "delay": 0,
    "created_at": "2019-11-16T08:42:23Z",
    "is_playlist": false,
    "stream_type": "live",
    "preview": {
      "small": "https://static-cdn.jtvnw.net/previews-ttv/live_user_esl_csgo-80x45.jpg",
      "medium": "https://static-cdn.jtvnw.net/previews-ttv/live_user_esl_csgo-320x180.jpg",
      "large": "https://static-cdn.jtvnw.net/previews-ttv/live_user_esl_csgo-640x360.jpg",
      "template": "https://static-cdn.jtvnw.net/previews-ttv/live_user_esl_csgo-{width}x{height}.jpg"
    },
    "channel": {
      "mature": false,
      "partner": true,
      "status": "RERUN: CS:GO - Envy vs. Singularity [Dust2] Map 2 - Group A - ESL NA Pro League Season 10",
      "broadcaster_language": "en",
      "broadcaster_software": "",
      "display_name": "ESL_CSGO",
      "game": "Counter-Strike: Global Offensive",
      "language": "en",
      "_id": 3.1239503E7,
      "name": "esl_csgo",
      "created_at": "2012-06-11T13:36:21Z",
      "updated_at": "2019-11-16T15:04:11Z",
      "delay": null,
      "logo": "https://static-cdn.jtvnw.net/jtv_user_pictures/1975b18f-fa7d-443f-b191-fba08f92f3a2-profile_image-300x300.jpeg",
      "banner": null,
      "video_banner": "https://static-cdn.jtvnw.net/jtv_user_pictures/7d7ef6e1-7db0-445c-8e8c-1c963afd4cd6-channel_offline_image-1920x1080.jpeg",
      "background": null,
      "profile_banner": "https://static-cdn.jtvnw.net/jtv_user_pictures/b94955f2-b9f6-4200-8179-3bdf5e032bdf-profile_banner-480.jpeg",
      "profile_banner_background_color": "#000000",
      "url": "https://www.twitch.tv/esl_csgo",
      "views": 4.06584807E8,
      "followers": 3.34725E6,
      "_links": {
        "self": "https://api.twitch.tv/kraken/channels/esl_csgo",
        "follows": "https://api.twitch.tv/kraken/channels/esl_csgo/follows",
        "commercial": "https://api.twitch.tv/kraken/channels/esl_csgo/commercial",
        "stream_key": "https://api.twitch.tv/kraken/channels/esl_csgo/stream_key",
        "chat": "https://api.twitch.tv/kraken/chat/esl_csgo",
        "features": "https://api.twitch.tv/kraken/channels/esl_csgo/features",
        "subscriptions": "https://api.twitch.tv/kraken/channels/esl_csgo/subscriptions",
        "editors": "https://api.twitch.tv/kraken/channels/esl_csgo/editors",
        "teams": "https://api.twitch.tv/kraken/channels/esl_csgo/teams",
        "videos": "https://api.twitch.tv/kraken/channels/esl_csgo/videos"
      }
    },
    "_links": {
      "self": "https://api.twitch.tv/kraken/streams/esl_csgo"
    }
  },
  "_links": {
    "self": "https://api.twitch.tv/kraken/streams/esl_csgo",
    "channel": "https://api.twitch.tv/kraken/channels/esl_csgo"
  }
}

$ xidel -s -H "Client-ID: kimne78kx3ncx6brgo4mv6wki5h1ko" "http://api.twitch.tv/api/channels/esl_csgo/access_token" -e '$json'
{
  "token": "{\"adblock\":false,\"authorization\":{\"forbidden\":false,\"reason\":\"\"},\"blackout_enabled\":false,\"channel\":\"esl_csgo\",\"channel_id\":31239503,\"chansub\":{\"restricted_bitrates\":[],\"view_until\":1924905600},\"ci_gb\":false,\"geoblock_reason\":\"\",\"device_id\":null,\"expires\":1573919018,\"game\":\"Counter-Strike: Global Offensive\",\"hide_ads\":false,\"https_required\":false,\"mature\":false,\"partner\":false,\"platform\":null,\"player_type\":null,\"private\":{\"allowed_to_view\":true},\"privileged\":false,\"server_ads\":true,\"show_ads\":true,\"subscriber\":false,\"turbo\":false,\"user_id\":null,\"user_ip\":\"x.x.x.x\",\"version\":2}",
  "sig": "63d1cdb256c5593de5cc287e1f6c9bbe876c255e",
  "mobile_restricted": false,
  "expires_at": "2019-11-16T15:43:38Z"
}

$ xidel -s -H "Client-ID: kimne78kx3ncx6brgo4mv6wki5h1ko" "http://api.twitch.tv/api/channels/esl_csgo/access_token" -e '$json/token'
{"adblock":false,"authorization":{"forbidden":false,"reason":""},"blackout_enabled":false,"channel":"esl_csgo","channel_id":31239503,"chansub":{"restricted_bitrates":[],"view_until":1924905600},"ci_gb":false,"geoblock_reason":"","device_id":null,"expires":1573919018,"game":"Counter-Strike: Global Offensive","hide_ads":false,"https_required":false,"mature":false,"partner":false,"platform":null,"player_type":null,"private":{"allowed_to_view":true},"privileged":false,"server_ads":true,"show_ads":true,"subscriber":false,"turbo":false,"user_id":null,"user_ip":"x.x.x.x","version":2}

$ xidel -s -H "Client-ID: kimne78kx3ncx6brgo4mv6wki5h1ko" "http://api.twitch.tv/api/channels/esl_csgo/access_token" -e '$json/uri-encode(token)'
%7B%22adblock%22%3Afalse%2C%22authorization%22%3A%7B%22forbidden%22%3Afalse%2C%22reason%22%3A%22%22%7D%2C%22blackout_enabled%22%3Afalse%2C%22channel%22%3A%22esl_csgo%22%2C%22channel_id%22%3A31239503%2C%22chansub%22%3A%7B%22restricted_bitrates%22%3A%5B%5D%2C%22view_until%22%3A1924905600%7D%2C%22ci_gb%22%3Afalse%2C%22geoblock_reason%22%3A%22%22%2C%22device_id%22%3Anull%2C%22expires%22%3A1573919018%2C%22game%22%3A%22Counter-Strike%3A%20Global%20Offensive%22%2C%22hide_ads%22%3Afalse%2C%22https_required%22%3Afalse%2C%22mature%22%3Afalse%2C%22partner%22%3Afalse%2C%22platform%22%3Anull%2C%22player_type%22%3Anull%2C%22private%22%3A%7B%22allowed_to_view%22%3Atrue%7D%2C%22privileged%22%3Afalse%2C%22server_ads%22%3Atrue%2C%22show_ads%22%3Atrue%2C%22subscriber%22%3Afalse%2C%22turbo%22%3Afalse%2C%22user_id%22%3Anull%2C%22user_ip%22%3A%22x.x.x.x%22%2C%22version%22%3A2%7D

Voor de "usher.ttvnw.net"-url-parameters zie https://github.com/ytdl-org/youtube-dl/blob/master/youtube_dl/extractor/twitch.py.

$ xidel -s --module=xivid.xqm -e 'let $a:="kimne78kx3ncx6brgo4mv6wki5h1ko",$b:=x:request({"headers":"Client-ID: "||$a,"url":"http://api.twitch.tv/kraken/streams/esl_csgo?stream_type=all"})/json,$c:=x:request({"headers":"Client-ID: "||$a,"url":"http://api.twitch.tv/api/channels/esl_csgo/access_token"})/json return {"name":"Twitch: "||$b//status,"date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(concat("https://usher.ttvnw.net/api/channel/hls/esl_csgo.m3u8?allow_source=true&allow_audio_only=true&allow_spectre=true&p=",random-seed(),random(1000000),"&player=twitchweb&segment_preference=4&sig=",$c/sig,"&token=",uri-encode($c/token)))}'
{
  "name": "Twitch: RERUN: CS:GO - Envy vs. Singularity [Nuke] Map 3 - Group A - ESL NA Pro League Season 10",
  "date": "16-11-2019",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://usher.ttvnw.net/api/channel/hls/esl_csgo.m3u8?allow_source=true&allow_audio_only=true&allow_spectre=true&p=791163&player=twitchweb&segment_preference=4&sig=3e44e827a9b30f48f6cf7c56d16871b563fc57ea&token=%7B%22adblock%22%3Afalse%2C%22authorization%22%3A%7B%22forbidden%22%3Afalse%2C%22reason%22%3A%22%22%7D%2C%22blackout_enabled%22%3Afalse%2C%22channel%22%3A%22esl_csgo%22%2C%22channel_id%22%3A31239503%2C%22chansub%22%3A%7B%22restricted_bitrates%22%3A%5B%5D%2C%22view_until%22%3A1924905600%7D%2C%22ci_gb%22%3Afalse%2C%22geoblock_reason%22%3A%22%22%2C%22device_id%22%3Anull%2C%22expires%22%3A1573919160%2C%22game%22%3A%22Counter-Strike%3A%20Global%20Offensive%22%2C%22hide_ads%22%3Afalse%2C%22https_required%22%3Afalse%2C%22mature%22%3Afalse%2C%22partner%22%3Afalse%2C%22platform%22%3Anull%2C%22player_type%22%3Anull%2C%22private%22%3A%7B%22allowed_to_view%22%3Atrue%7D%2C%22privileged%22%3Afalse%2C%22server_ads%22%3Atrue%2C%22show_ads%22%3Atrue%2C%22subscriber%22%3Afalse%2C%22turbo%22%3Afalse%2C%22user_id%22%3Anull%2C%22user_ip%22%3A%22x.x.x.x%22%2C%22version%22%3A2%7D"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "162kbps",
      "url": "https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/CrADNZcDLYk6Q8DExljI2iBNvfbxM6k0BvBzwP4D4ktYkcNdsheMrLp5VBB96jqR3JHF9iAxdFV6zu3LLRz3xFdTk4jYHbpoObqvJ9DKdUTVOVwL5UhSCBlOXH3ztCcx_X-o5zhBlqDsvbAbmicSTdU3QvGyHIOhi8-40K2fm9aMflE6r89zN8_hA7GojPUMbkuqIeywyWfHbPPZdpSxVgEKoLdZ598anCkpjZg3__m0jRAhhf1buGi8WVIBhwlyiPMw4_OT1ZXauAivEakpZv5Zj1WWut1e5cYjSHU4H9nqrmPrPkwYSkkOqT5kgINkSma1js6IH19uH2ai7afXownprgM0Woz957k7-PFwtWYfnmVCsBuBIdvrRfPtAJwYjHw5o790tps15j3OdZgPSx1IauubHr6FopT0tlNXxMZzLL1-oBZXof7oPePnAuca6I4m3njo0WsBqqxBNIgh4UWW5TpW_Fv7A0dEOhQTBNgXp-Cs0Dq9VA7VNzWjqCsi1swhZZ43BkU95tWIQBHPIom3tN0DhezHuPuCx3Ao2NaKvdCMao8DOhbFr64y7iX4FfByEhBZZPZj9whZCoc9qcMo8p-aGgyc-QXwog0DIwImRc8.m3u8"
    },
    [...]
    {
      "id": "hls-7",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080@60fps",
      "bitrate": "6922kbps",
      "url": "https://video-weaver.ams02.hls.ttvnw.net/v1/playlist/CqoDjf3E1CJyy1GRW5wPxGtHnB-2ENDAfkHOr23_CEH9Dq6-eBFRrn58oJONUcdjpxkBEdklu7sKzwqzra924axTVkg3itRufOaN-zA6Bay42TADnRCosQYMbzXkd6kNJXP26r3gKEXYmnVKHd_R8bz29v6lF31FHSVBYe5BlSqZcedu3STjG9CTRBp0KTMR5jGtIK7tFq4t7LO9r5Xr1hDZti06FJt4QYVpffpFnDqt16E5pTZmHhC81Q8ZV91vKT-LunuROiWk1PEJDfGOO0BCsgJUgCGOboEWVtWG9unP5FbT22jLNqyuCrnSw1sDZ4ptcyxgC8WXpMpBI3IjoQaBTCWVry_d5IUflok3iP2-4Q9YkIboWwR2t2QJNrp3ikrCWPXYuQZCc8CJV_QXU5c6l0AbtW2LlY9TVcBldDj8X0dkrCyVe4Z7bQBdJSa9agViWxXjySefE4A_IL4GluUHYhqktVeGLZZtnJ90sLwBsdb3eEOaN7_zCnjodDBYRKv8Nsoc3vP398VpZpWkySDtlZ1pU1KA4SK2hodVLirOhlZCCC_UmJ1nkFyoEhDarIRiInrISjG-_RWMIX7aGgzliR1iod2NClS6zlQ.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.twitch.tv/hktanaka/video/218588783

$ xidel -s --xquery 'declare variable $id:=extract("https://www.twitch.tv/hktanaka/video/218588783",".+/(.+)",1); declare variable $cid:="kimne78kx3ncx6brgo4mv6wki5h1ko"; if ($id castable as integer) then x:request({"headers":"Client-ID: "||$cid,"url":"https://api.twitch.tv/kraken/videos/"||$id})/json else x:request({"headers":"Client-ID: "||$cid,"url":concat("http://api.twitch.tv/kraken/streams/",$id,"?stream_type=all")})/json'
{
  "title": "Tactical Ops. Rapidwaters on sg public server",
  "description": "",
  "description_html": "",
  "broadcast_id": 1,
  "broadcast_type": "upload",
  "status": "recorded",
  "language": "en",
  "tag_list": "",
  "views": 108,
  "created_at": "2018-01-14T19:06:51Z",
  "published_at": "2018-01-14T20:36:07Z",
  "url": "https://www.twitch.tv/videos/218588783",
  "_id": "v218588783",
  "recorded_at": "2018-01-14T19:06:51Z",
  "game": "Tactical Ops: Assault on Terror",
  "length": 1373,
  "preview": "https://static-cdn.jtvnw.net/s3_vods/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/thumb/index-0000000000-320x240.jpg",
  "animated_preview_url": "https://vod-storyboards.twitch.tv/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/storyboards/218588783-strip-0.jpg",
  "thumbnails": [
    {
      "type": "generated",
      "url": "https://static-cdn.jtvnw.net/s3_vods/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/thumb/index-0000000000-320x240.jpg"
    },
    {
      "type": "generated",
      "url": "https://static-cdn.jtvnw.net/s3_vods/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/thumb/index-0000000003-320x240.jpg"
    },
    {
      "type": "generated",
      "url": "https://static-cdn.jtvnw.net/s3_vods/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/thumb/index-0000000006-320x240.jpg"
    },
    {
      "type": "generated",
      "url": "https://static-cdn.jtvnw.net/s3_vods/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/thumb/index-0000000009-320x240.jpg"
    }
  ],
  "fps": {
    "1080p60": 59.99985440462411,
    "144p30": 30.000655179191508,
    "360p30": 30.000655179191508,
    "480p30": 30.000655179191508,
    "720p30": 30.000655179191508,
    "720p60": 59.99985440462411
  },
  "resolutions": {
    "1080p60": "1920x1080",
    "144p30": "256x144",
    "360p30": "640x360",
    "480p30": "852x480",
    "720p30": "1280x720",
    "720p60": "1280x720"
  },
  "channel": {
    "name": "hktanaka",
    "display_name": "hkTaNaKa"
  },
  "_links": {
    "self": "https://api.twitch.tv/kraken/videos/v218588783",
    "channel": "https://api.twitch.tv/kraken/channels/hktanaka"
  }
}

$ xidel -s --xquery 'declare variable $id:=extract("https://www.twitch.tv/hktanaka/video/218588783",".+/(.+)",1); declare variable $cid:="kimne78kx3ncx6brgo4mv6wki5h1ko"; if ($id castable as integer) then x:request({"headers":"Client-ID: "||$cid,"url":concat("http://api.twitch.tv/api/vods/",$id,"/access_token")})/json else x:request({"headers":"Client-ID: "||$cid,"url":concat("http://api.twitch.tv/api/channels/",$id,"/access_token")})/json'
{
  "token": "{\"authorization\":{\"forbidden\":false,\"reason\":\"\"},\"chansub\":{\"restricted_bitrates\":[]},\"device_id\":null,\"expires\":1573415548,\"https_required\":false,\"privileged\":false,\"user_id\":null,\"version\":2,\"vod_id\":218588783}",
  "sig": "07e3c14f94423f6f7bee77e84b3df1446c5b82f0",
  "expires_at": "2019-11-10T19:52:28Z"
}

$ xidel -s --module=xivid.xqm --xquery 'declare variable $id:=extract("https://www.twitch.tv/hktanaka/video/218588783",".+/(.+)",1); declare variable $cid:="kimne78kx3ncx6brgo4mv6wki5h1ko"; if ($id castable as integer) then let $a:=x:request({"headers":"Client-ID: "||$cid,"url":"https://api.twitch.tv/kraken/videos/"||$id})/json,$b:=x:request({"headers":"Client-ID: "||$cid,"url":concat("http://api.twitch.tv/api/vods/",$id,"/access_token")})/json return {"name":"Twitch: "||$a/title,"date":format-date(dateTime($a/published_at),"[D01]-[M01]-[Y]"),"duration":format-time($a/length * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json(concat("https://usher.ttvnw.net/vod/",$id,".m3u8?allow_source=true&amp;allow_audio_only=true&amp;allow_spectre=true&amp;player=twitchweb&amp;sig=",$b/sig,"&amp;token=",uri-encode($b/token)))} else let $a:=x:request({"headers":"Client-ID: "||$cid,"url":concat("http://api.twitch.tv/kraken/streams/",$id,"?stream_type=all")})/json,$b:=x:request({"headers":"Client-ID: "||$cid,"url":concat("http://api.twitch.tv/api/channels/",$id,"/access_token")})/json return {"name":"Twitch: "||$a//status,"date":format-date(current-date(),"[D01]-[M01]-[Y]"),"formats":xivid:m3u8-to-json(concat("https://usher.ttvnw.net/api/channel/hls/",$id,".m3u8?allow_source=true&amp;allow_audio_only=true&amp;allow_spectre=true&amp;p=",random-seed(),random(1000000),"&amp;player=twitchweb&amp;segment_preference=4&amp;sig=",$b/sig,"&amp;token=",uri-encode($b/token)))}'
{
  "name": "Twitch: Tactical Ops. Rapidwaters on sg public server",
  "date": "14-01-2018",
  "duration": "00:22:53",
  "formats": [
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://usher.ttvnw.net/vod/218588783.m3u8?allow_source=true&allow_audio_only=true&allow_spectre=true&player=twitchweb&sig=2bf22c1068454fd2a92056bc6b9571b1388bcff0&token=%7B%22authorization%22%3A%7B%22forbidden%22%3Afalse%2C%22reason%22%3A%22%22%7D%2C%22chansub%22%3A%7B%22restricted_bitrates%22%3A%5B%5D%7D%2C%22device_id%22%3Anull%2C%22expires%22%3A1577022804%2C%22https_required%22%3Afalse%2C%22privileged%22%3Afalse%2C%22user_id%22%3Anull%2C%22version%22%3A2%2C%22vod_id%22%3A218588783%7D"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "143kbps",
      "url": "https://vod-metro.twitch.tv/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/audio_only/index-dvr.m3u8"
    },
    [...]
    {
      "id": "hls-7",
      "format": "m3u8[h264+aac]",
      "resolution": "1920x1080@60fps",
      "bitrate": "5117kbps",
      "url": "https://vod-metro.twitch.tv/nltanaka/218588783/9cf22346-f095-490b-b0cb-a8d02e668000/1080p60/index-dvr.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  declare variable $id:=extract("https://www.twitch.tv/hktanaka/video/218588783",".+/(.+)",1);
  declare variable $cid:="kimne78kx3ncx6brgo4mv6wki5h1ko";
  if ($id castable as integer) then
    let $a:=x:request({
          "headers":"Client-ID: "||$cid,
          "url":"https://api.twitch.tv/kraken/videos/"||$id
        })/json,
        $b:=x:request({
          "headers":"Client-ID: "||$cid,
          "url":concat("http://api.twitch.tv/api/vods/",$id,"/access_token")
        })/json
    return {
      "name":"Twitch: "||$a/title,
      "date":format-date(
        dateTime($a/published_at),
        "[D01]-[M01]-[Y]"
      ),
      "duration":format-time(
        $a/length * duration("PT1S"),
        "[H01]:[m01]:[s01]"
      ),
      "formats":xivid:m3u8-to-json(
        concat(
          "https://usher.ttvnw.net/vod/",
          $id,
          ".m3u8?allow_source=true&amp;allow_audio_only=true&amp;allow_spectre=true&amp;player=twitchweb&amp;sig=",
          $b/sig,
          "&amp;token=",
          uri-encode($b/token)
        )
      )
    }
  else
    let $a:=x:request({
          "headers":"Client-ID: "||$cid,
          "url":concat("http://api.twitch.tv/kraken/streams/",$id,"?stream_type=all")
        })/json,
        $b:=x:request({
          "headers":"Client-ID: "||$cid,
          "url":concat("http://api.twitch.tv/api/channels/",$id,"/access_token")
        })/json
    return {
      "name":"Twitch: "||$a//status,
      "date":format-date(current-date(),"[D01]-[M01]-[Y]"),
      "formats":xivid:m3u8-to-json(
        concat(
          "https://usher.ttvnw.net/api/channel/hls/",
          $id,
          ".m3u8?allow_source=true&amp;allow_audio_only=true&amp;allow_spectre=true&amp;p=",
          random-seed(),
          random(1000000),
          "&amp;player=twitchweb&amp;segment_preference=4&amp;sig=",
          $b/sig,
          "&amp;token=",
          uri-encode($b/token)
        )
      )
    }
'

================================================================================================

[autojunk]

https://www.autojunk.nl/2018/10/ford-fiesta-st-interview

$ xidel -s "https://www.autojunk.nl/2018/10/ford-fiesta-st-interview" -e '//div[@id="playerWrapper"]/script[1]/extract(.,"clipData.assets = (.+\]);",1,"s")'
[{
              id: 1, // unique asset ID
              mediatype: "MP4_HD", // HD if higher then 720p, MP4_MAIN otherwise.
              src: "https://static.autojunk.nl/flv/2018/1030/122604_720p.mp4", // asset URL
              width: "1280", // video width
              height: "720", // video height, used to display the asset name in the quality selector (rounded)
              bandwidth: "2000" // asset bitrate in kbps, used to sort the assets from high to low in the quality selector in the player and pick a suitable asset for the user's connection speed.
          },
          {
              id: 2,
              mediatype: "MP4_MAIN",
              src: "https://static.autojunk.nl/flv/2018/1030/122604.mp4",
              width: "640",
              height: "360",
              bandwidth: "1200",
          }]

$ xidel -s "https://www.autojunk.nl/2018/10/ford-fiesta-st-interview" -e '//div[@id="playerWrapper"]/script[1]/json(replace(extract(.,"clipData.assets = (.+\]);",1,"s")," //.+",""))'
[
  {
    "id": 1,
    "mediatype": "MP4_HD",
    "src": "https://static.autojunk.nl/flv/2018/1030/122604_720p.mp4",
    "width": "1280",
    "height": "720",
    "bandwidth": "2000"
  },
  {
    "id": 2,
    "mediatype": "MP4_MAIN",
    "src": "https://static.autojunk.nl/flv/2018/1030/122604.mp4",
    "width": "640",
    "height": "360",
    "bandwidth": "1200"
  }
]

$ xidel -s aj_ford-fiesta-st-interview.htm --xquery 'let $a:=//div[@id="playerWrapper"]/script[1] return {"name":"Autojunk: "||extract($a,"clipData.title=&quot;(.+)&quot;",1),"date":extract(//span[@class="posted"],"([\d-]+)",1),"duration":format-time(extract($a,"clipData\[&quot;length&quot;\].+?(\d+)",1) * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[for $x at $i in json(replace(extract($a,"clipData.assets = (.+\]);",1,"s")," //.+",""))() order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":$x/src}]}'
{
  "name": "Autojunk: Ford Fiesta ST interview",
  "date": "30-10-2018",
  "duration": "00:11:30",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1200kbps",
      "url": "https://static.autojunk.nl/flv/2018/1030/122604.mp4"
    },
    {
      "id": "pg-2",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2000kbps",
      "url": "https://static.autojunk.nl/flv/2018/1030/122604_720p.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

http://www.autojunk.nl/2009/11/peugeot-206-rally-crash

$ xidel -s "http://www.autojunk.nl/2009/11/peugeot-206-rally-crash" -e '//div[@id="playerWrapper"]/script[1]/extract(.,"clipData.assets = (.+\]);",1,"s")'
[{
              id: 1, // unique asset ID
              mediatype: "MP4_HD", // HD if higher then 720p, MP4_MAIN otherwise.
              src: "https://static.autojunk.nl/flv/2009/1115/135833.mp4", // asset URL
              width: "1280", // video width
              height: "720", // video height, used to display the asset name in the quality selector (rounded)
              bandwidth: "2000" // asset bitrate in kbps, used to sort the assets from high to low in the quality selector in the player and pick a suitable asset for the user's connection speed.
          },
          {
              id: 2,
              mediatype: "MP4_MAIN",
              src: "",
              width: "640",
              height: "360",
              bandwidth: "1200",
          }]

$ xidel -s "http://www.autojunk.nl/2009/11/peugeot-206-rally-crash" --xquery 'let $a:=//div[@id="playerWrapper"]/script[1] return {"name":"Autojunk: "||extract($a,"clipData.title=&quot;(.+)&quot;",1),"date":extract(//span[@class="posted"],"([\d-]+)",1),"duration":format-time(extract($a,"clipData\[&quot;length&quot;\].+?(\d+)",1) * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[for $x at $i in json(replace(extract($a,"clipData.assets = (.+\]);",1,"s")," //.+",""))()[src] order by $x/bandwidth count $i return {"id":"pg-"||$i,"format":"mp4[h264+aac]","resolution":concat($x/width,"x",$x/height),"bitrate":$x/bandwidth||"kbps","url":$x/src}]}'
{
  "name": "Autojunk: Peugeot 206 rally crash",
  "date": "15-11-2009",
  "duration": null,
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2000kbps",
      "url": "https://static.autojunk.nl/flv/2009/1115/135833.mp4"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  let $a:=//div[@id="playerWrapper"]/script[1] return {
    "name":"Autojunk: "||extract($a,"clipData.title=&quot;(.+)&quot;",1),
    "date":extract(//span[@class="posted"],"([\d-]+)",1),
    "duration":format-time(
      extract($a,"clipData\[&quot;length&quot;\].+?(\d+)",1) * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "formats":[
      for $x at $i in json(
        replace(
          extract($a,"clipData.assets = (.+\]);",1,"s"),
          " //.+",
          ""
        )
      )()[src]
      order by $x/bandwidth
      count $i
      return {
        "id":"pg-"||$i,
        "format":"mp4[h264+aac]",
        "resolution":concat($x/width,"x",$x/height),
        "bitrate":$x/bandwidth||"kbps",
        "url":$x/src
      }
    ]
  }
'

================================================================================================

[dailymotion]

https://www.dailymotion.com/video/x5aa1uc

$ xidel -s "https://www.dailymotion.com/video/x5aa1uc" -e 'json(//script/extract(.,"PLAYER_CONFIG__ = (.+);",1)[.])/context/metadata_template_url'
https://www.dailymotion.com/player/metadata/video/:videoId?embedder=:embedder&referer=:referer&app=com.dailymotion.neon&locale=nl&client_type=website

$ xidel -se 'extract("https://www.dailymotion.com/video/x5aa1uc",".+/(.+)",1)'
x5aa1uc

$ xidel -s --module=xivid.xqm "https://www.dailymotion.com/player/metadata/video/x5aa1uc" -e '$json/{"name":"Dailymotion: "||title,"date":format-date(created_time * duration("PT1S") + implicit-timezone() + date("1970-01-01"),"[D01]-[M01]-[Y]"),"duration":format-time(duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":xivid:m3u8-to-json(qualities//url)}'
{
  "name": "Dailymotion: PENOZA Seizoen 3 aflevering 9 (S03E09) [HD]",
  "date": "01-02-2017",
  "duration": "00:43:44",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp4[h264+aac]",
      "resolution": "192x112",
      "bitrate": "105kbps",
      "url": "https://proxy-019.dc3.dailymotion.com/sec(JNfjoSit1pis0fshbrs9gqqK-lmDY1uHzpm8ezDICxXp749LCpknL-XXJHDovcSMRSo3CPCg5B9ZkLx6Gk8N_Q)/video/889/595/319595988_mp4_h264_aac_l2_1.mp4"
    },
    [...]
    {
      "id": "pg-4",
      "format": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "836kbps",
      "url": "https://proxy-019.dc3.dailymotion.com/sec(RdkuEEV9zFs2hDWhHYjSGdmjL6SOmuJ_UhY-KMiLy6IVrhCzqFeGFakxympqZyoOywDtFB9DSY-L8d6RZxR8cg)/video/889/595/319595988_mp4_h264_aac_hq_1.mp4"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://www.dailymotion.com/cdn/manifest/video/x5aa1uc.m3u8?sec=eyMNx4dh_i1GpAS8KZdvuHFtoC6q42SoOn8LyvPeCydF5_ae0n5LyxXZ7lsIAuc0"
    },
    {
      "id": "hls-1",
      "format": "m3u8[h264+aac]",
      "resolution": "192x112",
      "bitrate": "105kbps",
      "url": "https://proxy-019.dc3.dailymotion.com/sec(ODTxNQv7_D3l1m3AnKDufITG2YXRnbz60ZJPFHq_CnccA167riXfoN-CPEE4bS0JCDEq1B4PEDFIOKxIikmmrllatU6D0NM_10sBymwC4fQ)/video/889/595/319595988_mp4_h264_aac_l2_1.m3u8"
    },
    [...]
    {
      "id": "hls-4",
      "format": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "836kbps",
      "url": "https://proxy-019.dc3.dailymotion.com/sec(ODTxNQv7_D3l1m3AnKDufITG2YXRnbz60ZJPFHq_CneU7hSKuFpu7niJlAz2vPTuGulbD_3cshknIU8Np_q-HLURQfnkbv_LCXGVkAYDDvk)/video/889/595/319595988_mp4_h264_aac_hq_1.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

-e '
  $json/{
    "name":"Dailymotion: "||title,
    "date":format-date(
      created_time * duration("PT1S") +
      implicit-timezone() + date("1970-01-01"),
      "[D01]-[M01]-[Y]"
    ),
    "duration":format-time(
      duration * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "formats":xivid:m3u8-to-json(qualities//url)
  }
'

================================================================================================

[mixcloud]

$ url=https://www.mixcloud.com/EricVanKleef/clubbin-12-wildfm-30-mei-2020

$ xidel -se 'tokenize(substring-after("'$url'","mixcloud.com/"),"/")[.]'
EricVanKleef
clubbin-12-wildfm-30-mei-2020

$ xidel -s "$url" -e '$headers[contains(.,"csrftoken")]'
set-cookie: csrftoken=DByTziojuvWczCcmPzUMJUx83hXB5s9OpRhhLmNZ6rpF3fedGCIA0ZmUX8CDdoug; Domain=.mixcloud.com; expires=Sun, 11-Jul-2021 09:37:49 GMT; Max-Age=31449600; Path=/; secure

$ xidel -s "$url" -e 'substring-before(substring-after($headers[contains(.,"csrftoken")],"="),";")'
DByTziojuvWczCcmPzUMJUx83hXB5s9OpRhhLmNZ6rpF3fedGCIA0ZmUX8CDdoug

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

JSON serialisatie in alle 4 vormen (voor Linux en Windows) incl. benodigde escape-characters:

$ xidel -s \
-e '
  let $a:=tokenize("'$url'","/")[position() gt last() - 2] return (
    concat(
      "{""query"": ""{cloudcastLookup(lookup:{username:\""",
      $a[1],
      "\"",slug:\""",
      $a[2],
      "\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}"
    ),
    serialize-json(
      {
        "query":concat(
          "{cloudcastLookup(lookup:{username:""",
          $a[1],
          """,slug:""",
          $a[2],
          """}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}"
        )
      }
    )
  )
' \
-e "
  let \$a:=tokenize('$url','/')[position() gt last() - 2] return (
    concat(
      '{\"query\": \"{cloudcastLookup(lookup:{username:\\\"',
      \$a[1],
      '\\\",slug:\\\"',
      \$a[2],
      '\\\"}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}\"}'
    ),
    serialize-json(
      {
        'query':concat(
          '{cloudcastLookup(lookup:{username:\"',
          \$a[1],
          '\",slug:\"',
          \$a[2],
          '\"}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}'
        )
      }
    )
  )
"
{"query": "{cloudcastLookup(lookup:{username:\"EricVanKleef\",slug:\"clubbin-12-wildfm-30-mei-2020\"}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}"}
[...] # en nog 3x hetzelfde.

$ csrf=$(xidel -s "$url" -e 'substring-before(substring-after($headers[contains(.,"csrftoken")],"="),";")')

$ xidel -s -H "Content-Type: application/json" -H "Referer: $url" -H "X-CSRFToken: $csrf" -H "Cookie: csrftoken=$csrf" -d '{let $us:=tokenize(substring-after("'$url'","mixcloud.com/"),"/") return concat("{""query"":""{cloudcastLookup(lookup:{username:\""",$us[1],"\"",slug:\""",$us[2],"\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}")}' https://www.mixcloud.com/graphql -e '$json//cloudcastLookup'
{
  "name": "CLUBBIN #12 @WILDFM 30 MEI 2020.",
  "owner": {
    "displayName": "Eric van Kleef",
    "url": "https://www.mixcloud.com/EricVanKleef/",
    "username": "EricVanKleef"
  },
  "publishDate": "2020-05-31T10:55:53+00:00",
  "audioLength": 5842,
  "streamInfo": {
    "hlsUrl": "ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=",
    "url": "ITItPyZtbmEnIDogID9le305OiwsKyohNG8qKylgPSo3MT0yYS9gLHAnfXl5Ynl3c2N+eidmcD8sNnp1fWdhZXEgMzJka2djYWJ/cTFncXAnJyx/K21qImMvczwoI3sUBX90KjkhJgFlEiUcPBAvMxkfBTc/"
  }
}
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
-d '{let $us:=tokenize(substring-after("'$url'","mixcloud.com/"),"/") return concat("{""query"":""{cloudcastLookup(lookup:{username:\""",$us[1],"\"",slug:\""",$us[2],"\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}")}'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
-d '{let $us:=tokenize(substring-after("'$url'","mixcloud.com/"),"/") return serialize-json({"query":concat("{cloudcastLookup(lookup:{username:""",$us[1],""",slug:""",$us[2],"""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}")})}'
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
-d "{let \$us:=tokenize(substring-after('$url','mixcloud.com/'),'/') return concat('{\"query\":\"{cloudcastLookup(lookup:{username:\\\"',\$us[1],'\\\",slug:\\\"',\$us[2],'\\\"}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}\"}')}"
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
-d "{let \$us:=tokenize(substring-after('$url','mixcloud.com/'),'/') return serialize-json({'query':concat('{cloudcastLookup(lookup:{username:\"',\$us[1],'\",slug:\"',\$us[2],'\"}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}')})}"
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s "$url" -e 'let $csrf:=substring-before(substring-after($headers[contains(.,"csrftoken")],"="),";"),$us:=tokenize(substring-after("'$url'","mixcloud.com/"),"/") return x:request({"headers":("Content-Type: application/json","Referer: '$url'","X-CSRFToken: "||$csrf,"Cookie: csrftoken="||$csrf),"post":concat("{""query"":""{cloudcastLookup(lookup:{username:\""",$us[1],"\"",slug:\""",$us[2],"\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}"),"url":"https://www.mixcloud.com/graphql"})/json//cloudcastLookup'
{
  "name": "CLUBBIN #12 @WILDFM 30 MEI 2020.",
  "owner": {
    "displayName": "Eric van Kleef",
    "url": "https://www.mixcloud.com/EricVanKleef/",
    "username": "EricVanKleef"
  },
  "publishDate": "2020-05-31T10:55:53+00:00",
  "audioLength": 5842,
  "streamInfo": {
    "hlsUrl": "ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=",
    "url": "ITItPyZtbmEnIDogID9le305OiwsKyohNG8qKylgPSo3MT0yYS9gLHAnfXl5Ynl3c2N+eidmcD8sNnp1fWdhZXEgMzJka2djYWJ/cTFncXAnJyx/K21qImMvczwoI3sUBX90KjkhJgFlEiUcPBAvMxkfBTc/"
  }
}
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
"post":concat("{""query"":""{cloudcastLookup(lookup:{username:\""",$us[1],"\"",slug:\""",$us[2],"\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}")
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
"post":serialize-json({"query":concat("{cloudcastLookup(lookup:{username:""",$us[1],""",slug:""",$us[2],"""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}")})

----------------------------------------------------------------

Windows:

SET url=https://www.mixcloud.com/EricVanKleef/clubbin-12-wildfm-30-mei-2020
FOR /F "delims=" %A IN ('xidel -s "%url%" -e "substring-before(substring-after($headers[contains(.,'csrftoken')],'='),';')"') DO SET csrf=%A

xidel -s -H "Content-Type: application/json" -H "Referer: %url%" -H "X-CSRFToken: %csrf%" -H "Cookie: csrftoken=%csrf%" -d "{let $us:=tokenize(substring-after('%url%','mixcloud.com/'),'/') return concat('{\"query\":\"{cloudcastLookup(lookup:{username:\\\"',$us[1],'\\\",slug:\\\"',$us[2],'\\\"}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}\"}')}" https://www.mixcloud.com/graphql -e "$json//cloudcastLookup"

xidel -s "%url%" -e "let $csrf:=substring-before(substring-after($headers[contains(.,'csrftoken')],'='),';'),$us:=tokenize(substring-after('%url%','mixcloud.com/'),'/') return x:request({'headers':('Content-Type: application/json','Referer: %url%','X-CSRFToken: '||$csrf,'Cookie: csrftoken='||$csrf),'post':concat('{\"query\":\"{cloudcastLookup(lookup:{username:\\\"',$us[1],'\\\",slug:\\\"',$us[2],'\\\"}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}\"}'),'url':'https://www.mixcloud.com/graphql'})/json/data/cloudcastLookup"

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

Decryptie:

$ xidel -se 'binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))'
!2-?&mna5!,,.cfg>=+7#(00~"&)k<+,!6*x& <ntib`|b*wu*,6i}ujzxc /2ypvqgyqg1ddv$&7a%pj){/`=*+26b"r1~

De decryptie-sleutel is "IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD". De base64-gedecodeerde url...
!2-?&mna5!,,.cfg>=+7#(00~"&)k<+,!6*x& <ntib`|b*wu*,6i}ujzxc /2ypvqgyqg1ddv$&7a%pj){/`=*+26b"r1~
...moet ontsleuteld worden met...
IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUDIFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADF
...waarbij de decryptie-sleutel dus herhaald wordt tot de lengte van de base64-gedecodeerde url.
Vervolgens moet van ieder teken de "binarywise exclusive-or" van de corresponderende codepoints berekend worden.
x:cps("!") --> 33 en x:integer-to-base(33,2) -->  100001
x:cps("I") --> 73 en x:integer-to-base(73,2) --> 1001001
0100001 XOR 1001001 = 1101000
x:integer(1101000,2) --> 104 en x:cps(104) --> "h"

----------------------------------------------------------------

- Substrings

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=")) return (string-length($url),string-length($decryption_key),ceiling(string-length($url) div string-length($decryption_key)))'
95
53
2   # ceiling(95 div 53) --> ceiling(1.79245) = 2. $decryption_key moet dus minimaal 2x herhaald worden om de lengte van $url te evenaren.

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=")) return ($url,string-join((1 to ceiling(string-length($url) div string-length($decryption_key))) ! $decryption_key))'
!2-?&mna5!,,.cfg>=+7#(00~"&)k<+,!6*x& <ntib`|b*wu*,6i}ujzxc /2ypvqgyqg1ddv$&7a%pj){/`=*+26b"r1~
IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUDIFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=")) return ($url,substring(string-join((1 to ceiling(string-length($url) div string-length($decryption_key))) ! $decryption_key),1,string-length($url)))'
!2-?&mna5!,,.cfg>=+7#(00~"&)k<+,!6*x& <ntib`|b*wu*,6i}ujzxc /2ypvqgyqg1ddv$&7a%pj){/`=*+26b"r1~
IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUDIFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADF

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=")),$key:=substring(string-join((1 to ceiling(string-length($url) div string-length($decryption_key))) ! $decryption_key),1,string-length($url)) return for $x in 1 to string-length($url) return join((substring($url,$x,1),substring($key,$x,1)))'
! I
2 F
- Y
? O
& U
[...]

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=")),$key:=substring(string-join((1 to ceiling(string-length($url) div string-length($decryption_key))) ! $decryption_key),1,string-length($url)) return for $x in 1 to string-length($url) return join((x:cps(substring($url,$x,1)),x:cps(substring($key,$x,1))))'
33 73
50 70
45 89
63 79
38 85
[...]

$ xidel -s --module=xivid.xqm -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=")),$key:=substring(string-join((1 to ceiling(string-length($url) div string-length($decryption_key))) ! $decryption_key),1,string-length($url)) return string-join(x:cps(for $x in 1 to string-length($url) return xivid:bin-xor(x:cps(substring($url,$x,1)),x:cps(substring($key,$x,1)))))'
https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/index.m3u8

$ time xidel -s --module=xivid.xqm -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=")),$key:=substring(string-join((1 to ceiling(string-length($url) div string-length($decryption_key))) ! $decryption_key),1,string-length($url)) return ((1 to 1000) ! string-join(x:cps(for $x in 1 to string-length($url) return xivid:bin-xor(x:cps(substring($url,$x,1)),x:cps(substring($key,$x,1))))))[1]'
https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/index.m3u8

real    0m25.250s
user    0m0.031s
sys     0m0.000s

----------------------------------------------------------------

- Reeksen (de youtube-dl manier)

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))),$key:=x:cps($decryption_key) return string-join(x:cps(for $x at $i in $url return $key[$i mod count($key)]))'
IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUIFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADF
                                                    ^ # "D" mist en lengte is 94 i.p.v. 95.

Dit komt omdat in XPath/XQuery de index van een reeks bij positie 1 begint i.p.v. 0.

$ xidel -se '    $ xidel -se '
   1 mod 53,        (1 - 1) mod 53 + 1,
  52 mod 53,       (52 - 1) mod 53 + 1,
  53 mod 53,       (53 - 1) mod 53 + 1,
  54 mod 53        (54 - 1) mod 53 + 1
'                '
1                1
52               52
0                53
1                1

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))),$key:=x:cps($decryption_key) return string-join(x:cps(for $x at $i in $url return $key[($i - 1) mod count($key) + 1]))'
IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUDIFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADF
                                                     ^ # Eindigt goed en herhaalt zichzelf tot de juiste lengte.

$ xidel -s --module=xivid.xqm -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))),$key:=x:cps($decryption_key) return string-join(x:cps(for $x at $i in $url return xivid:bin-xor($x,$key[($i - 1) mod count($key) + 1])))'
https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/index.m3u8

$ time xidel -s --module=xivid.xqm -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))),$key:=x:cps($decryption_key) return ((1 to 1000) ! string-join(x:cps(for $x at $i in $url return xivid:bin-xor($x,$key[($i - 1) mod count($key) + 1]))))[1]'
https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a

real    0m24.094s
user    0m0.015s
sys     0m0.016s

----------------------------------------------------------------

- Reeksen

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))) return (string-join(x:cps($url)),substring(string-join((1 to ceiling(count($url) div string-length($decryption_key))) ! $decryption_key),1,count($url)))'
!2-?&mna5!,,.cfg>=+7#(00~"&)k<+,!6*x& <ntib`|b*wu*,6i}ujzxc /2ypvqgyqg1ddv$&7a%pj){/`=*+26b"r1~
IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUDIFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADF

$ xidel -se 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))),$key:=x:cps(substring(string-join((1 to ceiling(count($url) div string-length($decryption_key))) ! $decryption_key),1,count($url))) return for $x at $i in $url return join(($x,$key[$i]))'
33 73
50 70
45 89
63 79
38 85
[...]

$ xidel -s --module=xivid.xqm -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))),$key:=x:cps(substring(string-join((1 to ceiling(count($url) div string-length($decryption_key))) ! $decryption_key),1,count($url))) return string-join(x:cps(for $x at $i in $url return xivid:bin-xor($x,$key[$i])))'
https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/index.m3u8

$ time xidel -s --module=xivid.xqm -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; let $url:=x:cps(binary-to-string(base64Binary("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4="))),$key:=x:cps(substring(string-join((1 to ceiling(count($url) div string-length($decryption_key))) ! $decryption_key),1,count($url))) return ((1 to 1000) ! string-join(x:cps(for $x at $i in $url return xivid:bin-xor($x,$key[$i]))))[1]'
https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/index.m3u8

real    0m23.531s   # Deze is dus toch het snelst.
user    0m0.015s
sys     0m0.015s

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s --module=xivid.xqm -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; declare function local:decrypt($a as base64Binary) as string {let $url:=x:cps(binary-to-string($a)),$key:=x:cps(substring(string-join((1 to ceiling(count($url) div string-length($decryption_key))) ! $decryption_key),1,count($url))) return string-join(x:cps(for $x at $i in $url return xivid:bin-xor($x,$key[$i])))}; ("ITItPyZtbmE1ISwsLmNmZz49KzcjKDAwfiImKWs8KywhNip4JiA8bnRpYmB8Yip3dSosNml9dWp6eGMgLzJ5cHZxZ3lxZzFkZHYkJjdhJXBqKXsvYD0qKzI2YiJyMX4=","ITItPyZtbmEnIDogID9le305OiwsKyohNG8qKylgPSo3MT0yYS9gLHAnfXl5Ynl3c2N+eidmcD8sNnp1fWdhZXEgMzJka2djYWJ/cTFncXAnJyx/K21qImMvczwoI3sUBX90KjkhJgFlEiUcPBAvMxkfBTc/") ! local:decrypt(base64Binary(.))'
https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/index.m3u8
https://stream12.mixcloud.com/secure/c/m4a/64/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a?sig=FJ29cabjN0VlZe_zdXQQcw

xidel -s "$url" -e 'let $csrf:=substring-before(substring-after($headers[contains(.,"csrftoken")],"="),";"),$us:=tokenize(substring-after("'$url'","mixcloud.com/"),"/") return x:request({"headers":("Content-Type: application/json","Referer: '$url'","X-CSRFToken: "||$csrf,"Cookie: csrftoken="||$csrf),"post":concat("{""query"":""{cloudcastLookup(lookup:{username:\""",$us[1],"\"",slug:\""",$us[2],"\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}"),"url":"https://www.mixcloud.com/graphql"})/json//cloudcastLookup'

$ xidel -s --module=xivid.xqm --json-mode=deprecated "$url" -e 'declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD"; declare function local:decrypt($a as base64Binary) as string {let $url:=x:cps(binary-to-string($a)),$key:=x:cps(substring(string-join((1 to ceiling(count($url) div string-length($decryption_key))) ! $decryption_key),1,count($url))) return string-join(x:cps(for $x at $i in $url return xivid:bin-xor($x,$key[$i])))}; let $csrf:=substring-before(substring-after($headers[contains(.,"csrftoken")],"="),";"),$us:=tokenize(substring-after("'$url'","mixcloud.com/"),"/") return x:request({"headers":("Content-Type: application/json","Referer: '$url'","X-CSRFToken: "||$csrf,"Cookie: csrftoken="||$csrf),"post":concat("{""query"":""{cloudcastLookup(lookup:{username:\""",$us[1],"\"",slug:\""",$us[2],"\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}"),"url":"https://www.mixcloud.com/graphql"})/json//cloudcastLookup/{"name":concat(owner/displayName," - ",name),"date":format-date(dateTime(publishDate),"[D01]-[M01]-[Y]"),"duration":format-time(audioLength * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[{"id":"pg-1","format":"m4a[aac]","url":local:decrypt(base64Binary(streamInfo/url))},xivid:m3u8-to-json(local:decrypt(base64Binary(streamInfo/hlsUrl)))]}'
{
  "name": "Eric van Kleef - CLUBBIN #12 @WILDFM 30 MEI 2020.",
  "date": "31-05-2020",
  "duration": "01:37:22",
  "formats": [
    {
      "id": "pg-1",
      "format": "m4a[aac]",
      "url": "https://stream12.mixcloud.com/secure/c/m4a/64/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a?sig=FJ29cabjN0VlZe_zdXQQcw"
    },
    {
      "id": "hls-0",
      "format": "m3u8[manifest]",
      "url": "https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/index.m3u8"
    },
    {
      "id": "hls-1",
      "format": "m3u8[aac]",
      "resolution": null,
      "bitrate": "71kbps",
      "url": "https://audio12.mixcloud.com/secure/hls/0/0/1/c/6fcc-4335-4aaf-8305-84e709ccc1d9.m4a/streamindex-a1.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

-e '
  declare variable $decryption_key:="IFYOUWANTTHEARTISTSTOGETPAIDDONOTDOWNLOADFROMMIXCLOUD";
  declare function local:decrypt($a as base64Binary) as string {
    let $url:=x:cps(binary-to-string($a)),
        $key:=x:cps(
          substring(
            string-join((1 to ceiling(count($url) div string-length($decryption_key))) ! $decryption_key),
            1,count($url)
          )
        )
    return
    string-join(
      x:cps(
        for $x at $i in $url return
        xivid:bin-xor($x,$key[$i])
      )
    )
  };
  let $csrf:=substring-before(substring-after($headers[contains(.,"csrftoken")],"="),";"),
      $us:=tokenize(substring-after("'$url'","mixcloud.com/"),"/")
  return
  x:request(
    {
      "headers":(
        "Content-Type: application/json",
        "Referer: '$url'",
        "X-CSRFToken: "||$csrf,
        "Cookie: csrftoken="||$csrf
      ),
      "post":concat(
        "{""query"":""{cloudcastLookup(lookup:{username:\""",
        $us[1],
        "\"",slug:\""",
        $us[2],
        "\""}){name,owner{displayName,url,username},publishDate,audioLength,streamInfo{hlsUrl,url}}}""}"
      ),
      "url":"https://www.mixcloud.com/graphql"
    }
  )/json//cloudcastLookup/{
    "name":concat(owner/displayName," - ",name),
    "date":format-date(dateTime(publishDate),"[D01]-[M01]-[Y]"),
    "duration":format-time(
      audioLength * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "formats":[
      {
        "id":"pg-1",
        "format":"m4a[aac]",
        "url":local:decrypt(base64Binary(streamInfo/url))
      },
      xivid:m3u8-to-json(
        local:decrypt(
          base64Binary(streamInfo/hlsUrl)
        )
      )
    ]
  }
'

================================================================================================

[soundcloud]

$ url=https://soundcloud.com/laidbackluke/laidback-luke-dj-set-live-at

$ xidel -s "$url" -e 'json(//script/extract(.,"(\[\{.+)\)",1)[.])()[.//media]/(data)()'
{
  "comment_count": 675,
  "full_duration": 3610982,
  "downloadable": true,
  "created_at": "2012-11-05T10:53:55Z",
  "description": "",
  "media": {
    "transcodings": [
      {
        "url": "https://api-v2.soundcloud.com/media/soundcloud:tracks:66196563/da74b653-7f46-443b-ad44-2337d07383c3/stream/hls",
        "preset": "mp3_0_0",
        "duration": 3610982,
        "snipped": false,
        "format": {
          "protocol": "hls",
          "mime_type": "audio/mpeg"
        },
        "quality": "sq"
      },
      {
        "url": "https://api-v2.soundcloud.com/media/soundcloud:tracks:66196563/da74b653-7f46-443b-ad44-2337d07383c3/stream/progressive",
        "preset": "mp3_0_0",
        "duration": 3610982,
        "snipped": false,
        "format": {
          "protocol": "progressive",
          "mime_type": "audio/mpeg"
        },
        "quality": "sq"
      },
      {
        "url": "https://api-v2.soundcloud.com/media/soundcloud:tracks:66196563/354da271-3480-4c98-8b3d-8729d4014a9d/stream/hls",
        "preset": "opus_0_0",
        "duration": 3610982,
        "snipped": false,
        "format": {
          "protocol": "hls",
          "mime_type": "audio/ogg; codecs=\"opus\""
        },
        "quality": "sq"
      }
    ]
  },
  "title": "Laidback Luke DJ set Live At Escape From Wonderland Oct 2012",
  "publisher_metadata": null,
  "duration": 3610982,
  "has_downloads_left": true,
  "artwork_url": "https://i1.sndcdn.com/artworks-000033583042-nk61e0-large.jpg",
  "public": true,
  "streamable": true,
  "tag_list": "",
  "genre": "DJ Mix",
  "id": 66196563,
  "reposts_count": 1068,
  "state": "finished",
  "label_name": "",
  "last_modified": "2020-02-26T06:13:28Z",
  "commentable": true,
  "policy": "MONETIZE",
  "visuals": null,
  "kind": "track",
  "purchase_url": null,
  "sharing": "public",
  "uri": "https://api.soundcloud.com/tracks/66196563",
  "secret_token": null,
  "download_count": 19606,
  "likes_count": 7306,
  "urn": "soundcloud:tracks:66196563",
  "license": "cc-by",
  "purchase_title": null,
  "display_date": "2012-11-05T10:53:55Z",
  "embeddable_by": "all",
  "release_date": null,
  "user_id": 236295,
  "monetization_model": "BLACKBOX",
  "waveform_url": "https://wave.sndcdn.com/gF2U20J9lZfU_m.json",
  "permalink": "laidback-luke-dj-set-live-at",
  "permalink_url": "https://soundcloud.com/laidbackluke/laidback-luke-dj-set-live-at",
  "user": {
    "avatar_url": "https://i1.sndcdn.com/avatars-000332190570-lfp2jp-large.jpg",
    "city": "",
    "comments_count": 69,
    "country_code": "NL",
    "created_at": "2009-08-31T23:58:14Z",
    "creator_subscriptions": [
      {
        "product": {
          "id": "creator-pro-unlimited"
        }
      }
    ],
    "creator_subscription": {
      "product": {
        "id": "creator-pro-unlimited"
      }
    },
    "description": "",
    "followers_count": 428519,
    "followings_count": 9,
    "first_name": "Laidback",
    "full_name": "Laidback Luke",
    "groups_count": 0,
    "id": 236295,
    "kind": "user",
    "last_modified": "2020-06-26T10:26:41Z",
    "last_name": "Luke",
    "likes_count": 49,
    "playlist_likes_count": 8,
    "permalink": "laidbackluke",
    "permalink_url": "https://soundcloud.com/laidbackluke",
    "playlist_count": 92,
    "reposts_count": null,
    "track_count": 375,
    "uri": "https://api.soundcloud.com/users/236295",
    "urn": "soundcloud:users:236295",
    "username": "LaidbackLuke",
    "verified": false,
    "visuals": {
      "urn": "soundcloud:users:236295",
      "enabled": true,
      "visuals": [
        {
          "urn": "soundcloud:visuals:102511671",
          "entry_time": 0,
          "visual_url": "https://i1.sndcdn.com/visuals-000000236295-JBYMVN-original.jpg"
        }
      ],
      "tracking": null
    }
  },
  "playback_count": 319259
}

$ xidel -s "$url" -e '//script[@crossorigin][last()]/@src'
https://a-v2.sndcdn.com/assets/46-4d78cbe8-3.js

$ xidel -s "$url" -e 'substring(substring-after(unparsed-text(//script[@crossorigin][last()]/@src),"client_id:"),2,32)'
rlZXIMK5JrRgRVARIuViQdb5WzF7VlHP

$ xidel -s "$url" -e 'let $cid:=substring(substring-after(unparsed-text(//script[@crossorigin][last()]/@src),"client_id:"),2,32) return json(//script/extract(.,"(\[\{.+)\)",1)[.])()[.//media]/(.//transcodings)()/concat(url,"?client_id=",$cid)'
https://api-v2.soundcloud.com/media/soundcloud:tracks:66196563/da74b653-7f46-443b-ad44-2337d07383c3/stream/hls?client_id=rlZXIMK5JrRgRVARIuViQdb5WzF7VlHP
https://api-v2.soundcloud.com/media/soundcloud:tracks:66196563/da74b653-7f46-443b-ad44-2337d07383c3/stream/progressive?client_id=rlZXIMK5JrRgRVARIuViQdb5WzF7VlHP
https://api-v2.soundcloud.com/media/soundcloud:tracks:66196563/354da271-3480-4c98-8b3d-8729d4014a9d/stream/hls?client_id=rlZXIMK5JrRgRVARIuViQdb5WzF7VlHP

$ xidel -s "$url" -e 'let $cid:=substring(substring-after(unparsed-text(//script[@crossorigin][last()]/@src),"client_id:"),2,32) return json(//script/extract(.,"(\[\{.+)\)",1)[.])()[.//media]/(.//transcodings)()/json(concat(url,"?client_id=",$cid))/url'
https://cf-hls-media.sndcdn.com/playlist/gF2U20J9lZfU.128.mp3/playlist.m3u8?[...]
https://cf-media.sndcdn.com/gF2U20J9lZfU.128.mp3?[...]
https://cf-hls-opus-media.sndcdn.com/playlist/gF2U20J9lZfU.64.opus/playlist.m3u8?[...]

$ xidel -s --json-mode=deprecated "$url" --xquery 'let $cid:=substring(substring-after(unparsed-text(//script[@crossorigin][last()]/@src),"client_id:"),2,32),$a:=json(//script/extract(.,"(\[\{.+)\)",1)[.])()[.//media]/(data)(),$b:=($a//transcodings)() return $a/{"name":concat(user/(full_name,username)[.][1]," - ",title),"date":format-date(dateTime(created_at),"[D01]-[M01]-[Y]"),"duration":format-time(round(duration div 1000) * duration("PT1S"),"[H01]:[m01]:[s01]"),"formats":[$b[format/protocol="progressive"]/(let $url:=json(concat(url,"?client_id=",$cid))/url return {"id":"pg-1","format":substring-before(preset,"_"),"bitrate":extract($url,"\.(\d+)\.",1)||"kbps","url":$url}),for $x at $i in $b where $x/format/protocol="hls" order by $x/preset descending count $i let $url:=json(concat($x/url,"?client_id=",$cid))/url return {"id":"hls-"||$i,"format":concat("m3u8[",substring-before($x/preset,"_"),"]"),"bitrate":extract($url,"\.(\d+)\.",1)||"kbps","url":$url}]}'
{
  "name": "Laidback Luke - Laidback Luke DJ set Live At Escape From Wonderland Oct 2012",
  "date": "05-11-2012",
  "duration": "01:00:11",
  "formats": [
    {
      "id": "pg-1",
      "format": "mp3",
      "bitrate": "128kbps",
      "url": "https://cf-media.sndcdn.com/gF2U20J9lZfU.128.mp3?[...]"
    },
    {
      "id": "hls-1",
      "format": "m3u8[opus]",
      "bitrate": "64kbps",
      "url": "https://cf-hls-opus-media.sndcdn.com/playlist/gF2U20J9lZfU.64.opus/playlist.m3u8?[...]"
    },
    {
      "id": "hls-2",
      "format": "m3u8[mp3]",
      "bitrate": "128kbps",
      "url": "https://cf-hls-media.sndcdn.com/playlist/gF2U20J9lZfU.128.mp3/playlist.m3u8?[...]"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  let $cid:=substring(
        substring-after(
          unparsed-text(//script[@crossorigin][last()]/@src),
          "client_id:"
        ),
        2,32
      ),
      $a:=json(//script/extract(.,"(\[\{.+)\)",1)[.])()[.//media]/(data)(),
      $b:=($a//transcodings)()
  return
  $a/{
    "name":concat(user/(full_name,username)[.][1]," - ",title),
    "date":format-date(dateTime(created_at),"[D01]-[M01]-[Y]"),
    "duration":format-time(
      round(duration div 1000) * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "formats":[
      $b[format/protocol="progressive"]/(
        let $url:=json(concat(url,"?client_id=",$cid))/url return {
          "id":"pg-1",
          "format":substring-before(preset,"_"),
          "bitrate":extract($url,"\.(\d+)\.",1)||"kbps",
          "url":$url
        }
      ),
      for $x at $i in $b
      where $x/format/protocol="hls"
      order by $x/preset descending
      count $i
      let $url:=json(concat($x/url,"?client_id=",$cid))/url
      return {
        "id":"hls-"||$i,
        "format":concat("m3u8[",substring-before($x/preset,"_"),"]"),
        "bitrate":extract($url,"\.(\d+)\.",1)||"kbps",
        "url":$url
      }
    ]
  }
'
