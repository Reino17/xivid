[npo]

https://www.npostart.nl/nos-journaal/12-12-2018/POW_03689795

$ xidel -s "http://e.omroep.nl/metadata/POW_03689795" --xquery '
  json(
    extract(
      $raw,
      "\((.+)\)",
      1
    )
  )[not(error)]/{
    "name":if (medium="live") then
      titel||": Livestream"
    else
      replace(
        concat(
          if (count(.//naam)=1) then
            .//naam
          else
            join(
              .//naam,
              " en "
            ),
          ": ",
          if (ptype="episode") then
            if (aflevering_titel) then
              if (
                contains(
                  titel,
                  aflevering_titel
                )
              ) then
                titel
              else if (
                contains(
                  aflevering_titel,
                  titel
                )
              ) then
                aflevering_titel
              else
                concat(
                  titel,
                  " - ",
                  aflevering_titel
                )
            else
              titel
          else
            concat(
              .//serie_titel,
              " - ",
              titel
            )
        ),
        "[&quot;&apos;]",
        "'\'\''"
      ),
    "date":if (medium="live") then
      "'$(date "+%d-%m-%Y")'"
    else (
      if (gidsdatum) then
        format-date(
          date(gidsdatum),
          "[D01]-[M01]-[Y]"
        )
      else if (
        matches(
          "https://www.npostart.nl/nos-journaal/12-12-2018/POW_03689795",
          "\d{2}-\d{2}-\d{4}"
        )
      ) then
        extract(
          "https://www.npostart.nl/nos-journaal/12-12-2018/POW_03689795",
          ".+/([\d-]+)",
          1
        )
      else
        extract(
          x:request(
            {
              "url":"https://www.npostart.nl/POW_03689795",
              "method":"HEAD"
            }
          )/url,
          ".+/([\d-]+)",
          1
        )
    ),
    "duration":if (tijdsduur) then
      tijdsduur
    else
      (),
    "start":start,
    "end":eind,
    "expdate":if (publicatie_eind) then
      format-dateTime(
        dateTime(publicatie_eind),
        "[D01]-[M01]-[Y] [H01]:[m01]:[s01]"
      )
    else
      (),
    "subtitle":if (tt888="ja") then
      "http://tt888.omroep.nl/tt888/"||prid
    else
      (),
    "formats":let $a:=x:request(
          {
            "url":"http://ida.omroep.nl/app.php/POW_03689795?token="||json(
              "http://ida.omroep.nl/app.php/auth"
            )/token,
            "error-handling":"4xx=accept"
          }
        )[
          contains(
            headers[1],
            "200"
          )
        ]/json/(items)()(),
        $b:=$a[format="hls"]/x:request(
          {
            "url":replace(
              url,
              "jsonp",
              "json"
            ),
            "error-handling":"4xx=accept"
          }
        )[
          contains(
            headers[1],
            "200"
          )
        ]/(
          if (json instance of string) then
            json
          else
            json/url
        ),
        $c:=[
          reverse(
            $a[contentType="odi"][format="mp4"]
          )/x:request(
            {
              "url":replace(
                url,
                "jsonp",
                "json"
              ),
              "error-handling":"4xx=accept"
            }
          )[
            contains(
              headers[1],
              "200"
            )
          ]/json/substring-before(
            url,
            "?"
          ) ! {
            "format":"pg-"||position(),
            "container":"m4v[h264+aac]",
            "url":.
          },
          {
            "format":"hls-0",
            "container":"m3u8[manifest]",
            "url":$b
          }[url],
          for $x at $i in tail(
            tokenize(
              extract(
                unparsed-text($b),
                "(#EXT-X-STREAM-INF.+m3u8$)",
                1,"ms"
              ),
              "#EXT-X-STREAM-INF:"
            )
          ) order by extract(
            $x,
            "BANDWIDTH=(\d+)",
            1
          ) count $i
          return {
            "format":"hls-"||$i,
            "container":if (
              contains(
                $x,
                "avc1"
              )
            ) then
              "m3u8[h264+aac]"
            else
              "m3u8[aac]",
            "resolution":extract(
              $x,
              "RESOLUTION=([\dx]+)",
              1
            )[.],
            "bitrate":let $a:=extract(
              $x,
              "audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",
              (1,2)
            ) return
            join(
              (
                $a[2][.],
                $a[1]
              ),
              "|"
            )||"kbps",
            "url":resolve-uri(
              ".",
              $b
            )||extract(
              $x,
              "(.+m3u8)",
              1
            )
          },
          reverse(
            $a[contentType="url"][format="mp4"]
          )/x:request(
            {
              "url":url,
              "method":"HEAD",
              "error-handling":"xxx=accept"
            }
          )[
            some $x in ("200","302") satisfies contains(
              headers[1],
              $x
            )
          ]/(
            if (
              contains(
                url,
                "content-ip"
              )
            ) then
              x:request(
                {
                  "url":"https://ipv4-api.nos.nl/resolve.php/video?url="||uri-encode(url),
                  "method":"HEAD"
                }
              )/url
            else
              url
          ) ! {
            "format":"mp4-"||position(),
            "container":extract(
              .,
              ".+\.(.+)",
              1
            )||"[h264+aac]",
            "url":.
          }
        ]
    return
    if ($c()) then
      $c
    else
      ()
  }
'
{
  "name": "NOS: NOS Journaal",
  "date": "12-12-2018",
  "duration": "00:24:39",
  "start": null,
  "end": null,
  "expdate": "01-01-2101 00:59:00",
  "subtitle": "http://tt888.omroep.nl/tt888/POW_03689795",
  "formats": [
    {
      "format": "pg-1",
      "container": "m4v[h264+aac]",
      "url": "https://content10c1b.omroep.nl/urishieldv2/l27m5a1b0a7d738bd144005c11a640000000.da077fb61a0c5933f1ae79863ff6a403/ceresodi/h264/p/12/10/10/f6/sb_POW_03689795.m4v"
    },
    {
      "format": "pg-2",
      "container": "m4v[h264+aac]",
      "url": "https://content10c1a.omroep.nl/urishieldv2/l27m05b6ed9143e505af005c11a640000000.c920edf4f11ccb22769034bacb65fc39/ceresodi/h264/p/12/10/10/f6/bb_POW_03689795.m4v"
    },
    {
      "format": "pg-3",
      "container": "m4v[h264+aac]",
      "url": "https://content10c3c.omroep.nl/urishieldv2/l27m07a681274325394d005c11a640000000.0b3f7b41a5e3ecfa9417d26dd3f7d31a/ceresodi/h264/p/12/10/10/f6/std_POW_03689795.m4v"
    },
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "203|96kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=203000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "203|128kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=203000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "203|192kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=203000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "505|96kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=505000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "505|128kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=505000.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "505|192kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=505000.m3u8"
    },
    {
      "format": "hls-7",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1109|96kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=1109000.m3u8"
    },
    {
      "format": "hls-8",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1109|128kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=1109000.m3u8"
    },
    {
      "format": "hls-9",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1109|192kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=1109000.m3u8"
    },
    {
      "format": "hls-10",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1810|96kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=1810000.m3u8"
    },
    {
      "format": "hls-11",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1810|128kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=1810000.m3u8"
    },
    {
      "format": "hls-12",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1810|192kbps",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=1810000.m3u8"
    }
  ]
}

https://www.npostart.nl/de-laatste-minuten/17-12-2018/POMS_AT_15009224
{
  "name": "AVROTROS: Hunted - De laatste minuten...",
  "date": "17-12-2018",
  "duration": "00:01:59",
  "start": "00:55:06",
  "end": "00:57:05",
  "expdate": "01-01-2101 00:59:00",
  "subtitle": "http://tt888.omroep.nl/tt888/AT_2105785",
  "formats": [
    {
      "format": "pg-1",
      "container": "m4v[h264+aac]",
      "url": "https://content10c4b.omroep.nl/urishieldv2/l27m6c2ec29c3fcf372e005c276570000000.b055f6717fc4e0b8ea2ae9042d1291e2/ceresodi/h264/p/06/10/10/f7/sb_AT_2105785.m4v"
    },
    {
      "format": "pg-2",
      "container": "m4v[h264+aac]",
      "url": "https://content10c4c.omroep.nl/urishieldv2/l27m34ec48023fb78477005c276570000000.171fddf89df4a5190ac631f86a056b63/ceresodi/h264/p/06/10/10/f7/bb_AT_2105785.m4v"
    },
    {
      "format": "pg-3",
      "container": "m4v[h264+aac]",
      "url": "https://content10c4a.omroep.nl/urishieldv2/l27m3187fe3c262e9d50005c276570000000.d1015a8a55fc8f98ef42e675570af912/ceresodi/h264/p/06/10/10/f7/std_AT_2105785.m4v"
    },
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "202|96kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=202000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "202|128kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=202000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "202|192kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=202000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "504|96kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=504000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "504|128kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=504000.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "504|192kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=504000.m3u8"
    },
    {
      "format": "hls-7",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1109|96kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=1109000.m3u8"
    },
    {
      "format": "hls-8",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1109|128kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=1109000.m3u8"
    },
    {
      "format": "hls-9",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1109|192kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=1109000.m3u8"
    },
    {
      "format": "hls-10",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1813|96kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=1813000.m3u8"
    },
    {
      "format": "hls-11",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1813|128kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=1813000.m3u8"
    },
    {
      "format": "hls-12",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1813|192kbps",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=1813000.m3u8"
    }
  ]
}

https://www.npostart.nl/live/npo-1
{
  "name": "NPO 1: Livestream",
  "date": "29-12-2018",
  "duration": null,
  "start": null,
  "end": null,
  "expdate": null,
  "subtitle": null,
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "384x216",
      "bitrate": "200|128kbps",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=200000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "499|128kbps",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=499968.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1000|128kbps",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=1000000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1800|128kbps",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=1800000.m3u8"
    }
  ]
}

================================================================================================================================

[rtl]

https://www.rtl.nl/video/143d56f6-816e-3757-961d-eba686183076

$ xidel -s "http://www.rtl.nl/system/s4m/vfd/version=2/uuid=143d56f6-816e-3757-961d-eba686183076/fmt=adaptive/" --xquery '
  $json[
    not(
      meta/nr_of_videos_total=0
    )
  ]/{
    "name":replace(
      concat(
        .//station,
        ": ",
        abstracts/name,
        " - ",
        if (.//classname="uitzending") then
          episodes/name
        else
          .//title
      ),
      "[&quot;&apos;]",
      "'\'\''"
    ),
    "date":format-date(
      (material)()/original_date * duration("PT1S") + date("1970-01-01"),
      "[D01]-[M01]-[Y]"
    ),
    "duration":format-time(
      time((material)()/duration) + duration("PT0.5S"),
      "[H01]:[m01]:[s01]"
    ),
    "expdate":if ((.//ddr_timeframes)()[model="AVOD"]/stop) then
      format-dateTime(
        (.//ddr_timeframes)()[model="AVOD"]/stop * duration("PT1S") + dateTime("1970-01-01T01:00:00"),
        "[D01]-[M01]-[Y] [H01]:[m01]:[s01]"
      )
    else
      (),
    "formats":let $a:=.//videohost||.//videopath return [
      {
        "format":"hls-0",
        "container":"m3u8[manifest]",
        "url":$a
      },
      for $x at $i in tail(
        tokenize(
          unparsed-text($a),
          "#EXT-X-STREAM-INF:"
        )
      ) order by extract(
        $x,
        "BANDWIDTH=(\d+)",
        1
      ) count $i
      return {
        "format":"hls-"||$i,
        "container":if (
          contains(
            $x,
            "avc1"
          )
        ) then
          "m3u8[h264+aac]"
        else
          "m3u8[aac]",
        "resolution":extract(
          $x,
          "RESOLUTION=([\dx]+)",
          1
        )[.],
        "bitrate":let $a:=extract(
          $x,
          "audio=(\d+)(?:-video=(\d+)\d{3})?",
          (1,2)
        ) return
        join(
          (
            $a[2][.],
            round(
              $a[1] div 1000
            )
          ),
          "|"
        )||"kbps",
        "url":let $b:=extract(
          $x,
          "(.+m3u8)",
          1
        ) return
        if (
          starts-with(
            $b,
            "http"
          )
        ) then
          $b
        else
          resolve-uri(
            ".",
            $a
          )||$b
      }
    ]
  }
'
{
  "name": "RTL4: RTL Nieuws - 19:30 uur",
  "date": "11-12-2018",
  "duration": "00:20:18",
  "expdate": "12-12-2019 06:35:25",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "http://manifest.us.rtl.nl/rtlxl/v166/network/pc/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "711x400",
      "bitrate": "903|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=903000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "912x512",
      "bitrate": "2093|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=2093000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3805|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=3805000.m3u8"
    }
  ]
}

================================================================================================================================

[-i, --info]

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json() return $b'
name
date
duration
start
end
expdate
subtitle
formats

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] return $b'
name
date
duration
start
end
expdate
subtitle

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return $b'
name
date
duration
expdate
subtitle

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return $b ! $a(.)'
Naam:
Datum:
Tijdsduur:
Gratis tot:
Ondertiteling:

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return max($b ! $a(.) ! string-length(.))'
14

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) return string-join((1 to $c+1) ! "#")'
###############

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)),$d:=string-join((1 to $c+1) ! " ") return $b ! concat(substring($a(.)||$d,1,$c+1),$json(.))'
Naam:          NOS: NOS Journaal
Datum:         12-12-2018
Tijdsduur:     00:24:39
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/POW_03689795

------------------------------------------------------------------------------------------------
$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '533,597p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9)'
9

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '533,597p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " ") return $b ! concat(substring($a(.)||$d,1,$c+1),$json(.))' -e '"Formaten:"'
Naam:     NPO 1: Livestream
Datum:    29-12-2018
Formaten:

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate") return $f ! $e(1)(.)'
formaat
extensie
resolutie
bitrate

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate") return $f ! max($e()(.) ! string-length(.))'
7
8
9
7
6

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)) return string-join((1 to sum($g)) ! "#")'
#####################################

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") for $x in $e(1) return concat(substring("Formaten:"||$d,1,$c+1),string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)))'
Formaten:      formaat  extensie  resolutie  bitrate

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ())'
Formaten:      formaat  extensie  resolutie  bitrate
               pg-1     m4v
               pg-2     m4v
               pg-3     m4v
               hls-0    m3u8      manifest
               hls-1    m3u8      480x270    v:203k   a:96k
               hls-2    m3u8      480x270    v:203k   a:128k
               hls-3    m3u8      480x270    v:203k   a:192k
               hls-4    m3u8      640x360    v:505k   a:96k
               hls-5    m3u8      640x360    v:505k   a:128k
               hls-6    m3u8      640x360    v:505k   a:192k
               hls-7    m3u8      1024x576   v:1109k  a:96k
               hls-8    m3u8      1024x576   v:1109k  a:128k
               hls-9    m3u8      1024x576   v:1109k  a:192k
               hls-10   m3u8      1024x576   v:1810k  a:96k
               hls-11   m3u8      1024x576   v:1810k  a:128k
               hls-12   m3u8      1024x576   v:1810k  a:192k  (best)

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()))'
Naam:          NOS: NOS Journaal
Datum:         12-12-2018
Tijdsduur:     00:24:39
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/POW_03689795
Formaten:      formaat  extensie  resolutie  bitrate
               pg-1     m4v
               pg-2     m4v
               pg-3     m4v
               hls-0    m3u8      manifest
               hls-1    m3u8      480x270    v:203k   a:96k
               hls-2    m3u8      480x270    v:203k   a:128k
               hls-3    m3u8      480x270    v:203k   a:192k
               hls-4    m3u8      640x360    v:505k   a:96k
               hls-5    m3u8      640x360    v:505k   a:128k
               hls-6    m3u8      640x360    v:505k   a:192k
               hls-7    m3u8      1024x576   v:1109k  a:96k
               hls-8    m3u8      1024x576   v:1109k  a:128k
               hls-9    m3u8      1024x576   v:1109k  a:192k
               hls-10   m3u8      1024x576   v:1810k  a:96k
               hls-11   m3u8      1024x576   v:1810k  a:128k
               hls-12   m3u8      1024x576   v:1810k  a:192k  (best)

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '533,597p' | xidel -s - --xquery '[...]'
Naam:     NPO 1: Livestream
Datum:    29-12-2018
Formaten: formaat  extensie  resolutie   bitrate
          hls-0    m3u8      manifest
          hls-1    m3u8      audiospoor           a:128k
          hls-2    m3u8      384x216     v:200k   a:128k
          hls-3    m3u8      480x270     v:499k   a:128k
          hls-4    m3u8      640x360     v:699k   a:128k
          hls-5    m3u8      768x432     v:1000k  a:128k
          hls-6    m3u8      1024x576    v:1800k  a:128k  (best)

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '403,530p' | xidel -s - -e 'if (start) then (time(start) - (seconds-from-time(start) mod 30 * duration("PT1S")),seconds-from-time(start) mod 30,duration) else ()'
00:55:00
6
00:01:59

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '403,530p' | xidel -s - -e 'if (start) then concat("Download: ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * duration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]") else ()'
Download: ffmpeg -ss 00:55:00 -i [url] -ss 6 -t 00:01:59 [...]
------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '403,530p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()),if (start) then ("",concat(substring("Download:"||$d,1,$c+1),"ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * duration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]")) else ())'
Naam:          AVROTROS: Hunted - De laatste minuten...
Datum:         17-12-2018
Tijdsduur:     00:01:59
Begin:         00:55:06
Einde:         00:57:05
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/AT_2105785
Formaten:      formaat  extensie  resolutie  bitrate
               pg-1     m4v
               pg-2     m4v
               pg-3     m4v
               hls-0    m3u8      manifest
               hls-1    m3u8      480x270    v:202k   a:96k
               hls-2    m3u8      480x270    v:202k   a:128k
               hls-3    m3u8      480x270    v:202k   a:192k
               hls-4    m3u8      640x360    v:504k   a:96k
               hls-5    m3u8      640x360    v:504k   a:128k
               hls-6    m3u8      640x360    v:504k   a:192k
               hls-7    m3u8      1024x576   v:1109k  a:96k
               hls-8    m3u8      1024x576   v:1109k  a:128k
               hls-9    m3u8      1024x576   v:1109k  a:192k
               hls-10   m3u8      1024x576   v:1813k  a:96k
               hls-11   m3u8      1024x576   v:1813k  a:128k
               hls-12   m3u8      1024x576   v:1813k  a:192k  (best)

Download:      ffmpeg -ss 00:55:00 -i [url] -ss 6 -t 00:01:59 [...]

$ cat <<EOF | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),if ($e(2)) then for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()) else substring("Formaten:"||$d,1,$c+1)||"-",if (start) then ("",concat(substring("Download:"||$d,1,$c+1),"ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * duration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]")) else ())'
{
  "name": "VPRO: Zigeunermuziek doet pijn - Bob Entrop, VPRO, 2008 (58 min.)",
  "date": "21-07-2010",
  "duration": "00:58:00",
  "start": null,
  "end": null,
  "expdate": null,
  "subtitle": null,
  "formats": null
}
EOF
Naam:      VPRO: Zigeunermuziek doet pijn - Bob Entrop, VPRO, 2008 (58 min.)
Datum:     21-07-2010
Tijdsduur: 00:58:00
Formaten:  -

------------------------------------------------------------------------------------------------

--xquery '
  let $a:={
        "name":"Naam:",
        "date":"Datum:",
        "duration":"Tijdsduur:",
        "start":"Begin:",
        "end":"Einde:",
        "expdate":"Gratis tot:",
        "subtitle":"Ondertiteling:"
      },
      $b:=$json()[
        position()<count($json())
      ] ! .[$json(.)[.]],
      $c:=max(
        $b ! $a(.) ! string-length(.)
      ) ! (
        if (.>9) then
          .
        else
          9
      ),
      $d:=string-join(
        (1 to $c+1) ! " "
      ),
      $e:=[
        {
          "format":"formaat",
          "extension":"extensie",
          "resolution":"resolutie",
          "vbitrate":"bitrate"
        },
        $json/(formats)()
      ],
      $f:=(
        "format",
        "extension",
        "resolution",
        "vbitrate",
        "abitrate"
      ),
      $g:=$f ! max(
        $e()(.) ! string-length(.)
      ),
      $h:=string-join(
        (1 to sum($g)) ! " "
      )
  return (
    $b ! concat(
      substring(
        $a(.)||$d,
        1,
        $c+1
      ),
      $json(.)
    ),
    if ($e(2)) then
      for $x at $i in $e() return
      concat(
        if ($i=1) then
          substring(
            "Formaten:"||$d,
            1,
            $c+1
          )
        else
          $d,
        string-join(
          for $y at $i in $f return
          substring(
            $x($y)||$h,
            1,
            $g[$i]+2
          )
        ),
        if ($i=count($e())) then
          "(best)"
        else
          ()
      )
    else
      substring(
        "Formaten:"||$d,
        1,
        $c+1
      )||"-",
    if (start) then (
      "",
      concat(
        substring(
          "Download:"||$d,
          1,
          $c+1
        ),
        "ffmpeg -ss ",
        time(start) - (
          seconds-from-time(start) mod 30 * duration("PT1S")
        ),
        " -i [url] -ss ",
        seconds-from-time(start) mod 30,
        " -t ",
        duration,
        " [...]"
      )
    ) else
      ()
  )
'

================================================================================================================================

[kijk]

https://www.kijk.nl/ --> https://consent.talpanetwork.com/?TN_REFERAL_URL=https://www.kijk.nl/&TN_REFERAL_ORIGIN= (cookie wall)

Antwoordheader in PaleMoon:

Host: www.kijk.nl
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:60.9) Gecko/20100101 Goanna/4.1 Firefox/60.9 PaleMoon/28.2.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: nl,en-US;q=0.7,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://consent.talpanetwork.com/?TN_REFERAL_URL=https:%2F%2Fwww.kijk.nl%2F&TN_REFERAL_ORIGIN=
Cookie: CONSENTMGR=ts:1546358787966|consent:true|c1:0; OPTOUTMULTI=0:0%7Cc5:0%7Cc1:0%7Cc4:0%7Cc3:0%7Cc2:0; TN_UUID=edae8abd-659b-477a-8dfe-caf4d718fcd7; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjCAcAAiABUAC4AIAAZABEgCaAJ4AWwAxABuAD8AIAARgApQBXADvAIQARaAjgCOgEuAJ2AVkAuoBgQDiAHugP0A_YCCg; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE54EfETAAQgAAHAA; utag_main=v_id:01680a2a9c200013725d1ee67abe02068001400d0086e$_sn:1$_ss:1$_st:1546360591204$ses_id:1546358791204%3Bexp-session$_pn:1%3Bexp-session$dc_group:79$dc_visit:1$dc_event:1%3Bexp-session; gig_canary=false; gig_canary_ver=2155-1-25772625; AMCV_A1DF40865A97CDF00A495C28%40AdobeOrg=1999109931%7CMCMID%7C60597001633179420918454649860814799344%7CMCAID%7CNONE; gig_hasGmid=login; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjB7_______9______9uz_Gv_v_f__33e8__9v_l_7_-___u_-33d4-_1vf99yfm1-7ftr3tp_87ues2_Xur__59__3z3_Nog; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE6ACgACAH0AQABOA; 706b604c-184a-4235-899c-a744921ce65cfaktorId=e024bb11-1299-48e3-bde1-107f1e68860c; s_cc=true; s_sq=%5B%5BB%5D%5D; lastConsentChange=1546358793852
Connection: keep-alive
If-None-Match: W/"1f0e3-fT3OIiIk44flJJLFU9CqLmMwCfA"
Cache-Control: max-age=0

$ xidel -s -H "Cookie: CONSENTMGR=ts:1546358787966|consent:true|c1:0; OPTOUTMULTI=0:0%7Cc5:0%7Cc1:0%7Cc4:0%7Cc3:0%7Cc2:0; TN_UUID=edae8abd-659b-477a-8dfe-caf4d718fcd7; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjCAcAAiABUAC4AIAAZABEgCaAJ4AWwAxABuAD8AIAARgApQBXADvAIQARaAjgCOgEuAJ2AVkAuoBgQDiAHugP0A_YCCg; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE54EfETAAQgAAHAA; utag_main=v_id:01680a2a9c200013725d1ee67abe02068001400d0086e$_sn:1$_ss:1$_st:1546360591204$ses_id:1546358791204%3Bexp-session$_pn:1%3Bexp-session$dc_group:79$dc_visit:1$dc_event:1%3Bexp-session; gig_canary=false; gig_canary_ver=2155-1-25772625; AMCV_A1DF40865A97CDF00A495C28%40AdobeOrg=1999109931%7CMCMID%7C60597001633179420918454649860814799344%7CMCAID%7CNONE; gig_hasGmid=login; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjB7_______9______9uz_Gv_v_f__33e8__9v_l_7_-___u_-33d4-_1vf99yfm1-7ftr3tp_87ues2_Xur__59__3z3_Nog; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE6ACgACAH0AQABOA; 706b604c-184a-4235-899c-a744921ce65cfaktorId=e024bb11-1299-48e3-bde1-107f1e68860c; s_cc=true; s_sq=%5B%5BB%5D%5D; lastConsentChange=1546358793852" "https://www.kijk.nl" -e '$raw'

Op deze manier kun je toch kijk.nl scrapen. Misschien is er een kortere/makkelijkere manier.
Gelukkig hoeft dit voor https://embed.kijk.nl/video/[prid] niet.

------------------------------------------------------------------------------------------------

PRID extractie:

$ cat <<EOF | while read a; do xidel -s -e 'extract("'$a'","(?:video|videos)/(\w+)",1)'; done
https://www.kijk.nl/sbs6/hartvannederland/videos/VR83fgb6opk/hart-van-nederland-late-editie
http://www.kijk.nl/video/VR83fgb6opk
EOF

VR83fgb6opk
VR83fgb6opk

------------------------------------------------------------------------------------------------

https://www.kijk.nl/sbs6/hartvannederland/videos/GgO61doGeqZ/hart-van-nederland-vroeg (15-01-2019)

$ xidel -s "https://embed.kijk.nl/video/GgO61doGeqZ" -e 'outer-html(//video)'
<video data-video-id="5989729116001" data-account="585049245001" data-player="B168VjQ3W" data-embed="default" data-application-id="" class="video-js" controls="" width="100%" height="100%" id="player" preload="none"></video>

Hier wordt blijkbaar nog van Brightcove gebruik gemaakt.

$ xidel -s "https://embed.kijk.nl/video/GgO61doGeqZ" -e 'x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json'
{
  "description": "Hart van Nederland - Vroeg",
  "poster_sources": [
    {
      "src": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200121985121-still.jpg"
    }
  ],
  "tags": ["hartvannederlandvroeg", "sbs6", "vod"],
  "cue_points": [],
  "custom_fields": {
    "sbs_videotype": "vod",
    "sbs_adpolicy": "long",
    "sbs_episode": "S2019E11",
    "sbs_program": "hartvannederland",
    "nlz_cst_id": "GgO61doGeqZ",
    "sko_t": "1900",
    "sko_stid": "63",
    "sko_prid": "611490483",
    "sko_pr": "hart_van_nederland__vroeg",
    "sko_ty": "tv.ep",
    "sko_dt": "20190115",
    "sbs_station": "sbs6"
  },
  "account_id": "585049245001",
  "sources": [
    {
      "avg_bitrate": 2.085E6,
      "width": 868,
      "duration": 1.3086E6,
      "size": 3.23033213E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200036985121-bg-1885.mp4",
      "codec": "H264",
      "asset_id": "5989728026001",
      "container": "MP4",
      "height": 488,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": 866000,
      "width": 512,
      "duration": 1.3086E6,
      "size": 1.21766761E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200026985121-bg-650.mp4",
      "codec": "H264",
      "asset_id": "5989728027001",
      "container": "MP4",
      "height": 288,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": 1.116E6,
      "width": 640,
      "duration": 1.3086E6,
      "size": 1.62308598E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200028985121-bg-900.mp4",
      "codec": "H264",
      "asset_id": "5989728344001",
      "container": "MP4",
      "height": 360,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": null,
      "width": null,
      "src": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/sbs6_hartvannederlandvroeg_S2019E11_190115201516985121-hls-main.m3u8",
      "size": 0,
      "height": null,
      "duration": -1,
      "container": "M2TS",
      "codec": "H264",
      "asset_id": "5989730179001"
    },
    {
      "avg_bitrate": 1.465E6,
      "width": 768,
      "duration": 1.3086E6,
      "size": 2.11828455E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200029985121-bg-1200.mp4",
      "codec": "H264",
      "asset_id": "5989730283001",
      "container": "MP4",
      "height": 432,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": 450000,
      "width": 320,
      "duration": 1.3086E6,
      "size": 7.2607446E7,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200022985121-bg-350.mp4",
      "codec": "H264",
      "asset_id": "5989730565001",
      "container": "MP4",
      "height": 180,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    }
  ],
  "name": "Hart van Nederland - Vroeg",
  "reference_id": "sbs6_hartvannederlandvroeg_S2019E11_190115201543",
  "long_description": "'Waar praat Nederland vandaag over?' Toegankelijk nieuwsprogramma dat het gesprek van de dag op verrassende wijze in beeld brengt.",
  "duration": 1.3086E6,
  "economics": "AD_SUPPORTED",
  "published_at": "2019-01-15T19:15:50.278Z",
  "text_tracks": [],
  "updated_at": "2019-01-15T19:15:54.765Z",
  "thumbnail": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200125985121-thumb.jpg",
  "poster": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200121985121-still.jpg",
  "offline_enabled": false,
  "link": null,
  "id": "5989729116001",
  "ad_keys": null,
  "thumbnail_sources": [
    {
      "src": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200125985121-thumb.jpg"
    }
  ],
  "created_at": "2019-01-15T19:15:50.265Z"
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Geen expiration date hier boven. Hier wel:

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/GgO61doGeqZ" -e '$json/playerInfo'
{
  "sbsvpakey": "GgO61doGeqZ",
  "hostingkey": "5989729116001",
  "license": {
    "licenseId": "YnJpZ2h0Y292ZS5GVk9ELjAuNTk4OTcyOTExNjAwMQ==",
    "licensetype": "FVOD",
    "promotions": [],
    "ishd": false,
    "startdate": {
      "date": "2019-01-15 19:30:46.000000",
      "timezone_type": 3,
      "timezone": "Europe/Amsterdam"
    },
    "enddate": {
      "date": "2020-01-15 19:30:46.000000",
      "timezone_type": 3,
      "timezone": "Europe/Amsterdam"
    },
    "price": 0,
    "hascontent": true,
    "preroll": true,
    "hostingkey": "5989729116001",
    "hostingservice": "brightcove",
    "AvailableOutletDevices": [
      [...]
    ]
  },
  "embed_video_url": "//embed.kijk.nl/?video=GgO61doGeqZ",
  "embed_api_url": "http://embed.kijk.nl/api/video/GgO61doGeqZ?id=kijkapp",
  "hasDRM": false
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

$ xidel -s "https://embed.kijk.nl/video/GgO61doGeqZ" --xquery 'x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/GgO61doGeqZ")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(".",$a)||extract(.,"(.+m3u8)",1)}]}'
{
  "name": "SBS6: Hart van Nederland - Vroeg S2019E11",
  "date": "15-01-2019",
  "duration": "00:21:49",
  "expdate": "15-01-2020 19:30:46",
  "formats": [
    {
      "format": "pg-1",
      "container": "mp4[h264+aac]",
      "resolution": "320x180",
      "bitrate": "450kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200022985121-bg-350.mp4"
    },
    {
      "format": "pg-2",
      "container": "mp4[h264+aac]",
      "resolution": "512x288",
      "bitrate": "866kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200026985121-bg-650.mp4"
    },
    {
      "format": "pg-3",
      "container": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1116kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200028985121-bg-900.mp4"
    },
    {
      "format": "pg-4",
      "container": "mp4[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1465kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200029985121-bg-1200.mp4"
    },
    {
      "format": "pg-5",
      "container": "mp4[h264+aac]",
      "resolution": "868x488",
      "vbitrate": "2085k",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200036985121-bg-1885.mp4"
    },
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/sbs6_hartvannederlandvroeg_S2019E11_190115201516985121-hls-main.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[h264+aac]",
      "resolution": "320x180",
      "bitrate": "611kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r1/sbs6_hartvannederlandvroeg_S2019E11_190115200141985121-hls-350.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "512x288",
      "bitrate": "929kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r2/sbs6_hartvannederlandvroeg_S2019E11_190115200150985121-hls-650.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1289kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r3/sbs6_hartvannederlandvroeg_S2019E11_190115200159985121-hls-900.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1643kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r4/sbs6_hartvannederlandvroeg_S2019E11_190115200210985121-hls-1200.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "868x488",
      "bitrate": "2179kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r8/sbs6_hartvannederlandvroeg_S2019E11_190115200212985121-hls-1885.m3u8"
    }
  ]
}

Inmiddels, na een paar dagen, zijn ook deze video's over gezet naar "theplatform" api. Waarschijnlijk gebruikt Kijk Brightcove nog als backup.

------------------------------------------------------------------------------------------------


https://www.kijk.nl/sbs6/hartvannederland/videos/wyK2GhcnFje/hart-van-nederland-vroeg (16-01-2019)

$ xidel -s "https://embed.kijk.nl/video/wyK2GhcnFje" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/fKaRT0ndbesA/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/nxnA_bHJGpLK/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        }
      ],
      "image": "https://img.kijk.nl/media/cache/computer_nonretina_series_image/imgsrc06/images/redactioneel/1081186-LS---20190117100148--39432a5aae5a45a59f87f1de912c84dd.jpg?lu=73647e9a8561c9ec7625b167c3e43bec",
      "mediaid": "wyK2GhcnFje",
      "title": "Hart van Nederland - Vroeg ",
      "description": "Aflevering 12, Seizoen 2019",
      "displaytitle": true,
      "tracks": [],
      "fwassetid": "wyK2GhcnFje",
      "TAQ": {
        "dataLayer": {
          "media_datecreated": 1547661600,
          "media_datemodified": 1547661600,
          "media_datepublished": 1547663352,
          "media_duration": "1272",
          "media_genre": "Nieuws",
          "media_id": "wyK2GhcnFje",
          "media_name": "Hart van Nederland - Vroeg ",
          "media_program_episodenumber": "12",
          "media_program_name": "Hart van Nederland - Vroeg",
          "media_program_season": "2019",
          "media_videotype": "vod",
          "player_channel": "embedded_3p",
          "player_channelid": "embedded_3p",
          "player_embedurl": "http://www.kijk.nl/video/wyK2GhcnFje",
          "player_id": "embedded_3p",
          "player_name": "jwplayer",
          "player_source": "embedded_3p",
          "player_version": "8.2.4"
        },
        "customLayer": {
          "c_media_dateexpires": 1579199352,
          "c_media_duration_type": "long",
          "c_media_genre_code": "nieuws/actualiteiten",
          "c_media_ispartof": "Hart van Nederland - Vroeg",
          "c_media_live": 0,
          "c_media_outlet": "embedded_3p",
          "c_media_partner": "embedded3p",
          "c_media_playbacktype": "vod",
          "c_media_station": "sbs6",
          "c_sko_cl": 1272,
          "c_sko_dt": "20190116",
          "c_sko_gen": 11100,
          "c_sko_pr": "hart_van_nederland_-_vroeg_editie",
          "c_sko_prid": "611490547",
          "c_sko_stid": 63,
          "c_sko_t": "1900",
          "c_sko_ty": "tv.ep"
        }
      }
    }
  ],
  "width": "100%",
  "height": "100%",
  "stretching": "uniform",
  "autostart": "true",
  "skin": {
    "name": "kijk",
    "timeslider": {
      "progress": "#f48800"
    }
  },
  "advertising": {
    "admessage": "",
    "client": "freewheel",
    "cuetext": "Advertentie",
    "vpaidcontrols": true,
    "freewheel": {
      "networkid": "506166",
      "serverid": "https://7b935.v.fwmrm.net/ad/g/1",
      "profileid": "506166:sanoma_sbs_ovp_js_live",
      "sectionid": "sbs_embedded3p_desktop",
      "adManagerURL": "https://mssl.fwmrm.net/p/sanoma_sbs_live/AdManager.js",
      "custom": {
        "cd_type": "long",
        "vdur": "1272",
        "embed_domain": "embed.kijk.nl"
      }
    },
    "schedule": {
      "adbreak": {
        "offset": "pre",
        "tag": "placeholder_preroll"
      }
    }
  },
  "sharing": {
    "heading": "Deel Video",
    "sites": [
      {
        "label": "Facebook",
        "icon": "/talpa-jw-skin/icons/facebook.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=facebook&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FwyK2GhcnFje&title=Hart van Nederland - Vroeg &ct=0&tt=0&"
      },
      {
        "label": "Twitter",
        "icon": "/talpa-jw-skin/icons/twitter.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=twitter&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FwyK2GhcnFje&title=Hart van Nederland - Vroeg &ct=0&tt=0&"
      }
    ]
  },
  "cast": [],
  "related": [],
  "videoType": "vod",
  "adBlockerCheck": true,
  "allowPlayerApi": false
}

$ xidel -s "https://embed.kijk.nl/video/wyK2GhcnFje" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/wyK2GhcnFje")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(".",$a)||extract(.,"(.+m3u8)",1)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/customLayer/concat(upper-case(c_media_station),": ",c_media_ispartof),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"formats":(sources)()[type="m3u8"]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","container":"m3u8[manifest]","url":url}[url],for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "SBS6: Hart van Nederland - Vroeg",
  "date": "16-01-2019",
  "duration": "00:21:12",
  "expdate": "16-01-2020 19:29:12",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]"
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/1547666742988.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "320x180",
      "bitrate": "395|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=395000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "512x288",
      "bitrate": "743|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=743000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "996|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=996000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1313|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=1313000.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "868x488",
      "bitrate": "2032|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=2032000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.kijk.nl/sbs6/wegmisbruikers/videos/yWLXx6VtFuG/wegmisbruikers

$ xidel -s "https://embed.kijk.nl/video/yWLXx6VtFuG" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/6jW4kiLWw7Bz/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/gR9CONHWSQHC/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        }
      ],
      "image": "https://img.kijk.nl/media/cache/computer_nonretina_series_image/imgsrc06/images/redactioneel/1079050-LS---20181214140739--c227486ec6235b395f7a96b978158499.jpg?lu=9d59d19573f5c680d7c96b87afff850d",
      "mediaid": "yWLXx6VtFuG",
      "title": "Wegmisbruikers",
      "description": "Aflevering 4, Seizoen 24",
      "displaytitle": true,
      "tracks": [
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-thumbnails.vtt",
          "type": "webvtt",
          "kind": "thumbnails"
        },
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-sd.vtt",
          "type": "webvtt",
          "kind": "captions",
          "label": " Doven en Slechthorenden"
        },
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-nl.vtt",
          "type": "webvtt",
          "kind": "captions",
          "label": " Nederlands"
        }
      ],
      "fwassetid": "yWLXx6VtFuG",
      "TAQ": {
        "dataLayer": {
          "media_datecreated": 1544815800,
          "media_datemodified": 1544815800,
          "media_datepublished": 1544819058,
          "media_duration": "2403",
          "media_genre": "Scripted Reality",
          "media_id": "yWLXx6VtFuG",
          "media_name": "Wegmisbruikers",
          "media_program_episodenumber": "4",
          "media_program_name": "Wegmisbruikers",
          "media_program_season": "24",
          "media_videotype": "vod",
          "player_channel": "embedded_3p",
          "player_channelid": "embedded_3p",
          "player_embedurl": "http://www.kijk.nl/video/yWLXx6VtFuG",
          "player_id": "embedded_3p",
          "player_name": "jwplayer",
          "player_source": "embedded_3p",
          "player_version": "8.2.4"
        },
        "customLayer": {
          "c_media_dateexpires": 1576355058,
          "c_media_duration_type": "long",
          "c_media_genre_code": "Overige",
          "c_media_ispartof": "Wegmisbruikers",
          "c_media_live": 0,
          "c_media_outlet": "embedded_3p",
          "c_media_partner": "embedded3p",
          "c_media_playbacktype": "vod",
          "c_media_station": "sbs6",
          "c_sko_cl": 2403,
          "c_sko_dt": "20181214",
          "c_sko_gen": 21190,
          "c_sko_pr": "wegmisbruikers",
          "c_sko_prid": "547724877",
          "c_sko_stid": 63,
          "c_sko_t": "2027",
          "c_sko_ty": "tv.ep"
        }
      }
    }
  ],
  "width": "100%",
  "height": "100%",
  "stretching": "uniform",
  "autostart": "true",
  "skin": {
    "name": "kijk",
    "timeslider": {
      "progress": "#f48800"
    }
  },
  "advertising": {
    "admessage": "",
    "client": "freewheel",
    "cuetext": "Advertentie",
    "vpaidcontrols": true,
    "freewheel": {
      "networkid": "506166",
      "serverid": "https://7b935.v.fwmrm.net/ad/g/1",
      "profileid": "506166:sanoma_sbs_ovp_js_live",
      "sectionid": "sbs_embedded3p_desktop",
      "adManagerURL": "https://mssl.fwmrm.net/p/sanoma_sbs_live/AdManager.js",
      "custom": {
        "cd_type": "long",
        "vdur": "2403",
        "embed_domain": "embed.kijk.nl"
      }
    },
    "schedule": {
      "adbreak": {
        "offset": "pre",
        "tag": "placeholder_preroll"
      }
    }
  },
  "sharing": {
    "heading": "Deel Video",
    "sites": [
      {
        "label": "Facebook",
        "icon": "/talpa-jw-skin/icons/facebook.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=facebook&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FyWLXx6VtFuG&title=Wegmisbruikers&ct=0&tt=0&"
      },
      {
        "label": "Twitter",
        "icon": "/talpa-jw-skin/icons/twitter.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=twitter&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FyWLXx6VtFuG&title=Wegmisbruikers&ct=0&tt=0&"
      }
    ]
  },
  "cast": [],
  "related": [],
  "videoType": "vod",
  "adBlockerCheck": true,
  "allowPlayerApi": false
}

$ xidel -s "https://embed.kijk.nl/video/yWLXx6VtFuG" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/yWLXx6VtFuG")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(".",$a)||extract(.,"(.+m3u8)",1)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[type="m3u8"]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","container":"m3u8[manifest]","url":url}[url],for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "SBS6: Wegmisbruikers S24E04",
  "date": "14-12-2018",
  "duration": "00:40:03",
  "expdate": "14-12-2019 21:24:18",
  "subtitle": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-nl.vtt",
  "formats": [
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/1544789330448.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "audiospoor",
      "vbitrate": "",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "637x252",
      "vbitrate": "v:365k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=365058.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "910x360",
      "vbitrate": "v:730k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=730083.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "1092x432",
      "vbitrate": "v:1500k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=1500117.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "1820x720",
      "vbitrate": "v:3000k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=3000297.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "2730x1080",
      "vbitrate": "v:4500k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=4500168.m3u8"
    },
    {
      "format": "hls-7",
      "extension": "m3u8",
      "resolution": "2730x1080",
      "vbitrate": "v:6000k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=6000467.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

http://www.kijk.nl/net5/pekingexpress/videos/w7ZW52xLgL5/aflevering-1

$ xidel -s "https://embed.kijk.nl/video/w7ZW52xLgL5" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/jMeLJuBkEPrN/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/O3MALYiXrEvo/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/DrlDOZ5p_34C/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/7VPyrVZ_p2_F/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/kvXDJgpLCCNY/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/SaZ_Wcowy8f5/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        }
      ],
      [...]
    }
  ],
  [...]
}

De 3 m3u8 playlists zijn allemaal hetzelfde. Daarom kiezen we gewoon de 1e --> (sources)()[type="m3u8"][1]/file.

$ xidel -s "https://embed.kijk.nl/video/w7ZW52xLgL5" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(".",$a)||extract(.,"(.+m3u8)",1)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[type="m3u8"][1]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","container":"m3u8[manifest]","url":url}[url],for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "NET5: Peking Express S01E01",
  "date": "03-04-2017",
  "duration": "01:03:59",
  "expdate": "31-03-2020 04:55:00",
  "subtitle": null,
  "formats": [
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/1535976944566.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "audiospoor",
      "vbitrate": "",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "320x180",
      "vbitrate": "v:350k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=350000.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "512x288",
      "vbitrate": "v:655k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=655000.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:912k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=912000.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "768x432",
      "vbitrate": "v:1214k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=1214000.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "868x488",
      "vbitrate": "v:1898k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=1898000.m3u8"
    }
  ]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5" -e '$json/playerInfo'
{
  [...],
  "embed_api_url": "http://embed.kijk.nl/api/video/w7ZW52xLgL5?id=kijkapp",
  "hasDRM": false
}

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5" -e '$json/playerInfo/json(embed_api_url)'
{
  "vpakey": "w7ZW52xLgL5",
  "videoId": null,
  "mediaId": null,
  "assetId": null,
  "appleTvMediaId": null,
  "roll": "https://embed.kijk.nl/api/roll/",
  "unroll": "https://embed.kijk.nl/api/unroll/",
  "playlist": "https://embed.kijk.nl/api/playlist/.m3u8",
  [...]
}

Dit suggereert dat de Ericsson videostreams niet meer beschikbaar zijn, maar als we de url handmatig samenstellen (zie BatchGemist notes), waarbij de user_token n de app_token blijkbaar niet per se nodig zijn, dan werken ze nog gewoon!

$ xidel -s "https://embed.kijk.nl/api/roll/w7ZW52xLgL5_dbzyr6?base_url=https%3A//emp-prod-acc-we.ebsd.ericsson.net/sbsgroup" -e '$json'
{
  "live": "false",
  "duration": "3840200",
  "markers": [
    {
      "start_offset": "0",
      "duration": "2270840",
      "type": "AD_VAST",
      "data": {}
    },
    {
      "start_offset": "2272000",
      "duration": "1568160",
      "type": "AD_VAST",
      "data": {}
    }
  ],
  "streams": [
    {
      "name": "1080p",
      "bitrate": 7000000,
      "resolution": "1920x1080",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_9/index.m3u8"
    },
    {
      "name": "720p",
      "bitrate": 4500000,
      "resolution": "1280x720",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_7/index.m3u8"
    },
    {
      "name": "576p",
      "bitrate": 2468000,
      "resolution": "1024x576",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_6/index.m3u8"
    },
    {
      "name": "480p",
      "bitrate": 1500000,
      "resolution": "768x432",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_5/index.m3u8"
    },
    {
      "name": "360p",
      "bitrate": 900000,
      "resolution": "640x360",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_4/index.m3u8"
    },
    {
      "name": "240p",
      "bitrate": 500000,
      "resolution": "512x288",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_3/index.m3u8"
    }
  ],
  "playlist_url": "https://embed.kijk.nl/api/playlist/w7ZW52xLgL5_dbzyr6.m3u8",
  "media_url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/"
}

Update: De api-url werkt inmiddels ook niet meer, MAAR de individuele video-urls hier boven vreemd genoeg nog wel.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

https://www.kijk.nl/sbs6/steenrijkstraatarm/videos/UitidpB9Yx5/steenrijk-straatarm

$ xidel -s "https://embed.kijk.nl/video/UitidpB9Yx5" -e 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TzEji1yiQs0E/file.m3u8?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "m3u8",
          "drm": {
            "fairplay": {
              "releasePid": "TzEji1yiQs0E",
              "certificateUrl": "https://vod-tpc-prod-1.talpatvcdn.nl/fairplay.cer",
              "processSpcUrl": "https://fairplay.entitlement.theplatform.eu/fpls/web/FairPlay?form=json&schema=1.0&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TzEji1yiQs0E"
            }
          }
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TyxGZdUvCzwg/file.mpd?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "dash",
          "drm": {
            "playready": {
              "releasePid": "TyxGZdUvCzwg",
              "url": "https://green.playready.entitlement.theplatform.eu/playready/rightsmanager.asmx?form=json&schema=1.0&auth=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TyxGZdUvCzwg"
            }
          }
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TkNGUgBksp7W/file.mpd?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "dash",
          "drm": {
            "widevine": {
              "releasePid": "TkNGUgBksp7W",
              "url": "https://widevine.entitlement.theplatform.eu/wv/web/ModularDrm?form=json&schema=1.0&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TkNGUgBksp7W"
            }
          }
        }
      ],
      [...]
    }
  ],
  [...]
}

DRM n SAMPLE-AES encryptie. FFmpeg ondersteunt dit nog niet, maar omdat het vanwege DRM sowieso niet gaat werken filteren we deze er uit met [not(drm)].

$ xidel -s "https://embed.kijk.nl/video/UitidpB9Yx5" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/UitidpB9Yx5")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(".",$a)||extract(.,"(.+m3u8)",1)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[not(drm) and type="m3u8"][1]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","container":"m3u8[manifest]","url":url}[url],for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "SBS6: Steenrijk, straatarm S03E03",
  "date": "09-01-2019",
  "duration": "00:41:35",
  "expdate": "09-01-2024 21:28:03",
  "subtitle": null,
  "formats": null
}

------------------------------------------------------------------------------------------------

--xquery '
  if (//video) then
    x:request(
      {
        "headers":"Accept: application/json;pk="||extract(
          unparsed-text(
            //script[
              contains(
                @src,
                //@data-account
              )
            ]/@src
          ),
          "policyKey:""(.+?)""",
          1
        ),
        "url":concat(
          "https://edge.api.brightcove.com/playback/v1/accounts/",
          //@data-account,
          "/videos/",
          //@data-video-id
        )
      }
    )/json/{
      "name":concat(
        upper-case(custom_fields/sbs_station),
        ": ",
        name,
        if (custom_fields/sbs_episode) then
          " "||custom_fields/sbs_episode
        else
          ()
      ),
      "date":replace(
        custom_fields/sko_dt,
        "(\d{4})(\d{2})(\d{2})",
        "$3-$2-$1"
      ),
      "duration":round(
        duration div 1000
      ) * duration("PT1S") + time("00:00:00"),
      "expdate":replace(
        json("http://api.kijk.nl/v1/default/entitlement/UitidpB9Yx5")//enddate/date,
        "(\d+)-(\d+)-(\d+) ([\d:]+).*",
        "$3-$2-$1 $4"
      ),
      "formats":let $a:=(sources)()[size=0]/src return [
        for $x at $i in (sources)()[stream_name]
        order by $x/size
        count $i
        return
        $x/{
          "format":"pg-"||$i,
          "container":"mp4[h264+aac]",
          "resolution":concat(
            width,
            "x",
            height
          ),
          "bitrate":round(
            avg_bitrate div 1000
          )||"kbps",
          "url":replace(
            stream_name,
            "mp4:",
            extract(
              $a,
              "(.+?nl/)",
              1
            )
          )
        },{
          "format":"hls-0",
          "container":"m3u8[manifest]",
          "url":$a
        }[url],
        tail(
          tokenize(
            unparsed-text($a),
            "#EXT-X-STREAM-INF:"
          )
        ) ! {
          "format":"hls-"||position(),
          "container":if (
            contains(
              .,
              "avc1"
            )
          ) then
            "m3u8[h264+aac]"
          else
            "m3u8[aac]",
          "resolution":extract(
            .,
            "RESOLUTION=([\dx]+)",
            1
          ),
          "bitrate":round(
            extract(
              .,
              "BANDWIDTH=(\d+)",
              1
            ) div 1000
          )||"kbps",
          "url":resolve-uri(
            ".",
            $a
          )||extract(
            .,
            "(.+m3u8)",
            1
          )
        }
      ]
    }
  else
    json(
      //script/extract(
        .,
        "playerConfig = (.+);",
        1
      )[.]
    )/(playlist)()/{
      "name":TAQ/concat(
        upper-case(customLayer/c_media_station),
        ": ",
        customLayer/c_media_ispartof,
        if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then
          concat(
            " S",
            dataLayer/media_program_season ! (
              if (.<10) then
                "0"||.
              else
                .
            ),
            "E",
            dataLayer/media_program_episodenumber ! (
              if (.<10) then
                "0"||.
              else
                .
            )
          )
        else
          ()
      ),
      "date":replace(
        TAQ/customLayer/c_sko_dt,
        "(\d{4})(\d{2})(\d{2})",
        "$3-$2-$1"
      ),
      "duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),
      "expdate":format-dateTime(
        TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),
        "[D01]-[M01]-[Y] [H01]:[m01]:[s01]"
      ),
      "subtitle":(tracks)()[label=" Nederlands"]/file,
      "formats":[
        (sources)()[not(drm) and type="m3u8"][1]/x:request(
          {
            "url":file,
            "method":"HEAD"
          }
        )/(
          {
            "format":"hls-0",
            "container":"m3u8[manifest]",
            "url":url
          }[url],
          for $x at $i in tail(
            tokenize(
              extract(
                unparsed-text(url),
                "(#EXT-X-STREAM-INF.+m3u8$)",
                1,"ms"
              ),
              "#EXT-X-STREAM-INF:"
            )
          ) order by extract(
            $x,
            "BANDWIDTH=(\d+)",
            1
          ) count $i
          return {
            "format":"hls-"||$i,
            "container":if (
              contains(
                $x,
                "avc1"
              )
            ) then
              "m3u8[h264+aac]"
            else
              "m3u8[aac]",
            "resolution":extract(
              $x,
              "RESOLUTION=([\dx]+)",
              1
            )[.],
            "bitrate":let $a:=extract(
              $x,
              "audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",
              (1,2)
            ) return
            join(
              (
                $a[2][.],
                $a[1]
              ),
              "|"
            )||"kbps"
            "url":resolve-uri(
              ".",
              url
            )||extract(
              $x,
              "(.+m3u8)",
              1
            )
          }
        )
      ]
    }
'

================================================================================================================================

[tvblik,uitzendinggemist]

$ cat <<EOF | while read a; do xidel -s "$a" -e '//div[@id="embed-player"]/(@data-episode,.//@href)'; done
https://tvblik.nl/journaal/nos-851
https://tvblik.nl/rtl-nieuws/laat-997
https://tvblik.nl/hart-van-nederland/15-januari-2019
EOF
//www.npostart.nl/embed/nos-journaal/15-01-2019/POW_04060130
http://www.rtlxl.nl/#!/_rtl-nieuws-132237/02b2833d-48dd-3a08-b6cd-8dbadcf8fba4?utm_medium=refferal&utm_source=tvblik
//embed.kijk.nl/?width=640&height=360&video=GgO61doGeqZ&autoplay=1

$ cat <<EOF | while read a; do xidel -s "$a" -e '//a[@rel="nofollow"]/@onclick,//iframe[@class="sbsEmbed"]/@src'; done
https://www.uitzendinggemist.net/aflevering/461995/Nos_Journaal.html
https://www.uitzendinggemist.net/aflevering/462016/Rtl_Nieuws_1930_Uur.html
https://www.uitzendinggemist.net/aflevering/462122/Hart_Van_Nederland.html
EOF
window.open('http://www.npo.nl/aa-aa/01-01-2015/POW_04059331','winname',"directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=yes,resizable=no,width=800,height=600");
window.open('http://www.rtlxl.nl/#!/zzzz/9483a466-6424-3dff-99fd-2d558a950e3e','winname',"directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=yes,resizable=no,width=1024,height=600");
https://embed.kijk.nl/?width=720&height=410&video=GgO61doGeqZ

$ cat <<EOF | while read a; do xidel -s "$a" -e 'join(extract((//div[@id="embed-player"]/(@data-episode,.//@href),//a[@rel="nofollow"]/@onclick,//iframe[@class="sbsEmbed"]/@src),"(npo|rtl|kijk).+(?:/|video=)([\w-]+)",(1,2)))'; done
https://tvblik.nl/journaal/nos-851
https://tvblik.nl/rtl-nieuws/laat-997
https://tvblik.nl/hart-van-nederland/15-januari-2019
https://www.uitzendinggemist.net/aflevering/461995/Nos_Journaal.html
https://www.uitzendinggemist.net/aflevering/462016/Rtl_Nieuws_1930_Uur.html
https://www.uitzendinggemist.net/aflevering/462122/Hart_Van_Nederland.html
EOF
npo POW_04060130
rtl 02b2833d-48dd-3a08-b6cd-8dbadcf8fba4
kijk rEFjefrsn1A
npo POW_04059331
rtl 9483a466-6424-3dff-99fd-2d558a950e3e
kijk GgO61doGeqZ

------------------------------------------------------------------------------------------------

-e '
  join(
    extract(
      (
        //div[@id="embed-player"]/(
          @data-episode,
          .//@href
        ),
        //a[@rel="nofollow"]/@onclick,
        //iframe[@class="sbsEmbed"]/@src
      ),
      "(npo|rtl|kijk).+(?:/|video=)([\w-]+)",
      (1,2)
    )
  )
'

================================================================================================================================

[youtube]

https://www.youtube.com/watch?v=nG_LtCRRZ20

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/(title,json(player_response)/streamingData//lastModified,length_seconds)'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
1548978611083579
1548978609684393
1548979118812685
1548978611887433
1548982696251964
1548978905736975
1548978905736975
1548978905736975
1548978905731670
1548978905736975
1548978905736975
1548978771474489
1093

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/(title,json(player_response)/min(streamingData//lastModified),length_seconds)'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
1548978609684393
1093

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/(title,json(player_response)/decimal(round(min(streamingData//lastModified) div 1000000)),length_seconds)'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
1548978610
1093

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/(title,json(player_response)/round(min(streamingData//lastModified) div 1000000) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),length_seconds * duration("PT1S") + time("00:00:00"))'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
2019-02-01T00:50:10
00:18:13

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/{"name":title,"date":format-date(json(player_response)/round(min(streamingData//lastModified) div 1000000) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y]"),"duration":length_seconds * duration("PT1S") + time("00:00:00")}'
{
  "name": "Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)",
  "date": "01-02-2019",
  "duration": "00:18:13"
}

------------------------------------------------------------------------------------------------

https://github.com/rg3/youtube-dl/blob/master/youtube_dl/extractor/youtube.py#L1822: "# bitrate for itag 43 is always 2147483647".
Negeren dus. En sorteren op bestandsgrootte. Anders komt "pg-4" met "bitrate": "2147484kbps" onderaan.

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/[for $x at $i in (formats)() order by $x/contentLength count $i return $x/{"format":"pg-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)\..+ (\w+)(?:\.|"")",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat(width,"x",height),"bitrate":if (.[itag="43"]) then () else round(bitrate div 1000)||"kbps","url":url}]'
[
  {
    "format": "pg-1",
    "container": "3gp[mp4v+aac]",
    "resolution": "176x144",
    "bitrate": "82kbps",
    "url": "<url>"
  },
  {
    "format": "pg-2",
    "container": "3gp[mp4v+aac]",
    "resolution": "320x180",
    "bitrate": "226kbps",
    "url": "<url>"
  },
  {
    "format": "pg-3",
    "container": "mp4[h264+aac]",
    "resolution": "640x360",
    "bitrate": "489kbps",
    "url": "<url>"
  },
  {
    "format": "pg-4",
    "container": "webm[vp8+vorbis]",
    "resolution": "640x360",
    "bitrate": null,
    "url": "<url>"
  },
  {
    "format": "pg-5",
    "container": "mp4[h264+aac]",
    "resolution": "1280x720",
    "bitrate": "1603kbps",
    "url": "<url>"
  }
]

------------------------------------------------------------------------------------------------

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/dashManifestUrl'
https://manifest.googlevideo.com/api/manifest/dash/mv/m/ipbits/0/expire/1549179524/id/9c6fcbb42451676d/mn/sn-mn4vg5aa-5hns%2Csn-5hne6ns6/mm/31%2C29/ms/au%2Crdu/sparams/as%2Cei%2Chfr%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cplayback_host%2Crequiressl%2Csource%2Cexpire/source/youtube/pl/15/itag/0/key/yt6/ip/x.x.x.x/initcwndbps/1607500/hfr/all/requiressl/yes/fvip/1/ei/JEZWXKbuHNGh8gOLipXoBw/as/fmp4_audio_clear%2Cfmp4_sd_hd_clear/playback_host/r4---sn-mn4vg5aa-5hns.googlevideo.com/mt/1549157740/signature/7CD75240ECBD2EA2A037A50EB7A8D6A8BECE1959.5A728D695D4624475A812F9818D5953BD84544DB

Zonder "disable_polymer" zijn de DASH streams vreemd genoeg helemaal niet te openen (met FFmpeg, of MPC-HC) (zie https://github.com/rg3/youtube-dl/issues/14083).
Sorteer op de aanwezigheid van @width, zodat de audio-only streams bovenaan komen, n vervolgens op @bandwidth.

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/[for $x at $i in doc(dashManifestUrl||"/disable_polymer/true")//Representation order by $x/boolean(@width),$x/@bandwidth count $i return $x/{"format":"dash-"||$i,"container":concat(substring-after(../@mimeType,"/"),"[",substring-before(@codecs,".") ! (if (.="mp4a") then "aac" else if (.="avc1") then "h264" else .),"]"),"resolution":if (@width) then concat(@width,"x",@height,"@",@frameRate,"fps") else (),"samplerate":if (@audioSamplingRate) then (@audioSamplingRate div 1000)||"kHz" else (),"bitrate":round(@bandwidth div 1000)||"kbps","url":BaseUrl}]'
[
  {
    "format": "dash-1",
    "container": "mp4[aac]",
    "resolution": null,
    "samplerate": "22.05kHz",
    "bitrate": "51kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/139/source/youtube/requiressl/yes/mv/m/ms/au,rdu/ei/2iZeXPboPM-R1gKsjbnQAQ/mn/sn-mn4vg5aa-5hns,sn-5hne6ns6/pl/15/mm/31,29/initcwndbps/1453750/ratebypass/yes/mime/audio%2Fmp4/otfp/1/gir/yes/clen/6663680/lmt/1548978770075323/dur/1092.684/mt/1549674036/fvip/1/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549695803/sparams/ip,ipbits,expire,id,itag,source,requiressl,mv,ms,ei,mn,pl,mm,initcwndbps,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/25FA0E634366E6B671774E784B593771DA201605.80AC248E5977BF50197BE7BA31D39AFC2AD6D88F/key/dg_yt0/"
  },
  {
    "format": "dash-2",
    "container": "mp4[aac]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "131kbps",
    "url": "<url>"
  },
  {
    "format": "dash-3",
    "container": "mp4[h264]",
    "resolution": "256x144@25fps",
    "samplerate": null,
    "bitrate": "108kbps",
    "url": "<url>"
  },
  {
    "format": "dash-4",
    "container": "mp4[h264]",
    "resolution": "426x240@25fps",
    "samplerate": null,
    "bitrate": "242kbps",
    "url": "<url>"
  },
  {
    "format": "dash-5",
    "container": "mp4[h264]",
    "resolution": "640x360@25fps",
    "samplerate": null,
    "bitrate": "613kbps",
    "url": "<url>"
  },
  {
    "format": "dash-6",
    "container": "mp4[h264]",
    "resolution": "854x480@25fps",
    "samplerate": null,
    "bitrate": "1155kbps",
    "url": "<url>"
  },
  {
    "format": "dash-7",
    "container": "mp4[h264]",
    "resolution": "1280x720@25fps",
    "samplerate": null,
    "bitrate": "2310kbps",
    "url": "<url>"
  },
  {
    "format": "dash-8",
    "container": "mp4[h264]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "2866kbps",
    "url": "<url>"
  }
]

------------------------------------------------------------------------------------------------

https://www.youtube.com/watch?v=5jOjwN_uJt0 (geen DASH manifest)

"&disable_polymer=true" is blijkt hier niet nodig te zijn.

$ xidel -s "https://www.youtube.com/watch?v=5jOjwN_uJt0" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/[for $x at $i in (adaptiveFormats)() order by $x/boolean(width),$x/bitrate count $i return $x/{"format":"dash-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)(?:\.|"")",(1,2)) return concat($a[1],"[",if ($a[2]="mp4a") then "aac" else if ($a[2]="avc1") then "h264" else $a[2],"]"),"resolution":if (width) then concat(width,"x",height,"@",fps,"fps") else (),"samplerate":if (audioSampleRate) then (audioSampleRate div 1000)||"kHz" else (),"bitrate":round(bitrate div 1000)||"kbps","url":url}]'
[
  {
    "format": "dash-1",
    "container": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "53kbps",
    "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?lmt=1441752806379607&expire=1549693637&fvip=1&keepalive=yes&requiressl=yes&gir=yes&mime=audio%2Fwebm&source=youtube&clen=6884987&signature=82DF7076702F74EB8FA0B1791BB802B1571A8501.42F558484EBCCA329E6C3499B2B751364B17BB20&ei=ZR5eXLrkIIuMgAflzJCQCw&c=WEB&key=yt6&ipbits=0&mv=m&dur=1127.101&mt=1549671941&itag=249&ms=au%2Crdu&initcwndbps=1740000&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&id=o-AHTPT0WYgpXcvEYrmwRNTDi_kSOvrOBSUgqV-1Z3eXJq&mn=sn-mn4vg5aa-5hns%2Csn-5hne6nsr&ip=x.x.x.x&mm=31%2C29&pl=15"
  },
  {
    "format": "dash-2",
    "container": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "69kbps",
    "url": "<url>"
  },
  {
    "format": "dash-3",
    "container": "webm[vorbis]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "126kbps",
    "url": "<url>"
  },
  {
    "format": "dash-4",
    "container": "mp4[aac]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "129kbps",
    "url": "<url>"
  },
  {
    "format": "dash-5",
    "container": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "136kbps",
    "url": "<url>"
  },
  {
    "format": "dash-6",
    "container": "webm[vp9]",
    "resolution": "256x144@13fps",
    "samplerate": null,
    "bitrate": "102kbps",
    "url": "<url>"
  },
  {
    "format": "dash-7",
    "container": "mp4[h264]",
    "resolution": "256x144@13fps",
    "samplerate": null,
    "bitrate": "116kbps",
    "url": "<url>"
  },
  {
    "format": "dash-8",
    "container": "webm[vp9]",
    "resolution": "426x240@25fps",
    "samplerate": null,
    "bitrate": "239kbps",
    "url": "<url>"
  },
  {
    "format": "dash-9",
    "container": "mp4[h264]",
    "resolution": "426x240@25fps",
    "samplerate": null,
    "bitrate": "250kbps",
    "url": "<url>"
  },
  {
    "format": "dash-10",
    "container": "webm[vp9]",
    "resolution": "640x360@25fps",
    "samplerate": null,
    "bitrate": "441kbps",
    "url": "<url>"
  },
  {
    "format": "dash-11",
    "container": "mp4[h264]",
    "resolution": "640x360@25fps",
    "samplerate": null,
    "bitrate": "602kbps",
    "url": "<url>"
  },
  {
    "format": "dash-12",
    "container": "webm[vp9]",
    "resolution": "854x480@25fps",
    "samplerate": null,
    "bitrate": "732kbps",
    "url": "<url>"
  },
  {
    "format": "dash-13",
    "container": "mp4[h264]",
    "resolution": "854x480@25fps",
    "samplerate": null,
    "bitrate": "1108kbps",
    "url": "<url>"
  },
  {
    "format": "dash-14",
    "container": "webm[vp9]",
    "resolution": "1280x720@25fps",
    "samplerate": null,
    "bitrate": "1454kbps",
    "url": "<url>"
  },
  {
    "format": "dash-15",
    "container": "mp4[h264]",
    "resolution": "1280x720@25fps",
    "samplerate": null,
    "bitrate": "2211kbps",
    "url": "<url>"
  },
  {
    "format": "dash-16",
    "container": "webm[vp9]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "2340kbps",
    "url": "<url>"
  },
  {
    "format": "dash-17",
    "container": "mp4[h264]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "3307kbps",
    "url": "<url>"
  }
]

------------------------------------------------------------------------------------------------

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/{"name":title,"date":format-date(json(player_response)/round(min(streamingData//lastModified) div 1000000) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y]"),"duration":length_seconds * duration("PT1S") + time("00:00:00"),"formats":json(player_response)/streamingData/[for $x at $i in (formats)() order by $x/contentLength count $i return $x/{"format":"pg-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)\..+ (\w+)(?:\.|"")",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat(width,"x",height),"bitrate":if (.[itag="43"]) then () else round(bitrate div 1000)||"kbps","url":url},if (dashManifestUrl) then for $x at $i in doc(dashManifestUrl||"/disable_polymer/true")//Representation order by $x/boolean(@width),$x/@bandwidth count $i return $x/{"format":"dash-"||$i,"container":concat(substring-after(../@mimeType,"/"),"[",substring-before(@codecs,".") ! (if (.="mp4a") then "aac" else if (.="avc1") then "h264" else .),"]"),"resolution":if (@width) then concat(@width,"x",@height,"@",@frameRate,"fps") else (),"samplerate":if (@audioSamplingRate) then (@audioSamplingRate div 1000)||"kHz" else (),"bitrate":round(@bandwidth div 1000)||"kbps","url":BaseUrl} else for $x at $i in (adaptiveFormats)() order by $x/boolean(width),$x/bitrate count $i return $x/{"format":"dash-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)(?:\.|"")",(1,2)) return concat($a[1],"[",if ($a[2]="mp4a") then "aac" else if ($a[2]="avc1") then "h264" else $a[2],"]"),"resolution":if (width) then concat(width,"x",height,"@",fps,"fps") else (),"samplerate":if (audioSampleRate) then (audioSampleRate div 1000)||"kHz" else (),"bitrate":round(bitrate div 1000)||"kbps","url":url}]}'
{
  "name": "Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)",
  "date": "01-02-2019",
  "duration": "00:18:13",
  "formats": [
    {
      "format": "pg-1",
      "container": "3gp[mp4v+aac]",
      "resolution": "176x144",
      "bitrate": "82kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.684&initcwndbps=1631250&pl=15&source=youtube&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2F3gpp&key=yt6&ipbits=0&lmt=1548978611083579&itag=17&mt=1549737053&mv=m&signature=D4947A55DF7DE68D594096B061A10448C00BFB11.079C5D1BEAF718E9CF890403F321EA329FE5A6F8&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2211222&clen=11222522&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-2",
      "container": "3gp[mp4v+aac]",
      "resolution": "320x180",
      "bitrate": "226kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.684&initcwndbps=1631250&pl=15&source=youtube&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2F3gpp&key=yt6&ipbits=0&lmt=1548978611887433&itag=36&mt=1549737053&mv=m&signature=337E7434E41F0684B85C3EC347F7C4B9566AF318.9DB23D65CF8375B64AF747CA897DE1D7D05F29B6&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2211222&clen=30802449&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-3",
      "container": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "489kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.661&initcwndbps=1631250&pl=15&source=youtube&ratebypass=yes&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2Fmp4&key=yt6&ipbits=0&lmt=1548978609684393&itag=18&mt=1549737053&mv=m&signature=CF12F8D7E99F8881BAE60768442B7BAC4D0AAE45.68C82F9E2D6176079BBCEC5ABC696A854F16667F&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2211222&clen=66756108&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-4",
      "container": "webm[vp8+vorbis]",
      "resolution": "640x360",
      "bitrate": null,
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=0.000&initcwndbps=1631250&pl=15&source=youtube&ratebypass=yes&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2Fwebm&key=yt6&ipbits=0&lmt=1548982696251964&itag=43&mt=1549737053&mv=m&signature=F114DF1FDA12F510E245D6AC22B9FC45C89995.ACC70506FD614DD314E24CE490FCB8CF3AD47F9E&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2201222&clen=104456295&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-5",
      "container": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "1603kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.638&initcwndbps=1631250&pl=15&source=youtube&ratebypass=yes&mv=m&signature=7C6F1FB2F7D6C88227CB0063987199B83B4863B0.7BFC2A609AD9C16A6DE3E920C789FE21D7FEA1CC&ms=au%2Crdu&mm=31%2C29&requiressl=yes&c=WEB&ipbits=0&fvip=1&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2216222&expire=1549758822&mime=video%2Fmp4&key=yt6&ip=x.x.x.x&mt=1549737053&lmt=1548979118812685&sparams=dur%2Cei%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg&itag=22"
    },
    {
      "format": "dash-1",
      "container": "mp4[aac]",
      "resolution": null,
      "samplerate": "22.05kHz",
      "bitrate": "51kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/139/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/audio%2Fmp4/otfp/1/gir/yes/clen/6663680/lmt/1548978770075323/dur/1092.684/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/20CFECEFFDA4974E8EF9ADA8F3D464B97E34F538.1D18EBF41FCF1BD41C9568D3D20C3DFB74112ADB/key/dg_yt0/"
    },
    {
      "format": "dash-2",
      "container": "mp4[aac]",
      "resolution": null,
      "samplerate": "44.1kHz",
      "bitrate": "131kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/140/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/audio%2Fmp4/otfp/1/gir/yes/clen/17683882/lmt/1548978771474489/dur/1092.638/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/7634564956B37D2C680A27D629304EC0631E3534.3BE34846B67FFA9B81C0634DE7AC4959012FDE12/key/dg_yt0/"
    },
    {
      "format": "dash-3",
      "container": "mp4[h264]",
      "resolution": "256x144@25fps",
      "samplerate": null,
      "bitrate": "108kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/160/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/104EB8B8D9DF68CDEC2FB85C2BE7B932CCC4C43F.601C57AD4676CE4917E891298311635E29F3B3BE/key/dg_yt0/"
    },
    {
      "format": "dash-4",
      "container": "mp4[h264]",
      "resolution": "426x240@25fps",
      "samplerate": null,
      "bitrate": "242kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/133/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/3E73EDB00FC2CBBACCB01F5B9238EB23D0986D24.193D84ABA7735F1EE5C47944AA46C3B4744C8076/key/dg_yt0/"
    },
    {
      "format": "dash-5",
      "container": "mp4[h264]",
      "resolution": "640x360@25fps",
      "samplerate": null,
      "bitrate": "613kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/134/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/gir/yes/clen/43381806/lmt/1548978905731670/dur/1092.600/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/808FA1B02B5FA26F8EF5C201EAEFBD3BACC2220D.3E7B4F85D2F6A586D4E22EAF29C95FEE924B8F97/key/dg_yt0/"
    },
    {
      "format": "dash-6",
      "container": "mp4[h264]",
      "resolution": "854x480@25fps",
      "samplerate": null,
      "bitrate": "1155kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/135/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/604E9621CE0583CEB7B775BC6F1CC85294BE2B0E.18630B3226A21DDF03D1AD2CFC7FEAB5DD3E7736/key/dg_yt0/"
    },
    {
      "format": "dash-7",
      "container": "mp4[h264]",
      "resolution": "1280x720@25fps",
      "samplerate": null,
      "bitrate": "2310kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/136/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/76355BA9C8CE0E3F1CA8C802E54FE7E70352D9B8.2DD87F8AA56BF3B0A5D2E20A518E5BE01304C842/key/dg_yt0/"
    },
    {
      "format": "dash-8",
      "container": "mp4[h264]",
      "resolution": "1280x720@50fps",
      "samplerate": null,
      "bitrate": "2866kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/298/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/gir/yes/clen/214600383/lmt/1548978905736975/dur/1092.580/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/2D0A6E57DE795D101CBB7AB42812BF4D59080D38.575112699B6ADAF94ABA0B32B19FE42F47260F3C/key/dg_yt0/"
    }
  ]
}


$ xidel -s "https://www.youtube.com/watch?v=5jOjwN_uJt0" --xquery '[...]'
{
  "name": "Delta Impuls 1 - De Treffers '70 2 (Noordelijke 2e Divisie, 07-02-2014)",
  "date": "08-09-2015",
  "duration": "00:18:47",
  "formats": [
    {
      "format": "pg-1",
      "container": "3gp[mp4v+aac]",
      "resolution": "176x144",
      "bitrate": "83kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?pl=15&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&c=WEB&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&expire=1549742862&ip=x.x.x.x&lmt=1441749284641801&ei=rt5eXOq0ItTMgAebxbaYBw&dur=1127.235&mt=1549721136&mv=m&ms=au%2Crdu&key=yt6&signature=79D5955FF71BD16F5A95547851BA5BC02A6823A8.35423E399281706935B525009BDA6E596D30E5F0&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=17&gir=yes&clen=11635486&mm=31%2C29&mime=video%2F3gpp&ipbits=0&fvip=1&requiressl=yes"
    },
    [...]
    {
      "format": "pg-5",
      "container": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1127.166&pl=15&sparams=dur%2Cei%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&mv=m&ms=au%2Crdu&key=yt6&signature=13AC49E30F4678DC1D7D0DF4178FD64E68987469.6AAFDFB9FB1138E08F9D7F1145D32B135A91E409&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=22&c=WEB&mm=31%2C29&mime=video%2Fmp4&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&expire=1549742862&ipbits=0&fvip=1&ip=x.x.x.x&lmt=1471212014981809&requiressl=yes&ratebypass=yes&mt=1549721136&ei=rt5eXOq0ItTMgAebxbaYBw"
    },
    {
      "format": "dash-1",
      "container": "webm[opus]",
      "resolution": null,
      "samplerate": "48kHz",
      "bitrate": "53kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?pl=15&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&keepalive=yes&c=WEB&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&expire=1549742862&ip=x.x.x.x&lmt=1441752806379607&ei=rt5eXOq0ItTMgAebxbaYBw&dur=1127.101&mt=1549721136&mv=m&ms=au%2Crdu&key=yt6&signature=D68D7638F50EBB2ADE96D7A6B1FA4E8217615D7F.314D24819328E12B854E6F5FF6B4DA889E4D6EF0&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=249&gir=yes&clen=6884987&mm=31%2C29&mime=audio%2Fwebm&ipbits=0&fvip=1&requiressl=yes"
    },
    [...]
    {
      "format": "dash-17",
      "container": "mp4[h264]",
      "resolution": "1280x720@50fps",
      "samplerate": null,
      "bitrate": "3307kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?pl=15&sparams=aitags%2Cclen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&keepalive=yes&c=WEB&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&aitags=133%2C134%2C135%2C136%2C160%2C242%2C243%2C244%2C247%2C278%2C298%2C302&ip=x.x.x.x&lmt=1441750875452025&ei=rt5eXOq0ItTMgAebxbaYBw&dur=1127.100&mt=1549721136&mv=m&ms=au%2Crdu&key=yt6&signature=C355EBFEE568DC3D179C9ADC3D916CA1BF632056.14A6B00BE2C5C7013B3BC78B60047740997173AB&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=298&gir=yes&clen=356351764&mm=31%2C29&mime=video%2Fmp4&expire=1549742862&ipbits=0&fvip=1&requiressl=yes"
    }
  ]
}

$ ./bashgemist.sh -i https://www.youtube.com/watch?v=nG_LtCRRZ20
Formaten:  formaat  container         resolutie       frequentie  bitrate
           pg-1     3gp[mp4v+aac]     176x144                     82kbps
           pg-2     3gp[mp4v+aac]     320x180                     226kbps
           pg-3     mp4[h264+aac]     640x360                     489kbps
           pg-4     webm[vp8+vorbis]  640x360
           pg-5     mp4[h264+aac]     1280x720                    1603kbps
           dash-1   mp4[aac]                          22.05kHz    51kbps
           dash-2   mp4[aac]                          44.1kHz     131kbps
           dash-3   mp4[h264]         256x144@25fps               108kbps
           dash-4   mp4[h264]         426x240@25fps               242kbps
           dash-5   mp4[h264]         640x360@25fps               613kbps
           dash-6   mp4[h264]         854x480@25fps               1155kbps
           dash-7   mp4[h264]         1280x720@25fps              2310kbps
           dash-8   mp4[h264]         1280x720@50fps              2866kbps  (best)

------------------------------------------------------------------------------------------------

--xquery '
  json(
    //script/extract(
      .,
      "ytplayer.config = (.+?\});",
      1
    )[.]
  )/args/{
    "name":title,
    "date":format-date(
      json(player_response)/round(
        min(streamingData//lastModified) div 1000000
      ) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),
      "[D01]-[M01]-[Y]"
    ),
    "duration":length_seconds * duration("PT1S") + time("00:00:00"),
    "formats":json(player_response)/streamingData/[
      for $x at $i in (formats)()
      order by $x/contentLength
      count $i
      return
      $x/{
        "format":"pg-"||$i,
        "container":let $a:=extract(
          mimeType,
          "/(.+);.+?(\w+)\..+ (\w+)(?:\.|"")",
          (1 to 3)
        ) return
        concat(
          if ($a[1]="3gpp") then
            "3gp"
          else
            $a[1],
          "[",
          if ($a[2]="avc1") then
            "h264"
          else
            $a[2],
          "+",
          if ($a[3]="mp4a") then
            "aac"
          else
            $a[3],
          "]"
        ),
        "resolution":concat(
          width,
          "x",
          height
        ),
        "bitrate":if (.[itag="43"]) then
          ()
        else
          round(
            bitrate div 1000
          )||"kbps",
        "url":url
      },
      if (dashManifestUrl) then
        for $x at $i in doc(
          dashManifestUrl||"/disable_polymer/true"
        )//Representation
        order by $x/boolean(@width),
                 $x/@bandwidth
        count $i
        return
        $x/{
          "format":"dash-"||$i,
          "container":concat(
            substring-after(
              ../@mimeType,
              "/"
            ),
            "[",
            substring-before(
              @codecs,
              "."
            ) ! (
              if (.="mp4a") then
                "aac"
              else if (.="avc1") then
                "h264"
              else
                .
            ),
            "]"
          ),
          "resolution":if (@width) then
            concat(
              @width,
              "x",
              @height,
              "@",
              @frameRate,
              "fps"
            )
          else
            (),
          "samplerate":if (@audioSamplingRate) then
            (@audioSamplingRate div 1000)||"kHz"
          else
            (),
          "bitrate":round(
            @bandwidth div 1000
          )||"kbps",
          "url":BaseUrl
        }
      else
        for $x at $i in (adaptiveFormats)()
        order by $x/boolean(width),
                 $x/bitrate
        count $i
        return
        $x/{
          "format":"dash-"||$i,
          "container":let $a:=extract(
            mimeType,
            "/(.+);.+?(\w+)(?:\.|"")",
            (1,2)
          ) return
          concat(
            $a[1],
            "[",
            if ($a[2]="mp4a") then
              "aac"
            else if ($a[2]="avc1") then
              "h264"
            else
              $a[2],
            "]"
          ),
          "resolution":if (width) then
            concat(
              width,
              "x",
              height,
              "@",
              fps,
              "fps"
            )
          else
            (),
          "samplerate":if (audioSampleRate) then
            (audioSampleRate div 1000)||"kHz"
          else
            (),
          "bitrate":round(
            bitrate div 1000
          )||"kbps",
          "url":url
        }
    ]
  }
'
