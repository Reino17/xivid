[npo]

https://www.npostart.nl/nos-journaal/12-12-2018/POW_03689795

$ xidel -s "http://e.omroep.nl/metadata/POW_03689795" --xquery '
  json(
    extract(
      $raw,
      "\((.+)\)",
      1
    )
  )[not(error)]/{
    "name":if (medium="live") then
      titel||": Livestream"
    else
      replace(
        concat(
          if (count(.//naam)=1) then
            .//naam
          else
            join(
              .//naam,
              " en "
            ),
          ": ",
          if (ptype="episode") then
            if (aflevering_titel) then
              if (
                contains(
                  titel,
                  aflevering_titel
                )
              ) then
                titel
              else
                if (
                  contains(
                    aflevering_titel,
                    titel
                  )
                ) then
                  aflevering_titel
                else
                  concat(
                    titel,
                    " - ",
                    aflevering_titel
                  )
            else
              titel
          else
            concat(
              .//serie_titel,
              " - ",
              titel
            )
        ),
        "[&quot;&apos;]",
        "'\'\''"
      ),
    "date":if (medium="live") then
      "'$(date "+%d-%m-%Y")'"
    else (
      if (gidsdatum) then
        replace(
          gidsdatum,
          "(\d+)-(\d+)-(\d+)",
          "$3-$2-$1"
        )
      else
        if (
          matches(
            "https://www.npostart.nl/nos-journaal/12-12-2018/POW_03689795",
            "\d{2}-\d{2}-\d{4}"
          )
        ) then
          extract(
            "https://www.npostart.nl/nos-journaal/12-12-2018/POW_03689795",
            ".+/([\d-]+)",
            1
          )
        else
          extract(
            x:request(
              {
                "url":"https://www.npostart.nl/POW_03689795",
                "method":"HEAD"
              }
            )/url,
            ".+/([\d-]+)",
            1
          )
    ),
    "duration":if (tijdsduur) then
      tijdsduur
    else
      (),
    "start":start,
    "end":eind,
    "expdate":if (publicatie_eind) then
      replace(
        publicatie_eind,
        "(\d+)-(\d+)-(\d+)T([\d:]+).+",
        "$3-$2-$1 $4"
      )
    else
      (),
    "subtitle":if (tt888="ja") then
      "http://tt888.omroep.nl/tt888/"||prid
    else
      (),
    "formats":let $a:=x:request(
          {
            "url":"http://ida.omroep.nl/app.php/POW_03689795?token="||json(
              "http://ida.omroep.nl/app.php/auth"
            )/token,
            "error-handling":"4xx=accept"
          }
        )[
          contains(
            headers[1],
            "200"
          )
        ]/json/(items)()(),
        $b:=$a[format="hls"]/x:request(
          {
            "url":replace(
              url,
              "jsonp",
              "json"
            ),
            "error-handling":"4xx=accept"
          }
        )[
          contains(
            headers[1],
            "200"
          )
        ]/(
          if (json instance of string) then
            json
          else
            json/url
        ),
        $c:=[
          reverse(
            $a[contentType="odi"][format="mp4"]
          )/x:request(
            {
              "url":replace(
                url,
                "jsonp",
                "json"
              ),
              "error-handling":"4xx=accept"
            }
          )[
            contains(
              headers[1],
              "200"
            )
          ]/json/substring-before(
            url,
            "?"
          ) ! {
            "format":"pg-"||position(),
            "extension":"m4v",
            "url":.
          },
          {
            "format":"hls-0",
            "extension":"m3u8",
            "resolution":"manifest",
            "url":$b
          }[url],
          for $x at $i in tail(
            tokenize(
              extract(
                unparsed-text($b),
                "(#EXT-X-STREAM-INF.+m3u8$)",
                1,"ms"
              ),
              "#EXT-X-STREAM-INF:"
            )
          ) order by extract(
            $x,
            "BANDWIDTH=(\d+)",
            1
          ) count $i
          return {
            "format":"hls-"||$i,
            "extension":"m3u8",
            "resolution":extract(
              $x,
              "RESOLUTION=([\dx]+)",
              1
            ) ! (
              if (.) then
                .
              else
                "audiospoor"
            ),
            "vbitrate":extract(
              $x,
              "video=(\d+)\d{3}",
              1
            ) ! (
              if (.) then
                concat(
                  "v:",
                  .,
                  "k"
                )
              else
                ""
            ),
            "abitrate":replace(
              $x,
              ".+audio.+?(\d+)\d{3}.+",
              "a:$1k","s"
            ),
            "url":resolve-uri(
              ".",
              $b
            )||extract(
              $x,
              "(.+m3u8)",
              1
            )
          },
          reverse(
            $a[contentType="url"][format="mp4"]
          )/x:request(
            {
              "url":url,
              "method":"HEAD",
              "error-handling":"xxx=accept"
            }
          )[
            some $x in ("200","302") satisfies contains(
              headers[1],
              $x
            )
          ]/(
            if (
              contains(
                url,
                "content-ip"
              )
            ) then
              x:request(
                {
                  "url":"https://ipv4-api.nos.nl/resolve.php/video?url="||uri-encode(url),
                  "method":"HEAD"
                }
              )/url
            else
              url
          ) ! {
            "format":"mp4-"||position(),
            "extension":extract(
              .,
              ".+\.(.+)",
              1
            ),
            "url":.
          }
        ]
    return
    if ($c()) then
      $c
    else
      ()
  }
'
{
  "name": "NOS: NOS Journaal",
  "date": "12-12-2018",
  "duration": "00:24:39",
  "start": null,
  "end": null,
  "expdate": "01-01-2101 00:59:00",
  "subtitle": "http://tt888.omroep.nl/tt888/POW_03689795",
  "formats": [
    {
      "format": "pg-1",
      "extension": "m4v",
      "url": "https://content10c1b.omroep.nl/urishieldv2/l27m5a1b0a7d738bd144005c11a640000000.da077fb61a0c5933f1ae79863ff6a403/ceresodi/h264/p/12/10/10/f6/sb_POW_03689795.m4v"
    },
    {
      "format": "pg-2",
      "extension": "m4v",
      "url": "https://content10c1a.omroep.nl/urishieldv2/l27m05b6ed9143e505af005c11a640000000.c920edf4f11ccb22769034bacb65fc39/ceresodi/h264/p/12/10/10/f6/bb_POW_03689795.m4v"
    },
    {
      "format": "pg-3",
      "extension": "m4v",
      "url": "https://content10c3c.omroep.nl/urishieldv2/l27m07a681274325394d005c11a640000000.0b3f7b41a5e3ecfa9417d26dd3f7d31a/ceresodi/h264/p/12/10/10/f6/std_POW_03689795.m4v"
    },
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "480x270",
      "vbitrate": "v:203k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=203000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "480x270",
      "vbitrate": "v:203k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=203000.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "480x270",
      "vbitrate": "v:203k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=203000.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:505k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=505000.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:505k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=505000.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:505k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=505000.m3u8"
    },
    {
      "format": "hls-7",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1109k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=1109000.m3u8"
    },
    {
      "format": "hls-8",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1109k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=1109000.m3u8"
    },
    {
      "format": "hls-9",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1109k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=1109000.m3u8"
    },
    {
      "format": "hls-10",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1810k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=96000-video=1810000.m3u8"
    },
    {
      "format": "hls-11",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1810k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=128000-video=1810000.m3u8"
    },
    {
      "format": "hls-12",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1810k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4b.npostreaming.nl/urishieldv2/l27m7221b08871bf8532005c11a641000000.e93717a7833dfa2ddc8f4d281895e2b0/p/12/10/10/5c/POW_03689795/POW_03689795.ism/POW_03689795-audio=192000-video=1810000.m3u8"
    }
  ]
}

https://www.npostart.nl/de-laatste-minuten/17-12-2018/POMS_AT_15009224
{
  "name": "AVROTROS: Hunted - De laatste minuten...",
  "date": "17-12-2018",
  "duration": "00:01:59",
  "start": "00:55:06",
  "end": "00:57:05",
  "expdate": "01-01-2101 00:59:00",
  "subtitle": "http://tt888.omroep.nl/tt888/AT_2105785",
  "formats": [
    {
      "format": "pg-1",
      "extension": "m4v",
      "url": "https://content10c4b.omroep.nl/urishieldv2/l27m6c2ec29c3fcf372e005c276570000000.b055f6717fc4e0b8ea2ae9042d1291e2/ceresodi/h264/p/06/10/10/f7/sb_AT_2105785.m4v"
    },
    {
      "format": "pg-2",
      "extension": "m4v",
      "url": "https://content10c4c.omroep.nl/urishieldv2/l27m34ec48023fb78477005c276570000000.171fddf89df4a5190ac631f86a056b63/ceresodi/h264/p/06/10/10/f7/bb_AT_2105785.m4v"
    },
    {
      "format": "pg-3",
      "extension": "m4v",
      "url": "https://content10c4a.omroep.nl/urishieldv2/l27m3187fe3c262e9d50005c276570000000.d1015a8a55fc8f98ef42e675570af912/ceresodi/h264/p/06/10/10/f7/std_AT_2105785.m4v"
    },
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "480x270",
      "vbitrate": "v:202k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=202000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "480x270",
      "vbitrate": "v:202k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=202000.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "480x270",
      "vbitrate": "v:202k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=202000.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:504k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=504000.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:504k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=504000.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:504k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=504000.m3u8"
    },
    {
      "format": "hls-7",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1109k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=1109000.m3u8"
    },
    {
      "format": "hls-8",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1109k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=1109000.m3u8"
    },
    {
      "format": "hls-9",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1109k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=1109000.m3u8"
    },
    {
      "format": "hls-10",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1813k",
      "abitrate": "a:96k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=96000-video=1813000.m3u8"
    },
    {
      "format": "hls-11",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1813k",
      "abitrate": "a:128k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=128000-video=1813000.m3u8"
    },
    {
      "format": "hls-12",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1813k",
      "abitrate": "a:192k",
      "url": "https://adaptive-e10c4a.npostreaming.nl/urishieldv2/l27m1f18e65b7d86dd64005c276570000000.3ef7e652a756367aa5d38a4933f1a866/p/06/10/10/5d/AT_2105785/AT_2105785.ism/AT_2105785-audio=192000-video=1813000.m3u8"
    }
  ]
}

https://www.npostart.nl/live/npo-1
{
  "name": "NPO 1: Livestream",
  "date": "29-12-2018",
  "duration": null,
  "start": null,
  "end": null,
  "expdate": null,
  "subtitle": null,
  "formats": [
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "audiospoor",
      "vbitrate": "",
      "abitrate": "a:128k",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "384x216",
      "vbitrate": "v:200k",
      "abitrate": "a:128k",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=200000.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "480x270",
      "vbitrate": "v:499k",
      "abitrate": "a:128k",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=499968.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:699k",
      "abitrate": "a:128k",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=699968.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "768x432",
      "vbitrate": "v:1000k",
      "abitrate": "a:128k",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=1000000.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "1024x576",
      "vbitrate": "v:1800k",
      "abitrate": "a:128k",
      "url": "https://smoote1e.omroep.nl/urishieldv2/l2fm336d5956703e265a005c278b66000000.d32446ac4749f1a1c62ccb75fc1bde7d/live/npo/tvlive/npo1/npo1.isml/npo1-audio_nld=128000-video=1800000.m3u8"
    }
  ]
}

================================================================================================================================

[rtl]

https://www.rtl.nl/video/143d56f6-816e-3757-961d-eba686183076

$ xidel -s "http://www.rtl.nl/system/s4m/vfd/version=2/uuid=143d56f6-816e-3757-961d-eba686183076/fmt=adaptive/" --xquery '
  $json[
    not(
      meta/nr_of_videos_total=0
    )
  ]/{
    "name":replace(
      concat(
        .//station,
        ": ",
        abstracts/name,
        " - ",
        if (.//classname="uitzending") then
          episodes/name
        else
          .//title
      ),
      "[&quot;&apos;]",
      "'\'\''"
    ),
    "date":replace(
      (material)()/original_date * duration("PT1S") + date("1970-01-01"),
      "(\d+)-(\d+)-(\d+)",
      "$3-$2-$1"
    ),
    "duration":format-time(
      time((material)()/duration) + duration("PT0.5S"),
      "[H01]:[m01]:[s01]"
    ),
    "expdate":if ((.//ddr_timeframes)()[model="AVOD"]/stop) then
      replace(
        (.//ddr_timeframes)()[model="AVOD"]/stop * duration("PT1S") + dateTime("1970-01-01T00:00:00"),
        "(\d+)-(\d+)-(\d+)T(.+)",
        "$3-$2-$1 $4"
      )
    else
      (),
    "formats":let $a:=.//videohost||.//videopath return [
      {
        "format":"hls-0",
        "extension":"m3u8",
        "resolution":"manifest",
        "url":$a
      },
      for $x at $i in tail(
        tokenize(
          unparsed-text($a),
          "#EXT-X-STREAM-INF:"
        )
      ) order by extract(
        $x,
        "BANDWIDTH=(\d+)",
        1
      ) count $i
      return {
        "format":"hls-"||$i,
        "extension":"m3u8",
        "resolution":extract(
          $x,
          "RESOLUTION=([\dx]+)",
          1
        ) ! (
          if (.) then
            .
          else
            "audiospoor"
        ),
        "vbitrate":extract(
          $x,
          "video=(\d+)\d{3}",
          1
        ) ! (
          if (.) then
            concat(
              "v:",
              .,
              "k"
            )
          else
            ""
        ),
        "abitrate":replace(
          $x,
          ".+audio.+?(\d+)\d{3}.+",
          "a:$1k","s"
        ),
        "url":let $b:=extract(
          $x,
          "(.+m3u8)",
          1
        ) return
        if (
          starts-with(
            $b,
            "http"
          )
        ) then
          $b
        else
          resolve-uri(
            ".",
            $a
          )||$b
      }
    ]
  }
'
{
  "name": "RTL4: RTL Nieuws - 19:30 uur",
  "date": "11-12-2018",
  "duration": "00:20:18",
  "expdate": "12-12-2019 05:35:25",
  "formats": [
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "http://manifest.us.rtl.nl/rtlxl/v166/network/pc/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "audiospoor",
      "vbitrate": "",
      "abitrate": "a:125k",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "711x400",
      "vbitrate": "v:903k",
      "abitrate": "a:125k",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=903000.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "912x512",
      "vbitrate": "v:2093k",
      "abitrate": "a:125k",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=2093000.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "1280x720",
      "vbitrate": "v:3805k",
      "abitrate": "a:125k",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=3805000.m3u8"
    }
  ]
}

================================================================================================================================

[-i, --info]

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json() return $b'
name
date
duration
start
end
expdate
subtitle
formats

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] return $b'
name
date
duration
start
end
expdate
subtitle

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return $b'
name
date
duration
expdate
subtitle

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return $b ! $a(.)'
Naam:
Datum:
Tijdsduur:
Gratis tot:
Ondertiteling:

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return max($b ! $a(.) ! string-length(.))'
14

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) return string-join((1 to $c+1) ! "#")'
###############

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)),$d:=string-join((1 to $c+1) ! " ") return $b ! concat(substring($a(.)||$d,1,$c+1),$json(.))'
Naam:          NOS: NOS Journaal
Datum:         12-12-2018
Tijdsduur:     00:24:39
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/POW_03689795

------------------------------------------------------------------------------------------------
$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '533,597p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]] return max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9)'
9

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '533,597p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " ") return $b ! concat(substring($a(.)||$d,1,$c+1),$json(.))' -e '"Formaten:"'
Naam:     NPO 1: Livestream
Datum:    29-12-2018
Formaten:

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate") return $f ! $e(1)(.)'
formaat
extensie
resolutie
bitrate

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate") return $f ! max($e()(.) ! string-length(.))'
7
8
9
7
6

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)) return string-join((1 to sum($g)) ! "#")'
#####################################

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") for $x in $e(1) return concat(substring("Formaten:"||$d,1,$c+1),string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)))'
Formaten:      formaat  extensie  resolutie  bitrate

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ())'
Formaten:      formaat  extensie  resolutie  bitrate
               pg-1     m4v
               pg-2     m4v
               pg-3     m4v
               hls-0    m3u8      manifest
               hls-1    m3u8      480x270    v:203k   a:96k
               hls-2    m3u8      480x270    v:203k   a:128k
               hls-3    m3u8      480x270    v:203k   a:192k
               hls-4    m3u8      640x360    v:505k   a:96k
               hls-5    m3u8      640x360    v:505k   a:128k
               hls-6    m3u8      640x360    v:505k   a:192k
               hls-7    m3u8      1024x576   v:1109k  a:96k
               hls-8    m3u8      1024x576   v:1109k  a:128k
               hls-9    m3u8      1024x576   v:1109k  a:192k
               hls-10   m3u8      1024x576   v:1810k  a:96k
               hls-11   m3u8      1024x576   v:1810k  a:128k
               hls-12   m3u8      1024x576   v:1810k  a:192k  (best)

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '273,400p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()))'
Naam:          NOS: NOS Journaal
Datum:         12-12-2018
Tijdsduur:     00:24:39
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/POW_03689795
Formaten:      formaat  extensie  resolutie  bitrate
               pg-1     m4v
               pg-2     m4v
               pg-3     m4v
               hls-0    m3u8      manifest
               hls-1    m3u8      480x270    v:203k   a:96k
               hls-2    m3u8      480x270    v:203k   a:128k
               hls-3    m3u8      480x270    v:203k   a:192k
               hls-4    m3u8      640x360    v:505k   a:96k
               hls-5    m3u8      640x360    v:505k   a:128k
               hls-6    m3u8      640x360    v:505k   a:192k
               hls-7    m3u8      1024x576   v:1109k  a:96k
               hls-8    m3u8      1024x576   v:1109k  a:128k
               hls-9    m3u8      1024x576   v:1109k  a:192k
               hls-10   m3u8      1024x576   v:1810k  a:96k
               hls-11   m3u8      1024x576   v:1810k  a:128k
               hls-12   m3u8      1024x576   v:1810k  a:192k  (best)

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '533,597p' | xidel -s - --xquery '[...]'
Naam:     NPO 1: Livestream
Datum:    29-12-2018
Formaten: formaat  extensie  resolutie   bitrate
          hls-0    m3u8      manifest
          hls-1    m3u8      audiospoor           a:128k
          hls-2    m3u8      384x216     v:200k   a:128k
          hls-3    m3u8      480x270     v:499k   a:128k
          hls-4    m3u8      640x360     v:699k   a:128k
          hls-5    m3u8      768x432     v:1000k  a:128k
          hls-6    m3u8      1024x576    v:1800k  a:128k  (best)

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '403,530p' | xidel -s - -e 'if (start) then (time(start) - (seconds-from-time(start) mod 30 * dayTimeDuration("PT1S")),seconds-from-time(start) mod 30,duration) else ()'
00:55:00
6
00:01:59

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '403,530p' | xidel -s - -e 'if (start) then concat("Download: ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * dayTimeDuration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]") else ()'
Download: ffmpeg -ss 00:55:00 -i [url] -ss 6 -t 00:01:59 [...]
------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '403,530p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()),if (start) then ("",concat(substring("Download:"||$d,1,$c+1),"ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * dayTimeDuration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]")) else ())'
Naam:          AVROTROS: Hunted - De laatste minuten...
Datum:         17-12-2018
Tijdsduur:     00:01:59
Begin:         00:55:06
Einde:         00:57:05
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/AT_2105785
Formaten:      formaat  extensie  resolutie  bitrate
               pg-1     m4v
               pg-2     m4v
               pg-3     m4v
               hls-0    m3u8      manifest
               hls-1    m3u8      480x270    v:202k   a:96k
               hls-2    m3u8      480x270    v:202k   a:128k
               hls-3    m3u8      480x270    v:202k   a:192k
               hls-4    m3u8      640x360    v:504k   a:96k
               hls-5    m3u8      640x360    v:504k   a:128k
               hls-6    m3u8      640x360    v:504k   a:192k
               hls-7    m3u8      1024x576   v:1109k  a:96k
               hls-8    m3u8      1024x576   v:1109k  a:128k
               hls-9    m3u8      1024x576   v:1109k  a:192k
               hls-10   m3u8      1024x576   v:1813k  a:96k
               hls-11   m3u8      1024x576   v:1813k  a:128k
               hls-12   m3u8      1024x576   v:1813k  a:192k  (best)

Download:      ffmpeg -ss 00:55:00 -i [url] -ss 6 -t 00:01:59 [...]

$ cat <<EOF | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[position()<count($json())] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","extension":"extensie","resolution":"resolutie","vbitrate":"bitrate"},$json/(formats)()],$f:=("format","extension","resolution","vbitrate","abitrate"),$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),if ($e(2)) then for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()) else substring("Formaten:"||$d,1,$c+1)||"-",if (start) then ("",concat(substring("Download:"||$d,1,$c+1),"ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * dayTimeDuration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]")) else ())'
{
  "name": "VPRO: Zigeunermuziek doet pijn - Bob Entrop, VPRO, 2008 (58 min.)",
  "date": "21-07-2010",
  "duration": "00:58:00",
  "start": null,
  "end": null,
  "expdate": null,
  "subtitle": null,
  "formats": null
}
EOF
Naam:      VPRO: Zigeunermuziek doet pijn - Bob Entrop, VPRO, 2008 (58 min.)
Datum:     21-07-2010
Tijdsduur: 00:58:00
Formaten:  -

------------------------------------------------------------------------------------------------

--xquery '
  let $a:={
        "name":"Naam:",
        "date":"Datum:",
        "duration":"Tijdsduur:",
        "start":"Begin:",
        "end":"Einde:",
        "expdate":"Gratis tot:",
        "subtitle":"Ondertiteling:"
      },
      $b:=$json()[
        position()<count($json())
      ] ! .[$json(.)[.]],
      $c:=max(
        $b ! $a(.) ! string-length(.)
      ) ! (
        if (.>9) then
          .
        else
          9
      ),
      $d:=string-join(
        (1 to $c+1) ! " "
      ),
      $e:=[
        {
          "format":"formaat",
          "extension":"extensie",
          "resolution":"resolutie",
          "vbitrate":"bitrate"
        },
        $json/(formats)()
      ],
      $f:=(
        "format",
        "extension",
        "resolution",
        "vbitrate",
        "abitrate"
      ),
      $g:=$f ! max(
        $e()(.) ! string-length(.)
      ),
      $h:=string-join(
        (1 to sum($g)) ! " "
      )
  return (
    $b ! concat(
      substring(
        $a(.)||$d,
        1,
        $c+1
      ),
      $json(.)
    ),
    if ($e(2)) then
      for $x at $i in $e() return
      concat(
        if ($i=1) then
          substring(
            "Formaten:"||$d,
            1,
            $c+1
          )
        else
          $d,
        string-join(
          for $y at $i in $f return
          substring(
            $x($y)||$h,
            1,
            $g[$i]+2
          )
        ),
        if ($i=count($e())) then
          "(best)"
        else
          ()
      )
    else
      substring(
        "Formaten:"||$d,
        1,
        $c+1
      )||"-",
    if (start) then (
      "",
      concat(
        substring(
          "Download:"||$d,
          1,
          $c+1
        ),
        "ffmpeg -ss ",
        time(start) - (
          seconds-from-time(start) mod 30 * dayTimeDuration("PT1S")
        ),
        " -i [url] -ss ",
        seconds-from-time(start) mod 30,
        " -t ",
        duration,
        " [...]"
      )
    ) else
      ()
  )
'

================================================================================================================================

[kijk]

https://www.kijk.nl/ --> https://consent.talpanetwork.com/?TN_REFERAL_URL=https://www.kijk.nl/&TN_REFERAL_ORIGIN= (cookie wall)

Antwoordheader in PaleMoon:

Host: www.kijk.nl
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:60.9) Gecko/20100101 Goanna/4.1 Firefox/60.9 PaleMoon/28.2.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: nl,en-US;q=0.7,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://consent.talpanetwork.com/?TN_REFERAL_URL=https:%2F%2Fwww.kijk.nl%2F&TN_REFERAL_ORIGIN=
Cookie: CONSENTMGR=ts:1546358787966|consent:true|c1:0; OPTOUTMULTI=0:0%7Cc5:0%7Cc1:0%7Cc4:0%7Cc3:0%7Cc2:0; TN_UUID=edae8abd-659b-477a-8dfe-caf4d718fcd7; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjCAcAAiABUAC4AIAAZABEgCaAJ4AWwAxABuAD8AIAARgApQBXADvAIQARaAjgCOgEuAJ2AVkAuoBgQDiAHugP0A_YCCg; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE54EfETAAQgAAHAA; utag_main=v_id:01680a2a9c200013725d1ee67abe02068001400d0086e$_sn:1$_ss:1$_st:1546360591204$ses_id:1546358791204%3Bexp-session$_pn:1%3Bexp-session$dc_group:79$dc_visit:1$dc_event:1%3Bexp-session; gig_canary=false; gig_canary_ver=2155-1-25772625; AMCV_A1DF40865A97CDF00A495C28%40AdobeOrg=1999109931%7CMCMID%7C60597001633179420918454649860814799344%7CMCAID%7CNONE; gig_hasGmid=login; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjB7_______9______9uz_Gv_v_f__33e8__9v_l_7_-___u_-33d4-_1vf99yfm1-7ftr3tp_87ues2_Xur__59__3z3_Nog; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE6ACgACAH0AQABOA; 706b604c-184a-4235-899c-a744921ce65cfaktorId=e024bb11-1299-48e3-bde1-107f1e68860c; s_cc=true; s_sq=%5B%5BB%5D%5D; lastConsentChange=1546358793852
Connection: keep-alive
If-None-Match: W/"1f0e3-fT3OIiIk44flJJLFU9CqLmMwCfA"
Cache-Control: max-age=0

$ xidel -s -H "Cookie: CONSENTMGR=ts:1546358787966|consent:true|c1:0; OPTOUTMULTI=0:0%7Cc5:0%7Cc1:0%7Cc4:0%7Cc3:0%7Cc2:0; TN_UUID=edae8abd-659b-477a-8dfe-caf4d718fcd7; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjCAcAAiABUAC4AIAAZABEgCaAJ4AWwAxABuAD8AIAARgApQBXADvAIQARaAjgCOgEuAJ2AVkAuoBgQDiAHugP0A_YCCg; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE54EfETAAQgAAHAA; utag_main=v_id:01680a2a9c200013725d1ee67abe02068001400d0086e$_sn:1$_ss:1$_st:1546360591204$ses_id:1546358791204%3Bexp-session$_pn:1%3Bexp-session$dc_group:79$dc_visit:1$dc_event:1%3Bexp-session; gig_canary=false; gig_canary_ver=2155-1-25772625; AMCV_A1DF40865A97CDF00A495C28%40AdobeOrg=1999109931%7CMCMID%7C60597001633179420918454649860814799344%7CMCAID%7CNONE; gig_hasGmid=login; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjB7_______9______9uz_Gv_v_f__33e8__9v_l_7_-___u_-33d4-_1vf99yfm1-7ftr3tp_87ues2_Xur__59__3z3_Nog; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE6ACgACAH0AQABOA; 706b604c-184a-4235-899c-a744921ce65cfaktorId=e024bb11-1299-48e3-bde1-107f1e68860c; s_cc=true; s_sq=%5B%5BB%5D%5D; lastConsentChange=1546358793852" "https://www.kijk.nl" -e '$raw'

Op deze manier kun je toch kijk.nl scrapen. Misschien is er een kortere/makkelijkere manier.
Gelukkig hoeft dit voor https://embed.kijk.nl/video/[prid] niet.

------------------------------------------------------------------------------------------------

PRID extractie:

$ cat <<EOF | while read a; do xidel -s -e 'extract("'$a'","(?:video|videos)/(\w+)",1)'; done
> https://www.kijk.nl/sbs6/hartvannederland/videos/VR83fgb6opk/hart-van-nederland-late-editie
> http://www.kijk.nl/video/VR83fgb6opk
> EOF
VR83fgb6opk
VR83fgb6opk

------------------------------------------------------------------------------------------------

https://www.kijk.nl/sbs6/hartvannederland/videos/VR83fgb6opk/hart-van-nederland-late-editie

$ xidel -s "https://embed.kijk.nl/video/VR83fgb6opk" -e 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/HMCkPcawlk2N/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/vL8zQQsuabAa/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        }
      ],
      "image": "https://img.kijk.nl/media/cache/computer_nonretina_series_image/imgsrc06/images/redactioneel/1066581-LS---20181123141846--dbda47f1d5640cd53033c71c0575c46d.jpg?lu=35c71f76acbc843b6aa4333ef7936e11",
      "mediaid": "VR83fgb6opk",
      "title": "Hart van Nederland - Late Editie",
      "description": "Hart van Nederland - Laat: 31 december 2018",
      "displaytitle": true,
      "tracks": [],
      "fwassetid": "VR83fgb6opk",
      "TAQ": {
        "dataLayer": {
          "media_datecreated": 1546291800,
          "media_datemodified": 1546291800,
          "media_datepublished": 1546291935,
          "media_duration": "1331",
          "media_genre": "Nieuws",
          "media_id": "VR83fgb6opk",
          "media_name": "Hart van Nederland - Late Editie",
          "media_program_episodenumber": "2018123101025653",
          "media_program_name": "Hart van Nederland - Laat",
          "media_program_season": "0",
          "media_videotype": "vod",
          "player_channel": "embedded_3p",
          "player_channelid": "embedded_3p",
          "player_embedurl": "http://www.kijk.nl/video/VR83fgb6opk",
          "player_id": "embedded_3p",
          "player_name": "jwplayer",
          "player_source": "embedded_3p",
          "player_version": "8.2.4"
        },
        "customLayer": {
          "c_media_dateexpires": 1577768100,
          "c_media_duration_type": "long",
          "c_media_genre_code": "nieuws/actualiteiten",
          "c_media_ispartof": "Hart van Nederland - Laat",
          "c_media_live": 0,
          "c_media_outlet": "embedded_3p",
          "c_media_partner": "embedded3p",
          "c_media_playbacktype": "vod",
          "c_media_station": "sbs6",
          "c_sko_cl": 1331,
          "c_sko_dt": "20181231",
          "c_sko_gen": 11100,
          "c_sko_pr": "hart_van_nederland_-_late_editie",
          "c_sko_prid": "506400113",
          "c_sko_stid": 63,
          "c_sko_t": "2232",
          "c_sko_ty": "tv.ep"
        }
      }
    }
  ],
  "width": "100%",
  "height": "100%",
  "stretching": "uniform",
  "autostart": "true",
  "skin": {
    "name": "kijk",
    "timeslider": {
      "progress": "#f48800"
    }
  },
  "advertising": {
    "admessage": "",
    "client": "freewheel",
    "cuetext": "Advertentie",
    "vpaidcontrols": true,
    "freewheel": {
      "networkid": "506166",
      "serverid": "https://7b935.v.fwmrm.net/ad/g/1",
      "profileid": "506166:sanoma_sbs_ovp_js_live",
      "sectionid": "sbs_embedded3p_desktop",
      "adManagerURL": "https://mssl.fwmrm.net/p/sanoma_sbs_live/AdManager.js",
      "custom": {
        "cd_type": "long",
        "vdur": "1331",
        "embed_domain": "embed.kijk.nl"
      }
    },
    "schedule": {
      "adbreak": {
        "offset": "pre",
        "tag": "placeholder_preroll"
      }
    }
  },
  "sharing": {
    "heading": "Deel Video",
    "sites": [
      {
        "label": "Facebook",
        "icon": "/talpa-jw-skin/icons/facebook.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=facebook&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FVR83fgb6opk&title=Hart van Nederland - Late Editie&ct=0&tt=0&"
      },
      {
        "label": "Twitter",
        "icon": "/talpa-jw-skin/icons/twitter.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=twitter&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FVR83fgb6opk&title=Hart van Nederland - Late Editie&ct=0&tt=0&"
      }
    ]
  },
  "cast": [],
  "related": [],
  "videoType": "vod",
  "adBlockerCheck": true,
  "allowPlayerApi": false
}

$ cat bashgemist_notes.txt | sed -n '1100,1217p' | xidel -s - --xquery '$json/(playlist)()/{"name":TAQ/customLayer/concat(upper-case(c_media_station),": ",c_media_ispartof),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * dayTimeDuration("PT1S") + time("00:00:00"),"expdate":replace(TAQ/customLayer/c_media_dateexpires * dayTimeDuration("PT1S") + dateTime("1970-01-01T01:00:00"),"(\d+)-(\d+)-(\d+)T(.+)","$3-$2-$1 $4"),"formats":(sources)()[type="m3u8"][1]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","extension":"m3u8","resolution":"manifest","url":url},for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"extension":"m3u8","resolution":extract($x,"RESOLUTION=([\dx]+)",1) ! (if (.) then . else "audiospoor"),"vbitrate":extract($x,"video=(\d+)\d{3}",1) ! (if (.) then concat("v:",.,"k") else ""),"abitrate":replace($x,".+audio.+?(\d+)\d{3}.+","a:$1k","s"),"url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "SBS6: Hart van Nederland - Laat",
  "date": "31-12-2018",
  "duration": "00:22:11",
  "expdate": "31-12-2019 05:55:00",
  "formats": [
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/VR83fgb6opk/1e000a29-b1bf-4704-b9db-251a49c30de0/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index.ism/1546295155126.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "audiospoor",
      "vbitrate": "",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/VR83fgb6opk/1e000a29-b1bf-4704-b9db-251a49c30de0/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index.ism/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index-audio_eng=94000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "320x180",
      "vbitrate": "v:398k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/VR83fgb6opk/1e000a29-b1bf-4704-b9db-251a49c30de0/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index.ism/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index-audio_eng=94000-video=398000.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "512x288",
      "vbitrate": "v:754k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/VR83fgb6opk/1e000a29-b1bf-4704-b9db-251a49c30de0/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index.ism/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index-audio_eng=94000-video=754000.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:1044k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/VR83fgb6opk/1e000a29-b1bf-4704-b9db-251a49c30de0/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index.ism/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index-audio_eng=94000-video=1044000.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "768x432",
      "vbitrate": "v:1387k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/VR83fgb6opk/1e000a29-b1bf-4704-b9db-251a49c30de0/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index.ism/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index-audio_eng=94000-video=1387000.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "868x488",
      "vbitrate": "v:2170k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/VR83fgb6opk/1e000a29-b1bf-4704-b9db-251a49c30de0/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index.ism/Hart_van_Nederland_Laat_Season_0_Episode_2018123101025653-index-audio_eng=94000-video=2170000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.kijk.nl/sbs6/wegmisbruikers/videos/yWLXx6VtFuG/wegmisbruikers

$ xidel -s "https://embed.kijk.nl/video/yWLXx6VtFuG" -e 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/6jW4kiLWw7Bz/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/gR9CONHWSQHC/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        }
      ],
      "image": "https://img.kijk.nl/media/cache/computer_nonretina_series_image/imgsrc06/images/redactioneel/1079050-LS---20181214140739--c227486ec6235b395f7a96b978158499.jpg?lu=9d59d19573f5c680d7c96b87afff850d",
      "mediaid": "yWLXx6VtFuG",
      "title": "Wegmisbruikers",
      "description": "Aflevering 4, Seizoen 24",
      "displaytitle": true,
      "tracks": [
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-thumbnails.vtt",
          "type": "webvtt",
          "kind": "thumbnails"
        },
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-sd.vtt",
          "type": "webvtt",
          "kind": "captions",
          "label": " Doven en Slechthorenden"
        },
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-nl.vtt",
          "type": "webvtt",
          "kind": "captions",
          "label": " Nederlands"
        }
      ],
      "fwassetid": "yWLXx6VtFuG",
      "TAQ": {
        "dataLayer": {
          "media_datecreated": 1544815800,
          "media_datemodified": 1544815800,
          "media_datepublished": 1544819058,
          "media_duration": "2403",
          "media_genre": "Scripted Reality",
          "media_id": "yWLXx6VtFuG",
          "media_name": "Wegmisbruikers",
          "media_program_episodenumber": "4",
          "media_program_name": "Wegmisbruikers",
          "media_program_season": "24",
          "media_videotype": "vod",
          "player_channel": "embedded_3p",
          "player_channelid": "embedded_3p",
          "player_embedurl": "http://www.kijk.nl/video/yWLXx6VtFuG",
          "player_id": "embedded_3p",
          "player_name": "jwplayer",
          "player_source": "embedded_3p",
          "player_version": "8.2.4"
        },
        "customLayer": {
          "c_media_dateexpires": 1576355058,
          "c_media_duration_type": "long",
          "c_media_genre_code": "Overige",
          "c_media_ispartof": "Wegmisbruikers",
          "c_media_live": 0,
          "c_media_outlet": "embedded_3p",
          "c_media_partner": "embedded3p",
          "c_media_playbacktype": "vod",
          "c_media_station": "sbs6",
          "c_sko_cl": 2403,
          "c_sko_dt": "20181214",
          "c_sko_gen": 21190,
          "c_sko_pr": "wegmisbruikers",
          "c_sko_prid": "547724877",
          "c_sko_stid": 63,
          "c_sko_t": "2027",
          "c_sko_ty": "tv.ep"
        }
      }
    }
  ],
  "width": "100%",
  "height": "100%",
  "stretching": "uniform",
  "autostart": "true",
  "skin": {
    "name": "kijk",
    "timeslider": {
      "progress": "#f48800"
    }
  },
  "advertising": {
    "admessage": "",
    "client": "freewheel",
    "cuetext": "Advertentie",
    "vpaidcontrols": true,
    "freewheel": {
      "networkid": "506166",
      "serverid": "https://7b935.v.fwmrm.net/ad/g/1",
      "profileid": "506166:sanoma_sbs_ovp_js_live",
      "sectionid": "sbs_embedded3p_desktop",
      "adManagerURL": "https://mssl.fwmrm.net/p/sanoma_sbs_live/AdManager.js",
      "custom": {
        "cd_type": "long",
        "vdur": "2403",
        "embed_domain": "embed.kijk.nl"
      }
    },
    "schedule": {
      "adbreak": {
        "offset": "pre",
        "tag": "placeholder_preroll"
      }
    }
  },
  "sharing": {
    "heading": "Deel Video",
    "sites": [
      {
        "label": "Facebook",
        "icon": "/talpa-jw-skin/icons/facebook.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=facebook&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FyWLXx6VtFuG&title=Wegmisbruikers&ct=0&tt=0&"
      },
      {
        "label": "Twitter",
        "icon": "/talpa-jw-skin/icons/twitter.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=twitter&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FyWLXx6VtFuG&title=Wegmisbruikers&ct=0&tt=0&"
      }
    ]
  },
  "cast": [],
  "related": [],
  "videoType": "vod",
  "adBlockerCheck": true,
  "allowPlayerApi": false
}

$ cat bashgemist_notes.txt | sed -n '1288,1423p' | xidel -s - --xquery '$json/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * dayTimeDuration("PT1S") + time("00:00:00"),"expdate":replace(TAQ/customLayer/c_media_dateexpires * dayTimeDuration("PT1S") + dateTime("1970-01-01T01:00:00"),"(\d+)-(\d+)-(\d+)T(.+)","$3-$2-$1 $4"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[type="m3u8"][1]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","extension":"m3u8","resolution":"manifest","url":url},for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"extension":"m3u8","resolution":extract($x,"RESOLUTION=([\dx]+)",1) ! (if (.) then . else "audiospoor"),"vbitrate":extract($x,"video=(\d+)\d{3}",1) ! (if (.) then concat("v:",.,"k") else ""),"abitrate":replace($x,".+audio.+?(\d+)\d{3}.+","a:$1k","s"),"url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "SBS6: Wegmisbruikers S24E04",
  "date": "14-12-2018",
  "duration": "00:40:03",
  "expdate": "14-12-2019 21:24:18",
  "subtitle": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-nl.vtt",
  "formats": [
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/1544789330448.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "audiospoor",
      "vbitrate": "",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "637x252",
      "vbitrate": "v:365k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=365058.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "910x360",
      "vbitrate": "v:730k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=730083.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "1092x432",
      "vbitrate": "v:1500k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=1500117.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "1820x720",
      "vbitrate": "v:3000k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=3000297.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "2730x1080",
      "vbitrate": "v:4500k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=4500168.m3u8"
    },
    {
      "format": "hls-7",
      "extension": "m3u8",
      "resolution": "2730x1080",
      "vbitrate": "v:6000k",
      "abitrate": "a:160k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=6000467.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

http://www.kijk.nl/net5/pekingexpress/videos/w7ZW52xLgL5/aflevering-1

$ xidel -s "https://embed.kijk.nl/video/w7ZW52xLgL5" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [			# De 3 m3u8 playlists zijn allemaal hetzelfde. Daarom kiezen we gewoon de 1e --> (sources)()[type="m3u8"][1]/file.
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/jMeLJuBkEPrN/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/O3MALYiXrEvo/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/DrlDOZ5p_34C/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/7VPyrVZ_p2_F/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/kvXDJgpLCCNY/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/SaZ_Wcowy8f5/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        }
      ],
      [...]
    }
  ],
  [...]
}

$ xidel -s "https://embed.kijk.nl/video/w7ZW52xLgL5" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * dayTimeDuration("PT1S") + time("00:00:00"),"expdate":replace(TAQ/customLayer/c_media_dateexpires * dayTimeDuration("PT1S") + dateTime("1970-01-01T01:00:00"),"(\d+)-(\d+)-(\d+)T(.+)","$3-$2-$1 $4"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[type="m3u8"][1]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","extension":"m3u8","resolution":"manifest","url":url},for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"extension":"m3u8","resolution":extract($x,"RESOLUTION=([\dx]+)",1) ! (if (.) then . else "audiospoor"),"vbitrate":extract($x,"video=(\d+)\d{3}",1) ! (if (.) then concat("v:",.,"k") else ""),"abitrate":replace($x,".+audio.+?(\d+)\d{3}.+","a:$1k","s"),"url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "NET5: Peking Express S01E01",
  "date": "03-04-2017",
  "duration": "01:03:59",
  "expdate": "31-03-2020 05:55:00",
  "subtitle": null,
  "formats": [
    {
      "format": "hls-0",
      "extension": "m3u8",
      "resolution": "manifest",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/1535976944566.m3u8"
    },
    {
      "format": "hls-1",
      "extension": "m3u8",
      "resolution": "audiospoor",
      "vbitrate": "",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000.m3u8"
    },
    {
      "format": "hls-2",
      "extension": "m3u8",
      "resolution": "320x180",
      "vbitrate": "v:350k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=350000.m3u8"
    },
    {
      "format": "hls-3",
      "extension": "m3u8",
      "resolution": "512x288",
      "vbitrate": "v:655k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=655000.m3u8"
    },
    {
      "format": "hls-4",
      "extension": "m3u8",
      "resolution": "640x360",
      "vbitrate": "v:912k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=912000.m3u8"
    },
    {
      "format": "hls-5",
      "extension": "m3u8",
      "resolution": "768x432",
      "vbitrate": "v:1214k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=1214000.m3u8"
    },
    {
      "format": "hls-6",
      "extension": "m3u8",
      "resolution": "868x488",
      "vbitrate": "v:1898k",
      "abitrate": "a:94k",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=1898000.m3u8"
    }
  ]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5" -e '$json/playerInfo'
{
  [...],
  "embed_api_url": "http://embed.kijk.nl/api/video/w7ZW52xLgL5?id=kijkapp",
  "hasDRM": false
}

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5" -e '$json/playerInfo/json(embed_api_url)'
{
  "vpakey": "w7ZW52xLgL5",
  "videoId": null,
  "mediaId": null,
  "assetId": null,
  "appleTvMediaId": null,
  "roll": "https://embed.kijk.nl/api/roll/",
  "unroll": "https://embed.kijk.nl/api/unroll/",
  "playlist": "https://embed.kijk.nl/api/playlist/.m3u8",
  [...]
}

Dit suggereert dat de Ericsson videostreams niet meer beschikbaar zijn, maar als we de url handmatig samenstellen (zie BatchGemist notes), waarbij de user_token n de app_token blijkbaar niet per se nodig zijn, dan werken ze nog gewoon!

$ xidel -s "https://embed.kijk.nl/api/roll/w7ZW52xLgL5_dbzyr6?base_url=https%3A//emp-prod-acc-we.ebsd.ericsson.net/sbsgroup" -e '$json'
{
  "live": "false",
  "duration": "3840200",
  "markers": [
    {
      "start_offset": "0",
      "duration": "2270840",
      "type": "AD_VAST",
      "data": {}
    },
    {
      "start_offset": "2272000",
      "duration": "1568160",
      "type": "AD_VAST",
      "data": {}
    }
  ],
  "streams": [
    {
      "name": "1080p",
      "bitrate": 7000000,
      "resolution": "1920x1080",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_9/index.m3u8"
    },
    {
      "name": "720p",
      "bitrate": 4500000,
      "resolution": "1280x720",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_7/index.m3u8"
    },
    {
      "name": "576p",
      "bitrate": 2468000,
      "resolution": "1024x576",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_6/index.m3u8"
    },
    {
      "name": "480p",
      "bitrate": 1500000,
      "resolution": "768x432",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_5/index.m3u8"
    },
    {
      "name": "360p",
      "bitrate": 900000,
      "resolution": "640x360",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_4/index.m3u8"
    },
    {
      "name": "240p",
      "bitrate": 500000,
      "resolution": "512x288",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_3/index.m3u8"
    }
  ],
  "playlist_url": "https://embed.kijk.nl/api/playlist/w7ZW52xLgL5_dbzyr6.m3u8",
  "media_url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/"
}

Update: De api-url werkt inmiddels ook niet meer, MAAR de individuele video-urls hier boven vreemd genoeg nog wel.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

https://www.kijk.nl/sbs6/steenrijkstraatarm/videos/UitidpB9Yx5/steenrijk-straatarm

$ xidel -s "https://embed.kijk.nl/video/UitidpB9Yx5" -e 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TzEji1yiQs0E/file.m3u8?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "m3u8",
          "drm": {
            "fairplay": {
              "releasePid": "TzEji1yiQs0E",
              "certificateUrl": "https://vod-tpc-prod-1.talpatvcdn.nl/fairplay.cer",
              "processSpcUrl": "https://fairplay.entitlement.theplatform.eu/fpls/web/FairPlay?form=json&schema=1.0&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TzEji1yiQs0E"
            }
          }
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TyxGZdUvCzwg/file.mpd?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "dash",
          "drm": {
            "playready": {
              "releasePid": "TyxGZdUvCzwg",
              "url": "https://green.playready.entitlement.theplatform.eu/playready/rightsmanager.asmx?form=json&schema=1.0&auth=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TyxGZdUvCzwg"
            }
          }
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TkNGUgBksp7W/file.mpd?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "dash",
          "drm": {
            "widevine": {
              "releasePid": "TkNGUgBksp7W",
              "url": "https://widevine.entitlement.theplatform.eu/wv/web/ModularDrm?form=json&schema=1.0&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TkNGUgBksp7W"
            }
          }
        }
      ],
      [...]
    }
  ],
  [...]
}

$ xidel -s "https://embed.kijk.nl/video/UitidpB9Yx5" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * dayTimeDuration("PT1S") + time("00:00:00"),"expdate":replace(TAQ/customLayer/c_media_dateexpires * dayTimeDuration("PT1S") + dateTime("1970-01-01T01:00:00"),"(\d+)-(\d+)-(\d+)T(.+)","$3-$2-$1 $4"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[type="m3u8"][not(drm)][1]/x:request({"url":file,"method":"HEAD"})/[{"format":"hls-0","extension":"m3u8","resolution":"manifest","url":url},for $x at $i in tail(tokenize(extract(unparsed-text(url),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"extension":"m3u8","resolution":extract($x,"RESOLUTION=([\dx]+)",1) ! (if (.) then . else "audiospoor"),"vbitrate":extract($x,"video=(\d+)\d{3}",1) ! (if (.) then concat("v:",.,"k") else ""),"abitrate":replace($x,".+audio.+?(\d+)\d{3}.+","a:$1k","s"),"url":resolve-uri(".",url)||extract($x,"(.+m3u8)",1)}]}'
{
  "name": "SBS6: Steenrijk, straatarm S03E03",
  "date": "09-01-2019",
  "duration": "00:41:35",
  "expdate": "09-01-2024 21:28:03",
  "subtitle": null,
  "formats": null			# Als resultaat van [not(drm)].
}

------------------------------------------------------------------------------------------------

--xquery '
  json(
    //script/extract(
      .,
      "playerConfig = (.+);",
      1
    )[.]
  )/(playlist)()/{
    "name":TAQ/concat(
      upper-case(customLayer/c_media_station),
      ": ",
      customLayer/c_media_ispartof,
      if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then
        concat(
          " S",
          dataLayer/media_program_season ! (
            if (.<10) then
              "0"||.
            else
              .
          ),
          "E",
          dataLayer/media_program_episodenumber ! (
            if (.<10) then
              "0"||.
            else
              .
          )
        )
      else
        ()
    ),
    "date":replace(
      TAQ/customLayer/c_sko_dt,
      "(\d{4})(\d{2})(\d{2})",
      "$3-$2-$1"
    ),
    "duration":TAQ/customLayer/c_sko_cl * dayTimeDuration("PT1S") + time("00:00:00"),
    "expdate":replace(
      TAQ/customLayer/c_media_dateexpires * dayTimeDuration("PT1S") + dateTime("1970-01-01T01:00:00"),
      "(\d+)-(\d+)-(\d+)T(.+)",
      "$3-$2-$1 $4"
    ),
    "subtitle":(tracks)()[label=" Nederlands"]/file,
    "formats":[
      (sources)()[type="m3u8"][not(drm)][1]/x:request(
        {
          "url":file,
          "method":"HEAD"
        }
      )/(
        {
          "format":"hls-0",
          "extension":"m3u8",
          "resolution":"manifest",
          "url":url
        },
        for $x at $i in tail(
          tokenize(
            extract(
              unparsed-text(url),
              "(#EXT-X-STREAM-INF.+m3u8$)",
              1,"ms"
            ),
            "#EXT-X-STREAM-INF:"
          )
        ) order by extract(
          $x,
          "BANDWIDTH=(\d+)",
          1
        ) count $i
        return {
          "format":"hls-"||$i,
          "extension":"m3u8",
          "resolution":extract(
            $x,
            "RESOLUTION=([\dx]+)",
            1
          ) ! (
            if (.) then
              .
            else
              "audiospoor"
          ),
          "vbitrate":extract(
            $x,
            "video=(\d+)\d{3}",
            1
          ) ! (
            if (.) then
              concat(
                "v:",
                .,
                "k"
              )
            else
              ""
          ),
          "abitrate":replace(
            $x,
            ".+audio.+?(\d+)\d{3}.+",
            "a:$1k","s"
          ),
          "url":resolve-uri(
            ".",
            url
          )||extract(
            $x,
            "(.+m3u8)",
            1
          )
        }
      )
    ]
  }
'
