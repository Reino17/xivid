[npo-live]

https://www.npostart.nl/live/npo-1 (huidige API)

$ xidel -s -H "X-Requested-With: XMLHttpRequest" "https://www.npostart.nl/api/token" -e '$json'
of
$ xidel -s -e 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json'
{
  "token": "dXbagD2EBAsa43aAQ1lEDMp1ZvUpQbHs0SEPAByt"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json'
{
  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjb21zY29yZSI6eyJucG9JbmdlbG9nZCI6Im5vIiwibnBvTG9naW50eXBlIjoiYW5vbmllbSIsIm5wb0xvZ2luSWQiOiIifSwic21hcnR0YWciOnsic2l0ZUlkIjoiNCJ9LCJoYXNTdWJzY3JpcHRpb24iOiIiLCJoYXNQcmVtaXVtU3Vic2NyaXB0aW9uIjoiIiwiZWxlbWVudElkIjoicGxheWVyLUxJX05MMV80MTg4MTAyIiwibWVkaWFJZCI6IkxJX05MMV80MTg4MTAyIiwidG9wc3BpbiI6eyJwYXJ0eUlkIjoiIiwicHJvZmlsZUlkIjoiIn0sImhhc1NldHRpbmdzIjoiMCIsImhhc0FkQ29uc2VudCI6IjEiLCJzaGFyZSI6IjEiLCJwYWdlVXJsIjoiIiwic3RlclJlZmVycmFsVXJsIjoiIiwic3RlclNpdGVJZCI6Im5wb3N0YXJ0IiwiaWF0IjoxNTUyNjY0NTY0LCJuYmYiOjE1NTI2NjQ1NjQsImV4cCI6MTU1MjY5MzM2NCwiY29uc3VtZXJJZCI6bnVsbCwiaXNQbGF5bGlzdCI6ZmFsc2UsInJlZmVycmVyVXJsIjpudWxsLCJza2lwQ2F0YWxvZyI6MCwibm9BZHMiOjAsInJlY29tbWVuZGF0aW9ucyI6MSwiaXNzIjoiZXlKcGRpSTZJbXB1UkZWbFFqaG1kbWxCVTFOalEyOU5WR2xYZFZFOVBTSXNJblpoYkhWbElqb2lZM2h4UmpVNFlWTjJOMEp1VVRkTmMxWjVlbmQ2VGpWMU1YUXpaRzVXT1VkaFNIUkhObW94VkRBellUbGhRMFl4UkVWa1NuVjBPVTVXY1RFd1EzWXJkeUlzSW0xaFl5STZJbVppWVRWbFlUSmtPRE5rTWpCak1URmlZemsyTkdFek5XWTNNakpsWldGbU9HVTVZMk15TlRobU4yVmlZVEZqTlRNellUUTJabVEyTVRKbVpESmtZekVpZlE9PSJ9.Vajmxn2QFcp9ZUAcfK6eTayccAhKZhLSIggO5i_G9mk",
  "embedUrl": "https://start-player.npo.nl/embed/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjb21zY29yZSI6eyJucG9JbmdlbG9nZCI6Im5vIiwibnBvTG9naW50eXBlIjoiYW5vbmllbSIsIm5wb0xvZ2luSWQiOiIifSwic21hcnR0YWciOnsic2l0ZUlkIjoiNCJ9LCJoYXNTdWJzY3JpcHRpb24iOiIiLCJoYXNQcmVtaXVtU3Vic2NyaXB0aW9uIjoiIiwiZWxlbWVudElkIjoicGxheWVyLUxJX05MMV80MTg4MTAyIiwibWVkaWFJZCI6IkxJX05MMV80MTg4MTAyIiwidG9wc3BpbiI6eyJwYXJ0eUlkIjoiIiwicHJvZmlsZUlkIjoiIn0sImhhc1NldHRpbmdzIjoiMCIsImhhc0FkQ29uc2VudCI6IjEiLCJzaGFyZSI6IjEiLCJwYWdlVXJsIjoiIiwic3RlclJlZmVycmFsVXJsIjoiIiwic3RlclNpdGVJZCI6Im5wb3N0YXJ0IiwiaWF0IjoxNTUyNjY0NTY0LCJuYmYiOjE1NTI2NjQ1NjQsImV4cCI6MTU1MjY5MzM2NCwiY29uc3VtZXJJZCI6bnVsbCwiaXNQbGF5bGlzdCI6ZmFsc2UsInJlZmVycmVyVXJsIjpudWxsLCJza2lwQ2F0YWxvZyI6MCwibm9BZHMiOjAsInJlY29tbWVuZGF0aW9ucyI6MSwiaXNzIjoiZXlKcGRpSTZJbXB1UkZWbFFqaG1kbWxCVTFOalEyOU5WR2xYZFZFOVBTSXNJblpoYkhWbElqb2lZM2h4UmpVNFlWTjJOMEp1VVRkTmMxWjVlbmQ2VGpWMU1YUXpaRzVXT1VkaFNIUkhObW94VkRBellUbGhRMFl4UkVWa1NuVjBPVTVXY1RFd1EzWXJkeUlzSW0xaFl5STZJbVppWVRWbFlUSmtPRE5rTWpCak1URmlZemsyTkdFek5XWTNNakpsWldGbU9HVTVZMk15TlRobU4yVmlZVEZqTlRNellUUTJabVEyTVRKbVpESmtZekVpZlE9PSJ9.Vajmxn2QFcp9ZUAcfK6eTayccAhKZhLSIggO5i_G9mk",
  "embedCode": "<script>var urlForIframe = \"https://start-player.npo.nl/embed/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJjb21zY29yZSI6eyJucG9JbmdlbG9nZCI6Im5vIiwibnBvTG9naW50eXBlIjoiYW5vbmllbSIsIm5wb0xvZ2luSWQiOiIifSwic21hcnR0YWciOnsic2l0ZUlkIjoiNCJ9LCJoYXNTdWJzY3JpcHRpb24iOiIiLCJoYXNQcmVtaXVtU3Vic2NyaXB0aW9uIjoiIiwiZWxlbWVudElkIjoicGxheWVyLUxJX05MMV80MTg4MTAyIiwibWVkaWFJZCI6IkxJX05MMV80MTg4MTAyIiwidG9wc3BpbiI6eyJwYXJ0eUlkIjoiIiwicHJvZmlsZUlkIjoiIn0sImhhc1NldHRpbmdzIjoiMCIsImhhc0FkQ29uc2VudCI6IjEiLCJzaGFyZSI6IjEiLCJwYWdlVXJsIjoiIiwic3RlclJlZmVycmFsVXJsIjoiIiwic3RlclNpdGVJZCI6Im5wb3N0YXJ0IiwiaWF0IjoxNTUyNjY0NTY0LCJuYmYiOjE1NTI2NjQ1NjQsImV4cCI6MTU1MjY5MzM2NCwiY29uc3VtZXJJZCI6bnVsbCwiaXNQbGF5bGlzdCI6ZmFsc2UsInJlZmVycmVyVXJsIjpudWxsLCJza2lwQ2F0YWxvZyI6MCwibm9BZHMiOjAsInJlY29tbWVuZGF0aW9ucyI6MSwiaXNzIjoiZXlKcGRpSTZJbXB1UkZWbFFqaG1kbWxCVTFOalEyOU5WR2xYZFZFOVBTSXNJblpoYkhWbElqb2lZM2h4UmpVNFlWTjJOMEp1VVRkTmMxWjVlbmQ2VGpWMU1YUXpaRzVXT1VkaFNIUkhObW94VkRBellUbGhRMFl4UkVWa1NuVjBPVTVXY1RFd1EzWXJkeUlzSW0xaFl5STZJbVppWVRWbFlUSmtPRE5rTWpCak1URmlZemsyTkdFek5XWTNNakpsWldGbU9HVTVZMk15TlRobU4yVmlZVEZqTlRNellUUTJabVEyTVRKbVpESmtZekVpZlE9PSJ9.Vajmxn2QFcp9ZUAcfK6eTayccAhKZhLSIggO5i_G9mk\"; var elementId = \"player-LI_NL1_4188102\"; var mediaId = \"LI_NL1_4188102\";</script><script src=\"https://start-player.npo.nl/js/embed.js\"></script>"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(doc(embedUrl)//script/extract(.,"var video =(.+);",1)[.])'
{
  "id": "LI_NL1_4188102",
  "type": "livetv",
  "title": "NPO 1",
  "subtitles": [],
  "episodeTitle": "",
  "franchiseTitle": "",
  "description": "",
  "duration": null,
  "age_rating": null,
  "still_image_url": "https://www-assets.npo.nl/uploads/tv_channel/263/guide_highlight/regular_2018_-_NPO1_IDENT_-_PAUW.jpg",
  "orig_image_url": "https://www-assets.npo.nl/uploads/tv_channel/263/logo/logo-npo1.png",
  "post_play_url": "https://www-assets.npo.nl/uploads/tv_channel/263/guide_highlight/regular_2018_-_NPO1_IDENT_-_PAUW.jpg",
  "share_text": "Bekijk NPO 1 op https://www.npostart.nl/LI_NL1_4188102",
  "share_url": "https://www.npostart.nl/LI_NL1_4188102",
  "broadcasters": [],
  "broadcastDate": "2019-03-15T15:44:20Z",
  "nextAsset": null,
  "qualityOptions": [
    {
      "bitrate": "0",
      "label": "Hoogste",
      "resolution": "1080p",
      "platform": "npo"
    },
    {
      "bitrate": "643000",
      "label": "Hoog",
      "resolution": "720p",
      "platform": "npo"
    },
    {
      "bitrate": "491000",
      "label": "Medium",
      "resolution": "576p",
      "platform": "npo"
    },
    {
      "bitrate": "248000",
      "label": "Laag",
      "resolution": "360p",
      "platform": "npo"
    }
  ],
  "visualRadio": null,
  "episodeNumber": null,
  "seriesId": null,
  "net": null,
  "genres": "",
  "ster": {
    "uri": "https://adconfig.ster.nl/adurl/$$identifier$$?ncc=$$ncc$$&cust_params=1%3D1%26programma_titel%3D%26afleverings_titel%3Dnpo1%26genre%3D%26subgenre%3D%26video_duur%3D0%26prid%3DLI_NL1_4188102%26srid%3D%26net%3D%26omroep%3D%26os%3D$$os$$%26osversion%3D$$osversion$$%26player%3D$$player$$%26playerversion%3D$$playerversion$$%26site%3D$$site$$%26ai%3D$$ai$$%26referrer_url%3D$$referrer_url$$%26description_url%3D$$description_url$$",
    "customParameters": {
      "prid": "LI_NL1_4188102",
      "srid": null
    },
    "placeholderValues": {
      "$$netwerk_id$$": "9233",
      "$$genre$$": null,
      "$$subgenre$$": "",
      "$$video_duur$$": 0,
      "$$net$$": null,
      "$$omroep$$": "",
      "$$programma_titel$$": "",
      "$$programmanaam$$": "",
      "$$stationid$$": "npo",
      "$$afleverings_titel$$": "npo1"
    }
  },
  "recommender": "ts-base",
  "startAt": null,
  "parentId": null,
  "channel": null
}

https://start-player.npo.nl/js/app.js:
[...]
var n = {
        "com.apple.fps.1_0": "hls",
        "com.widevine.alpha": "dash-widevine",
        "com.microsoft.playready": "dash-playready",
        silverlight: "smooth"
    },
[...]

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(concat("https://start-player.npo.nl/video/",$a,"/streams?profile=hls&quality=npo&tokenId=",token))'
{
  "stream": {
    "src": "https://pedgewarer28a.video.kpnstreaming.nl/session/7c2dbe1c-4735-11e9-8e3b-1458d0420170/ywkf3i/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/playlist.m3u8?token=9dd8d1315b7d124fb4584a64922f5c29_1552749465_1552749465",
    "type": "application/vnd.apple.mpegurl",
    "protection": {
      "keySystem": "com.apple.fps.1_0",
      "certificateUrl": "https://s3-eu-west-1.amazonaws.com/24i-npo-stream/fairplay.cer",
      "licenseUrl": "https://npo-drm-gateway.samgcloud.nepworldwide.nl/authentication?custom_data=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJucG8iLCJpYXQiOjE1NTI2NjMwNTUsImRybV90eXBlIjoiZmFpcnBsYXkiLCJsaWNlbnNlX3Byb2ZpbGUiOiJ3ZWIiLCJjbGllbnRfaXAiOiI4MC4xMDEuNDkuNSJ9.MrJkJRhFG4lww9Nz7BOJ3NiVb7DyoprVGT4qyMkaFNw"
    }
  },
  "catchupAvailable": true
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -f 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(concat("https://start-player.npo.nl/video/",$a,"/streams?profile=hls&quality=npo&tokenId=",token))/stream/src' -e '$raw'
[...]
#EXT-X-SESSION-KEY:METHOD=SAMPLE-AES,URI="skd://60f29d98-6526-e8e6-02cd-1a6cc037f599",KEYFORMAT="com.apple.streamingkeydelivery",KEYFORMATVERSIONS="1"
[...]

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s "https://www.npostart.nl/live/npo-1" --xquery 'let $a:=//npo-player/@media-id return x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$a})/json/json(concat("https://start-player.npo.nl/video/",$a,"/streams?profile=hls&amp;quality=npo&amp;tokenId=",token))/stream/[{"format":"hls-0","container":"m3u8[manifest]","url":src},for $x at $i in tail(tokenize(extract(unparsed-text(src),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),src)}]'
[
  {
    "format": "hls-0",
    "container": "m3u8[manifest]",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/playlist.m3u8?token=ee2a3e8377aa5c6670c36cecbaa4d0c8_1552751413_1552751413"
  },
  {
    "format": "hls-1",
    "container": "m3u8[aac]",
    "resolution": null,
    "bitrate": "128kbps",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000.m3u8"
  },
  {
    "format": "hls-2",
    "container": "m3u8[h264+aac]",
    "resolution": "384x216",
    "bitrate": "200|128kbps",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=200000.m3u8"
  },
  {
    "format": "hls-3",
    "container": "m3u8[h264+aac]",
    "resolution": "480x270",
    "bitrate": "499|128kbps",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=499968.m3u8"
  },
  {
    "format": "hls-4",
    "container": "m3u8[h264+aac]",
    "resolution": "768x432",
    "bitrate": "1000|128kbps",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1000000.m3u8"
  },
  {
    "format": "hls-5",
    "container": "m3u8[h264+aac]",
    "resolution": "1024x576",
    "bitrate": "1800|128kbps",
    "url": "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8"
  }
]

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ ffmpeg -hide_banner -i "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8"
[https @ 057cf540] Opening 'https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8' for reading
[hls,applehttp @ 051494c0] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 051494c0] Failed to open segment 194083138 of playlist 0
[hls,applehttp @ 051494c0] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 051494c0] Failed to open segment 194083139 of playlist 0
[hls,applehttp @ 051494c0] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 051494c0] Failed to open segment 194083140 of playlist 0
[...]
[hls,applehttp @ 051494c0] Error when loading first segment 'https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000-194083139.ts'

(https://github.com/e2iplayer/hlsdl/releases)
$ hlsdl "https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8" -v
> START media_playlist_get_links
> END media_playlist_get_links
HLS Stream is SAMPLE-AES encrypted.
Media Playlist parsed successfully.
{"d_t":"live"}
DownloUpdate thread started
ading part 194092232
Error: Getting key-file [https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8/../skd://60f29d98-6526-e8e6-02cd-1a6cc037f599] failed http_code[502].
{"t_d":32,"d_d":7,"d_s":1896544}
Downloading part 194092233
Error: Getting key-file [https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8/../skd://60f29d98-6526-e8e6-02cd-1a6cc037f599] failed http_code[502].
{"t_d":32,"d_d":15,"d_s":3760564}
Downloading part 194092234
Error: Getting key-file [https://pedgewarea28b.video.kpnstreaming.nl/session/054a4216-473a-11e9-b728-1458d0426038/p8ijhp/hls/live/nponep/live/npo/u/npo/drm/hls_fairplay/npo-1/0/0/0/npo-1.isml/npo-1-audio_nld=128000-video=1800000.m3u8/../skd://60f29d98-6526-e8e6-02cd-1a6cc037f599] failed http_code[502].
[...]

------------------------------------------------------------------------------------------------

https://www.npostart.nl/live/npo-1 (oude API)

$ xidel -s "http://ida.omroep.nl/app.php/auth" -e '$json'
{
  "token": "6qm1ivpj8q4vm6c4s4fs4cb7i2"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))'
{
  "limited": false,
  "site": null,
  "items": [
    [
      {
        "label": "Live",
        "contentType": "live",
        "url": "https://livestreams.omroep.nl/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8?hash=dfd2fbbc1487ca2af5fb88419e178759&token=3e47c7ec3116134d97460ef058cac2ab&type=jsonp&protection=url",
        "format": "hls"
      }
    ]
  ]
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/json(replace(.//url,"jsonp","json"))'
https://smoote2a.omroep.nl/urishieldv2/l2fm69153f3570e8b83a005c8ce825000000.fee9019baad2e00387eb856a885cd3c8/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

https://www.npostart.nl/live/npo-1-extra

$ xidel -s "https://www.npostart.nl/live/npo-1-extra" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/json(replace(.//url,"jsonp","json"))'
Error:
err:FODC0002: Internet/HTTP Error: 404
when talking to: https://livestreams.omroep.nl/live/npo/thematv/101tv/101tv.isml/101tv.m3u8?hash=cdfe301d72cedc0452845b56c413f99c&token=a6a9cc4f8699d6f410749a9fe984a984&type=json&protection=url

$ xidel -s "https://www.npostart.nl/live/npo-1-extra" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/x:request({"url":replace(.//url,"jsonp","json"),"error-handling":"4xx=accept"})'
{
  "url": "https://livestreams.omroep.nl/live/npo/thematv/101tv/101tv.isml/101tv.m3u8?hash=0b20e3bd652dd5b1c856d20e8db432a1&token=fd1013ba8bdcfa3ab1a8d2c864472745&type=json&protection=url",
  "type": "text/html; charset=UTF-8",
  "headers": [
    "HTTP/1.1 404 Not Found",
    "Date: Sat, 16 Mar 2019 13:19:14 GMT",
    "Content-Type: text/html; charset=UTF-8",
    "Transfer-Encoding: chunked",
    "Vary: Accept-Encoding",
    "Server: nginx",
    "Vary: Accept-Encoding",
    "X-stream-message: flow_valid_livestream: 0: 'Livestream not found in cache or configured as not-available'",
    "Via: 1.1 google",
    ""
  ],
  "raw": "",
  "doc": null
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/x:request({"url":replace(.//url,"jsonp","json"),"error-handling":"4xx=accept"})[json]'
{
  "url": "https://livestreams.omroep.nl/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8?hash=7b77c52239cc1a95354ce79e4e639993&token=8e1c0abf06439fd6ce84f7305fd0d972&type=json&protection=url",
  "type": "application/json",
  "headers": [
    "HTTP/1.1 200 OK",
    "Date: Sat, 16 Mar 2019 23:58:11 GMT",
    "Content-Type: application/json",
    "Transfer-Encoding: chunked",
    "Vary: Accept-Encoding",
    "Server: nginx",
    "Vary: Accept-Encoding",
    "X-stream-message: flow_cluster_instance: 0: 'Success. Used the default NPO cluster'",
    "Via: 1.1 google",
    ""
  ],
  "raw": "\"https:\\/\\/smoote2h.omroep.nl\\/urishieldv2\\/l2fm7efa778b39f993a2005c8d8d93000000.058fc1c4f40aaffb538624957b900806\\/live\\/npo\\/tvlive\\/npo1\\/npo1.isml\\/npo1.m3u8\"",
  "json": "https://smoote2h.omroep.nl/urishieldv2/l2fm7efa778b39f993a2005c8d8d93000000.058fc1c4f40aaffb538624957b900806/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" -e 'json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/x:request({"url":replace(.//url,"jsonp","json"),"error-handling":"4xx=accept"})[json]/unparsed-text(json)'
#EXTM3U
#EXT-X-VERSION:4
## Created with Unified Streaming Platform(version=1.9.5)

# AUDIO groups
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-128",NAME="audio",AUTOSELECT=YES,DEFAULT=YES,CHANNELS="2"

# variants
#EXT-X-STREAM-INF:BANDWIDTH=733000,AVERAGE-BANDWIDTH=666000,CODECS="mp4a.40.2,avc1.42C028",RESOLUTION=640x360,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
npo1-audio=128000-video=500000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=1316000,AVERAGE-BANDWIDTH=1196000,CODECS="mp4a.40.2,avc1.42C028",RESOLUTION=848x480,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
npo1-audio=128000-video=1000000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=2249000,AVERAGE-BANDWIDTH=2044000,CODECS="mp4a.40.2,avc1.42C028",RESOLUTION=1024x576,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
npo1-audio=128000-video=1800000.m3u8

# variants
#EXT-X-STREAM-INF:BANDWIDTH=150000,AVERAGE-BANDWIDTH=136000,CODECS="mp4a.40.2",AUDIO="audio-aacl-128"
npo1-audio=128000.m3u8

# keyframes
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=73000,CODECS="avc1.42C028",RESOLUTION=640x360,URI="keyframes/npo1-video=500000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=146000,CODECS="avc1.42C028",RESOLUTION=848x480,URI="keyframes/npo1-video=1000000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=263000,CODECS="avc1.42C028",RESOLUTION=1024x576,URI="keyframes/npo1-video=1800000.m3u8"
}

$ xidel -s "https://www.npostart.nl/live/npo-1" --xquery '{"name":replace(//title," - Live tv",": Livestream"),"date":"'$(date "+%d-%m-%Y")'","formats":json(concat("http://ida.omroep.nl/app.php/",//npo-player/@media-id,"?token=",json("http://ida.omroep.nl/app.php/auth")/token))/x:request({"url":replace(.//url,"jsonp","json"),"error-handling":"4xx=accept"})[json]/[{"format":"hls-0","container":"m3u8[manifest]","url":json},for $x at $i in tail(tokenize(extract(unparsed-text(json),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),json)}]}'
{
  "name": "NPO 1: Livestream",
  "date": "16-03-2019",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1-audio=128000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "500|128kbps",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1-audio=128000-video=500000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "848x480",
      "bitrate": "1000|128kbps",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1-audio=128000-video=1000000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1800|128kbps",
      "url": "https://smoote2d.omroep.nl/urishieldv2/l2fm3a9a3af15007ec5f005c8d0822000000.a5e79cf6973549e2d3d7ea1527f32029/live/npo/tvlive/npo1/npo1.isml/npo1-audio=128000-video=1800000.m3u8"
    }
  ]
}

$ xidel -s "https://www.npostart.nl/live/npo-1-extra" --xquery '[...]'
{
  "name": "NPO 1 extra: Livestream",
  "date": "16-03-2019",
  "formats": null
}

------------------------------------------------------------------------------------------------

--xquery '
  {
    "name":replace(
      //title,
      " - Live tv",
      ": Livestream"
    ),
    "date":"'$(date "+%d-%m-%Y")'",
    "formats":json(
      concat(
        "http://ida.omroep.nl/app.php/",
        //npo-player/@media-id,
        "?token=",
        json("http://ida.omroep.nl/app.php/auth")/token
      )
    )/x:request(
      {
        "url":replace(
          .//url,
          "jsonp",
          "json"
        ),
        "error-handling":"4xx=accept"
      }
    )[json]/[
      {
        "format":"hls-0",
        "container":"m3u8[manifest]",
        "url":json
      },
      for $x at $i in tail(
        tokenize(
          extract(
            unparsed-text(json),
            "(#EXT-X-STREAM-INF.+m3u8$)",
            1,"ms"
          ),
          "#EXT-X-STREAM-INF:"
        )
      ) order by extract(
        $x,
        "BANDWIDTH=(\d+)",
        1
      ) count $i
      return {
        "format":"hls-"||$i,
        "container":if (
          contains(
            $x,
            "avc1"
          )
        ) then
          "m3u8[h264+aac]"
        else
          "m3u8[aac]",
        "resolution":extract(
          $x,
          "RESOLUTION=([\dx]+)",
          1
        )[.],
        "bitrate":let $a:=extract(
          $x,
          "audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",
          (1,2)
        ) return
        join(
          (
            $a[2][.],
            $a[1]
          ),
          "|"
        )||"kbps",
        "url":resolve-uri(
          extract(
            $x,
            "(.+m3u8)",
            1
          ),
          json
        )
      }
    ]
  }
'

================================================================================================================================

[npo]

https://www.npostart.nl/nos-journaal/15-03-2019/POW_04059374 (oude API, per 28-02-2019)

$ xidel -s -e 'json(concat("http://ida.omroep.nl/app.php/POW_04059374?token=",json("http://ida.omroep.nl/app.php/auth")/token))'
{
  "limited": false,
  "site": null,
  "items": [
    [
      {
        "label": "Adaptive",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/adaptive/a40fc245d68bbd6ade6fee8b87006187/5c8d0c0b/POW_04059374/1?extension=m3u8&type=jsonp&callback=?",
        "format": "hls"
      },
      {
        "label": "Hoog",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/h264_std/2f7433794cbff513f772501b34b71b3b/5c8d0c0b/POW_04059374/1?type=jsonp&callback=?",
        "format": "mp4"
      },
      {
        "label": "Normaal",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/h264_bb/ef0a10051d3de9560e78ecccd83bb38c/5c8d0c0b/POW_04059374/1?type=jsonp&callback=?",
        "format": "mp4"
      },
      {
        "label": "Laag",
        "contentType": "odi",
        "url": "https://odis.omroep.nl/video/ida/h264_sb/dd0bbb0bfa1194b20513f311e34c84f9/5c8d0c0b/POW_04059374/1?type=jsonp&callback=?",
        "format": "mp4"
      }
    ]
  ]
}

$ xidel -s -e 'json(concat("http://ida.omroep.nl/app.php/POW_04059374?token=",json("http://ida.omroep.nl/app.php/auth")/token))//url ! json(replace(.,"jsonp","json"))/url'
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/adaptive/2b39f51e5a4d9e865fe7c95340ffd0af/5c8d0c98/POW_04059374/1?extension=m3u8&type=json&callback=?
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/h264_std/6d301b8d73b7e8ef4eab42845f536eff/5c8d0c98/POW_04059374/1?type=json&callback=?
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/h264_bb/6ce7a8fe765d62925943cd3ba8d0dcc2/5c8d0c98/POW_04059374/1?type=json&callback=?
https://content.omroep.nl/streams/doeg/vodnotavailable.m4v?odiredirecturl=/video/ida/h264_sb/25e8a3d0cd41c7e396b368b0dcd3d424/5c8d0c98/POW_04059374/1?type=json&callback=?

------------------------------------------------------------------------------------------------

https://www.npostart.nl/nos-journaal/15-03-2019/POW_04059374 (huidige API)

$ xidel -s -e 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/POW_04059374"})/json/json("https://start-player.npo.nl/video/POW_04059374/streams?profile=hls&quality=npo&tokenId="||token)'
{
  "stream": {
    "src": "https://pedgewarer22a.video.kpnstreaming.nl/session/690efb6e-47ff-11e9-8259-9cb65498b840/u7df45/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/playlist.m3u8?token=53ad92ab9278a93cb79958b080f69faa_1552836191_1552836191",
    "type": "application/vnd.apple.mpegurl",
    "protection": {
      "keySystem": "com.apple.fps.1_0",
      "certificateUrl": "https://s3-eu-west-1.amazonaws.com/24i-npo-stream/fairplay.cer",
      "licenseUrl": "https://npo-drm-gateway.samgcloud.nepworldwide.nl/authentication?custom_data=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJucG8iLCJpYXQiOjE1NTI3NDk3ODEsImRybV90eXBlIjoiZmFpcnBsYXkiLCJsaWNlbnNlX3Byb2ZpbGUiOiJ3ZWIiLCJjbGllbnRfaXAiOiI4MC4xMDEuNDkuNSJ9.cFMXsKOd-EM0_-UOX_CXed6Ki-xHjdECbMC92XOqzJU"
    }
  },
  "catchupAvailable": false
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

$ xidel -s -e 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/POW_04059374"})/json/json("https://start-player.npo.nl/video/POW_04059374/streams?profile=hls&quality=npo&tokenId="||token)/unparsed-text(.//src)'
#EXTM3U
#EXT-X-VERSION:4
## Created with Unified Streaming Platform(version=1.7.18) - generated by HMG

# AUDIO groups
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-127",LANGUAGE="en",NAME="English",DEFAULT=YES,AUTOSELECT=YES,URI="a1/a1.m3u8"

# variants
#EXT-X-STREAM-INF:BANDWIDTH=1532000,AVERAGE-BANDWIDTH=1387000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=768x432,AUDIO="audio-aacl-127",CLOSED-CAPTIONS=NONE
v4/v4.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=722000,AVERAGE-BANDWIDTH=654000,CODECS="avc1.4D401F,mp4a.40.2",RESOLUTION=480x270,AUDIO="audio-aacl-127",CLOSED-CAPTIONS=NONE
v5/v5.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=894000,AVERAGE-BANDWIDTH=811000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=480x270,AUDIO="audio-aacl-127",CLOSED-CAPTIONS=NONE
v6/v6.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=452000,AVERAGE-BANDWIDTH=410000,CODECS="avc1.42C01E,mp4a.40.2",RESOLUTION=320x180,AUDIO="audio-aacl-127",CLOSED-CAPTIONS=NONE
v7/v7.m3u8

# keyframes
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=514000,AVERAGE-BANDWIDTH=194000,CODECS="avc1.42C01E",RESOLUTION=768x432,URI="v4/iframe_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=234000,AVERAGE-BANDWIDTH=100000,CODECS="avc1.4D401F",RESOLUTION=480x270,URI="v5/iframe_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=243000,AVERAGE-BANDWIDTH=104000,CODECS="avc1.42C01E",RESOLUTION=480x270,URI="v6/iframe_index.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=116000,AVERAGE-BANDWIDTH=47000,CODECS="avc1.42C01E",RESOLUTION=320x180,URI="v7/iframe_index.m3u8"

$ xidel -s --xquery 'let $a:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/POW_04059374"})/json/json("https://start-player.npo.nl/video/POW_04059374/streams?profile=hls&amp;quality=npo&amp;tokenId="||token)//src return [{"format":"hls-0","container":"m3u8[manifest]","url":$a},for $x at $i in tokenize(tail(tokenize(substring-before(unparsed-text($a),"# keyframes"),"#EXT-X-MEDIA")),"#EXT-X-STREAM-INF") order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"(?:.+?BANDWIDTH=(\d+)\d{3})?.+aacl-(\d+)",(1,2)) return join(($a[1][.]-$a[2],$a[2]),"|")||"kbps","url":resolve-uri(extract($x,"(\w+/\w+\.m3u8)",1),$a)}]'
[
  {
    "format": "hls-0",
    "container": "m3u8[manifest]",
    "url": "https://pedgewarer29a.video.kpnstreaming.nl/session/115afc42-4845-11e9-8fdd-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/playlist.m3u8?token=6a655615e70ec5e72f562d2866ef066c_1552866109_1552866109"
  },
  {
    "format": "hls-1",
    "container": "m3u8[aac]",
    "resolution": null,
    "bitrate": "127kbps",
    "url": "https://pedgewarer29a.video.kpnstreaming.nl/session/115afc42-4845-11e9-8fdd-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/a1/a1.m3u8"
  },
  {
    "format": "hls-2",
    "container": "m3u8[h264+aac]",
    "resolution": "320x180",
    "bitrate": "325|127kbps",
    "url": "https://pedgewarer29a.video.kpnstreaming.nl/session/115afc42-4845-11e9-8fdd-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/v7/v7.m3u8"
  },
  {
    "format": "hls-3",
    "container": "m3u8[h264+aac]",
    "resolution": "480x270",
    "bitrate": "595|127kbps",
    "url": "https://pedgewarer29a.video.kpnstreaming.nl/session/115afc42-4845-11e9-8fdd-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/v5/v5.m3u8"
  },
  {
    "format": "hls-4",
    "container": "m3u8[h264+aac]",
    "resolution": "480x270",
    "bitrate": "767|127kbps",
    "url": "https://pedgewarer29a.video.kpnstreaming.nl/session/115afc42-4845-11e9-8fdd-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/v6/v6.m3u8"
  },
  {
    "format": "hls-5",
    "container": "m3u8[h264+aac]",
    "resolution": "768x432",
    "bitrate": "1405|127kbps",
    "url": "https://pedgewarer29a.video.kpnstreaming.nl/session/115afc42-4845-11e9-8fdd-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/v4/v4.m3u8"
  }
]

$ ffmpeg -hide_banner -i "https://pedgewarer29a.video.kpnstreaming.nl/session/f711b2bc-480e-11e9-ab0c-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/v4/v4.m3u8"
[hls,applehttp @ 05148c40] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 05148c40] Failed to open segment 0 of playlist 0
[hls,applehttp @ 05148c40] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 05148c40] Failed to open segment 1 of playlist 0
[hls,applehttp @ 05148c40] SAMPLE-AES encryption is not supported yet
[hls,applehttp @ 05148c40] Failed to open segment 2 of playlist 0
[...]
[hls,applehttp @ 05148c40] Failed to open segment 186 of playlist 0
[hls,applehttp @ 05148c40] Error when loading first segment 'https://pedgewarer29a.video.kpnstreaming.nl/session/f711b2bc-480e-11e9-ab0c-9cb65498e820/vn6ge2/hls/vod/nponep/vod/npo/fps/TEST/npo/hls/POW_04059374_v1552678828/v4/v4.ts'

------------------------------------------------------------------------------------------------

https://www.npostart.nl/nos-journaal/01-01-2017/POW_03375409 (huidige API)

$ xidel -s --xquery 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/POW_03375409"})/json/json(doc(embedUrl)//script/extract(.,"var video =(.+);",1)[.])'
{
  "id": "POW_03375409",
  "type": "broadcast",
  "title": "NOS Journaal",
  "subtitles": [
    {
      "label": "Nederlands",
      "default": false,
      "language": "nl",
      "src": "https://rs.poms.omroep.nl/v1/api/subtitles/POW_03375409/nl_NL/CAPTION.vtt"
    }
  ],
  "episodeTitle": "NOS Journaal",
  "franchiseTitle": "NOS Journaal 20.00 uur",
  "description": "Met het laatste nieuws, gebeurtenissen van nationaal en internationaal belang en de weersverwachting voor de avond en komende dagen.",
  "duration": 942,
  "age_rating": null,
  "still_image_url": "https://images.poms.omroep.nl/image/s1280/c1280x720/847679.jpg",
  "orig_image_url": "https://images.poms.omroep.nl/image/847679.jpg",
  "post_play_url": "https://images.poms.omroep.nl/image/s223/c223x125/847679.jpg",
  "share_text": "Bekijk NOS Journaal op https://www.npostart.nl/POW_03375409",
  "share_url": "https://www.npostart.nl/POW_03375409",
  "broadcasters": ["NOS"],
  "broadcastDate": "2017-01-01T19:00:00Z",
  "nextAsset": [...],
  "qualityOptions": [
    {
      "bitrate": "0",
      "label": "Hoogste",
      "resolution": "1080p",
      "platform": "npo"
    },
    {
      "bitrate": "643000",
      "label": "Hoog",
      "resolution": "720p",
      "platform": "npo"
    },
    {
      "bitrate": "491000",
      "label": "Medium",
      "resolution": "576p",
      "platform": "npo"
    },
    {
      "bitrate": "248000",
      "label": "Laag",
      "resolution": "360p",
      "platform": "npo"
    }
  ],
  "visualRadio": null,
  "episodeNumber": 1,
  "seriesId": "NOSjnl2000",
  "net": null,
  "genres": "informatief,nieuws/actualiteiten",
  "ster": {
    "uri": "https://adconfig.ster.nl/adurl/$$identifier$$?ncc=$$ncc$$&cust_params=1%3D1%26programma_titel%3Dnosjournaal2000uur%26afleverings_titel%3Dnosjournaal%26genre%3Dinformatief%26subgenre%3Dnieuws%2Factualiteiten%26video_duur%3D942%26prid%3DPOW_03375409%26srid%3DNOSjnl2000%26net%3D%26omroep%3Dnos%26os%3D$$os$$%26osversion%3D$$osversion$$%26player%3D$$player$$%26playerversion%3D$$playerversion$$%26site%3D$$site$$%26ai%3D$$ai$$%26referrer_url%3D$$referrer_url$$%26description_url%3D$$description_url$$",
    "customParameters": {
      "prid": "POW_03375409",
      "srid": "NOSjnl2000"
    },
    "placeholderValues": {
      "$$netwerk_id$$": "9233",
      "$$genre$$": "informatief",
      "$$subgenre$$": "nieuws/actualiteiten",
      "$$video_duur$$": 942,
      "$$net$$": null,
      "$$omroep$$": "nos",
      "$$programma_titel$$": "nosjournaal2000uur",
      "$$programmanaam$$": "nosjournaal2000uur",
      "$$stationid$$": "npo",
      "$$afleverings_titel$$": "nosjournaal"
    }
  },
  "recommender": "ts-base",
  "startAt": null,
  "parentId": null,
  "channel": "NED1"
}

$ xidel -s -e 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/POW_03375409"})/json/json("https://start-player.npo.nl/video/POW_03375409/streams?profile=hls&quality=npo&tokenId="||token)'
{
  "stream": {
    "src": "https://nl-ams-p8-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA1NjcsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.pk4pWcGsO3inQaJZJ8q6_2Yj7qKkfvGDTfvLYokiY2w/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/playlist.m3u8",
    "type": "application/vnd.apple.mpegurl"
  },
  "catchupAvailable": false
}

$ xidel -s -e 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/POW_03375409"})/json/json("https://start-player.npo.nl/video/POW_03375409/streams?profile=hls&quality=npo&tokenId="||token)/stream[not(protection)]/unparsed-text(src)'
#EXTM3U
#EXT-X-VERSION:4
## Created with Unified Streaming Platform(version=1.7.25)

# AUDIO groups
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-64",NAME="audio",AUTOSELECT=YES,DEFAULT=YES,CHANNELS="2"
#EXT-X-MEDIA:TYPE=AUDIO,GROUP-ID="audio-aacl-128",NAME="audio",AUTOSELECT=YES,DEFAULT=YES,CHANNELS="2"

# variants
#EXT-X-STREAM-INF:BANDWIDTH=282000,CODECS="mp4a.40.2,avc1.42C01E",RESOLUTION=480x270,AUDIO="audio-aacl-64",CLOSED-CAPTIONS=NONE
POW_03375409_v4-audio=64000-video=202000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=670000,CODECS="mp4a.40.2,avc1.42C01E",RESOLUTION=640x360,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
POW_03375409_v4-audio=128000-video=504000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=883000,CODECS="mp4a.40.2,avc1.42C01F",RESOLUTION=768x432,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
POW_03375409_v4-audio=128000-video=705000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=1203000,CODECS="mp4a.40.2,avc1.42C029",RESOLUTION=1024x576,AUDIO="audio-aacl-128",CLOSED-CAPTIONS=NONE
POW_03375409_v4-audio=128000-video=1006000.m3u8

# variants
#EXT-X-STREAM-INF:BANDWIDTH=68000,CODECS="mp4a.40.2",AUDIO="audio-aacl-64"
POW_03375409_v4-audio=64000.m3u8
#EXT-X-STREAM-INF:BANDWIDTH=136000,CODECS="mp4a.40.2",AUDIO="audio-aacl-128"
POW_03375409_v4-audio=128000.m3u8

# keyframes
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=27000,CODECS="avc1.42C01E",RESOLUTION=480x270,URI="keyframes/POW_03375409_v4-video=202000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=67000,CODECS="avc1.42C01E",RESOLUTION=640x360,URI="keyframes/POW_03375409_v4-video=504000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=94000,CODECS="avc1.42C01F",RESOLUTION=768x432,URI="keyframes/POW_03375409_v4-video=705000.m3u8"
#EXT-X-I-FRAME-STREAM-INF:BANDWIDTH=134000,CODECS="avc1.42C029",RESOLUTION=1024x576,URI="keyframes/POW_03375409_v4-video=1006000.m3u8"

$ xidel -s --xquery 'let $prid:="POW_03375409",$a:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$prid})/json,$b:=json(doc($a/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$c:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&amp;quality=npo&amp;tokenId=",$a/token))/stream[not(protection)]/src return {"name":$b/concat(franchiseTitle,if (contains(franchiseTitle,title)) then () else ": "||title),"date":format-date(dateTime($b/broadcastDate),"[D01]-[M01]-[Y]"),"duration":format-time($b/duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"subtitle":$b/(subtitles)()/src,"formats":[{"format":"hls-0","container":"m3u8[manifest]","url":$c}[url],for $x at $i in tail(tokenize(extract(unparsed-text($c),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),$c)}]}'
{
  "name": "NOS Journaal 20.00 uur",
  "date": "01-01-2017",
  "duration": "00:15:42",
  "subtitle": "https://rs.poms.omroep.nl/v1/api/subtitles/POW_03375409/nl_NL/CAPTION.vtt",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/playlist.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "64kbps",
      "url": "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=64000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "202|64kbps",
      "url": "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=64000-video=202000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "504|128kbps",
      "url": "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000-video=504000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "705|128kbps",
      "url": "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000-video=705000.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1006|128kbps",
      "url": "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000-video=1006000.m3u8"
    }
  ]
}

$ ffmpeg -hide_banner -i "https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000-video=1006000.m3u8"
[hls,applehttp @ 05148f00] Opening 'https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000-video=1006000-1.ts' for reading
[hls,applehttp @ 05148f00] Opening 'https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000-video=1006000-2.ts' for reading
Input #0, hls,applehttp, from 'https://nl-ams-p8-am3.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0MzA2NzksInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NTQwOVwvUE9XXzAzMzc1NDA5X3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.X4BVAngirnWk3oJ6U3cZpcXn-awJSC2W233RE_S7Gis/vod/npo/usp/npo/hls_unencrypted/POW_03375409/POW_03375409_v4.ism/POW_03375409_v4-audio=128000-video=1006000.m3u8':
  Duration: 00:15:42.32, start: 10.000000, bitrate: 0 kb/s
  Program 0
    Metadata:
      variant_bitrate : 0
    Stream #0:0: Audio: aac (LC) ([15][0][0][0] / 0x000F), 48000 Hz, stereo, fltp
    Metadata:
      variant_bitrate : 0
    Stream #0:1: Video: h264 (Constrained Baseline) ([27][0][0][0] / 0x001B), yuv420p, 1024x576 [SAR 1:1 DAR 16:9], 25 tbr, 90k tbn, 50 tbc
    Metadata:
      variant_bitrate : 0

------------------------------------------------------------------------------------------------

https://www.npostart.nl/tekenaar-dick-bruna-89-overleden/17-02-2017/POMS_NOS_7332480 (videofragment, huidige API)

$ xidel -s --xquery 'x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/POMS_NOS_7332480"})/json/json(doc(embedUrl)//script/extract(.,"var video =(.+);",1)[.])'
{
  "id": "POMS_NOS_7332480",
  "type": "fragment",
  "title": "Tekenaar Dick Bruna (89) overleden",
  "subtitles": [],
  "episodeTitle": "",
  "franchiseTitle": "NOS Journaal",
  "description": "Dick Bruna is gisteravond in zijn slaap overleden in zijn woonplaats Utrecht. De tekenaar die vooral bekend werd van Nijntje is 89 jaar geworden.",
  "duration": 104,
  "age_rating": null,
  "still_image_url": "https://images.poms.omroep.nl/image/s1280/c1280x720/866562.jpg",
  "orig_image_url": "https://images.poms.omroep.nl/image/866562.jpg",
  "post_play_url": "https://images.poms.omroep.nl/image/s223/c223x125/866562.jpg",
  "share_text": "Bekijk Tekenaar Dick Bruna (89) overleden op https://www.npostart.nl/POMS_NOS_7332480",
  "share_url": "https://www.npostart.nl/POMS_NOS_7332480",
  "broadcasters": ["NOS"],
  "broadcastDate": "2017-02-17T14:38:25Z",
  "nextAsset": null,
  "qualityOptions": [
    {
      "bitrate": "0",
      "label": "Hoogste",
      "resolution": "1080p",
      "platform": "npo"
    },
    {
      "bitrate": "643000",
      "label": "Hoog",
      "resolution": "720p",
      "platform": "npo"
    },
    {
      "bitrate": "491000",
      "label": "Medium",
      "resolution": "576p",
      "platform": "npo"
    },
    {
      "bitrate": "248000",
      "label": "Laag",
      "resolution": "360p",
      "platform": "npo"
    }
  ],
  "visualRadio": null,
  "episodeNumber": null,
  "seriesId": "NOSJournaal",
  "net": null,
  "genres": "informatief,nieuws/actualiteiten",
  "ster": {
    "uri": "https://adconfig.ster.nl/adurl/$$identifier$$?ncc=$$ncc$$&cust_params=1%3D1%26programma_titel%3Dnosjournaal%26afleverings_titel%3Dtekenaardickbruna89overleden%26genre%3Dinformatief%26subgenre%3Dnieuws%2Factualiteiten%26video_duur%3D104%26prid%3DPOMS_NOS_7332480%26srid%3DNOSJournaal%26net%3D%26omroep%3Dnos%26os%3D$$os$$%26osversion%3D$$osversion$$%26player%3D$$player$$%26playerversion%3D$$playerversion$$%26site%3D$$site$$%26ai%3D$$ai$$%26referrer_url%3D$$referrer_url$$%26description_url%3D$$description_url$$",
    "customParameters": {
      "prid": "POMS_NOS_7332480",
      "srid": "NOSJournaal"
    },
    "placeholderValues": {
      "$$netwerk_id$$": "9233",
      "$$genre$$": "informatief",
      "$$subgenre$$": "nieuws/actualiteiten",
      "$$video_duur$$": 104,
      "$$net$$": null,
      "$$omroep$$": "nos",
      "$$programma_titel$$": "nosjournaal",
      "$$programmanaam$$": "nosjournaal",
      "$$stationid$$": "npo",
      "$$afleverings_titel$$": "tekenaardickbruna89overleden"
    }
  },
  "recommender": "ts-base",
  "startAt": 22,
  "parentId": "POW_03374071",
  "channel": "NED1"
}

$ xidel -s --xquery 'let $prid:="POMS_NOS_7332480",$a:=x:request({"header":"X-Requested-With: XMLHttpRequest","url":"https://www.npostart.nl/api/token"})/json/x:request({"post":"_token="||token,"url":"https://www.npostart.nl/player/"||$prid})/json,$b:=json(doc($a/embedUrl)//script/extract(.,"var video =(.+);",1)[.]),$c:=json(concat("https://start-player.npo.nl/video/",$prid,"/streams?profile=hls&amp;quality=npo&amp;tokenId=",$a/token))/stream[not(protection)]/src return {"name":$b/concat(franchiseTitle,if (contains(franchiseTitle,title)) then () else ": "||title),"date":format-date(dateTime($b/broadcastDate),"[D01]-[M01]-[Y]"),"duration":format-time($b/duration * duration("PT1S"),"[H01]:[m01]:[s01]"),"start":if ($b/startAt) then format-time($b/startAt * duration("PT1S"),"[H01]:[m01]:[s01]") else (),"end":if ($b/startAt) then format-time(($b/duration + $b/startAt) * duration("PT1S"),"[H01]:[m01]:[s01]") else (),"subtitle":if ($b/parentId) then x:request({"url":concat("https://rs.poms.omroep.nl/v1/api/subtitles/",$b/parentId,"/nl_NL/CAPTION.vtt")})[contains(headers[1],"200")]/url else $b/(subtitles)()/src,"formats":[{"format":"hls-0","container":"m3u8[manifest]","url":$c}[url],for $x at $i in tail(tokenize(extract(unparsed-text($c),"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),$c)}]}'
{
  "name": "NOS Journaal: Tekenaar Dick Bruna (89) overleden",
  "date": "17-02-2017",
  "duration": "00:01:44",
  "start": "00:00:22",
  "end": "00:02:06",
  "subtitle": "https://rs.poms.omroep.nl/v1/api/subtitles/POW_03374071/nl_NL/CAPTION.vtt",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://nl-ams-p4-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0NjMyMzAsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NDA3MVwvUE9XXzAzMzc0MDcxX3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.7xDzcHJ4C2zzSsMyFTfmJN8HJX2Vy3dIfCZK83dPV6g/vod/npo/usp/npo/hls_unencrypted/POW_03374071/POW_03374071_v4.ism/playlist.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "64kbps",
      "url": "https://nl-ams-p4-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0NjMyMzAsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NDA3MVwvUE9XXzAzMzc0MDcxX3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.7xDzcHJ4C2zzSsMyFTfmJN8HJX2Vy3dIfCZK83dPV6g/vod/npo/usp/npo/hls_unencrypted/POW_03374071/POW_03374071_v4.ism/POW_03374071_v4-audio=64000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://nl-ams-p4-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0NjMyMzAsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NDA3MVwvUE9XXzAzMzc0MDcxX3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.7xDzcHJ4C2zzSsMyFTfmJN8HJX2Vy3dIfCZK83dPV6g/vod/npo/usp/npo/hls_unencrypted/POW_03374071/POW_03374071_v4.ism/POW_03374071_v4-audio=128000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "203|64kbps",
      "url": "https://nl-ams-p4-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0NjMyMzAsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NDA3MVwvUE9XXzAzMzc0MDcxX3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.7xDzcHJ4C2zzSsMyFTfmJN8HJX2Vy3dIfCZK83dPV6g/vod/npo/usp/npo/hls_unencrypted/POW_03374071/POW_03374071_v4.ism/POW_03374071_v4-audio=64000-video=203000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "506|128kbps",
      "url": "https://nl-ams-p4-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0NjMyMzAsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NDA3MVwvUE9XXzAzMzc0MDcxX3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.7xDzcHJ4C2zzSsMyFTfmJN8HJX2Vy3dIfCZK83dPV6g/vod/npo/usp/npo/hls_unencrypted/POW_03374071/POW_03374071_v4.ism/POW_03374071_v4-audio=128000-video=506000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "709|128kbps",
      "url": "https://nl-ams-p4-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0NjMyMzAsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NDA3MVwvUE9XXzAzMzc0MDcxX3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.7xDzcHJ4C2zzSsMyFTfmJN8HJX2Vy3dIfCZK83dPV6g/vod/npo/usp/npo/hls_unencrypted/POW_03374071/POW_03374071_v4.ism/POW_03374071_v4-audio=128000-video=709000.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1012|128kbps",
      "url": "https://nl-ams-p4-am5.cdn.streamgate.nl/eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE1NTM0NjMyMzAsInVyaSI6Ilwvdm9kXC9ucG9cL3VzcFwvbnBvXC9obHNfdW5lbmNyeXB0ZWRcL1BPV18wMzM3NDA3MVwvUE9XXzAzMzc0MDcxX3Y0LmlzbSIsImNsaWVudF9pcCI6IjgwLjEwMS40OS41In0.7xDzcHJ4C2zzSsMyFTfmJN8HJX2Vy3dIfCZK83dPV6g/vod/npo/usp/npo/hls_unencrypted/POW_03374071/POW_03374071_v4.ism/POW_03374071_v4-audio=128000-video=1012000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  let $prid:="POMS_NOS_7332480",
      $a:=x:request(
        {
          "header":"X-Requested-With: XMLHttpRequest",
          "url":"https://www.npostart.nl/api/token"
        }
      )/json/x:request(
        {
          "post":"_token="||token,
          "url":"https://www.npostart.nl/player/"||$prid
        }
      )/json,
      $b:=json(
        doc($a/embedUrl)//script/extract(
          .,
          "var video =(.+);",
          1
        )[.]
      ),
      $c:=json(
        concat(
          "https://start-player.npo.nl/video/",
          $prid,
          "/streams?profile=hls&amp;quality=npo&amp;tokenId=",
          $a/token
        )
      )/stream[not(protection)]/src
  return {
    "name":$b/concat(
      franchiseTitle,
      ": ",
      title
    ),
    "date":format-date(
      dateTime($b/broadcastDate),
      "[D01]-[M01]-[Y]"
    ),
    "duration":format-time(
      $b/duration * duration("PT1S"),
      "[H01]:[m01]:[s01]"
    ),
    "start":if ($b/startAt) then
      format-time(
        $b/startAt * duration("PT1S"),
        "[H01]:[m01]:[s01]"
      )
    else
      (),
    "end":if ($b/startAt) then
      format-time(
        ($b/duration + $b/startAt) * duration("PT1S"),
        "[H01]:[m01]:[s01]"
      )
    else
      (),
    "subtitle":if ($b/parentId) then
      x:request(
        {
          "url":concat(
            "https://rs.poms.omroep.nl/v1/api/subtitles/",
            $b/parentId,
            "/nl_NL/CAPTION.vtt"
          )
        }
      )[
        contains(
          headers[1],
          "200"
        )
      ]/url
    else
      $b/(subtitles)()/src,
    "formats":[
      {
        "format":"hls-0",
        "container":"m3u8[manifest]",
        "url":$c
      }[url],
      for $x at $i in tail(
        tokenize(
          extract(
            unparsed-text($c),
            "(#EXT-X-STREAM-INF.+m3u8$)",
            1,"ms"
          ),
          "#EXT-X-STREAM-INF:"
        )
      ) order by extract(
        $x,
        "BANDWIDTH=(\d+)",
        1
      ) count $i
      return {
        "format":"hls-"||$i,
        "container":if (
          contains(
            $x,
            "avc1"
          )
        ) then
          "m3u8[h264+aac]"
        else
          "m3u8[aac]",
        "resolution":extract(
          $x,
          "RESOLUTION=([\dx]+)",
          1
        )[.],
        "bitrate":let $a:=extract(
          $x,
          "audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",
          (1,2)
        ) return
        join(
          (
            $a[2][.],
            $a[1]
          ),
          "|"
        )||"kbps",
        "url":resolve-uri(
          extract(
            $x,
            "(.+m3u8)",
            1
          ),
          $c
        )
      }
    ]
  }
'

================================================================================================================================

[rtl]

https://www.rtl.nl/video/143d56f6-816e-3757-961d-eba686183076

$ xidel -s "http://www.rtl.nl/system/s4m/vfd/version=2/uuid=143d56f6-816e-3757-961d-eba686183076/fmt=adaptive/" --xquery '
  $json[
    not(
      meta/nr_of_videos_total=0
    )
  ]/{
    "name":replace(
      concat(
        .//station,
        ": ",
        abstracts/name,
        " - ",
        if (.//classname="uitzending") then
          episodes/name
        else
          .//title
      ),
      "[&quot;&apos;]",
      "'\'\''"
    ),
    "date":format-date(
      (material)()/original_date * duration("PT1S") + date("1970-01-01"),
      "[D01]-[M01]-[Y]"
    ),
    "duration":format-time(
      time((material)()/duration) + duration("PT0.5S"),
      "[H01]:[m01]:[s01]"
    ),
    "expdate":if ((.//ddr_timeframes)()[model="AVOD"]/stop) then
      format-dateTime(
        (.//ddr_timeframes)()[model="AVOD"]/stop * duration("PT1S") + dateTime("1970-01-01T01:00:00"),
        "[D01]-[M01]-[Y] [H01]:[m01]:[s01]"
      )
    else
      (),
    "formats":let $a:=.//videohost||.//videopath return [
      {
        "format":"hls-0",
        "container":"m3u8[manifest]",
        "url":$a
      },
      for $x at $i in tail(
        tokenize(
          unparsed-text($a),
          "#EXT-X-STREAM-INF:"
        )
      ) order by extract(
        $x,
        "BANDWIDTH=(\d+)",
        1
      ) count $i
      return {
        "format":"hls-"||$i,
        "container":if (
          contains(
            $x,
            "avc1"
          )
        ) then
          "m3u8[h264+aac]"
        else
          "m3u8[aac]",
        "resolution":extract(
          $x,
          "RESOLUTION=([\dx]+)",
          1
        )[.],
        "bitrate":let $a:=extract(
          $x,
          "audio=(\d+)(?:-video=(\d+)\d{3})?",
          (1,2)
        ) return
        join(
          (
            $a[2][.],
            round(
              $a[1] div 1000
            )
          ),
          "|"
        )||"kbps",
        "url":let $b:=extract(
          $x,
          "(.+m3u8)",
          1
        ) return
        if (
          starts-with(
            $b,
            "http"
          )
        ) then
          $b
        else
          resolve-uri(
            $b,
            $a
          )
      }
    ]
  }
'
{
  "name": "RTL4: RTL Nieuws - 19:30 uur",
  "date": "11-12-2018",
  "duration": "00:20:18",
  "expdate": "12-12-2019 06:35:25",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "http://manifest.us.rtl.nl/rtlxl/v166/network/pc/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "711x400",
      "bitrate": "903|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=903000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "912x512",
      "bitrate": "2093|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=2093000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3805|125kbps",
      "url": "http://manifest.us.rtl.nl/10/v166/aes/adaptive/components/actueel/rtlnieuws/390575/143d56f6-816e-3757-961d-eba686183076.ssm/143d56f6-816e-3757-961d-eba686183076.ism/143d56f6-816e-3757-961d-eba686183076-audio=125437-video=3805000.m3u8"
    }
  ]
}

================================================================================================================================

[-i, --info]

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json() return $b'
name
date
duration
start
end
expdate
subtitle
formats

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] return $b'
name
date
duration
start
end
expdate
subtitle

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]] return $b'
name
date
duration
expdate
subtitle

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]] return $b ! $a(.)'
Naam:
Datum:
Tijdsduur:
Gratis tot:
Ondertiteling:

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) return $c'
14

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)),$d:=string-join((1 to $c+1) ! "#") return $d'
###############

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)),$d:=string-join((1 to $c+1) ! " "),$e:=$b ! concat(substring($a(.)||$d,1,$c+1),$json(.)) return $e'
Naam:          NOS: NOS Journaal
Datum:         12-12-2018
Tijdsduur:     00:24:39
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/POW_03689795

------------------------------------------------------------------------------------------------
$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '501,551p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)),$d:=string-join((1 to $c+1) ! " "),$e:=$b ! concat(substring($a(.)||$d,1,$c+1),$json(.)) return $e' -e '"Formaten:"'
Naam:  NPO 1: Livestream
Datum: 29-12-2018
Formaten:

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '501,551p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=$b ! concat(substring($a(.)||$d,1,$c+1),$json(.)) return $e' -e '"Formaten:"'
Naam:     NPO 1: Livestream
Datum:    29-12-2018
Formaten:

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=$e(1)() return $f'
format
container
resolution
samplerate
bitrate			# In deze volgorde moeten de kolommen ook worden samengesteld.

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=distinct-values($json/(formats)()())[.!="url"] return $f'
format
container
resolution
bitrate			# De aanwezige objecten in $json/(formats)() in de goede volgorde.

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '2860,2965p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=distinct-values($json/(formats)()()[.!="url"]) return $f'
format
container
resolution
bitrate
samplerate			# De aanwezige objecten in $json/(formats)() in de verkeerde volgorde.

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '2860,2965p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)] return $f'
format
container
resolution
samplerate
bitrate			# De aanwezige objecten in $json/(formats)() in de goede volgorde.

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! $e(1)(.) return $g'
formaat
container
resolutie
bitrate

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! max($e()(.) ! string-length(.)) return $g'
7
14
9
12

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - -e 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! "#") return $h'
##########################################

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") for $x in $e(1) return concat(substring("Formaten:"||$d,1,$c+1),string-join(for $y at $i in $f return substring($x($y)[.]||$h,1,$g[$i]+2)))'
Formaten:      formaat  container       resolutie  bitrate

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)[.]||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ())'
Formaten:      formaat  container       resolutie  bitrate
               pg-1     m4v[h264+aac]
               pg-2     m4v[h264+aac]
               pg-3     m4v[h264+aac]
               hls-0    m3u8[manifest]
               hls-1    m3u8[h264+aac]  480x270    203|96kbps
               hls-2    m3u8[h264+aac]  480x270    203|128kbps
               hls-3    m3u8[h264+aac]  480x270    203|192kbps
               hls-4    m3u8[h264+aac]  640x360    505|96kbps
               hls-5    m3u8[h264+aac]  640x360    505|128kbps
               hls-6    m3u8[h264+aac]  640x360    505|192kbps
               hls-7    m3u8[h264+aac]  1024x576   1109|96kbps
               hls-8    m3u8[h264+aac]  1024x576   1109|128kbps
               hls-9    m3u8[h264+aac]  1024x576   1109|192kbps
               hls-10   m3u8[h264+aac]  1024x576   1810|96kbps
               hls-11   m3u8[h264+aac]  1024x576   1810|128kbps
               hls-12   m3u8[h264+aac]  1024x576   1810|192kbps  (best)

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '267,381p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)[.]||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()))'
Naam:          NOS: NOS Journaal
Datum:         12-12-2018
Tijdsduur:     00:24:39
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/POW_03689795
Formaten:      formaat  container       resolutie  bitrate
               pg-1     m4v[h264+aac]
               pg-2     m4v[h264+aac]
               pg-3     m4v[h264+aac]
               hls-0    m3u8[manifest]
               hls-1    m3u8[h264+aac]  480x270    203|96kbps
               hls-2    m3u8[h264+aac]  480x270    203|128kbps
               hls-3    m3u8[h264+aac]  480x270    203|192kbps
               hls-4    m3u8[h264+aac]  640x360    505|96kbps
               hls-5    m3u8[h264+aac]  640x360    505|128kbps
               hls-6    m3u8[h264+aac]  640x360    505|192kbps
               hls-7    m3u8[h264+aac]  1024x576   1109|96kbps
               hls-8    m3u8[h264+aac]  1024x576   1109|128kbps
               hls-9    m3u8[h264+aac]  1024x576   1109|192kbps
               hls-10   m3u8[h264+aac]  1024x576   1810|96kbps
               hls-11   m3u8[h264+aac]  1024x576   1810|128kbps
               hls-12   m3u8[h264+aac]  1024x576   1810|192kbps  (best)

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '501,551p' | xidel -s - --xquery '[...]'
Naam:     NPO 1: Livestream
Datum:    29-12-2018
Formaten: formaat  container       resolutie  bitrate
          hls-0    m3u8[manifest]
          hls-1    m3u8[aac]                  128kbps
          hls-2    m3u8[h264+aac]  384x216    200|128kbps
          hls-3    m3u8[h264+aac]  480x270    499|128kbps
          hls-4    m3u8[h264+aac]  768x432    1000|128kbps
          hls-5    m3u8[h264+aac]  1024x576   1800|128kbps  (best)

------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '384,498p' | xidel -s - -e 'if (start) then (time(start) - (seconds-from-time(start) mod 30 * duration("PT1S")),seconds-from-time(start) mod 30,duration) else ()'
00:55:00
6
00:01:59

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '384,498p' | xidel -s - -e 'if (start) then concat("Download: ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * duration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]") else ()'
Download: ffmpeg -ss 00:55:00 -i [url] -ss 6 -t 00:01:59 [...]
------------------------------------------------------------------------------------------------

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '384,498p' | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)[.]||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()),if (start) then ("",concat(substring("Download:"||$d,1,$c+1),"ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * duration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]")) else ())'
Naam:          AVROTROS: Hunted - De laatste minuten...
Datum:         17-12-2018
Tijdsduur:     00:01:59
Begin:         00:55:06
Einde:         00:57:05
Gratis tot:    01-01-2101 00:59:00
Ondertiteling: http://tt888.omroep.nl/tt888/AT_2105785
Formaten:      formaat  container       resolutie  bitrate
               pg-1     m4v[h264+aac]
               pg-2     m4v[h264+aac]
               pg-3     m4v[h264+aac]
               hls-0    m3u8[manifest]
               hls-1    m3u8[h264+aac]  480x270    202|96kbps
               hls-2    m3u8[h264+aac]  480x270    202|128kbps
               hls-3    m3u8[h264+aac]  480x270    202|192kbps
               hls-4    m3u8[h264+aac]  640x360    504|96kbps
               hls-5    m3u8[h264+aac]  640x360    504|128kbps
               hls-6    m3u8[h264+aac]  640x360    504|192kbps
               hls-7    m3u8[h264+aac]  1024x576   1109|96kbps
               hls-8    m3u8[h264+aac]  1024x576   1109|128kbps
               hls-9    m3u8[h264+aac]  1024x576   1109|192kbps
               hls-10   m3u8[h264+aac]  1024x576   1813|96kbps
               hls-11   m3u8[h264+aac]  1024x576   1813|128kbps
               hls-12   m3u8[h264+aac]  1024x576   1813|192kbps  (best)

Download:      ffmpeg -ss 00:55:00 -i [url] -ss 6 -t 00:01:59 [...]

$ cat <<EOF | xidel -s - --xquery 'let $a:={"name":"Naam:","date":"Datum:","duration":"Tijdsduur:","start":"Begin:","end":"Einde:","expdate":"Gratis tot:","subtitle":"Ondertiteling:"},$b:=$json()[.!="formats"] ! .[$json(.)[.]],$c:=max($b ! $a(.) ! string-length(.)) ! (if (.>9) then . else 9),$d:=string-join((1 to $c+1) ! " "),$e:=[{"format":"formaat","container":"container","resolution":"resolutie","samplerate":"frequentie","bitrate":"bitrate"},$json/(formats)()],$f:=for $x in $e(1)() return distinct-values($json/(formats)()()[.!="url"])[contains(.,$x)],$g:=$f ! max($e()(.) ! string-length(.)),$h:=string-join((1 to sum($g)) ! " ") return ($b ! concat(substring($a(.)||$d,1,$c+1),$json(.)),if ($e(2)) then for $x at $i in $e() return concat(if ($i=1) then substring("Formaten:"||$d,1,$c+1) else $d,string-join(for $y at $i in $f return substring($x($y)[.]||$h,1,$g[$i]+2)),if ($i=count($e())) then "(best)" else ()) else substring("Formaten:"||$d,1,$c+1)||"-",if (start) then ("",concat(substring("Download:"||$d,1,$c+1),"ffmpeg -ss ",time(start) - (seconds-from-time(start) mod 30 * duration("PT1S"))," -i [url] -ss ",seconds-from-time(start) mod 30," -t ",duration," [...]")) else ())'
{
  "name": "VPRO: Zigeunermuziek doet pijn - Bob Entrop, VPRO, 2008 (58 min.)",
  "date": "21-07-2010",
  "duration": "00:58:00",
  "start": null,
  "end": null,
  "expdate": null,
  "subtitle": null,
  "formats": null
}
EOF
Naam:      VPRO: Zigeunermuziek doet pijn - Bob Entrop, VPRO, 2008 (58 min.)
Datum:     21-07-2010
Tijdsduur: 00:58:00
Formaten:  -

$ cat /cygdrive/d/Storage/Media/Binaries/bashgemist_notes.txt | sed -n '2860,2965p' | xidel -s - --xquery '[...]'
Naam:      Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
Datum:     01-02-2019
Tijdsduur: 00:18:13
Formaten:  formaat  container         resolutie       frequentie  bitrate
           pg-1     3gp[mp4v+aac]     176x144                     82kbps
           pg-2     3gp[mp4v+aac]     320x180                     226kbps
           pg-3     mp4[h264+aac]     640x360                     489kbps
           pg-4     webm[vp8+vorbis]  640x360
           pg-5     mp4[h264+aac]     1280x720                    1603kbps
           dash-1   mp4[aac]                          22.05kHz    51kbps
           dash-2   mp4[aac]                          44.1kHz     131kbps
           dash-3   mp4[h264]         256x144@25fps               108kbps
           dash-4   mp4[h264]         426x240@25fps               242kbps
           dash-5   mp4[h264]         640x360@25fps               613kbps
           dash-6   mp4[h264]         854x480@25fps               1155kbps
           dash-7   mp4[h264]         1280x720@25fps              2310kbps
           dash-8   mp4[h264]         1280x720@50fps              2866kbps  (best)

------------------------------------------------------------------------------------------------

--xquery '
  let $a:={
        "name":"Naam:",
        "date":"Datum:",
        "duration":"Tijdsduur:",
        "start":"Begin:",
        "end":"Einde:",
        "expdate":"Gratis tot:",
        "subtitle":"Ondertiteling:"
      },
      $b:=$json()[.!="formats"] ! .[$json(.)[.]],
      $c:=max(
        $b ! $a(.) ! string-length(.)
      ) ! (
        if (.>9) then
          .
        else
          9
      ),
      $d:=string-join(
        (1 to $c+1) ! " "
      ),
      $e:=[
        {
          "format":"formaat",
          "container":"container",
          "resolution":"resolutie",
          "samplerate":"frequentie",
          "bitrate":"bitrate"
        },
        $json/(formats)()
      ],
      $f:=for $x in $e(1)() return
      distinct-values(
        $json/(formats)()()[.!="url"]
      )[
        contains(
          .,
          $x
        )
      ],
      $g:=$f ! max(
        $e()(.) ! string-length(.)
      ),
      $h:=string-join(
        (1 to sum($g)) ! " "
      )
  return (
    $b ! concat(
      substring(
        $a(.)||$d,
        1,
        $c+1
      ),
      $json(.)
    ),
    if ($e(2)) then
      for $x at $i in $e() return
      concat(
        if ($i=1) then
          substring(
            "Formaten:"||$d,
            1,
            $c+1
          )
        else
          $d,
        string-join(
          for $y at $i in $f return
          substring(
            $x($y)[.]||$h,
            1,
            $g[$i]+2
          )
        ),
        if ($i=count($e())) then
          "(best)"
        else
          ()
      )
    else
      substring(
        "Formaten:"||$d,
        1,
        $c+1
      )||"-",
    if (start) then (
      "",
      concat(
        substring(
          "Download:"||$d,
          1,
          $c+1
        ),
        "ffmpeg -ss ",
        time(start) - (
          seconds-from-time(start) mod 30 * duration("PT1S")
        ),
        " -i [url] -ss ",
        seconds-from-time(start) mod 30,
        " -t ",
        duration,
        " [...]"
      )
    ) else
      ()
  )
'

================================================================================================================================

[kijk]

https://www.kijk.nl/ --> https://consent.talpanetwork.com/?TN_REFERAL_URL=https://www.kijk.nl/&TN_REFERAL_ORIGIN= (cookie wall)

Antwoordheader in PaleMoon:

Host: www.kijk.nl
User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:60.9) Gecko/20100101 Goanna/4.1 Firefox/60.9 PaleMoon/28.2.2
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: nl,en-US;q=0.7,en;q=0.3
Accept-Encoding: gzip, deflate, br
Referer: https://consent.talpanetwork.com/?TN_REFERAL_URL=https:%2F%2Fwww.kijk.nl%2F&TN_REFERAL_ORIGIN=
Cookie: CONSENTMGR=ts:1546358787966|consent:true|c1:0; OPTOUTMULTI=0:0%7Cc5:0%7Cc1:0%7Cc4:0%7Cc3:0%7Cc2:0; TN_UUID=edae8abd-659b-477a-8dfe-caf4d718fcd7; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjCAcAAiABUAC4AIAAZABEgCaAJ4AWwAxABuAD8AIAARgApQBXADvAIQARaAjgCOgEuAJ2AVkAuoBgQDiAHugP0A_YCCg; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE54EfETAAQgAAHAA; utag_main=v_id:01680a2a9c200013725d1ee67abe02068001400d0086e$_sn:1$_ss:1$_st:1546360591204$ses_id:1546358791204%3Bexp-session$_pn:1%3Bexp-session$dc_group:79$dc_visit:1$dc_event:1%3Bexp-session; gig_canary=false; gig_canary_ver=2155-1-25772625; AMCV_A1DF40865A97CDF00A495C28%40AdobeOrg=1999109931%7CMCMID%7C60597001633179420918454649860814799344%7CMCAID%7CNONE; gig_hasGmid=login; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjB7_______9______9uz_Gv_v_f__33e8__9v_l_7_-___u_-33d4-_1vf99yfm1-7ftr3tp_87ues2_Xur__59__3z3_Nog; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE6ACgACAH0AQABOA; 706b604c-184a-4235-899c-a744921ce65cfaktorId=e024bb11-1299-48e3-bde1-107f1e68860c; s_cc=true; s_sq=%5B%5BB%5D%5D; lastConsentChange=1546358793852
Connection: keep-alive
If-None-Match: W/"1f0e3-fT3OIiIk44flJJLFU9CqLmMwCfA"
Cache-Control: max-age=0

$ xidel -s -H "Cookie: CONSENTMGR=ts:1546358787966|consent:true|c1:0; OPTOUTMULTI=0:0%7Cc5:0%7Cc1:0%7Cc4:0%7Cc3:0%7Cc2:0; TN_UUID=edae8abd-659b-477a-8dfe-caf4d718fcd7; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjCAcAAiABUAC4AIAAZABEgCaAJ4AWwAxABuAD8AIAARgApQBXADvAIQARaAjgCOgEuAJ2AVkAuoBgQDiAHugP0A_YCCg; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE54EfETAAQgAAHAA; utag_main=v_id:01680a2a9c200013725d1ee67abe02068001400d0086e$_sn:1$_ss:1$_st:1546360591204$ses_id:1546358791204%3Bexp-session$_pn:1%3Bexp-session$dc_group:79$dc_visit:1$dc_event:1%3Bexp-session; gig_canary=false; gig_canary_ver=2155-1-25772625; AMCV_A1DF40865A97CDF00A495C28%40AdobeOrg=1999109931%7CMCMID%7C60597001633179420918454649860814799344%7CMCAID%7CNONE; gig_hasGmid=login; 706b604c-184a-4235-899c-a744921ce65ceuconsent=BOZs6AnOZs6AnADABANLB_-AAAAjB7_______9______9uz_Gv_v_f__33e8__9v_l_7_-___u_-33d4-_1vf99yfm1-7ftr3tp_87ues2_Xur__59__3z3_Nog; 706b604c-184a-4235-899c-a744921ce65ccconsent=BOZs6AnOZs6AnADABANLAEAAAAAE6ACgACAH0AQABOA; 706b604c-184a-4235-899c-a744921ce65cfaktorId=e024bb11-1299-48e3-bde1-107f1e68860c; s_cc=true; s_sq=%5B%5BB%5D%5D; lastConsentChange=1546358793852" "https://www.kijk.nl" -e '$raw'

Op deze manier kun je toch kijk.nl scrapen. Misschien is er een kortere/makkelijkere manier.
Gelukkig hoeft dit voor https://embed.kijk.nl/video/[prid] niet.

------------------------------------------------------------------------------------------------

PRID extractie:

$ cat <<EOF | while read a; do xidel -s -e 'extract("'$a'","(?:video|videos)/(\w+)",1)'; done
https://www.kijk.nl/sbs6/hartvannederland/videos/VR83fgb6opk/hart-van-nederland-late-editie
http://www.kijk.nl/video/VR83fgb6opk
EOF

VR83fgb6opk
VR83fgb6opk

------------------------------------------------------------------------------------------------

https://www.kijk.nl/sbs6/hartvannederland/videos/GgO61doGeqZ/hart-van-nederland-vroeg (15-01-2019)

$ xidel -s "https://embed.kijk.nl/video/GgO61doGeqZ" -e 'outer-html(//video)'
<video data-video-id="5989729116001" data-account="585049245001" data-player="B168VjQ3W" data-embed="default" data-application-id="" class="video-js" controls="" width="100%" height="100%" id="player" preload="none"></video>

Hier wordt blijkbaar nog van Brightcove gebruik gemaakt.

$ xidel -s "https://embed.kijk.nl/video/GgO61doGeqZ" -e 'x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json'
{
  "description": "Hart van Nederland - Vroeg",
  "poster_sources": [
    {
      "src": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200121985121-still.jpg"
    }
  ],
  "tags": ["hartvannederlandvroeg", "sbs6", "vod"],
  "cue_points": [],
  "custom_fields": {
    "sbs_videotype": "vod",
    "sbs_adpolicy": "long",
    "sbs_episode": "S2019E11",
    "sbs_program": "hartvannederland",
    "nlz_cst_id": "GgO61doGeqZ",
    "sko_t": "1900",
    "sko_stid": "63",
    "sko_prid": "611490483",
    "sko_pr": "hart_van_nederland__vroeg",
    "sko_ty": "tv.ep",
    "sko_dt": "20190115",
    "sbs_station": "sbs6"
  },
  "account_id": "585049245001",
  "sources": [
    {
      "avg_bitrate": 2.085E6,
      "width": 868,
      "duration": 1.3086E6,
      "size": 3.23033213E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200036985121-bg-1885.mp4",
      "codec": "H264",
      "asset_id": "5989728026001",
      "container": "MP4",
      "height": 488,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": 866000,
      "width": 512,
      "duration": 1.3086E6,
      "size": 1.21766761E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200026985121-bg-650.mp4",
      "codec": "H264",
      "asset_id": "5989728027001",
      "container": "MP4",
      "height": 288,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": 1.116E6,
      "width": 640,
      "duration": 1.3086E6,
      "size": 1.62308598E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200028985121-bg-900.mp4",
      "codec": "H264",
      "asset_id": "5989728344001",
      "container": "MP4",
      "height": 360,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": null,
      "width": null,
      "src": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/sbs6_hartvannederlandvroeg_S2019E11_190115201516985121-hls-main.m3u8",
      "size": 0,
      "height": null,
      "duration": -1,
      "container": "M2TS",
      "codec": "H264",
      "asset_id": "5989730179001"
    },
    {
      "avg_bitrate": 1.465E6,
      "width": 768,
      "duration": 1.3086E6,
      "size": 2.11828455E8,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200029985121-bg-1200.mp4",
      "codec": "H264",
      "asset_id": "5989730283001",
      "container": "MP4",
      "height": 432,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    },
    {
      "avg_bitrate": 450000,
      "width": 320,
      "duration": 1.3086E6,
      "size": 7.2607446E7,
      "stream_name": "mp4:ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200022985121-bg-350.mp4",
      "codec": "H264",
      "asset_id": "5989730565001",
      "container": "MP4",
      "height": 180,
      "app_name": "rtmp://pssbsfs.fplive.net/pssbsfs"
    }
  ],
  "name": "Hart van Nederland - Vroeg",
  "reference_id": "sbs6_hartvannederlandvroeg_S2019E11_190115201543",
  "long_description": "'Waar praat Nederland vandaag over?' Toegankelijk nieuwsprogramma dat het gesprek van de dag op verrassende wijze in beeld brengt.",
  "duration": 1.3086E6,
  "economics": "AD_SUPPORTED",
  "published_at": "2019-01-15T19:15:50.278Z",
  "text_tracks": [],
  "updated_at": "2019-01-15T19:15:54.765Z",
  "thumbnail": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200125985121-thumb.jpg",
  "poster": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200121985121-still.jpg",
  "offline_enabled": false,
  "link": null,
  "id": "5989729116001",
  "ad_keys": null,
  "thumbnail_sources": [
    {
      "src": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/stills/sbs6_hartvannederlandvroeg_S2019E11_190115200125985121-thumb.jpg"
    }
  ],
  "created_at": "2019-01-15T19:15:50.265Z"
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Geen expiration date hier boven. Hier wel:

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/GgO61doGeqZ" -e '$json/playerInfo'
{
  "sbsvpakey": "GgO61doGeqZ",
  "hostingkey": "5989729116001",
  "license": {
    "licenseId": "YnJpZ2h0Y292ZS5GVk9ELjAuNTk4OTcyOTExNjAwMQ==",
    "licensetype": "FVOD",
    "promotions": [],
    "ishd": false,
    "startdate": {
      "date": "2019-01-15 19:30:46.000000",
      "timezone_type": 3,
      "timezone": "Europe/Amsterdam"
    },
    "enddate": {
      "date": "2020-01-15 19:30:46.000000",
      "timezone_type": 3,
      "timezone": "Europe/Amsterdam"
    },
    "price": 0,
    "hascontent": true,
    "preroll": true,
    "hostingkey": "5989729116001",
    "hostingservice": "brightcove",
    "AvailableOutletDevices": [
      [...]
    ]
  },
  "embed_video_url": "//embed.kijk.nl/?video=GgO61doGeqZ",
  "embed_api_url": "http://embed.kijk.nl/api/video/GgO61doGeqZ?id=kijkapp",
  "hasDRM": false
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

$ xidel -s "https://embed.kijk.nl/video/GgO61doGeqZ" --xquery 'x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/GgO61doGeqZ")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(extract(.,"(.+m3u8)",1),$a)}]}'
{
  "name": "SBS6: Hart van Nederland - Vroeg S2019E11",
  "date": "15-01-2019",
  "duration": "00:21:49",
  "expdate": "15-01-2020 19:30:46",
  "formats": [
    {
      "format": "pg-1",
      "container": "mp4[h264+aac]",
      "resolution": "320x180",
      "bitrate": "450kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200022985121-bg-350.mp4"
    },
    {
      "format": "pg-2",
      "container": "mp4[h264+aac]",
      "resolution": "512x288",
      "bitrate": "866kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200026985121-bg-650.mp4"
    },
    {
      "format": "pg-3",
      "container": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1116kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200028985121-bg-900.mp4"
    },
    {
      "format": "pg-4",
      "container": "mp4[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1465kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200029985121-bg-1200.mp4"
    },
    {
      "format": "pg-5",
      "container": "mp4[h264+aac]",
      "resolution": "868x488",
      "bitrate": "2085k",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/mp4/sbs6_hartvannederlandvroeg_S2019E11_190115200036985121-bg-1885.mp4"
    },
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/sbs6_hartvannederlandvroeg_S2019E11_190115201516985121-hls-main.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[h264+aac]",
      "resolution": "320x180",
      "bitrate": "611kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r1/sbs6_hartvannederlandvroeg_S2019E11_190115200141985121-hls-350.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "512x288",
      "bitrate": "929kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r2/sbs6_hartvannederlandvroeg_S2019E11_190115200150985121-hls-650.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "1289kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r3/sbs6_hartvannederlandvroeg_S2019E11_190115200159985121-hls-900.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1643kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r4/sbs6_hartvannederlandvroeg_S2019E11_190115200210985121-hls-1200.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "868x488",
      "bitrate": "2179kbps",
      "url": "https://vod-bc-prod-1.talpatvcdn.nl/ra/01/98512197192f61fad62fba8d11db7a0c243dff/hls/r8/sbs6_hartvannederlandvroeg_S2019E11_190115200212985121-hls-1885.m3u8"
    }
  ]
}

Inmiddels, na een paar dagen, zijn ook deze video's over gezet naar "theplatform" api. Waarschijnlijk gebruikt Kijk Brightcove nog als backup.

------------------------------------------------------------------------------------------------


https://www.kijk.nl/sbs6/hartvannederland/videos/wyK2GhcnFje/hart-van-nederland-vroeg (16-01-2019)

$ xidel -s "https://embed.kijk.nl/video/wyK2GhcnFje" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/fKaRT0ndbesA/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/nxnA_bHJGpLK/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        }
      ],
      "image": "https://img.kijk.nl/media/cache/computer_nonretina_series_image/imgsrc06/images/redactioneel/1081186-LS---20190117100148--39432a5aae5a45a59f87f1de912c84dd.jpg?lu=73647e9a8561c9ec7625b167c3e43bec",
      "mediaid": "wyK2GhcnFje",
      "title": "Hart van Nederland - Vroeg ",
      "description": "Aflevering 12, Seizoen 2019",
      "displaytitle": true,
      "tracks": [],
      "fwassetid": "wyK2GhcnFje",
      "TAQ": {
        "dataLayer": {
          "media_datecreated": 1547661600,
          "media_datemodified": 1547661600,
          "media_datepublished": 1547663352,
          "media_duration": "1272",
          "media_genre": "Nieuws",
          "media_id": "wyK2GhcnFje",
          "media_name": "Hart van Nederland - Vroeg ",
          "media_program_episodenumber": "12",
          "media_program_name": "Hart van Nederland - Vroeg",
          "media_program_season": "2019",
          "media_videotype": "vod",
          "player_channel": "embedded_3p",
          "player_channelid": "embedded_3p",
          "player_embedurl": "http://www.kijk.nl/video/wyK2GhcnFje",
          "player_id": "embedded_3p",
          "player_name": "jwplayer",
          "player_source": "embedded_3p",
          "player_version": "8.2.4"
        },
        "customLayer": {
          "c_media_dateexpires": 1579199352,
          "c_media_duration_type": "long",
          "c_media_genre_code": "nieuws/actualiteiten",
          "c_media_ispartof": "Hart van Nederland - Vroeg",
          "c_media_live": 0,
          "c_media_outlet": "embedded_3p",
          "c_media_partner": "embedded3p",
          "c_media_playbacktype": "vod",
          "c_media_station": "sbs6",
          "c_sko_cl": 1272,
          "c_sko_dt": "20190116",
          "c_sko_gen": 11100,
          "c_sko_pr": "hart_van_nederland_-_vroeg_editie",
          "c_sko_prid": "611490547",
          "c_sko_stid": 63,
          "c_sko_t": "1900",
          "c_sko_ty": "tv.ep"
        }
      }
    }
  ],
  "width": "100%",
  "height": "100%",
  "stretching": "uniform",
  "autostart": "true",
  "skin": {
    "name": "kijk",
    "timeslider": {
      "progress": "#f48800"
    }
  },
  "advertising": {
    "admessage": "",
    "client": "freewheel",
    "cuetext": "Advertentie",
    "vpaidcontrols": true,
    "freewheel": {
      "networkid": "506166",
      "serverid": "https://7b935.v.fwmrm.net/ad/g/1",
      "profileid": "506166:sanoma_sbs_ovp_js_live",
      "sectionid": "sbs_embedded3p_desktop",
      "adManagerURL": "https://mssl.fwmrm.net/p/sanoma_sbs_live/AdManager.js",
      "custom": {
        "cd_type": "long",
        "vdur": "1272",
        "embed_domain": "embed.kijk.nl"
      }
    },
    "schedule": {
      "adbreak": {
        "offset": "pre",
        "tag": "placeholder_preroll"
      }
    }
  },
  "sharing": {
    "heading": "Deel Video",
    "sites": [
      {
        "label": "Facebook",
        "icon": "/talpa-jw-skin/icons/facebook.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=facebook&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FwyK2GhcnFje&title=Hart van Nederland - Vroeg &ct=0&tt=0&"
      },
      {
        "label": "Twitter",
        "icon": "/talpa-jw-skin/icons/twitter.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=twitter&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FwyK2GhcnFje&title=Hart van Nederland - Vroeg &ct=0&tt=0&"
      }
    ]
  },
  "cast": [],
  "related": [],
  "videoType": "vod",
  "adBlockerCheck": true,
  "allowPlayerApi": false
}

$ xidel -s "https://embed.kijk.nl/video/wyK2GhcnFje" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/wyK2GhcnFje")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(extract(.,"(.+m3u8)",1),$a)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/customLayer/concat(upper-case(c_media_station),": ",c_media_ispartof),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"formats":(sources)()[type="m3u8"]/x:request({"url":file})/[{"format":"hls-0","container":"m3u8[manifest]","url":url}[url],for $x at $i in tail(tokenize(extract(doc,"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),url)}]}'
{
  "name": "SBS6: Hart van Nederland - Vroeg",
  "date": "16-01-2019",
  "duration": "00:21:12",
  "expdate": "16-01-2020 19:29:12",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]"
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/1547666742988.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "320x180",
      "bitrate": "395|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=395000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "512x288",
      "bitrate": "743|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=743000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "996|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=996000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1313|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=1313000.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "868x488",
      "bitrate": "2032|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/wyK2GhcnFje/6fc90666-61fd-4e10-a474-5a046800f49a/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index.ism/Hart_van_Nederland_Vroeg_Season_2019_Episode_12-index-audio_eng=94000-video=2032000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://www.kijk.nl/sbs6/wegmisbruikers/videos/yWLXx6VtFuG/wegmisbruikers

$ xidel -s "https://embed.kijk.nl/video/yWLXx6VtFuG" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/6jW4kiLWw7Bz/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/gR9CONHWSQHC/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        }
      ],
      "image": "https://img.kijk.nl/media/cache/computer_nonretina_series_image/imgsrc06/images/redactioneel/1079050-LS---20181214140739--c227486ec6235b395f7a96b978158499.jpg?lu=9d59d19573f5c680d7c96b87afff850d",
      "mediaid": "yWLXx6VtFuG",
      "title": "Wegmisbruikers",
      "description": "Aflevering 4, Seizoen 24",
      "displaytitle": true,
      "tracks": [
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-thumbnails.vtt",
          "type": "webvtt",
          "kind": "thumbnails"
        },
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-sd.vtt",
          "type": "webvtt",
          "kind": "captions",
          "label": " Doven en Slechthorenden"
        },
        {
          "file": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-nl.vtt",
          "type": "webvtt",
          "kind": "captions",
          "label": " Nederlands"
        }
      ],
      "fwassetid": "yWLXx6VtFuG",
      "TAQ": {
        "dataLayer": {
          "media_datecreated": 1544815800,
          "media_datemodified": 1544815800,
          "media_datepublished": 1544819058,
          "media_duration": "2403",
          "media_genre": "Scripted Reality",
          "media_id": "yWLXx6VtFuG",
          "media_name": "Wegmisbruikers",
          "media_program_episodenumber": "4",
          "media_program_name": "Wegmisbruikers",
          "media_program_season": "24",
          "media_videotype": "vod",
          "player_channel": "embedded_3p",
          "player_channelid": "embedded_3p",
          "player_embedurl": "http://www.kijk.nl/video/yWLXx6VtFuG",
          "player_id": "embedded_3p",
          "player_name": "jwplayer",
          "player_source": "embedded_3p",
          "player_version": "8.2.4"
        },
        "customLayer": {
          "c_media_dateexpires": 1576355058,
          "c_media_duration_type": "long",
          "c_media_genre_code": "Overige",
          "c_media_ispartof": "Wegmisbruikers",
          "c_media_live": 0,
          "c_media_outlet": "embedded_3p",
          "c_media_partner": "embedded3p",
          "c_media_playbacktype": "vod",
          "c_media_station": "sbs6",
          "c_sko_cl": 2403,
          "c_sko_dt": "20181214",
          "c_sko_gen": 21190,
          "c_sko_pr": "wegmisbruikers",
          "c_sko_prid": "547724877",
          "c_sko_stid": 63,
          "c_sko_t": "2027",
          "c_sko_ty": "tv.ep"
        }
      }
    }
  ],
  "width": "100%",
  "height": "100%",
  "stretching": "uniform",
  "autostart": "true",
  "skin": {
    "name": "kijk",
    "timeslider": {
      "progress": "#f48800"
    }
  },
  "advertising": {
    "admessage": "",
    "client": "freewheel",
    "cuetext": "Advertentie",
    "vpaidcontrols": true,
    "freewheel": {
      "networkid": "506166",
      "serverid": "https://7b935.v.fwmrm.net/ad/g/1",
      "profileid": "506166:sanoma_sbs_ovp_js_live",
      "sectionid": "sbs_embedded3p_desktop",
      "adManagerURL": "https://mssl.fwmrm.net/p/sanoma_sbs_live/AdManager.js",
      "custom": {
        "cd_type": "long",
        "vdur": "2403",
        "embed_domain": "embed.kijk.nl"
      }
    },
    "schedule": {
      "adbreak": {
        "offset": "pre",
        "tag": "placeholder_preroll"
      }
    }
  },
  "sharing": {
    "heading": "Deel Video",
    "sites": [
      {
        "label": "Facebook",
        "icon": "/talpa-jw-skin/icons/facebook.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=facebook&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FyWLXx6VtFuG&title=Wegmisbruikers&ct=0&tt=0&"
      },
      {
        "label": "Twitter",
        "icon": "/talpa-jw-skin/icons/twitter.svg",
        "src": "http://www.addthis.com/bookmark.php?v=300&winname=addthis&pub=sbsinteractievemedia&source=tbx-300&lng=en-US&s=twitter&url=http%3A%2F%2Fwww.kijk.nl%2Fvideo%2FyWLXx6VtFuG&title=Wegmisbruikers&ct=0&tt=0&"
      }
    ]
  },
  "cast": [],
  "related": [],
  "videoType": "vod",
  "adBlockerCheck": true,
  "allowPlayerApi": false
}

$ xidel -s "https://embed.kijk.nl/video/yWLXx6VtFuG" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/yWLXx6VtFuG")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(extract(.,"(.+m3u8)",1),$a)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[type="m3u8"]/x:request({"url":file})/[{"format":"hls-0","container":"m3u8[manifest]","url":url}[url],for $x at $i in tail(tokenize(extract(doc,"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),url)}]}'
{
  "name": "SBS6: Wegmisbruikers S24E04",
  "date": "14-12-2018",
  "duration": "00:40:03",
  "expdate": "14-12-2019 21:24:18",
  "subtitle": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/591af2de-73bc-4ec9-a2e4-5237954f1c2a/Wegmisbruikers_Season_24_Episode_4-webvtt-nl.vtt",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/1544789330448.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "160kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "637x252",
      "bitrate": "365|160kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=365058.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "910x360",
      "bitrate": "730|160kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=730083.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "1092x432",
      "bitrate": "1500|160kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=1500117.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "1820x720",
      "bitrate": "3000|160kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=3000297.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "2730x1080",
      "bitrate": "4500|160kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=4500168.m3u8"
    },
    {
      "format": "hls-7",
      "container": "m3u8[h264+aac]",
      "resolution": "2730x1080",
      "bitrate": "6000|160kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/yWLXx6VtFuG/b3c27c55-80bf-4c16-80dc-e3e057a4d092/Wegmisbruikers_Season_24_Episode_4-index.ism/Wegmisbruikers_Season_24_Episode_4-index-audio=160000-video=6000467.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

http://www.kijk.nl/net5/pekingexpress/videos/w7ZW52xLgL5/aflevering-1

$ xidel -s "https://embed.kijk.nl/video/w7ZW52xLgL5" --xquery 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/jMeLJuBkEPrN/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/O3MALYiXrEvo/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/DrlDOZ5p_34C/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/7VPyrVZ_p2_F/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/kvXDJgpLCCNY/file.mpd?feed=prod-getMediaObject&metafile=false",
          "type": "dash"
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/SaZ_Wcowy8f5/file.m3u8?feed=prod-getMediaObject&metafile=false",
          "type": "m3u8"
        }
      ],
      [...]
    }
  ],
  [...]
}

De 3 m3u8 playlists zijn allemaal hetzelfde. Daarom kiezen we gewoon de 1e --> (sources)()[type="m3u8"][1]/file.
Update 24-02-2019: De hls-manifest blijkt (tijdelijk?) niet beschikbaar te zijn. Error-handling er maar weer bij dus.

$ xidel -s "https://embed.kijk.nl/video/w7ZW52xLgL5" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(extract(.,"(.+m3u8)",1),$a)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[type="m3u8"][1]/x:request({"url":file,"error-handling":"xxx=accept"})[contains(headers[1],"200")]/[{"format":"hls-0","container":"m3u8[manifest]","url":url},for $x at $i in tail(tokenize(extract(doc,"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),url)}]}'
{
  "name": "NET5: Peking Express S01E01",
  "date": "03-04-2017",
  "duration": "01:03:59",
  "expdate": "31-03-2020 04:55:00",
  "subtitle": null,
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/1535976944566.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "320x180",
      "bitrate": "350|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=350000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "512x288",
      "bitrate": "655|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=655000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "912|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=912000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1214|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=1214000.m3u8"
    },
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "868x488",
      "bitrate": "1898|94kbps",
      "url": "https://vod-tpc-prod-1.talpatvcdn.nl/SBS/w7ZW52xLgL5/9dc418ae-e80d-4c2a-b474-f856dd79840a/Peking_Express_Season_1_Episode_1-index.ism/Peking_Express_Season_1_Episode_1-index-audio=94000-video=1898000.m3u8"
    }
  ]
}

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5" -e '$json/playerInfo'
{
  [...],
  "embed_api_url": "http://embed.kijk.nl/api/video/w7ZW52xLgL5?id=kijkapp",
  "hasDRM": false
}

$ xidel -s "http://api.kijk.nl/v1/default/entitlement/w7ZW52xLgL5" -e '$json/playerInfo/json(embed_api_url)'
{
  "vpakey": "w7ZW52xLgL5",
  "videoId": null,
  "mediaId": null,
  "assetId": null,
  "appleTvMediaId": null,
  "roll": "https://embed.kijk.nl/api/roll/",
  "unroll": "https://embed.kijk.nl/api/unroll/",
  "playlist": "https://embed.kijk.nl/api/playlist/.m3u8",
  [...]
}

Dit suggereert dat de Ericsson videostreams niet meer beschikbaar zijn, maar als we de url handmatig samenstellen (zie BatchGemist notes), waarbij de user_token n de app_token blijkbaar niet per se nodig zijn, dan werken ze nog gewoon!

$ xidel -s "https://embed.kijk.nl/api/roll/w7ZW52xLgL5_dbzyr6?base_url=https%3A//emp-prod-acc-we.ebsd.ericsson.net/sbsgroup" -e '$json'
{
  "live": "false",
  "duration": "3840200",
  "markers": [
    {
      "start_offset": "0",
      "duration": "2270840",
      "type": "AD_VAST",
      "data": {}
    },
    {
      "start_offset": "2272000",
      "duration": "1568160",
      "type": "AD_VAST",
      "data": {}
    }
  ],
  "streams": [
    {
      "name": "1080p",
      "bitrate": 7000000,
      "resolution": "1920x1080",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_9/index.m3u8"
    },
    {
      "name": "720p",
      "bitrate": 4500000,
      "resolution": "1280x720",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_7/index.m3u8"
    },
    {
      "name": "576p",
      "bitrate": 2468000,
      "resolution": "1024x576",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_6/index.m3u8"
    },
    {
      "name": "480p",
      "bitrate": 1500000,
      "resolution": "768x432",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_5/index.m3u8"
    },
    {
      "name": "360p",
      "bitrate": 900000,
      "resolution": "640x360",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_4/index.m3u8"
    },
    {
      "name": "240p",
      "bitrate": 500000,
      "resolution": "512x288",
      "url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/vod_sbs_hd_mux_unenc_2_4_3/index.m3u8"
    }
  ],
  "playlist_url": "https://embed.kijk.nl/api/playlist/w7ZW52xLgL5_dbzyr6.m3u8",
  "media_url": "https://vod-es-gf-prod-2.sbscdn.nl/prod/4/605539/"
}

Update: De api-url werkt inmiddels ook niet meer, MAAR de individuele video-urls hier boven vreemd genoeg nog wel.

- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

https://www.kijk.nl/sbs6/steenrijkstraatarm/videos/UitidpB9Yx5/steenrijk-straatarm

$ xidel -s "https://embed.kijk.nl/video/UitidpB9Yx5" -e 'json(//script/extract(.,"playerConfig = (.+);",1)[.])'
{
  "playlist": [
    {
      "sources": [
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TzEji1yiQs0E/file.m3u8?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "m3u8",
          "drm": {
            "fairplay": {
              "releasePid": "TzEji1yiQs0E",
              "certificateUrl": "https://vod-tpc-prod-1.talpatvcdn.nl/fairplay.cer",
              "processSpcUrl": "https://fairplay.entitlement.theplatform.eu/fpls/web/FairPlay?form=json&schema=1.0&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TzEji1yiQs0E"
            }
          }
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TyxGZdUvCzwg/file.mpd?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "dash",
          "drm": {
            "playready": {
              "releasePid": "TyxGZdUvCzwg",
              "url": "https://green.playready.entitlement.theplatform.eu/playready/rightsmanager.asmx?form=json&schema=1.0&auth=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TyxGZdUvCzwg"
            }
          }
        },
        {
          "file": "https://link.theplatform.eu/s/-9DGhC/TkNGUgBksp7W/file.mpd?feed=prod-getMediaObject&metafile=false&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU",
          "type": "dash",
          "drm": {
            "widevine": {
              "releasePid": "TkNGUgBksp7W",
              "url": "https://widevine.entitlement.theplatform.eu/wv/web/ModularDrm?form=json&schema=1.0&token=5tqJrjfYAKMAGxQ-2NbMcYBWoEAeMFDU&account=http%3A%2F%2Faccess.auth.theplatform.com%2Fdata%2FAccount%2F2702725319&releasePid=TkNGUgBksp7W"
            }
          }
        }
      ],
      [...]
    }
  ],
  [...]
}

DRM n SAMPLE-AES encryptie. FFmpeg ondersteunt dit nog niet, maar omdat het vanwege DRM sowieso niet gaat werken filteren we deze er uit met [not(drm)].

$ xidel -s "https://embed.kijk.nl/video/UitidpB9Yx5" --xquery 'if (//video) then x:request({"headers":"Accept: application/json;pk="||extract(unparsed-text(//script[contains(@src,//@data-account)]/@src),"policyKey:""(.+?)""",1),"url":concat("https://edge.api.brightcove.com/playback/v1/accounts/",//@data-account,"/videos/",//@data-video-id)})/json/{"name":concat(upper-case(custom_fields/sbs_station),": ",name,if (custom_fields/sbs_episode) then " "||custom_fields/sbs_episode else ()),"date":replace(custom_fields/sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":round(duration div 1000) * duration("PT1S") + time("00:00:00"),"expdate":replace(json("http://api.kijk.nl/v1/default/entitlement/UitidpB9Yx5")//enddate/date,"(\d+)-(\d+)-(\d+) ([\d:]+).*","$3-$2-$1 $4"),"formats":let $a:=(sources)()[size=0]/src return [for $x at $i in (sources)()[stream_name] order by $x/size count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height),"bitrate":round(avg_bitrate div 1000)||"kbps","url":replace(stream_name,"mp4:",extract($a,"(.+?nl/)",1))},{"format":"hls-0","container":"m3u8[manifest]","url":$a}[url],tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":if (contains(.,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(extract(.,"(.+m3u8)",1),$a)}]} else json(//script/extract(.,"playerConfig = (.+);",1)[.])/(playlist)()/{"name":TAQ/concat(upper-case(customLayer/c_media_station),": ",customLayer/c_media_ispartof,if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then concat(" S",dataLayer/media_program_season ! (if (.<10) then "0"||. else .),"E",dataLayer/media_program_episodenumber ! (if (.<10) then "0"||. else .)) else ()),"date":replace(TAQ/customLayer/c_sko_dt,"(\d{4})(\d{2})(\d{2})","$3-$2-$1"),"duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),"expdate":format-dateTime(TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y] [H01]:[m01]:[s01]"),"subtitle":(tracks)()[label=" Nederlands"]/file,"formats":(sources)()[not(drm) and type="m3u8"][1]/x:request({"url":file,"error-handling":"xxx=accept"})[contains(headers[1],"200")]/[{"format":"hls-0","container":"m3u8[manifest]","url":url},for $x at $i in tail(tokenize(extract(doc,"(#EXT-X-STREAM-INF.+m3u8$)",1,"ms"),"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),url)}]}'
{
  "name": "SBS6: Steenrijk, straatarm S03E03",
  "date": "09-01-2019",
  "duration": "00:41:35",
  "expdate": "09-01-2024 21:28:03",
  "subtitle": null,
  "formats": null
}

------------------------------------------------------------------------------------------------

--xquery '
  if (//video) then
    x:request(
      {
        "headers":"Accept: application/json;pk="||extract(
          unparsed-text(
            //script[
              contains(
                @src,
                //@data-account
              )
            ]/@src
          ),
          "policyKey:""(.+?)""",
          1
        ),
        "url":concat(
          "https://edge.api.brightcove.com/playback/v1/accounts/",
          //@data-account,
          "/videos/",
          //@data-video-id
        )
      }
    )/json/{
      "name":concat(
        upper-case(custom_fields/sbs_station),
        ": ",
        name,
        if (custom_fields/sbs_episode) then
          " "||custom_fields/sbs_episode
        else
          ()
      ),
      "date":replace(
        custom_fields/sko_dt,
        "(\d{4})(\d{2})(\d{2})",
        "$3-$2-$1"
      ),
      "duration":round(
        duration div 1000
      ) * duration("PT1S") + time("00:00:00"),
      "expdate":replace(
        json("http://api.kijk.nl/v1/default/entitlement/UitidpB9Yx5")//enddate/date,
        "(\d+)-(\d+)-(\d+) ([\d:]+).*",
        "$3-$2-$1 $4"
      ),
      "formats":let $a:=(sources)()[size=0]/src return [
        for $x at $i in (sources)()[stream_name]
        order by $x/size
        count $i
        return
        $x/{
          "format":"pg-"||$i,
          "container":"mp4[h264+aac]",
          "resolution":concat(
            width,
            "x",
            height
          ),
          "bitrate":round(
            avg_bitrate div 1000
          )||"kbps",
          "url":replace(
            stream_name,
            "mp4:",
            extract(
              $a,
              "(.+?nl/)",
              1
            )
          )
        },{
          "format":"hls-0",
          "container":"m3u8[manifest]",
          "url":$a
        }[url],
        tail(
          tokenize(
            unparsed-text($a),
            "#EXT-X-STREAM-INF:"
          )
        ) ! {
          "format":"hls-"||position(),
          "container":if (
            contains(
              .,
              "avc1"
            )
          ) then
            "m3u8[h264+aac]"
          else
            "m3u8[aac]",
          "resolution":extract(
            .,
            "RESOLUTION=([\dx]+)",
            1
          ),
          "bitrate":round(
            extract(
              .,
              "BANDWIDTH=(\d+)",
              1
            ) div 1000
          )||"kbps",
          "url":resolve-uri(
            extract(
              .,
              "(.+m3u8)",
              1
            ),
            $a
          )
        }
      ]
    }
  else
    json(
      //script/extract(
        .,
        "playerConfig = (.+);",
        1
      )[.]
    )/(playlist)()/{
      "name":TAQ/concat(
        upper-case(customLayer/c_media_station),
        ": ",
        customLayer/c_media_ispartof,
        if (dataLayer/media_program_season!=0 and dataLayer/media_program_episodenumber<=99) then
          concat(
            " S",
            dataLayer/media_program_season ! (
              if (.<10) then
                "0"||.
              else
                .
            ),
            "E",
            dataLayer/media_program_episodenumber ! (
              if (.<10) then
                "0"||.
              else
                .
            )
          )
        else
          ()
      ),
      "date":replace(
        TAQ/customLayer/c_sko_dt,
        "(\d{4})(\d{2})(\d{2})",
        "$3-$2-$1"
      ),
      "duration":TAQ/customLayer/c_sko_cl * duration("PT1S") + time("00:00:00"),
      "expdate":format-dateTime(
        TAQ/customLayer/c_media_dateexpires * duration("PT1S") + dateTime("1970-01-01T01:00:00"),
        "[D01]-[M01]-[Y] [H01]:[m01]:[s01]"
      ),
      "subtitle":(tracks)()[label=" Nederlands"]/file,
      "formats":[
        (sources)()[not(drm) and type="m3u8"][1]/x:request(
          {
            "url":file,
            "error-handling":"xxx=accept"
          }
        )[
          contains(
            headers[1],
            "200"
          )
        ]/(
          {
            "format":"hls-0",
            "container":"m3u8[manifest]",
            "url":url
          },
          for $x at $i in tail(
            tokenize(
              extract(
                doc,
                "(#EXT-X-STREAM-INF.+m3u8$)",
                1,"ms"
              ),
              "#EXT-X-STREAM-INF:"
            )
          ) order by extract(
            $x,
            "BANDWIDTH=(\d+)",
            1
          ) count $i
          return {
            "format":"hls-"||$i,
            "container":if (
              contains(
                $x,
                "avc1"
              )
            ) then
              "m3u8[h264+aac]"
            else
              "m3u8[aac]",
            "resolution":extract(
              $x,
              "RESOLUTION=([\dx]+)",
              1
            )[.],
            "bitrate":let $a:=extract(
              $x,
              "audio.+?(\d+)\d{3}(?:-video=(\d+)\d{3})?",
              (1,2)
            ) return
            join(
              (
                $a[2][.],
                $a[1]
              ),
              "|"
            )||"kbps"
            "url":resolve-uri(
              extract(
                $x,
                "(.+m3u8)",
                1
              ),
              url
            )
          }
        )
      ]
    }
'

================================================================================================================================

[tvblik,uitzendinggemist]

$ cat <<EOF | while read a; do xidel -s "$a" -e '//div[@id="embed-player"]/(@data-episode,.//@href)'; done
https://tvblik.nl/journaal/nos-851
https://tvblik.nl/rtl-nieuws/laat-997
https://tvblik.nl/hart-van-nederland/15-januari-2019
EOF
//www.npostart.nl/embed/nos-journaal/15-01-2019/POW_04060130
http://www.rtlxl.nl/#!/_rtl-nieuws-132237/02b2833d-48dd-3a08-b6cd-8dbadcf8fba4?utm_medium=refferal&utm_source=tvblik
//embed.kijk.nl/?width=640&height=360&video=GgO61doGeqZ&autoplay=1

$ cat <<EOF | while read a; do xidel -s "$a" -e '//a[@rel="nofollow"]/@onclick,//iframe[@class="sbsEmbed"]/@src'; done
https://www.uitzendinggemist.net/aflevering/461995/Nos_Journaal.html
https://www.uitzendinggemist.net/aflevering/462016/Rtl_Nieuws_1930_Uur.html
https://www.uitzendinggemist.net/aflevering/462122/Hart_Van_Nederland.html
EOF
window.open('http://www.npo.nl/aa-aa/01-01-2015/POW_04059331','winname',"directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=yes,resizable=no,width=800,height=600");
window.open('http://www.rtlxl.nl/#!/zzzz/9483a466-6424-3dff-99fd-2d558a950e3e','winname',"directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=yes,resizable=no,width=1024,height=600");
https://embed.kijk.nl/?width=720&height=410&video=GgO61doGeqZ

$ cat <<EOF | while read a; do xidel -s "$a" -e 'join(extract((//div[@id="embed-player"]/(@data-episode,.//@href),//a[@rel="nofollow"]/@onclick,//iframe[@class="sbsEmbed"]/@src),"(npo|rtl|kijk).+(?:/|video=)([\w-]+)",(1,2)))'; done
https://tvblik.nl/journaal/nos-851
https://tvblik.nl/rtl-nieuws/laat-997
https://tvblik.nl/hart-van-nederland/15-januari-2019
https://www.uitzendinggemist.net/aflevering/461995/Nos_Journaal.html
https://www.uitzendinggemist.net/aflevering/462016/Rtl_Nieuws_1930_Uur.html
https://www.uitzendinggemist.net/aflevering/462122/Hart_Van_Nederland.html
EOF
npo POW_04060130
rtl 02b2833d-48dd-3a08-b6cd-8dbadcf8fba4
kijk rEFjefrsn1A
npo POW_04059331
rtl 9483a466-6424-3dff-99fd-2d558a950e3e
kijk GgO61doGeqZ

------------------------------------------------------------------------------------------------

-e '
  join(
    extract(
      (
        //div[@id="embed-player"]/(
          @data-episode,
          .//@href
        ),
        //a[@rel="nofollow"]/@onclick,
        //iframe[@class="sbsEmbed"]/@src
      ),
      "(npo|rtl|kijk).+(?:/|video=)([\w-]+)",
      (1,2)
    )
  )
'

================================================================================================================================

[youtube]

https://www.youtube.com/watch?v=nG_LtCRRZ20 (normaal toegankelijke video)

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/(videoDetails/title,streamingData//lastModified,videoDetails/lengthSeconds)'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
1548978611083579
1548978609684393
1548979118812685
1548978611887433
1548982696251964
1548978905736975
1548978905736975
1548978905736975
1548978905731670
1548978905736975
1548978905736975
1548978771474489
1093

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/(videoDetails/title,min(streamingData//lastModified),videoDetails/lengthSeconds)'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
1548978609684393
1093

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/(videoDetails/title,decimal(round(min(streamingData//lastModified) div 1000000)),videoDetails/lengthSeconds)'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
1548978610
1093

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/(videoDetails/title,round(min(streamingData//lastModified) div 1000000) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),videoDetails/lengthSeconds * duration("PT1S") + time("00:00:00"))'
Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
2019-02-01T00:50:10
00:18:13

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" -e 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/{"name":videoDetails/title,"date":format-date(round(min(streamingData//lastModified) div 1000000) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y]"),"duration":videoDetails/lengthSeconds * duration("PT1S") + time("00:00:00")}'
{
  "name": "Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)",
  "date": "01-02-2019",
  "duration": "00:18:13"
}

------------------------------------------------------------------------------------------------

https://www.youtube.com/watch?v=2U5mf_fEKiU (leeftijds beperkte video) (https://github.com/rg3/youtube-dl/issues/17604#issuecomment-422367440)

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" -e 'outer-html(//meta[@property="og:restrictions:age"])'
<meta property="og:restrictions:age" content="18+">

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" -e 'if (//meta[@property="og:restrictions:age"]) then concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts) else json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/player_response'
https://www.youtube.com/get_video_info?video_id=2U5mf_fEKiU&eurl=https%3A%2F%2Fyoutube.googleapis.com%2Fv%2F2U5mf_fEKiU&sts=17940

Wat deze url teruggeeft is volledig url-encoded. Url-decode(), tokenize op "&" en vervolgens is daar de json "player_response" weer:

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" -e 'json(if (//meta[@property="og:restrictions:age"]) then let $a:=concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts) return tokenize(uri-decode(doc($a)),"&") ! extract(.,"player_response=(.+)",1)[.] else json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/player_response)'
{
  "playabilityStatus": {
    "status": "OK",
    "playableInEmbed": true
  },
  "streamingData": {
    [...]
  },
  [...]
}

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" -e 'json(if (//meta[@property="og:restrictions:age"]) then let $a:=concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts) return tokenize(uri-decode(doc($a)),"&") ! extract(.,"player_response=(.+)",1)[.] else json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/player_response)/{"name":videoDetails/title,"date":format-date(round(min(streamingData//lastModified) div 1000000) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y]"),"duration":videoDetails/lengthSeconds * duration("PT1S") + time("00:00:00")}'
{
  "name": "Allow embedding, Age restriction",
  "date": "18-09-2018",
  "duration": "00:00:20"
}

------------------------------------------------------------------------------------------------

https://github.com/rg3/youtube-dl/blob/master/youtube_dl/extractor/youtube.py#L1822: "# bitrate for itag 43 is always 2147483647".
Negeren dus. En sorteren op bestandsgrootte. Anders komt "pg-4" met "bitrate": "2147484kbps" onderaan.

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/[for $x at $i in (formats)() order by $x/contentLength count $i return $x/{"format":"pg-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)\..+ (\w+)(?:\.|"")",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat(width,"x",height),"bitrate":if (.[itag="43"]) then () else round(bitrate div 1000)||"kbps","url":url}]'
[
  {
    "format": "pg-1",
    "container": "3gp[mp4v+aac]",
    "resolution": "176x144",
    "bitrate": "82kbps",
    "url": "<url>"
  },
  {
    "format": "pg-2",
    "container": "3gp[mp4v+aac]",
    "resolution": "320x180",
    "bitrate": "226kbps",
    "url": "<url>"
  },
  {
    "format": "pg-3",
    "container": "mp4[h264+aac]",
    "resolution": "640x360",
    "bitrate": "489kbps",
    "url": "<url>"
  },
  {
    "format": "pg-4",
    "container": "webm[vp8+vorbis]",
    "resolution": "640x360",
    "bitrate": null,
    "url": "<url>"
  },
  {
    "format": "pg-5",
    "container": "mp4[h264+aac]",
    "resolution": "1280x720",
    "bitrate": "1603kbps",
    "url": "<url>"
  }
]

------------------------------------------------------------------------------------------------

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/dashManifestUrl'
https://manifest.googlevideo.com/api/manifest/dash/mv/m/ipbits/0/expire/1549179524/id/9c6fcbb42451676d/mn/sn-mn4vg5aa-5hns%2Csn-5hne6ns6/mm/31%2C29/ms/au%2Crdu/sparams/as%2Cei%2Chfr%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cplayback_host%2Crequiressl%2Csource%2Cexpire/source/youtube/pl/15/itag/0/key/yt6/ip/x.x.x.x/initcwndbps/1607500/hfr/all/requiressl/yes/fvip/1/ei/JEZWXKbuHNGh8gOLipXoBw/as/fmp4_audio_clear%2Cfmp4_sd_hd_clear/playback_host/r4---sn-mn4vg5aa-5hns.googlevideo.com/mt/1549157740/signature/7CD75240ECBD2EA2A037A50EB7A8D6A8BECE1959.5A728D695D4624475A812F9818D5953BD84544DB

Zonder "disable_polymer" zijn de DASH streams vreemd genoeg helemaal niet te openen (met FFmpeg, of MPC-HC) (zie https://github.com/rg3/youtube-dl/issues/14083).
Sorteer op de aanwezigheid van @width, zodat de audio-only streams bovenaan komen, n vervolgens op @bandwidth.

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/[for $x at $i in doc(dashManifestUrl||"/disable_polymer/true")//Representation order by $x/boolean(@width),$x/@bandwidth count $i return $x/{"format":"dash-"||$i,"container":concat(substring-after(../@mimeType,"/"),"[",substring-before(@codecs,".") ! (if (.="mp4a") then "aac" else if (.="avc1") then "h264" else .),"]"),"resolution":if (@width) then concat(@width,"x",@height,"@",@frameRate,"fps") else (),"samplerate":if (@audioSamplingRate) then (@audioSamplingRate div 1000)||"kHz" else (),"bitrate":round(@bandwidth div 1000)||"kbps","url":BaseUrl}]'
[
  {
    "format": "dash-1",
    "container": "mp4[aac]",
    "resolution": null,
    "samplerate": "22.05kHz",
    "bitrate": "51kbps",
    "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/139/source/youtube/requiressl/yes/mv/m/ms/au,rdu/ei/2iZeXPboPM-R1gKsjbnQAQ/mn/sn-mn4vg5aa-5hns,sn-5hne6ns6/pl/15/mm/31,29/initcwndbps/1453750/ratebypass/yes/mime/audio%2Fmp4/otfp/1/gir/yes/clen/6663680/lmt/1548978770075323/dur/1092.684/mt/1549674036/fvip/1/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549695803/sparams/ip,ipbits,expire,id,itag,source,requiressl,mv,ms,ei,mn,pl,mm,initcwndbps,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/25FA0E634366E6B671774E784B593771DA201605.80AC248E5977BF50197BE7BA31D39AFC2AD6D88F/key/dg_yt0/"
  },
  {
    "format": "dash-2",
    "container": "mp4[aac]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "131kbps",
    "url": "<url>"
  },
  {
    "format": "dash-3",
    "container": "mp4[h264]",
    "resolution": "256x144@25fps",
    "samplerate": null,
    "bitrate": "108kbps",
    "url": "<url>"
  },
  {
    "format": "dash-4",
    "container": "mp4[h264]",
    "resolution": "426x240@25fps",
    "samplerate": null,
    "bitrate": "242kbps",
    "url": "<url>"
  },
  {
    "format": "dash-5",
    "container": "mp4[h264]",
    "resolution": "640x360@25fps",
    "samplerate": null,
    "bitrate": "613kbps",
    "url": "<url>"
  },
  {
    "format": "dash-6",
    "container": "mp4[h264]",
    "resolution": "854x480@25fps",
    "samplerate": null,
    "bitrate": "1155kbps",
    "url": "<url>"
  },
  {
    "format": "dash-7",
    "container": "mp4[h264]",
    "resolution": "1280x720@25fps",
    "samplerate": null,
    "bitrate": "2310kbps",
    "url": "<url>"
  },
  {
    "format": "dash-8",
    "container": "mp4[h264]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "2866kbps",
    "url": "<url>"
  }
]

------------------------------------------------------------------------------------------------

https://www.youtube.com/watch?v=5jOjwN_uJt0 (geen DASH manifest)

"&disable_polymer=true" is blijkt hier niet nodig te zijn.

$ xidel -s "https://www.youtube.com/watch?v=5jOjwN_uJt0" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/[for $x at $i in (adaptiveFormats)() order by $x/boolean(width),$x/bitrate count $i return $x/{"format":"dash-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)(?:\.|"")",(1,2)) return concat($a[1],"[",if ($a[2]="mp4a") then "aac" else if ($a[2]="avc1") then "h264" else $a[2],"]"),"resolution":if (width) then concat(width,"x",height,"@",fps,"fps") else (),"samplerate":if (audioSampleRate) then (audioSampleRate div 1000)||"kHz" else (),"bitrate":round(bitrate div 1000)||"kbps","url":url}]'
[
  {
    "format": "dash-1",
    "container": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "53kbps",
    "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?lmt=1441752806379607&expire=1549693637&fvip=1&keepalive=yes&requiressl=yes&gir=yes&mime=audio%2Fwebm&source=youtube&clen=6884987&signature=82DF7076702F74EB8FA0B1791BB802B1571A8501.42F558484EBCCA329E6C3499B2B751364B17BB20&ei=ZR5eXLrkIIuMgAflzJCQCw&c=WEB&key=yt6&ipbits=0&mv=m&dur=1127.101&mt=1549671941&itag=249&ms=au%2Crdu&initcwndbps=1740000&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&id=o-AHTPT0WYgpXcvEYrmwRNTDi_kSOvrOBSUgqV-1Z3eXJq&mn=sn-mn4vg5aa-5hns%2Csn-5hne6nsr&ip=x.x.x.x&mm=31%2C29&pl=15"
  },
  {
    "format": "dash-2",
    "container": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "69kbps",
    "url": "<url>"
  },
  {
    "format": "dash-3",
    "container": "webm[vorbis]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "126kbps",
    "url": "<url>"
  },
  {
    "format": "dash-4",
    "container": "mp4[aac]",
    "resolution": null,
    "samplerate": "44.1kHz",
    "bitrate": "129kbps",
    "url": "<url>"
  },
  {
    "format": "dash-5",
    "container": "webm[opus]",
    "resolution": null,
    "samplerate": "48kHz",
    "bitrate": "136kbps",
    "url": "<url>"
  },
  {
    "format": "dash-6",
    "container": "webm[vp9]",
    "resolution": "256x144@13fps",
    "samplerate": null,
    "bitrate": "102kbps",
    "url": "<url>"
  },
  {
    "format": "dash-7",
    "container": "mp4[h264]",
    "resolution": "256x144@13fps",
    "samplerate": null,
    "bitrate": "116kbps",
    "url": "<url>"
  },
  {
    "format": "dash-8",
    "container": "webm[vp9]",
    "resolution": "426x240@25fps",
    "samplerate": null,
    "bitrate": "239kbps",
    "url": "<url>"
  },
  {
    "format": "dash-9",
    "container": "mp4[h264]",
    "resolution": "426x240@25fps",
    "samplerate": null,
    "bitrate": "250kbps",
    "url": "<url>"
  },
  {
    "format": "dash-10",
    "container": "webm[vp9]",
    "resolution": "640x360@25fps",
    "samplerate": null,
    "bitrate": "441kbps",
    "url": "<url>"
  },
  {
    "format": "dash-11",
    "container": "mp4[h264]",
    "resolution": "640x360@25fps",
    "samplerate": null,
    "bitrate": "602kbps",
    "url": "<url>"
  },
  {
    "format": "dash-12",
    "container": "webm[vp9]",
    "resolution": "854x480@25fps",
    "samplerate": null,
    "bitrate": "732kbps",
    "url": "<url>"
  },
  {
    "format": "dash-13",
    "container": "mp4[h264]",
    "resolution": "854x480@25fps",
    "samplerate": null,
    "bitrate": "1108kbps",
    "url": "<url>"
  },
  {
    "format": "dash-14",
    "container": "webm[vp9]",
    "resolution": "1280x720@25fps",
    "samplerate": null,
    "bitrate": "1454kbps",
    "url": "<url>"
  },
  {
    "format": "dash-15",
    "container": "mp4[h264]",
    "resolution": "1280x720@25fps",
    "samplerate": null,
    "bitrate": "2211kbps",
    "url": "<url>"
  },
  {
    "format": "dash-16",
    "container": "webm[vp9]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "2340kbps",
    "url": "<url>"
  },
  {
    "format": "dash-17",
    "container": "mp4[h264]",
    "resolution": "1280x720@50fps",
    "samplerate": null,
    "bitrate": "3307kbps",
    "url": "<url>"
  }
]

------------------------------------------------------------------------------------------------

https://www.youtube.com/watch?v=sN6bdk6pmrU (live videostream)

$ xidel -s "https://www.youtube.com/watch?v=sN6bdk6pmrU" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/hlsManifestUrl'
https://manifest.googlevideo.com/api/manifest/hls_variant/dover/11/gcr/nl/hfr/1/ratebypass/yes/ipbits/0/sparams/ei%2Cgcr%2Cgo%2Chfr%2Cid%2Cip%2Cipbits%2Citag%2Cmaudio%2Cplaylist_type%2Cratebypass%2Crequiressl%2Csource%2Cexpire/ip/80.101.49.5/key/yt6/itag/0/source/yt_live_broadcast/signature/76A88A6E089761D9E6EA6C66D7FB0F75C2B5D68D.16502FB14EA61F50A4BE76F389C1FDE9722CF181/maudio/1/ei/4t97XLn1Doyt1wKgzqDIBw/requiressl/yes/playlist_type/DVR/id/sN6bdk6pmrU.1/keepalive/yes/go/1/expire/1551643714/file/index.m3u8

$ xidel -s "https://www.youtube.com/watch?v=sN6bdk6pmrU" --xquery 'json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/json(player_response)/streamingData/[{"format":"hls-0","container":"m3u8[manifest]","url":hlsManifestUrl},tail(tokenize(unparsed-text(hlsManifestUrl),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":"m3u8[h264+aac]","resolution":concat(extract(.,"RESOLUTION=([\dx]+)",1),"@",round(number(extract(.,"FRAME-RATE=([\d.]+)",1))),"fps"),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":extract(.,"(.+m3u8)",1)}]'
[
  {
    "format": "hls-0",
    "container": "m3u8[manifest]",
    "url": "<url>"
  },
  {
    "format": "hls-1",
    "container": "m3u8[h264+aac]",
    "resolution": "256x144@30fps",
    "bitrate": "197kbps",
    "url": "<url>"
  },
  {
    "format": "hls-2",
    "container": "m3u8[h264+aac]",
    "resolution": "426x240@30fps",
    "bitrate": "338kbps",
    "url": "<url>"
  },
  {
    "format": "hls-3",
    "container": "m3u8[h264+aac]",
    "resolution": "640x360@30fps",
    "bitrate": "830kbps",
    "url": "<url>"
  },
  {
    "format": "hls-4",
    "container": "m3u8[h264+aac]",
    "resolution": "854x480@30fps",
    "bitrate": "1381kbps",
    "url": "<url>"
  },
  {
    "format": "hls-5",
    "container": "m3u8[h264+aac]",
    "resolution": "1280x720@30fps",
    "bitrate": "2594kbps",
    "url": "<url>"
  },
  {
    "format": "hls-6",
    "container": "m3u8[h264+aac]",
    "resolution": "1920x1080@30fps",
    "bitrate": "4716kbps",
    "url": "<url>"
  }
]

------------------------------------------------------------------------------------------------

$ xidel -s "https://www.youtube.com/watch?v=nG_LtCRRZ20" --xquery 'json(if (//meta[@property="og:restrictions:age"]) then let $a:=concat("https://www.youtube.com/get_video_info?video_id=",//meta[@itemprop="videoId"]/@content,"&amp;eurl=",uri-encode("https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content),"&amp;sts=",json(doc("https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content)//script/extract(.,"setConfig\((.+?)\)",1,"*")[3])//sts) return tokenize(uri-decode(doc($a)),"&amp;") ! extract(.,"player_response=(.+)",1)[.] else json(//script/extract(.,"ytplayer.config = (.+?\});",1)[.])/args/player_response)/{"name":videoDetails/title,"date":if (videoDetails/isLive) then "'$(date "+%d-%m-%Y")'" else format-date(round(min(streamingData//lastModified) div 1000000) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),"[D01]-[M01]-[Y]"),"duration":if (videoDetails/isLive) then () else videoDetails/lengthSeconds * duration("PT1S") + time("00:00:00"),"formats":streamingData/[for $x at $i in (formats)() order by $x/contentLength count $i return $x/{"format":"pg-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)\..+ (\w+)(?:\.|"")",(1 to 3)) return concat(if ($a[1]="3gpp") then "3gp" else $a[1],"[",if ($a[2]="avc1") then "h264" else $a[2],"+",if ($a[3]="mp4a") then "aac" else $a[3],"]"),"resolution":concat(width,"x",height),"bitrate":if (.[itag="43"]) then () else round(bitrate div 1000)||"kbps","url":url},if (dashManifestUrl) then for $x at $i in doc(dashManifestUrl||"/disable_polymer/true")//Representation order by $x/boolean(@width),$x/@bandwidth count $i return $x/{"format":"dash-"||$i,"container":concat(substring-after(../@mimeType,"/"),"[",substring-before(@codecs,".") ! (if (.="mp4a") then "aac" else if (.="avc1") then "h264" else .),"]"),"resolution":if (@width) then concat(@width,"x",@height,"@",@frameRate,"fps") else (),"samplerate":if (@audioSamplingRate) then (@audioSamplingRate div 1000)||"kHz" else (),"bitrate":round(@bandwidth div 1000)||"kbps","url":BaseUrl} else for $x at $i in (adaptiveFormats)() order by $x/boolean(width),$x/bitrate count $i return $x/{"format":"dash-"||$i,"container":let $a:=extract(mimeType,"/(.+);.+?(\w+)(?:\.|"")",(1,2)) return concat($a[1],"[",if ($a[2]="mp4a") then "aac" else if ($a[2]="avc1") then "h264" else $a[2],"]"),"resolution":if (width) then concat(width,"x",height,"@",fps,"fps") else (),"samplerate":if (audioSampleRate) then (audioSampleRate div 1000)||"kHz" else (),"bitrate":round(bitrate div 1000)||"kbps","url":url},{"format":"hls-0","container":"m3u8[manifest]","url":hlsManifestUrl}[url],tail(tokenize(unparsed-text(hlsManifestUrl),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":"m3u8[h264+aac]","resolution":concat(extract(.,"RESOLUTION=([\dx]+)",1),"@",round(number(extract(.,"FRAME-RATE=([\d.]+)",1))),"fps"),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":extract(.,"(.+m3u8)",1)}]}'
{
  "name": "Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)",
  "date": "01-02-2019",
  "duration": "00:18:13",
  "formats": [
    {
      "format": "pg-1",
      "container": "3gp[mp4v+aac]",
      "resolution": "176x144",
      "bitrate": "82kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.684&initcwndbps=1631250&pl=15&source=youtube&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2F3gpp&key=yt6&ipbits=0&lmt=1548978611083579&itag=17&mt=1549737053&mv=m&signature=D4947A55DF7DE68D594096B061A10448C00BFB11.079C5D1BEAF718E9CF890403F321EA329FE5A6F8&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2211222&clen=11222522&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-2",
      "container": "3gp[mp4v+aac]",
      "resolution": "320x180",
      "bitrate": "226kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.684&initcwndbps=1631250&pl=15&source=youtube&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2F3gpp&key=yt6&ipbits=0&lmt=1548978611887433&itag=36&mt=1549737053&mv=m&signature=337E7434E41F0684B85C3EC347F7C4B9566AF318.9DB23D65CF8375B64AF747CA897DE1D7D05F29B6&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2211222&clen=30802449&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-3",
      "container": "mp4[h264+aac]",
      "resolution": "640x360",
      "bitrate": "489kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.661&initcwndbps=1631250&pl=15&source=youtube&ratebypass=yes&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2Fmp4&key=yt6&ipbits=0&lmt=1548978609684393&itag=18&mt=1549737053&mv=m&signature=CF12F8D7E99F8881BAE60768442B7BAC4D0AAE45.68C82F9E2D6176079BBCEC5ABC696A854F16667F&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2211222&clen=66756108&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-4",
      "container": "webm[vp8+vorbis]",
      "resolution": "640x360",
      "bitrate": null,
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=0.000&initcwndbps=1631250&pl=15&source=youtube&ratebypass=yes&requiressl=yes&gir=yes&fvip=1&expire=1549758822&mime=video%2Fwebm&key=yt6&ipbits=0&lmt=1548982696251964&itag=43&mt=1549737053&mv=m&signature=F114DF1FDA12F510E245D6AC22B9FC45C89995.ACC70506FD614DD314E24CE490FCB8CF3AD47F9E&ms=au%2Crdu&mm=31%2C29&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&c=WEB&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2201222&clen=104456295&ip=x.x.x.x&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg"
    },
    {
      "format": "pg-5",
      "container": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "1603kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1092.638&initcwndbps=1631250&pl=15&source=youtube&ratebypass=yes&mv=m&signature=7C6F1FB2F7D6C88227CB0063987199B83B4863B0.7BFC2A609AD9C16A6DE3E920C789FE21D7FEA1CC&ms=au%2Crdu&mm=31%2C29&requiressl=yes&c=WEB&ipbits=0&fvip=1&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7s&id=o-AOyLIyOLt8i8cS-JrnCzTKic5_eCabEe3qqKf1KmLHZu&txp=2216222&expire=1549758822&mime=video%2Fmp4&key=yt6&ip=x.x.x.x&mt=1549737053&lmt=1548979118812685&sparams=dur%2Cei%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&ei=Bh1fXLCiJ4nPgQek5Y-4Bg&itag=22"
    },
    {
      "format": "dash-1",
      "container": "mp4[aac]",
      "resolution": null,
      "samplerate": "22.05kHz",
      "bitrate": "51kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/139/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/audio%2Fmp4/otfp/1/gir/yes/clen/6663680/lmt/1548978770075323/dur/1092.684/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/20CFECEFFDA4974E8EF9ADA8F3D464B97E34F538.1D18EBF41FCF1BD41C9568D3D20C3DFB74112ADB/key/dg_yt0/"
    },
    {
      "format": "dash-2",
      "container": "mp4[aac]",
      "resolution": null,
      "samplerate": "44.1kHz",
      "bitrate": "131kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/140/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/audio%2Fmp4/otfp/1/gir/yes/clen/17683882/lmt/1548978771474489/dur/1092.638/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/7634564956B37D2C680A27D629304EC0631E3534.3BE34846B67FFA9B81C0634DE7AC4959012FDE12/key/dg_yt0/"
    },
    {
      "format": "dash-3",
      "container": "mp4[h264]",
      "resolution": "256x144@25fps",
      "samplerate": null,
      "bitrate": "108kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/160/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/104EB8B8D9DF68CDEC2FB85C2BE7B932CCC4C43F.601C57AD4676CE4917E891298311635E29F3B3BE/key/dg_yt0/"
    },
    {
      "format": "dash-4",
      "container": "mp4[h264]",
      "resolution": "426x240@25fps",
      "samplerate": null,
      "bitrate": "242kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/133/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/3E73EDB00FC2CBBACCB01F5B9238EB23D0986D24.193D84ABA7735F1EE5C47944AA46C3B4744C8076/key/dg_yt0/"
    },
    {
      "format": "dash-5",
      "container": "mp4[h264]",
      "resolution": "640x360@25fps",
      "samplerate": null,
      "bitrate": "613kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/134/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/gir/yes/clen/43381806/lmt/1548978905731670/dur/1092.600/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/808FA1B02B5FA26F8EF5C201EAEFBD3BACC2220D.3E7B4F85D2F6A586D4E22EAF29C95FEE924B8F97/key/dg_yt0/"
    },
    {
      "format": "dash-6",
      "container": "mp4[h264]",
      "resolution": "854x480@25fps",
      "samplerate": null,
      "bitrate": "1155kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/135/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/604E9621CE0583CEB7B775BC6F1CC85294BE2B0E.18630B3226A21DDF03D1AD2CFC7FEAB5DD3E7736/key/dg_yt0/"
    },
    {
      "format": "dash-7",
      "container": "mp4[h264]",
      "resolution": "1280x720@25fps",
      "samplerate": null,
      "bitrate": "2310kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/136/source/yt_otf/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/otf/1/lmt/1548978905736975/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,otf,lmt/signature/76355BA9C8CE0E3F1CA8C802E54FE7E70352D9B8.2DD87F8AA56BF3B0A5D2E20A518E5BE01304C842/key/dg_yt0/"
    },
    {
      "format": "dash-8",
      "container": "mp4[h264]",
      "resolution": "1280x720@50fps",
      "samplerate": null,
      "bitrate": "2866kbps",
      "url": "https://r4---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback/id/9c6fcbb42451676d/itag/298/source/youtube/requiressl/yes/initcwndbps/1631250/pl/15/mv/m/ms/au,rdu/mm/31,29/mn/sn-mn4vg5aa-5hns,sn-5hnekn7s/ei/Bh1fXLCiJ4nPgQek5Y-4Bg/ratebypass/yes/mime/video%2Fmp4/otfp/1/gir/yes/clen/214600383/lmt/1548978905736975/dur/1092.580/fvip/1/mt/1549737053/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1549758822/sparams/ip,ipbits,expire,id,itag,source,requiressl,initcwndbps,pl,mv,ms,mm,mn,ei,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/2D0A6E57DE795D101CBB7AB42812BF4D59080D38.575112699B6ADAF94ABA0B32B19FE42F47260F3C/key/dg_yt0/"
    }
  ]
}

$ xidel -s "https://www.youtube.com/watch?v=5jOjwN_uJt0" --xquery '[...]'
{
  "name": "Delta Impuls 1 - De Treffers '70 2 (Noordelijke 2e Divisie, 07-02-2014)",
  "date": "08-09-2015",
  "duration": "00:18:47",
  "formats": [
    {
      "format": "pg-1",
      "container": "3gp[mp4v+aac]",
      "resolution": "176x144",
      "bitrate": "83kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?pl=15&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&c=WEB&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&expire=1549742862&ip=x.x.x.x&lmt=1441749284641801&ei=rt5eXOq0ItTMgAebxbaYBw&dur=1127.235&mt=1549721136&mv=m&ms=au%2Crdu&key=yt6&signature=79D5955FF71BD16F5A95547851BA5BC02A6823A8.35423E399281706935B525009BDA6E596D30E5F0&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=17&gir=yes&clen=11635486&mm=31%2C29&mime=video%2F3gpp&ipbits=0&fvip=1&requiressl=yes"
    },
    [...]
    {
      "format": "pg-5",
      "container": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "3kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?dur=1127.166&pl=15&sparams=dur%2Cei%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&mv=m&ms=au%2Crdu&key=yt6&signature=13AC49E30F4678DC1D7D0DF4178FD64E68987469.6AAFDFB9FB1138E08F9D7F1145D32B135A91E409&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=22&c=WEB&mm=31%2C29&mime=video%2Fmp4&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&expire=1549742862&ipbits=0&fvip=1&ip=x.x.x.x&lmt=1471212014981809&requiressl=yes&ratebypass=yes&mt=1549721136&ei=rt5eXOq0ItTMgAebxbaYBw"
    },
    {
      "format": "dash-1",
      "container": "webm[opus]",
      "resolution": null,
      "samplerate": "48kHz",
      "bitrate": "53kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?pl=15&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&keepalive=yes&c=WEB&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&expire=1549742862&ip=x.x.x.x&lmt=1441752806379607&ei=rt5eXOq0ItTMgAebxbaYBw&dur=1127.101&mt=1549721136&mv=m&ms=au%2Crdu&key=yt6&signature=D68D7638F50EBB2ADE96D7A6B1FA4E8217615D7F.314D24819328E12B854E6F5FF6B4DA889E4D6EF0&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=249&gir=yes&clen=6884987&mm=31%2C29&mime=audio%2Fwebm&ipbits=0&fvip=1&requiressl=yes"
    },
    [...]
    {
      "format": "dash-17",
      "container": "mp4[h264]",
      "resolution": "1280x720@50fps",
      "samplerate": null,
      "bitrate": "3307kbps",
      "url": "https://r3---sn-mn4vg5aa-5hns.googlevideo.com/videoplayback?pl=15&sparams=aitags%2Cclen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Ckeepalive%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&source=youtube&initcwndbps=1236250&keepalive=yes&c=WEB&id=o-AIstRAa6K6c0Hm-q7F9gUeY5HJ7bxWiOTOc1giJZutlF&aitags=133%2C134%2C135%2C136%2C160%2C242%2C243%2C244%2C247%2C278%2C298%2C302&ip=x.x.x.x&lmt=1441750875452025&ei=rt5eXOq0ItTMgAebxbaYBw&dur=1127.100&mt=1549721136&mv=m&ms=au%2Crdu&key=yt6&signature=C355EBFEE568DC3D179C9ADC3D916CA1BF632056.14A6B00BE2C5C7013B3BC78B60047740997173AB&mn=sn-mn4vg5aa-5hns%2Csn-5hnekn7d&itag=298&gir=yes&clen=356351764&mm=31%2C29&mime=video%2Fmp4&expire=1549742862&ipbits=0&fvip=1&requiressl=yes"
    }
  ]
}

$ xidel -s "https://www.youtube.com/watch?v=2U5mf_fEKiU" --xquery '[...]'
{
  "name": "Allow embedding, Age restriction",
  "date": "18-09-2018",
  "duration": "00:00:20",
  "formats": [
    {
      "format": "pg-1",
      "container": "3gp[mp4v+aac]",
      "resolution": "176x144",
      "bitrate": "81kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback?signature=2C60ECB9B0094C16061450E092B4CAC44988604A.6ABA0842F4873DCB4720AEE1E26353E92D77E7D3&ei=LEJoXKqgGcyd1gKm6KOYDQ&mn=sn-mn4vg5aa-5hnl%2Csn-5hnekn7l&mm=31%2C29&ipbits=0&mv=m&mt=1550336458&ms=au%2Crdu&clen=203274&expire=1550358156&requiressl=yes&initcwndbps=1436250&gir=yes&pl=20&source=youtube&txp=2211222&c=WEB&mime=video%2F3gpp&sparams=clen%2Cdur%2Cei%2Cgir%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Crequiressl%2Csource%2Cexpire&fvip=3&key=yt6&ip=x.x.x.x&lmt=1537272334217807&dur=20.108&itag=17&beids=9466587&id=o-AKZV_W9mJl51PdfsI3DvehEKv9F4VY3djNy2b5dURdn4"
    },
    [...]
    {
      "format": "pg-5",
      "container": "mp4[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "2697kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback?mime=video%2Fmp4&signature=E0A1C34D64CC0E94027E54EBD173261EEBADBA8B.DEAC54ACD3933B6E70EB4B710D6716B72A182917&requiressl=yes&mn=sn-mn4vg5aa-5hnl%2Csn-5hnekn7l&sparams=dur%2Cei%2Cid%2Cinitcwndbps%2Cip%2Cipbits%2Citag%2Clmt%2Cmime%2Cmm%2Cmn%2Cms%2Cmv%2Cpl%2Cratebypass%2Crequiressl%2Csource%2Cexpire&fvip=3&ipbits=0&mv=m&txp=2211222&mt=1550336458&ms=au%2Crdu&dur=20.085&ei=LEJoXKqgGcyd1gKm6KOYDQ&expire=1550358156&initcwndbps=1436250&key=yt6&ip=x.x.x.x&itag=22&lmt=1537272423660508&source=youtube&ratebypass=yes&pl=20&beids=9466587&id=o-AKZV_W9mJl51PdfsI3DvehEKv9F4VY3djNy2b5dURdn4&mm=31%2C29&c=WEB"
    },
    {
      "format": "dash-1",
      "container": "mp4[aac]",
      "resolution": null,
      "samplerate": "22.05kHz",
      "bitrate": "49kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback/id/d94e667ff7c42a25/itag/139/source/youtube/requiressl/yes/mn/sn-mn4vg5aa-5hnl,sn-5hnekn7l/mv/m/ms/au,rdu/ei/LEJoXKqgGcyd1gKm6KOYDQ/initcwndbps/1436250/pl/20/mm/31,29/ratebypass/yes/mime/audio%2Fmp4/otfp/1/gir/yes/clen/121176/lmt/1537272325927074/dur/20.154/fvip/3/mt/1550336458/beids/9466587/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1550358156/sparams/ip,ipbits,expire,id,itag,source,requiressl,mn,mv,ms,ei,initcwndbps,pl,mm,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/2A5F24AC506C0E051E4CE89646283083EAE42EA4.7FBB667AD8F95B3383324B18FBBBCEB4C056DA62/key/dg_yt0/"
    },
    [...]
    {
      "format": "dash-10",
      "container": "mp4[h264]",
      "resolution": "1920x1080@60fps",
      "samplerate": null,
      "bitrate": "5813kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnl.googlevideo.com/videoplayback/id/d94e667ff7c42a25/itag/299/source/youtube/requiressl/yes/mn/sn-mn4vg5aa-5hnl,sn-5hnekn7l/mv/m/ms/au,rdu/ei/LEJoXKqgGcyd1gKm6KOYDQ/initcwndbps/1436250/pl/20/mm/31,29/ratebypass/yes/mime/video%2Fmp4/otfp/1/gir/yes/clen/13961574/lmt/1537272379096048/dur/20.019/fvip/3/mt/1550336458/beids/9466587/disable_polymer/true/ip/x.x.x.x/ipbits/0/expire/1550358156/sparams/ip,ipbits,expire,id,itag,source,requiressl,mn,mv,ms,ei,initcwndbps,pl,mm,ratebypass,mime,otfp,gir,clen,lmt,dur/signature/069489D4B0EEB19615692CD20A37FDB9161C07C5.228054DA8CC672AA874A0527BD4956C262A61BE2/key/dg_yt0/"
    }
  ]
}

$ xidel -s "https://www.youtube.com/watch?v=sN6bdk6pmrU" --xquery '[...]'
{
  "name": "NK Tafeltennis 2019 - Finale dag",
  "date": "03-03-2019",
  "duration": null,
  "formats": [
    {
      "format": "dash-1",
      "container": "mp4[aac]",
      "resolution": null,
      "samplerate": "24kHz",
      "bitrate": "64kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnz.googlevideo.com/videoplayback/id/sN6bdk6pmrU.1/itag/139/source/yt_live_broadcast/requiressl/yes/ei/k-B7XMjGL42KgAf40pe4CQ/gcr/nl/playlist_type/DVR/ratebypass/yes/cmbypass/yes/mime/audio%2Fmp4/live/1/gir/yes/noclen/1/dur/5.000/disable_polymer/true/ip/80.101.49.5/ipbits/0/expire/1551643891/sparams/cmbypass,dur,ei,expire,gcr,gir,id,initcwndbps,ip,ipbits,itag,live,mime,mm,mn,ms,mv,noclen,pl,playlist_type,ratebypass,requiressl,source/signature/78F449B46C09ED183256B21701D6EEDF450F2004.5E483737D68850C1BE57E990E976285BBED62154/key/cms1/initcwndbps/11430/mm/32/mn/sn-mn4vg5aa-5hnz/ms/lv/mt/1551622169/mv/m/pl/15/"
    },
    [...]
    {
      "format": "dash-8",
      "container": "mp4[h264]",
      "resolution": "1920x1080@30fps",
      "samplerate": null,
      "bitrate": "4347kbps",
      "url": "https://r1---sn-mn4vg5aa-5hnz.googlevideo.com/videoplayback/id/sN6bdk6pmrU.1/itag/137/source/yt_live_broadcast/requiressl/yes/ei/k-B7XMjGL42KgAf40pe4CQ/gcr/nl/playlist_type/DVR/ratebypass/yes/cmbypass/yes/mime/video%2Fmp4/live/1/gir/yes/noclen/1/dur/5.000/disable_polymer/true/ip/80.101.49.5/ipbits/0/expire/1551643891/sparams/cmbypass,dur,ei,expire,gcr,gir,id,initcwndbps,ip,ipbits,itag,live,mime,mm,mn,ms,mv,noclen,pl,playlist_type,ratebypass,requiressl,source/signature/3265E98D1F4533543D11C1E2EF2B8EAB35CB6AE4.164AD248B3A084838DE6CAFE02D26BB53DCBCE24/key/cms1/initcwndbps/11430/mm/32/mn/sn-mn4vg5aa-5hnz/ms/lv/mt/1551622169/mv/m/pl/15/"
    },
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://manifest.googlevideo.com/api/manifest/hls_variant/maudio/1/keepalive/yes/dover/11/key/yt6/ip/80.101.49.5/signature/CF761F4EFF9E65B65DA0C83B30E08E8929DAE8CB.E23634A005C3130C93F295E0F6E05469A303F0B5/ratebypass/yes/ipbits/0/sparams/ei%2Cgcr%2Cgo%2Chfr%2Cid%2Cip%2Cipbits%2Citag%2Cmaudio%2Cplaylist_type%2Cratebypass%2Crequiressl%2Csource%2Cexpire/hfr/1/ei/k-B7XMjGL42KgAf40pe4CQ/id/sN6bdk6pmrU.1/itag/0/gcr/nl/expire/1551643891/go/1/source/yt_live_broadcast/playlist_type/DVR/requiressl/yes/file/index.m3u8"
    },
    [...]
    {
      "format": "hls-6",
      "container": "m3u8[h264+aac]",
      "resolution": "1920x1080@30fps",
      "bitrate": "4716kbps",
      "url": "https://manifest.googlevideo.com/api/manifest/hls_playlist/id/sN6bdk6pmrU.1/itag/96/source/yt_live_broadcast/requiressl/yes/ratebypass/yes/live/1/cmbypass/yes/goi/160/sgoap/gir%3Dyes%3Bitag%3D140/sgovp/gir%3Dyes%3Bitag%3D137/hls_chunk_host/r1---sn-mn4vg5aa-5hnz.googlevideo.com/ei/k-B7XMjGL42KgAf40pe4CQ/gcr/nl/playlist_type/DVR/initcwndbps/11430/mm/32/mn/sn-mn4vg5aa-5hnz/ms/lv/mv/m/pl/15/dover/11/keepalive/yes/mt/1551622169/ip/80.101.49.5/ipbits/0/expire/1551643891/sparams/ip,ipbits,expire,id,itag,source,requiressl,ratebypass,live,cmbypass,goi,sgoap,sgovp,hls_chunk_host,ei,gcr,playlist_type,initcwndbps,mm,mn,ms,mv,pl/signature/90DB35EC3855A2A45C42034F62925C2D74672769.88AF73E778B0469A0339DD9D3AF17DA33BE973B1/key/dg_yt0/playlist/index.m3u8"
    }
  ]
}

$ ./bashgemist.sh -i https://www.youtube.com/watch?v=nG_LtCRRZ20
Naam:      Delta Impuls 2 - Delta Impuls 3 (regionale 1e klasse tafeltennis, 18-01-2019)
Datum:     01-02-2019
Tijdsduur: 00:18:13
Formaten:  formaat  container         resolutie       frequentie  bitrate
           pg-1     3gp[mp4v+aac]     176x144                     82kbps
           pg-2     3gp[mp4v+aac]     320x180                     226kbps
           pg-3     mp4[h264+aac]     640x360                     489kbps
           pg-4     webm[vp8+vorbis]  640x360
           pg-5     mp4[h264+aac]     1280x720                    1603kbps
           dash-1   mp4[aac]                          22.05kHz    51kbps
           dash-2   mp4[aac]                          44.1kHz     131kbps
           dash-3   mp4[h264]         256x144@25fps               108kbps
           dash-4   mp4[h264]         426x240@25fps               242kbps
           dash-5   mp4[h264]         640x360@25fps               613kbps
           dash-6   mp4[h264]         854x480@25fps               1155kbps
           dash-7   mp4[h264]         1280x720@25fps              2310kbps
           dash-8   mp4[h264]         1280x720@50fps              2866kbps  (best)

------------------------------------------------------------------------------------------------

--xquery '
  json(
    if (//meta[@property="og:restrictions:age"]) then
      let $a:=concat(
        "https://www.youtube.com/get_video_info?video_id=",
        //meta[@itemprop="videoId"]/@content,
        "&amp;eurl=",
        uri-encode(
          "https://youtube.googleapis.com/v/"||//meta[@itemprop="videoId"]/@content
        ),
        "&amp;sts=",
        json(
          doc(
            "https://www.youtube.com/embed/"||//meta[@itemprop="videoId"]/@content
          )//script/extract(
            .,
            "setConfig\((.+?)\)",
            1,"*"
          )[3]
        )//sts
      ) return
      tokenize(
        uri-decode(
          doc($a)
        ),
        "&amp;"
      ) ! extract(
        .,
        "player_response=(.+)",
        1
      )[.]
    else
      json(
        //script/extract(
          .,
          "ytplayer.config = (.+?\});",
          1
        )[.]
      )/args/player_response
  )/{
    "name":videoDetails/title,
    "date":if (videoDetails/isLive) then
      "'$(date "+%d-%m-%Y")'"
    else
      format-date(
        round(
          min(streamingData//lastModified) div 1000000
        ) * duration("PT1S") + dateTime("1970-01-01T01:00:00"),
        "[D01]-[M01]-[Y]"
      ),
    "duration":if (videoDetails/isLive) then
      ()
    else
      videoDetails/lengthSeconds * duration("PT1S") + time("00:00:00"),
    "formats":streamingData/[
      for $x at $i in (formats)()
      order by $x/contentLength
      count $i
      return
      $x/{
        "format":"pg-"||$i,
        "container":let $a:=extract(
          mimeType,
          "/(.+);.+?(\w+)\..+ (\w+)(?:\.|"")",
          (1 to 3)
        ) return
        concat(
          if ($a[1]="3gpp") then
            "3gp"
          else
            $a[1],
          "[",
          if ($a[2]="avc1") then
            "h264"
          else
            $a[2],
          "+",
          if ($a[3]="mp4a") then
            "aac"
          else
            $a[3],
          "]"
        ),
        "resolution":concat(
          width,
          "x",
          height
        ),
        "bitrate":if (.[itag="43"]) then
          ()
        else
          round(
            bitrate div 1000
          )||"kbps",
        "url":url
      },
      if (dashManifestUrl) then
        for $x at $i in doc(
          dashManifestUrl||"/disable_polymer/true"
        )//Representation
        order by $x/boolean(@width),
                 $x/@bandwidth
        count $i
        return
        $x/{
          "format":"dash-"||$i,
          "container":concat(
            substring-after(
              ../@mimeType,
              "/"
            ),
            "[",
            substring-before(
              @codecs,
              "."
            ) ! (
              if (.="mp4a") then
                "aac"
              else if (.="avc1") then
                "h264"
              else
                .
            ),
            "]"
          ),
          "resolution":if (@width) then
            concat(
              @width,
              "x",
              @height,
              "@",
              @frameRate,
              "fps"
            )
          else
            (),
          "samplerate":if (@audioSamplingRate) then
            (@audioSamplingRate div 1000)||"kHz"
          else
            (),
          "bitrate":round(
            @bandwidth div 1000
          )||"kbps",
          "url":BaseUrl
        }
      else
        for $x at $i in (adaptiveFormats)()
        order by $x/boolean(width),
                 $x/bitrate
        count $i
        return
        $x/{
          "format":"dash-"||$i,
          "container":let $a:=extract(
            mimeType,
            "/(.+);.+?(\w+)(?:\.|"")",
            (1,2)
          ) return
          concat(
            $a[1],
            "[",
            if ($a[2]="mp4a") then
              "aac"
            else if ($a[2]="avc1") then
              "h264"
            else
              $a[2],
            "]"
          ),
          "resolution":if (width) then
            concat(
              width,
              "x",
              height,
              "@",
              fps,
              "fps"
            )
          else
            (),
          "samplerate":if (audioSampleRate) then
            (audioSampleRate div 1000)||"kHz"
          else
            (),
          "bitrate":round(
            bitrate div 1000
          )||"kbps",
          "url":url
        },
      {
        "format":"hls-0",
        "container":"m3u8[manifest]",
        "url":hlsManifestUrl
      }[url],
      tail(
        tokenize(
          unparsed-text(hlsManifestUrl),
          "#EXT-X-STREAM-INF:"
        )
      ) ! {
        "format":"hls-"||position(),
        "container":"m3u8[h264+aac]",
        "resolution":concat(
          extract(
            .,
            "RESOLUTION=([\dx]+)",
            1
          ),
          "@",
          round(
            number(
              extract(
                .,
                "FRAME-RATE=([\d.]+)",
                1
              )
            )
          ),
          "fps"
        ),
        "bitrate":round(
          extract(
            .,
            "BANDWIDTH=(\d+)",
            1
          ) div 1000
        )||"kbps",
        "url":extract(
          .,
          "(.+m3u8)",
          1
        )
      }
    ]
  }
'

================================================================================================================================

[vimeo]

https://vimeo.com/310786958

$ xidel -s "https://vimeo.com/310786958" -e 'json(//script/extract(.,"clip_page_config = (.+);",1)[.])'
{
  "clip": {
    "id": 310786958,
    "title": "Staat van het internet 2019",
    "description": "<p class=\"first\">De nieuwe jaarlijkse lezing de Staat van het internet werd op 15 januari 2019 voor het eerst gehouden bij de centrale OBA in Amsterdam. Een peilmoment voor het internet.</p>\n<p>Sprekers:</p>\n<p>Jos&eacute; van Dijck, hoogleraar media en digitale samenleving aan de Universiteit Utrecht en co-auteur van het boek &#039;The Platform Society. Online values in a connective world&#039;.</p>\n<p>Touria Meliani, wethouder van kunst, cultuur en de digitale stad Amsterdam.</p>\n<p>Marleen Stikker, directeur en mede-oprichter van Waag. Marleen Stikker is een van de pioniers van het internet en was afgelopen zomer te zien in het VPRO-programma Zomergasten waarin ze haar visie deelde op de ontwikkelingen in de technologie en de impact daarvan op de samenleving.</p>\n<p>Met performances van Two Step Flow - een collectief van maatschappelijk ge&iuml;nteresseerde artiesten.</p>\n<p>Waag organiseerde de Staat van het internet 2019 samen met SIDN, XS4ALL, OBA, Gemeente Amsterdam CTO office en UvA - Faculteit der Natuurwetenschappen, Wiskunde en Informatica.</p>",
    "uploaded_on": "2019-01-11 09:09:52",
    "uploaded_on_relative": "1 month ago",
    "uploaded_on_full": "Friday, January 11, 2019 at 9:09 AM EST",
    "is_spatial": false,
    "is_hdr": false,
    "privacy": {
      "is_public": true,
      "type": "anybody",
      "description": "Public"
    },
    "duration": {
      "raw": 6352,
      "formatted": "01:45:52"
    },
    "is_liked": false,
    "is_unavailable": false,
    [...]
    }
  },
  [...]
  "player": {
    "config_url": "https://player.vimeo.com/video/310786958/config?autopause=1&byline=0&collections=1&context=Vimeo%5CController%5CClipController.main&default_to_hd=1&outro=nothing&portrait=0&share=1&title=0&watch_trailer=0&s=39f391e40bd49862fd15f2753c27754964ac7d30_1550343304",
    "player_url": "player.vimeo.com",
    "dimensions": {
      "height": 540,
      "width": 960
    },
    "poster": {
      "url": "https://i.vimeocdn.com/video/752205746.jpg?mw=2000&mh=1080&q=70"
    }
  },
  [...]
}

$ xidel -s "https://vimeo.com/310786958" -e 'json(//script/extract(.,"clip_page_config = (.+);",1)[.])/{"name":clip/title,"date":replace(clip/uploaded_on,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":clip/duration/formatted}'
{
  "name": "Staat van het internet 2019",
  "date": "11-01-2019",
  "duration": "01:45:52"
}

------------------------------------------------------------------------------------------------

$ xidel -s "https://vimeo.com/310786958" -e 'json(//script/extract(.,"clip_page_config = (.+);",1)[.])/player/json(config_url)'
{
  "cdn_url": "https://f.vimeocdn.com",
  "vimeo_api_url": "api.vimeo.com",
  "request": {
    "files": {
      "dash": {
        "separate_av": true,
        "streams": [
          {
            "profile": 174,
            "quality": "720p",
            "id": 1199579358,
            "fps": 26
          },
          {
            "profile": 165,
            "quality": "540p",
            "id": 1199579362,
            "fps": 26
          },
          {
            "profile": 164,
            "quality": "360p",
            "id": 1199579357,
            "fps": 26
          }
        ],
        "cdns": {
          "akfire_interconnect_quic": {
            "url": "https://159skyfiregce-vimeo.akamaized.net/exp=1550269109~acl=%2F310786958%2F%2A~hmac=10375d26dd2facfbc56f4679bbd499c1c7d247241fcb5ff4625b261938dddedf/310786958/sep/video/1199579357,1199579362,1199579358/master.json?base64_init=1",
            "origin": "gcs"
          },
          "fastly_skyfire": {
            "url": "https://skyfire.vimeocdn.com/1550269109-0xd8adc2fcdb2097423810a761f7acf027f3d4afa4/310786958/sep/video/1199579357,1199579362,1199579358/master.json?base64_init=1",
            "origin": "gcs"
          }
        },
        "default_cdn": "fastly_skyfire"
      },
      "hls": {
        "separate_av": false,
        "default_cdn": "fastly_skyfire",
        "cdns": {
          "akfire_interconnect_quic": {
            "url": "https://159skyfiregce-vimeo.akamaized.net/exp=1550269108~acl=%2F310786958%2F%2A~hmac=3643cf1b938be5abb2c693e938bf6390dcb37920d2f996bbfc0dc8c25f64d038/310786958/video/1199579357,1199579362,1199579358/master.m3u8",
            "origin": "gcs"
          },
          "fastly_skyfire": {
            "url": "https://skyfire.vimeocdn.com/1550269108-0x21f9d0c98d36eb5ed9d026def87f36013fd94d72/310786958/video/1199579357,1199579362,1199579358/master.m3u8",
            "origin": "gcs"
          }
        }
      },
      "progressive": [
        {
          "profile": 165,
          "width": 960,
          "mime": "video/mp4",
          "fps": 26,
          "url": "https://fpdl.vimeocdn.com/vimeo-prod-skyfire-std-us/01/2157/12/310786958/1199579362.mp4?token=1550269108-0xd5a1c4a70f17fc27c438fa905b5826d207716885",
          "cdn": "fastly",
          "quality": "540p",
          "id": 1199579362,
          "origin": "gcs",
          "height": 540
        },
        {
          "profile": 174,
          "width": 1280,
          "mime": "video/mp4",
          "fps": 26,
          "url": "https://fpdl.vimeocdn.com/vimeo-prod-skyfire-std-us/01/2157/12/310786958/1199579358.mp4?token=1550269108-0x0d89a8d1dcc029be78142290df1c12b5c8c2c92e",
          "cdn": "fastly",
          "quality": "720p",
          "id": 1199579358,
          "origin": "gcs",
          "height": 720
        },
        {
          "profile": 164,
          "width": 640,
          "mime": "video/mp4",
          "fps": 26,
          "url": "https://fpdl.vimeocdn.com/vimeo-prod-skyfire-std-us/01/2157/12/310786958/1199579357.mp4?token=1550269108-0x27a090e441f5b0987cbf9c4b75e83aa84265b4b1",
          "cdn": "fastly",
          "quality": "360p",
          "id": 1199579357,
          "origin": "gcs",
          "height": 360
        }
      ]
    },
    [...]
  },
  [...]

$ xidel -s "https://vimeo.com/310786958" --xquery 'json(//script/extract(.,"clip_page_config = (.+);",1)[.])/{"name":clip/title,"date":replace(clip/uploaded_on,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"duration":clip/duration/formatted,"formats":player/json(config_url)//files/(let $a:=hls/(.//url)[1] return [for $x at $i in (progressive)() order by $x/width count $i return $x/{"format":"pg-"||$i,"container":"mp4[h264+aac]","resolution":concat(width,"x",height,"@",fps,"fps"),"url":url},{"format":"hls-0","container":"m3u8[manifest]","url":$a},tail(tokenize(unparsed-text($a),"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":"m3u8[h264+aac]","resolution":concat(extract(.,"RESOLUTION=([\dx]+)",1),"@",round(number(extract(.,"FRAME-RATE=([\d.]+)",1))),"fps"),"bitrate":round(extract(.,"BANDWIDTH=(\d+)",1) div 1000)||"kbps","url":resolve-uri(extract(.,"(.+m3u8)",1),$a)}])}'
{
  "name": "Staat van het internet 2019",
  "date": "11-01-2019",
  "duration": "01:45:52",
  "formats": [
    {
      "format": "pg-1",
      "container": "mp4[h264+aac]",
      "resolution": "640x360@26fps",
      "url": "https://fpdl.vimeocdn.com/vimeo-prod-skyfire-std-us/01/2157/12/310786958/1199579357.mp4?token=1550277909-0x5509ed9ff7059064392a8e7f6127778f58aa3b5f"
    },
    {
      "format": "pg-2",
      "container": "mp4[h264+aac]",
      "resolution": "960x540@26fps",
      "url": "https://fpdl.vimeocdn.com/vimeo-prod-skyfire-std-us/01/2157/12/310786958/1199579362.mp4?token=1550277909-0x50eb52fc75f7f5ef8a5e0c62705e36a26f8d1b25"
    },
    {
      "format": "pg-3",
      "container": "mp4[h264+aac]",
      "resolution": "1280x720@26fps",
      "url": "https://fpdl.vimeocdn.com/vimeo-prod-skyfire-std-us/01/2157/12/310786958/1199579358.mp4?token=1550277909-0x5307255fb54122d7117e72518070ea3d2ff5ff13"
    },
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://159skyfiregce-vimeo.akamaized.net/exp=1550277909~acl=%2F310786958%2F%2A~hmac=5d194025ee5da2844391ddb41493c9b10a0c2e10036f7492d24b636e68e6d646/310786958/video/1199579357,1199579362,1199579358/master.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360@27fps",
      "bitrate": "720kbps",
      "url": "https://159skyfiregce-vimeo.akamaized.net/exp=1550277909~acl=%2F310786958%2F%2A~hmac=5d194025ee5da2844391ddb41493c9b10a0c2e10036f7492d24b636e68e6d646/310786958/video/1199579357/playlist.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "960x540@27fps",
      "bitrate": "1839kbps",
      "url": "https://159skyfiregce-vimeo.akamaized.net/exp=1550277909~acl=%2F310786958%2F%2A~hmac=5d194025ee5da2844391ddb41493c9b10a0c2e10036f7492d24b636e68e6d646/310786958/video/1199579362/playlist.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "1280x720@27fps",
      "bitrate": "3272kbps",
      "url": "https://159skyfiregce-vimeo.akamaized.net/exp=1550277909~acl=%2F310786958%2F%2A~hmac=5d194025ee5da2844391ddb41493c9b10a0c2e10036f7492d24b636e68e6d646/310786958/video/1199579358/playlist.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  json(
    //script/extract(
      .,
      "clip_page_config = (.+);",
      1
    )[.]
  )/{
    "name":clip/title,
    "date":replace(
      clip/uploaded_on,
      "(\d+)-(\d+)-(\d+).+",
      "$3-$2-$1"
    ),
    "duration":clip/duration/formatted,
    "formats":player/json(config_url)//files/(
      let $a:=hls/(.//url)[1] return [
        for $x at $i in (progressive)()
        order by $x/width
        count $i
        return
        $x/{
          "format":"pg-"||$i,
          "container":"mp4[h264+aac]",
          "resolution":concat(
            width,
            "x",
            height,
            "@",
            fps,
            "fps"
          ),
          "url":url
        },{
          "format":"hls-0",
          "container":"m3u8[manifest]",
          "url":$a
        },
        tail(
          tokenize(
            unparsed-text($a),
            "#EXT-X-STREAM-INF:"
          )
        ) ! {
          "format":"hls-"||position(),
          "container":"m3u8[h264+aac]",
          "resolution":concat(
            extract(
              .,
              "RESOLUTION=([\dx]+)",
              1
            ),
            "@",
            round(
              number(
                extract(
                  .,
                  "FRAME-RATE=([\d.]+)",
                  1
                )
              )
            ),
            "fps"
          ),
          "bitrate":round(
            extract(
              .,
              "BANDWIDTH=(\d+)",
              1
            ) div 1000
          )||"kbps",
          "url":resolve-uri(
            extract(
              .,
              "(.+m3u8)",
              1
            ),
            $a
          )
        }
      ]
    )
  }
'

================================================================================================================================

[nos]

https://nos.nl/video/2263747-dit-is-waarom-het-internet-zich-zo-druk-maakt-over-artikel-13.html

$ xidel -s "https://nos.nl/video/2263747-dit-is-waarom-het-internet-zich-zo-druk-maakt-over-artikel-13.html" -e '{"name":"NOS: "||//h1[ends-with(@class,"__title")],"date":replace(//@datetime,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"formats":let $a:=x:request({"url"://video//@src}) return [{"format":"hls-0","container":"m3u8[manifest]","url":$a/url},tail(tokenize($a/doc,"#EXT-X-STREAM-INF:")) ! {"format":"hls-"||position(),"container":"m3u8[h264+aac]","resolution":extract(.,"RESOLUTION=([\dx]+)",1),"bitrate":let $a:=extract(.,"audio.+?(\d+)\d{3}(?:-video.+?(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract(.,"(.+m3u8)",1),$a/url)}]}'
{
  "name": "NOS: Dit is waarom het internet zich zo druk maakt over artikel 13",
  "date": "16-12-2018",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://adaptive-e50c4b.npostreaming.nl/urishieldv2/l27m3bda2873496a69e8005c68a995000000.180e86c3ad607424229d5601884be61e/o/nos/content/video/2018/12/15/230871-d7a0f430ffd58a6afd83c0983ee7a4e1/230871-d7a0f430ffd58a6afd83c0983ee7a4e1.ism/230871-d7a0f430ffd58a6afd83c0983ee7a4e1.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[h264+aac]",
      "resolution": "640x360",
      "bitrate": "402|128kbps",
      "url": "https://adaptive-e50c4b.npostreaming.nl/urishieldv2/l27m3bda2873496a69e8005c68a995000000.180e86c3ad607424229d5601884be61e/o/nos/content/video/2018/12/15/230871-d7a0f430ffd58a6afd83c0983ee7a4e1/230871-d7a0f430ffd58a6afd83c0983ee7a4e1.ism/230871-d7a0f430ffd58a6afd83c0983ee7a4e1-audio_eng=128000-video_eng=402000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "848x480",
      "bitrate": "899|128kbps",
      "url": "https://adaptive-e50c4b.npostreaming.nl/urishieldv2/l27m3bda2873496a69e8005c68a995000000.180e86c3ad607424229d5601884be61e/o/nos/content/video/2018/12/15/230871-d7a0f430ffd58a6afd83c0983ee7a4e1/230871-d7a0f430ffd58a6afd83c0983ee7a4e1.ism/230871-d7a0f430ffd58a6afd83c0983ee7a4e1-audio_eng=128000-video_eng=899000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "960x540",
      "bitrate": "1294|128kbps",
      "url": "https://adaptive-e50c4b.npostreaming.nl/urishieldv2/l27m3bda2873496a69e8005c68a995000000.180e86c3ad607424229d5601884be61e/o/nos/content/video/2018/12/15/230871-d7a0f430ffd58a6afd83c0983ee7a4e1/230871-d7a0f430ffd58a6afd83c0983ee7a4e1.ism/230871-d7a0f430ffd58a6afd83c0983ee7a4e1-audio_eng=128000-video_eng=1294000.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "1280x720",
      "bitrate": "1795|128kbps",
      "url": "https://adaptive-e50c4b.npostreaming.nl/urishieldv2/l27m3bda2873496a69e8005c68a995000000.180e86c3ad607424229d5601884be61e/o/nos/content/video/2018/12/15/230871-d7a0f430ffd58a6afd83c0983ee7a4e1/230871-d7a0f430ffd58a6afd83c0983ee7a4e1.ism/230871-d7a0f430ffd58a6afd83c0983ee7a4e1-audio_eng=128000-video_eng=1795000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

https://nos.nl/livestream/npo-politiek.html

$ xidel -s "https://nos.nl/livestream/npo-politiek.html" --xquery '{"name":concat("NOS: ",//h1[ends-with(@class,"__title")],if (//video/@data-type="livestream") then " Livestream" else ()),"date":if (//video/@data-type="livestream") then "'$(date "+%d-%m-%Y")'" else replace(//@datetime,"(\d+)-(\d+)-(\d+).+","$3-$2-$1"),"formats":let $a:=x:request({"url"://video/(.//@src,@data-stream)}) return [{"format":"hls-0","container":"m3u8[manifest]","url":$a/url},for $x at $i in tail(tokenize($a/doc,"#EXT-X-STREAM-INF:")) order by extract($x,"BANDWIDTH=(\d+)",1) count $i return {"format":"hls-"||$i,"container":if (contains($x,"avc1")) then "m3u8[h264+aac]" else "m3u8[aac]","resolution":extract($x,"RESOLUTION=([\dx]+)",1)[.],"bitrate":let $a:=extract($x,"audio.+?(\d+)\d{3}(?:-video.+?(\d+)\d{3})?",(1,2)) return join(($a[2][.],$a[1]),"|")||"kbps","url":resolve-uri(extract($x,"(.+m3u8)",1),$a/url)}]}'
{
  "name": "NOS: NPO Politiek Livestream",
  "date": "17-02-2019",
  "formats": [
    {
      "format": "hls-0",
      "container": "m3u8[manifest]",
      "url": "https://smoote2a.omroep.nl/urishieldv2/l2fm5a9ad3376a60dddd005c68afb9000000.3834dd60014701e58b841c9362ed84cc/live/npo/thematv/politiek24/politiek24.isml/politiek24.m3u8"
    },
    {
      "format": "hls-1",
      "container": "m3u8[aac]",
      "resolution": null,
      "bitrate": "128kbps",
      "url": "https://smoote2a.omroep.nl/urishieldv2/l2fm5a9ad3376a60dddd005c68afb9000000.3834dd60014701e58b841c9362ed84cc/live/npo/thematv/politiek24/politiek24.isml/politiek24-audio_nld=128000.m3u8"
    },
    {
      "format": "hls-2",
      "container": "m3u8[h264+aac]",
      "resolution": "384x216",
      "bitrate": "200|128kbps",
      "url": "https://smoote2a.omroep.nl/urishieldv2/l2fm5a9ad3376a60dddd005c68afb9000000.3834dd60014701e58b841c9362ed84cc/live/npo/thematv/politiek24/politiek24.isml/politiek24-audio_nld=128000-video=200000.m3u8"
    },
    {
      "format": "hls-3",
      "container": "m3u8[h264+aac]",
      "resolution": "480x270",
      "bitrate": "499|128kbps",
      "url": "https://smoote2a.omroep.nl/urishieldv2/l2fm5a9ad3376a60dddd005c68afb9000000.3834dd60014701e58b841c9362ed84cc/live/npo/thematv/politiek24/politiek24.isml/politiek24-audio_nld=128000-video=499968.m3u8"
    },
    {
      "format": "hls-4",
      "container": "m3u8[h264+aac]",
      "resolution": "768x432",
      "bitrate": "1000|128kbps",
      "url": "https://smoote2a.omroep.nl/urishieldv2/l2fm5a9ad3376a60dddd005c68afb9000000.3834dd60014701e58b841c9362ed84cc/live/npo/thematv/politiek24/politiek24.isml/politiek24-audio_nld=128000-video=1000000.m3u8"
    },
    {
      "format": "hls-5",
      "container": "m3u8[h264+aac]",
      "resolution": "1024x576",
      "bitrate": "1400|128kbps",
      "url": "https://smoote2a.omroep.nl/urishieldv2/l2fm5a9ad3376a60dddd005c68afb9000000.3834dd60014701e58b841c9362ed84cc/live/npo/thematv/politiek24/politiek24.isml/politiek24-audio_nld=128000-video=1400000.m3u8"
    }
  ]
}

------------------------------------------------------------------------------------------------

--xquery '
  {
    "name":concat(
      "NOS: ",
      //h1[ends-with(@class,"__title")],
      if (//video/@data-type="livestream") then
        " Livestream"
      else
        ()
    ),
    "date":if (//video/@data-type="livestream") then
      "'$(date "+%d-%m-%Y")'"
    else
      replace(
        //@datetime,
        "(\d+)-(\d+)-(\d+).+",
        "$3-$2-$1"
      ),
    "formats":let $a:=x:request(
      {
        "url"://video/(
          .//@src,
          @data-stream
        )
      }
    ) return [
      {
        "format":"hls-0",
        "container":"m3u8[manifest]",
        "url":$a/url
      },
      for $x at $i in tail(
        tokenize(
          $a/doc,
          "#EXT-X-STREAM-INF:"
        )
      ) order by extract(
        $x,
        "BANDWIDTH=(\d+)",
        1
      ) count $i
      return {
        "format":"hls-"||$i,
        "container":if (
          contains(
            $x,
            "avc1"
          )
        ) then
          "m3u8[h264+aac]"
        else
          "m3u8[aac]",
        "resolution":extract(
          $x,
          "RESOLUTION=([\dx]+)",
          1
        )[.],
        "bitrate":let $a:=extract(
          $x,
          "audio.+?(\d+)\d{3}(?:-video.+?(\d+)\d{3})?",
          (1,2)
        ) return
        join(
          (
            $a[2][.],
            $a[1]
          ),
          "|"
        )||"kbps",
        "url":resolve-uri(
          extract(
            $x,
            "(.+m3u8)",
            1
          ),
          $a/url
        )
      }
    ]
  }
'

================================================================================================================================

[dumpert]

https://www.dumpert.nl/mediabase/7629097/eca3888b/monfils_wint_abn_amro_in_stijl.html

$ xidel -s -H "Cookie: nsfw=1;cpc=10" "http://www.dumpert.nl/mediabase/6678198/4301bfad/goud._dafne_schippers_wint_200m_bejing_.html" --xquery '{"name":"Dumpert: "||//div[@class="dump-desc"]/h1,"date":let $a:={"januari":"01","februari":"02","maart":"03","april":"04","mei":"05","juni":"06","juli":"07","augustus":"08","september":"09","oktober":"10","november":"11","december":"12"},$b:=tokenize(//p[@class="dump-pub"]," ") return join((if ($b[1]<10) then '0'||$b[1] else $b[1],$a($b[2]),$b[3]),"-"),"formats":let $a:=json(binary-to-string(base64Binary(//@data-files))) for $x at $i in ("flv","mobile","tablet","720p") ! $a(.) return {"format":"pg-"||$i,"container":extract($x,".+\.(.+)",1)||"[h264+aac]","url":$x}}'
{
  "name": "Dumpert: GOUD. Dafne Schippers wint 200m Bejing!",
  "date": "28-08-2015",
  "formats": [
    {
      "format": "pg-1",
      "container": "flv[h264+aac]",
      "url": "https://media.dumpert.nl/flv/4301bfad_schippers.mp4.mp4.flv"
    },
    {
      "format": "pg-2",
      "container": "mp4[h264+aac]",
      "url": "https://media.dumpert.nl/mobile/4301bfad_schippers.mp4.mp4.mp4"
    },
    {
      "format": "pg-3",
      "container": "mp4[h264+aac]",
      "url": "https://media.dumpert.nl/tablet/4301bfad_schippers.mp4.mp4.mp4"
    },
    {
      "format": "pg-4",
      "container": "mp4[h264+aac]",
      "url": "https://media.dumpert.nl/720p/4301bfad_schippers.mp4.mp4.mp4"
    }
  ]
}

https://www.dumpert.nl/embed/6678198/4301bfad/

Gebruik altijd de non-embedded url als bron.

$ xidel -s -H "Cookie: nsfw=1;cpc=10" "https://www.dumpert.nl/embed/6678198/4301bfad/" --xquery '(if (//body[@id="embed"]) then doc(//meta[@property="og:url"]/@content) else .)/{"name":"Dumpert: "||//div[@class="dump-desc"]/h1,"date":let $a:={"januari":"01","februari":"02","maart":"03","april":"04","mei":"05","juni":"06","juli":"07","augustus":"08","september":"09","oktober":"10","november":"11","december":"12"},$b:=tokenize(//p[@class="dump-pub"]," ") return join((if ($b[1]<10) then '0'||$b[1] else $b[1],$a($b[2]),$b[3]),"-"),"formats":let $a:=json(binary-to-string(base64Binary(//@data-files))) for $x at $i in ("flv","mobile","tablet","720p") ! $a(.) return {"format":"pg-"||$i,"container":extract($x,".+\.(.+)",1)||"[h264+aac]","url":$x}}'

https://www.dumpert.nl/mediabase/7627779/f41e160c/keiglad_hier_dfjw_mee_met_de_zoutstrooiers.html (embedded youtube video)

$ xidel -s -H "Cookie: nsfw=1;cpc=10" "https://www.dumpert.nl/mediabase/7627779/f41e160c/keiglad_hier_dfjw_mee_met_de_zoutstrooiers.html" --xquery '(if (//body[@id="embed"]) then doc(//meta[@property="og:url"]/@content) else .)/(if (//iframe) then replace(//iframe/@src,".+/(.+)\?.+","https://youtu.be/$1") else {"name":"Dumpert: "||//div[@class="dump-desc"]/h1,"date":let $a:={"januari":"01","februari":"02","maart":"03","april":"04","mei":"05","juni":"06","juli":"07","augustus":"08","september":"09","oktober":"10","november":"11","december":"12"},$b:=tokenize(//p[@class="dump-pub"]," ") return join((if ($b[1]<10) then '0'||$b[1] else $b[1],$a($b[2]),$b[3]),"-"),"formats":let $a:=json(binary-to-string(base64Binary(//@data-files))) for $x at $i in ("flv","mobile","tablet","720p") ! $a(.) return {"format":"pg-"||$i,"container":extract($x,".+\.(.+)",1)||"[h264+aac]","url":$x}})'
https://youtu.be/CZ_9DCl6O4M

------------------------------------------------------------------------------------------------

--xquery '
  (
    if (//body[@id="embed"]) then
      doc(//meta[@property="og:url"]/@content)
    else
      .
  )/(
    if (//iframe) then
      replace(
        //iframe/@src,
        ".+/(.+)\?.+",
        "https://youtu.be/$1"
      )
    else {
      "name":"Dumpert: "||//div[@class="dump-desc"]/h1,
      "date":let $a:={
            "januari":"01",
            "februari":"02",
            "maart":"03",
            "april":"04",
            "mei":"05",
            "juni":"06",
            "juli":"07",
            "augustus":"08",
            "september":"09",
            "oktober":"10",
            "november":"11",
            "december":"12"
          },
          $b:=tokenize(
            //p[@class="dump-pub"],
            " "
          )
      return
      join(
        (
          if ($b[1]<10) then
            '0'||$b[1]
          else
            $b[1],
          $a($b[2]),
          $b[3]
        ),
        "-"
      ),
      "formats":let $a:=json(
        binary-to-string(
          base64Binary(//@data-files)
        )
      )
      for $x at $i in (
        "flv",
        "mobile",
        "tablet",
        "720p"
      ) ! $a(.)
      return {
        "format":"pg-"||$i,
        "container":extract(
          $x,
          ".+\.(.+)",
          1
        )||"[h264+aac]",
        "url":$x
      }
    }
  )
'
